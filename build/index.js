var MK=Object.defineProperty;var F0=(K,Q)=>{for(var $ in Q)MK(K,$,{get:Q[$],enumerable:!0,configurable:!0,set:(Z)=>Q[$]=()=>Z})};class g{disposables;own(K){if(!this.disposables)this.disposables=new Set;return this.disposables.add(K),K}addOnDestroy(K){this.disposables?.add({destroy:K})}destroy(){this.disposables?.forEach((K)=>K.destroy())}}var E=globalThis.WebGL2RenderingContext??{},h0="position_and_tex",S0="index",P0="transform",I0="slotSize_and_number",w0="cam",p0="projection",v0="maxTextureSize",g0="uTextures";var GK=function(K,Q,$){function Z(P,X){function O(U){return U===K?.VERTEX_SHADER?"vertex":U===K?.FRAGMENT_SHADER?"fragment":void 0}if(X!==K.VERTEX_SHADER&&X!==K.FRAGMENT_SHADER)throw new Error(`Shader error in ${O(X)}`);const W=K.createShader(X);if(!W)throw new Error(`Unable to generate ${O(X)} shader.`);if(K.shaderSource(W,P),K.compileShader(W),!K.getShaderParameter(W,K.COMPILE_STATUS))console.error(`Shader compile error in ${O(X)}:`+K.getShaderInfoLog(W));return W}const J=K.createProgram();if(!J)throw new Error("Unable to create program.");const V=Z(Q,K.VERTEX_SHADER),Y=Z($,K.FRAGMENT_SHADER),B=K.getShaderInfoLog(V),F=K.getShaderInfoLog(Y);if(B)console.log("VERTEX",B);if(F)console.log("FRAGMENT",F);K.attachShader(J,V),K.attachShader(J,Y),K.linkProgram(J);const C=K.getProgramInfoLog(J);if(C)console.log("PROGRAM",C);if(K.detachShader(J,V),K.detachShader(J,Y),K.deleteShader(V),K.deleteShader(Y),K.validateProgram(J),Object.entries(E).forEach(([P,X])=>{if(X&&K.getError()===X)console.log(`gl.${P}`)}),!K.getProgramParameter(J,K.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+K.getProgramInfoLog(J));return J},TK=function(K,Q){K.deleteProgram(Q)};class C0 extends g{gl;program;constructor(K,Q,$){super();this.gl=K,this.program=GK(K,Q.trim(),$.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),TK(this.gl,this.program)}}class X0 extends g{activeProgramId="";gl;programs={};constructor(K){super();this.gl=K}addProgram(K,Q,$){if(this.programs[K])this.removeProgram(K);this.programs[K]=this.own(new C0(this.gl,Q,$))}useProgram(K){if(this.activeProgramId!==K)this.activeProgramId=K,this.programs[K].use()}removeProgram(K){this.programs[K].destroy(),delete this.programs[K]}getProgram(K){return this.programs[K??this.activeProgramId]?.program}}class H0 extends g{gl;triangleArray;constructor(K){super();this.gl=K,this.triangleArray=K.createVertexArray(),K.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class O0 extends g{bufferRecord={};lastBoundBuffer;gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getAttributeLocation(K,Q){const $=this.programs.getProgram(Q);return $?this.gl.getAttribLocation($,K)??-1:-1}createBuffer(K){this.deleteBuffer(K);const Q=this.gl?.createBuffer();if(!Q)throw new Error(`Unable to create buffer "${K}"`);const $={buffer:Q,location:this.getAttributeLocation(K)};return this.bufferRecord[K]=$,$}deleteBuffer(K){if(this.bufferRecord[K])this.gl.deleteBuffer(this.bufferRecord[K].buffer),delete this.bufferRecord[K]}getAttributeBuffer(K,Q){const $=this.bufferRecord[K];if(!$){if(Q)return this.createBuffer(K);throw new Error(`Attribute "${K}" not created. Make sure "createBuffer" is called.`)}return $}bufferData(K,Q,$,Z,J){const V=this.getAttributeBuffer(Q);if($)this.gl.bufferData(K,$,J);else this.gl.bufferData(K,Z,J);V.bufferSize=Z||$?.length,V.bufferArray=$??new Float32Array(V.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),V.usage=J,V.target=K}bufferSubData(K,Q,$,Z,J){if(Z)this.gl.bufferSubData(K,$,Q,Z,J);else this.gl.bufferSubData(K,$,Q)}bindBuffer(K,Q){if(this.lastBoundBuffer!==Q)this.lastBoundBuffer=Q,this.gl.bindBuffer(K,Q.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((K)=>this.deleteBuffer(K))}}class W0 extends g{gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getUniformLocation(K,Q){const $=this.programs.getProgram(Q);return this.gl.getUniformLocation($,K)}}function f0(K,Q=($)=>$.key){var $=[];return U0(K,"",!0,(Z)=>$.push(Z),Q),$.join("")}var U0=function(K,Q,$,Z,J){if(K){Z(`${Q}${$?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${J(K)}\n`);const V=Q+($?"    ":"\u2502   ");if(K.left)U0(K.left,V,!1,Z,J);if(K.right)U0(K.right,V,!0,Z,J)}};function u(K){if(K===null)return!0;var Q=o(K.left),$=o(K.right);if(Math.abs(Q-$)<=1&&u(K.left)&&u(K.right))return!0;return!1}var o=function(K){return K?1+Math.max(o(K.left),o(K.right)):0};function a(K,Q,$,Z,J){const V=J-Z;if(V>0){const Y=Z+Math.floor(V/2),B=Q[Y],F=$[Y],C={key:B,data:F,parent:K};return C.left=a(C,Q,$,Z,Y),C.right=a(C,Q,$,Y+1,J),C}return null}function t(K){if(K===null)return 0;const Q=t(K.left),$=t(K.right);return K.balanceFactor=Q-$,Math.max(Q,$)+1}function K0(K,Q,$,Z,J){if($>=Z)return;const V=K[$+Z>>1];let Y=$-1,B=Z+1;while(!0){do Y++;while(J(K[Y],V)<0);do B--;while(J(K[B],V)>0);if(Y>=B)break;let F=K[Y];K[Y]=K[B],K[B]=F,F=Q[Y],Q[Y]=Q[B],Q[B]=F}K0(K,Q,$,B,J),K0(K,Q,B+1,Z,J)}var kK=function(K,Q){return K>Q?1:K<Q?-1:0},Q0=function(K){var Q=K.right;if(K.right=Q.left,Q.left)Q.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.left=K,K.balanceFactor+=1,Q.balanceFactor<0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor+=1,K.balanceFactor>0)Q.balanceFactor+=K.balanceFactor;return Q},$0=function(K){var Q=K.left;if(K.left=Q.right,K.left)K.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.right=K,K.balanceFactor-=1,Q.balanceFactor>0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor-=1,K.balanceFactor<0)Q.balanceFactor+=K.balanceFactor;return Q};class l{constructor(K,Q=!1){this._comparator=K||kK,this._root=null,this._size=0,this._noDuplicates=!!Q}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(K){if(this._root){var Q=this._root,$=this._comparator;while(Q){var Z=$(K,Q.key);if(Z===0)return!0;else if(Z<0)Q=Q.left;else Q=Q.right}}return!1}next(K){var Q=K;if(Q)if(Q.right){Q=Q.right;while(Q.left)Q=Q.left}else{Q=K.parent;while(Q&&Q.right===K)K=Q,Q=Q.parent}return Q}prev(K){var Q=K;if(Q)if(Q.left){Q=Q.left;while(Q.right)Q=Q.right}else{Q=K.parent;while(Q&&Q.left===K)K=Q,Q=Q.parent}return Q}forEach(K){var Q=this._root,$=[],Z=!1,J=0;while(!Z)if(Q)$.push(Q),Q=Q.left;else if($.length>0)Q=$.pop(),K(Q,J++),Q=Q.right;else Z=!0;return this}range(K,Q,$,Z){const J=[],V=this._comparator;let Y=this._root,B;while(J.length!==0||Y)if(Y)J.push(Y),Y=Y.left;else{if(Y=J.pop(),B=V(Y.key,Q),B>0)break;else if(V(Y.key,K)>=0){if($.call(Z,Y))return this}Y=Y.right}return this}keys(){var K=this._root,Q=[],$=[],Z=!1;while(!Z)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.key),K=K.right;else Z=!0;return $}values(){var K=this._root,Q=[],$=[],Z=!1;while(!Z)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.data),K=K.right;else Z=!0;return $}at(K){var Q=this._root,$=[],Z=!1,J=0;while(!Z)if(Q)$.push(Q),Q=Q.left;else if($.length>0){if(Q=$.pop(),J===K)return Q;J++,Q=Q.right}else Z=!0;return null}minNode(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K}maxNode(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K}min(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K.key}max(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K.key}isEmpty(){return!this._root}pop(){var K=this._root,Q=null;if(K){while(K.left)K=K.left;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}popMax(){var K=this._root,Q=null;if(K){while(K.right)K=K.right;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}find(K){var Q=this._root,$=Q,Z,J=this._comparator;while($)if(Z=J(K,$.key),Z===0)return $;else if(Z<0)$=$.left;else $=$.right;return null}insert(K,Q){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:K,data:Q},this._size++,this._root;var $=this._comparator,Z=this._root,J=null,V=0;if(this._noDuplicates)while(Z)if(V=$(K,Z.key),J=Z,V===0)return null;else if(V<0)Z=Z.left;else Z=Z.right;else while(Z)if(V=$(K,Z.key),J=Z,V<=0)Z=Z.left;else Z=Z.right;var Y={left:null,right:null,balanceFactor:0,parent:J,key:K,data:Q},B;if(V<=0)J.left=Y;else J.right=Y;while(J){if(V=$(J.key,K),V<0)J.balanceFactor-=1;else J.balanceFactor+=1;if(J.balanceFactor===0)break;else if(J.balanceFactor<-1){if(J.right.balanceFactor===1)$0(J.right);if(B=Q0(J),J===this._root)this._root=B;break}else if(J.balanceFactor>1){if(J.left.balanceFactor===-1)Q0(J.left);if(B=$0(J),J===this._root)this._root=B;break}J=J.parent}return this._size++,Y}remove(K){if(!this._root)return null;var Q=this._root,$=this._comparator,Z=0;while(Q)if(Z=$(K,Q.key),Z===0)break;else if(Z<0)Q=Q.left;else Q=Q.right;if(!Q)return null;var J=Q.key,V,Y;if(Q.left){V=Q.left;while(V.left||V.right){while(V.right)V=V.right;if(Q.key=V.key,Q.data=V.data,V.left)Q=V,V=V.left}Q.key=V.key,Q.data=V.data,Q=V}if(Q.right){Y=Q.right;while(Y.left||Y.right){while(Y.left)Y=Y.left;if(Q.key=Y.key,Q.data=Y.data,Y.right)Q=Y,Y=Y.right}Q.key=Y.key,Q.data=Y.data,Q=Y}var B=Q.parent,F=Q,C;while(B){if(B.left===F)B.balanceFactor-=1;else B.balanceFactor+=1;if(B.balanceFactor<-1){if(B.right.balanceFactor===1)$0(B.right);if(C=Q0(B),B===this._root)this._root=C;B=C}else if(B.balanceFactor>1){if(B.left.balanceFactor===-1)Q0(B.left);if(C=$0(B),B===this._root)this._root=C;B=C}if(B.balanceFactor===-1||B.balanceFactor===1)break;F=B,B=B.parent}if(Q.parent)if(Q.parent.left===Q)Q.parent.left=null;else Q.parent.right=null;if(Q===this._root)this._root=null;return this._size--,J}load(K=[],Q=[],$){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const Z=K.length;if($)K0(K,Q,0,Z-1,this._comparator);return this._root=a(null,K,Q,0,Z),t(this._root),this._size=Z,this}isBalanced(){return u(this._root)}toString(K){return f0(this._root,K)}}l.default=l;class y{size;slotNumber;x;y;textureIndex;parent;sibbling;textureSizeLimits;constructor(K,Q,$,Z){this.textureSizeLimits=$?.textureSizeLimits??Z??{min:D0,max:j0},this.size=K,this.slotNumber=Q,this.parent=$,this.sibbling=void 0;const{x:J,y:V,textureIndex:Y}=this.calculatePosition(K,Q);this.x=J,this.y=V,this.textureIndex=Y}calculateTextureIndex(K,Q){const[$,Z]=K,J=this.textureSizeLimits.max/$*(this.textureSizeLimits.max/Z);return Math.floor(Q/J)}calculatePosition(K,Q){const[$,Z]=K,J=this.textureSizeLimits.max/$,V=this.textureSizeLimits.max/Z,Y=Q%J*$,B=Math.floor(Q/J)%V*Z;return{x:Y,y:B,textureIndex:this.calculateTextureIndex(K,Q)}}getTag(){return y.getTag(this)}static getTag(K){return`${K.size[0]}x${K.size[1]}-#${K.slotNumber}`}static positionToTextureSlot(K,Q,$,Z,J){const[V,Y]=$,B=J.textureSizeLimits.max/V,C=J.textureSizeLimits.max/V*(J.textureSizeLimits.max/Y)*Z+Q/Y*B+K/V;return new y($,C,J)}getPosition(){return{x:this.x,y:this.y,size:this.size,textureIndex:this.textureIndex}}canSplitHorizontally(){const[,K]=this.size;return K>this.textureSizeLimits.min}canSplitVertically(){const[K]=this.size;return K>this.textureSizeLimits.min}splitHorizontally(){const{x:K,y:Q,size:$,textureIndex:Z}=this,[J,V]=$;if(!this.canSplitHorizontally())throw new Error(`Cannot split texture slot of size ${J} horizontally`);const Y=J/2,B=y.positionToTextureSlot(K,Q,[Y,V],Z,this),F=y.positionToTextureSlot(K+Y,Q,[Y,V],Z,this);return B.sibbling=F,F.sibbling=B,[B,F]}splitVertically(){const{x:K,y:Q,size:$,textureIndex:Z}=this,[J,V]=$;if(!this.canSplitVertically())throw new Error(`Cannot split texture slot of size ${V} vertically`);const Y=V/2,B=y.positionToTextureSlot(K,Q,[J,Y],Z,this),F=y.positionToTextureSlot(K,Q+Y,[J,Y],Z,this);return B.sibbling=F,F.sibbling=B,[B,F]}}function Z0(K,Q){return Math.max(Q,Math.pow(2,Math.ceil(Math.log(K)/Math.log(2))))}function z0(K,Q,$,Z){if($<1)throw new Error("Invalid count");const J=Z0(K,Z.min),V=Z0(Q,Z.min),Y=new Map;let B=Z.min;for(let F=1;F<=$;F++){B=Z0(J*F,Z.min);const C=Z0(V*Math.ceil($/F),Z.min);Y.set(B,C)}for(let F=B;F<=Z.max;F*=2)if(!Y.has(F))Y.set(F,V);return Y}var qK=!1,D0=16,j0=4096,LK=16;class E0{textureSlots=new l((K,Q)=>{const $=K.size[0]*K.size[1]-Q.size[0]*Q.size[1];if($!==0)return $;return K.slotNumber-Q.slotNumber},!1);allocatedTextures={};minTextureSize;maxTextureSize;numTextureSheets;initialSlots=[];constructor({numTextureSheets:K,minTextureSize:Q,maxTextureSize:$}={},Z){if(this.numTextureSheets=K??LK,this.minTextureSize=Q??D0,this.maxTextureSize=$??j0,Z)this.numTextureSheets=Math.min(this.numTextureSheets,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_IMAGE_UNITS)),this.maxTextureSize=Math.min(this.maxTextureSize,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_SIZE)),this.minTextureSize=Math.min(this.minTextureSize,this.maxTextureSize);for(let J=0;J<this.numTextureSheets;J++)this.initialSlots.push(new y([this.maxTextureSize,this.maxTextureSize],J,void 0,{min:this.minTextureSize,max:this.maxTextureSize}));this.initialSlots.forEach((J)=>this.textureSlots.insert(J))}allocate(K,Q,$=1){const{size:Z,slotNumber:J,x:V,y:Y,textureIndex:B}=this.allocateHelper(K,Q,$);return{size:Z,slotNumber:J,x:V,y:Y,textureIndex:B}}deallocate(K){if(!this.isSlotUsed(K))throw new Error("Slot is not allocated");const Q=this.allocatedTextures[y.getTag(K)];this.deallocateHelper(Q)}get countUsedTextureSheets(){return this.initialSlots.filter((K)=>this.isSlotUsed(K)).length}allocateHelper(K,Q,$=1){const Z=z0(K,Q,$,{min:this.minTextureSize,max:this.maxTextureSize}),J=this.findSlot(Z);if(!J)throw new Error(`Could not find a slot for texture to fit ${$} sprites of size ${K}x${Q}`);this.textureSlots.remove(J);const[V,Y]=this.bestFit(Z,J);return this.fitSlot(J,V,Y)}findSlot(K){for(let Q=0;Q<this.textureSlots.size;Q++){const Z=this.textureSlots.at(Q).key,[J,V]=Z.size;if(K.get(J)<=V)return Z}return null}calculateRatio(K,Q){return Math.max(K/Q,Q/K)}bestFit(K,Q){const[$,Z]=Q.size;let J=Q.textureSizeLimits.max;return K.forEach((V,Y)=>{if(Y<=$&&V<=Z){const B=Y*V,F=K.get(J)*J;if(B<F)J=Y;else if(B===F){if(this.calculateRatio(Y,V)<this.calculateRatio(J,K.get(J)))J=Y}}}),[J,K.get(J)]}isSlotUsed(K){return!!this.allocatedTextures[y.getTag(K)]}deallocateHelper(K){if(K.parent&&K.sibbling&&!this.isSlotUsed(K.sibbling)){const Q=K.sibbling;if(this.textureSlots.remove(Q),qK&&this.textureSlots.find(K))throw new Error("Slot is not expected to be in the tree");const $=K.parent;this.deallocateHelper($);return}this.textureSlots.insert(K),delete this.allocatedTextures[K.getTag()]}trySplitHorizontally(K,Q,$){if(K.canSplitHorizontally()){const[Z,J]=K.splitHorizontally();if(Z.size[0]>=Q)return this.textureSlots.insert(J),this.fitSlot(Z,Q,$)}return null}trySplitVertically(K,Q,$){if(K.canSplitVertically()){const[Z,J]=K.splitVertically();if(Z.size[1]>=$)return this.textureSlots.insert(J),this.fitSlot(Z,Q,$)}return null}fitSlot(K,Q,$){if(this.allocatedTextures[K.getTag()]=K,K.size[0]>K.size[1]){const Z=this.trySplitHorizontally(K,Q,$)??this.trySplitVertically(K,Q,$);if(Z)return Z}else{const Z=this.trySplitVertically(K,Q,$)??this.trySplitHorizontally(K,Q,$);if(Z)return Z}return K}listSlots(){this.textureSlots.forEach((K)=>{console.log(K.key?.getTag())})}}class A0 extends g{gl;uniforms;textureBuffers={};tempContext=new OffscreenCanvas(1,1).getContext("2d");textureSlotAllocator=new E0;constructor(K,Q){super();this.gl=K,this.uniforms=Q,this.tempContext.imageSmoothingEnabled=!0}initialize(){this.initTextureUniforms(),this.initMaxTexture()}getTexture(K){if(!this.textureBuffers[K]){const Q=this.gl.createTexture();if(!Q)return;this.gl.bindTexture(E.TEXTURE_2D,Q),this.gl.texImage2D(E.TEXTURE_2D,0,E.RGBA,this.textureSlotAllocator.maxTextureSize,this.textureSlotAllocator.maxTextureSize,0,E.RGBA,E.UNSIGNED_BYTE,null),this.textureBuffers[K]=Q,this.addOnDestroy(()=>this.gl.deleteTexture(Q))}return this.textureBuffers[K]}loadTexture(K,Q,$,Z,J){this.gl.activeTexture(E[Q]),this.gl.bindTexture(E.TEXTURE_2D,$),this.applyTexImage2d(K,Z,J),this.gl.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR)}applyTexImage2d(K,[Q,$,Z,J],[V,Y,B,F]){if(Z===B&&J===F&&!Q&&!$)this.gl.texSubImage2D(E.TEXTURE_2D,0,V,Y,B,F,E.RGBA,E.UNSIGNED_BYTE,K.texImgSrc);else{const C=this.tempContext.canvas;if(K.texImgSrc instanceof ImageData){if(C.width=B||K.width,C.height=F||K.height,this.tempContext.putImageData(K.texImgSrc,0,0),Q||$)console.warn("Offset not available when sending imageData")}else{const P=Z||K.width,X=J||K.height;C.width=B||P,C.height=F||X,this.tempContext.drawImage(K.texImgSrc,Q,$,P,X,0,0,C.width,C.height)}this.gl.texSubImage2D(E.TEXTURE_2D,0,V,Y,C.width,C.height,E.RGBA,E.UNSIGNED_BYTE,C)}}allocateSlotForImage(K){const Q=this.textureSlotAllocator.allocate(K.width,K.height),$=`TEXTURE${Q.textureIndex}`,Z=this.getTexture($);if(!Z)throw new Error(`Invalid texture Id ${$}`);const J=this.assignImageToTexture(K,$,Z,[0,0,K.width,K.height],[Q.x,Q.y,...Q.size]);return{slot:Q,refreshCallback:J}}assignImageToTexture(K,Q,$,Z,J){if(K){const V=Z??[0,0,K.width,K.height],Y=J??[0,0,V[2],V[3]];if(K.active){const B=()=>{this.gl.bindTexture(E.TEXTURE_2D,$),this.applyTexImage2d(K,V,Y)};return B(),B}else this.loadTexture(K,Q,$,V,Y),K.active=!0}return null}generateMipMap(K){const Q=this.getTexture(K);if(Q)this.gl.activeTexture(E[K]),this.gl.bindTexture(E.TEXTURE_2D,Q),this.gl.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR),this.gl.generateMipmap(E.TEXTURE_2D),console.log("GENERATED MIPMAP")}generateMipMaps(){const K=this.textureSlotAllocator.countUsedTextureSheets;for(let Q=0;Q<K;Q++){const $=`TEXTURE${Q}`;this.generateMipMap($)}}initTextureUniforms(){const K=this.gl.getParameter(E.MAX_TEXTURE_IMAGE_UNITS),Q=new Array(K).fill(null).map((Z,J)=>J),$=this.uniforms.getUniformLocation(g0);this.gl.uniform1iv($,Q)}initMaxTexture(){const K=this.uniforms.getUniformLocation(v0);this.gl.uniform1f(K,this.textureSlotAllocator.maxTextureSize)}}class x extends g{texImgSrc;active=!1;width;height;constructor(K){super();if(this.texImgSrc=K,this.width=K instanceof Image?K.naturalWidth:K instanceof VideoFrame?K.displayWidth:K.width,this.height=K instanceof Image?K.naturalHeight:K instanceof VideoFrame?K.displayHeight:K.height,!this.width||!this.height)throw new Error("Invalid image")}static createFromCanvas(K){return new x(K)}static async loadImage(K){return new Promise((Q,$)=>{const Z=new Image,J=new x(Z),V=()=>Q(J),Y=(B)=>$(B.error);Z.addEventListener("error",Y),Z.addEventListener("load",V,{once:!0}),J.addOnDestroy(()=>Z.removeEventListener("load",V)),Z.src=K})}static async loadVideo(K,Q){return new Promise(($,Z)=>{const J=document.createElement("video"),V=new x(J);if(J.loop=!0,Q!==void 0)J.volume=Q;const Y=()=>J.play(),B=()=>$(V);J.addEventListener("loadedmetadata",Y),J.addEventListener("playing",B,{once:!0}),J.addEventListener("error",(F)=>Z(F.error)),J.src=K,V.addOnDestroy(()=>{J.pause(),J.removeEventListener("playing",B),J.removeEventListener("loadmetadata",Y)})})}static async loadWebcam(K){return new Promise((Q,$)=>{const Z=document.createElement("video"),J=new x(Z);Z.loop=!0;const V=()=>Z.play(),Y=()=>Q(J);Z.addEventListener("loadedmetadata",V),Z.addEventListener("playing",Y,{once:!0}),Z.addEventListener("error",(F)=>$(F.error));let B=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:K}}).then((F)=>{if(!B)Z.srcObject=F,J.addOnDestroy(()=>F.getTracks().forEach((C)=>C.stop()))}),J.addOnDestroy(()=>{B=!0,Z.pause(),Z.removeEventListener("playing",Y),Z.removeEventListener("loadmetadata",V)})})}}class R0 extends g{constructor(){super(...arguments)}images=[];hasImageId(K){return!!this.getMedia(K)}getMedia(K){return this.images[K]}setImage(K,Q){this.images[K]=Q}async drawImage(K,Q){const $=new OffscreenCanvas(1,1);Q($.getContext("2d"));const Z=x.createFromCanvas($);return this.images[K]=this.own(Z),Z}async loadCanvas(K,Q){const $=x.createFromCanvas(Q);return Q.getContext("2d"),this.images[K]=this.own($),$}async loadImage(K,Q){const $=await x.loadImage(Q);return this.images[K]=this.own($),$}async loadVideo(K,Q,$){const Z=await x.loadVideo(Q,$);return this.images[K]=this.own(Z),Z}async loadWebCam(K,Q){const $=await x.loadWebcam(Q);return this.images[K]=this.own($),$}}var y0=`#version 300 es
//  ~{AUTHOR}

precision highp float;

//  IN
//  shape
layout(location = 0) in vec4 position_and_tex;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec3 slotSize_and_number;

//  UNIFORM
uniform float maxTextureSize;
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  vec2 position = position_and_tex.xy;
  vec2 tex = position_and_tex.zw;
  vec2 slotSize = slotSize_and_number.xy;
  float slotNumber = slotSize_and_number.z;
  float maxCols = maxTextureSize / slotSize.x;
  float maxRows = maxTextureSize / slotSize.y;
  float slotX = mod(slotNumber, maxCols);
  float slotY = mod(floor(slotNumber / maxCols), maxRows);

  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = (vec2(slotX, slotY) + tex) * slotSize / maxTextureSize;
  textureIndex = floor(slotNumber / (maxCols * maxRows));
}
`;var x0=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function _0(K,Q){return K.replace(/~\{(\w+)\}/g,($,Z)=>{return Q?.[Z]||$})}var M=0.000001,k=typeof Float32Array!=="undefined"?Float32Array:Array,m=Math.random,AZ=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var K=0,Q=arguments.length;while(Q--)K+=arguments[Q]*arguments[Q];return Math.sqrt(K)};function c0(){var K=new k(9);if(k!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0;return K[0]=1,K[4]=1,K[8]=1,K}var q={};F0(q,{transpose:()=>{{return zK}},translate:()=>{{return mK}},targetTo:()=>{{return HQ}},subtract:()=>{{return r0}},sub:()=>{{return _Q}},str:()=>{{return OQ}},set:()=>{{return fK}},scale:()=>{{return lK}},rotateZ:()=>{{return sK}},rotateY:()=>{{return nK}},rotateX:()=>{{return iK}},rotate:()=>{{return dK}},perspectiveZO:()=>{{return BQ}},perspectiveNO:()=>{{return n0}},perspectiveFromFieldOfView:()=>{{return FQ}},perspective:()=>{{return YQ}},orthoZO:()=>{{return CQ}},orthoNO:()=>{{return s0}},ortho:()=>{{return PQ}},multiplyScalarAndAdd:()=>{{return jQ}},multiplyScalar:()=>{{return DQ}},multiply:()=>{{return l0}},mul:()=>{{return RQ}},lookAt:()=>{{return XQ}},invert:()=>{{return yK}},identity:()=>{{return m0}},getTranslation:()=>{{return KQ}},getScaling:()=>{{return i0}},getRotation:()=>{{return QQ}},frustum:()=>{{return VQ}},fromZRotation:()=>{{return aK}},fromYRotation:()=>{{return oK}},fromXRotation:()=>{{return uK}},fromValues:()=>{{return gK}},fromTranslation:()=>{{return rK}},fromScaling:()=>{{return bK}},fromRotationTranslationScaleOrigin:()=>{{return ZQ}},fromRotationTranslationScale:()=>{{return $Q}},fromRotationTranslation:()=>{{return d0}},fromRotation:()=>{{return eK}},fromQuat2:()=>{{return tK}},fromQuat:()=>{{return JQ}},frob:()=>{{return WQ}},exactEquals:()=>{{return EQ}},equals:()=>{{return AQ}},determinant:()=>{{return cK}},create:()=>{{return wK}},copy:()=>{{return vK}},clone:()=>{{return pK}},adjoint:()=>{{return xK}},add:()=>{{return UQ}}});function wK(){var K=new k(16);if(k!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0;return K[0]=1,K[5]=1,K[10]=1,K[15]=1,K}function pK(K){var Q=new k(16);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function vK(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function gK(K,Q,$,Z,J,V,Y,B,F,C,P,X,O,W,U,D){var H=new k(16);return H[0]=K,H[1]=Q,H[2]=$,H[3]=Z,H[4]=J,H[5]=V,H[6]=Y,H[7]=B,H[8]=F,H[9]=C,H[10]=P,H[11]=X,H[12]=O,H[13]=W,H[14]=U,H[15]=D,H}function fK(K,Q,$,Z,J,V,Y,B,F,C,P,X,O,W,U,D,H){return K[0]=Q,K[1]=$,K[2]=Z,K[3]=J,K[4]=V,K[5]=Y,K[6]=B,K[7]=F,K[8]=C,K[9]=P,K[10]=X,K[11]=O,K[12]=W,K[13]=U,K[14]=D,K[15]=H,K}function m0(K){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function zK(K,Q){if(K===Q){var $=Q[1],Z=Q[2],J=Q[3],V=Q[6],Y=Q[7],B=Q[11];K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=$,K[6]=Q[9],K[7]=Q[13],K[8]=Z,K[9]=V,K[11]=Q[14],K[12]=J,K[13]=Y,K[14]=B}else K[0]=Q[0],K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=Q[1],K[5]=Q[5],K[6]=Q[9],K[7]=Q[13],K[8]=Q[2],K[9]=Q[6],K[10]=Q[10],K[11]=Q[14],K[12]=Q[3],K[13]=Q[7],K[14]=Q[11],K[15]=Q[15];return K}function yK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Q[4],B=Q[5],F=Q[6],C=Q[7],P=Q[8],X=Q[9],O=Q[10],W=Q[11],U=Q[12],D=Q[13],H=Q[14],j=Q[15],G=$*B-Z*Y,N=$*F-J*Y,_=$*C-V*Y,A=Z*F-J*B,R=Z*C-V*B,I=J*C-V*F,L=P*D-X*U,h=P*H-O*U,S=P*j-W*U,p=X*H-O*D,v=X*j-W*D,f=O*j-W*H,T=G*f-N*v+_*p+A*S-R*h+I*L;if(!T)return null;return T=1/T,K[0]=(B*f-F*v+C*p)*T,K[1]=(J*v-Z*f-V*p)*T,K[2]=(D*I-H*R+j*A)*T,K[3]=(O*R-X*I-W*A)*T,K[4]=(F*S-Y*f-C*h)*T,K[5]=($*f-J*S+V*h)*T,K[6]=(H*_-U*I-j*N)*T,K[7]=(P*I-O*_+W*N)*T,K[8]=(Y*v-B*S+C*L)*T,K[9]=(Z*S-$*v-V*L)*T,K[10]=(U*R-D*_+j*G)*T,K[11]=(X*_-P*R-W*G)*T,K[12]=(B*h-Y*p-F*L)*T,K[13]=($*p-Z*h+J*L)*T,K[14]=(D*N-U*A-H*G)*T,K[15]=(P*A-X*N+O*G)*T,K}function xK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Q[4],B=Q[5],F=Q[6],C=Q[7],P=Q[8],X=Q[9],O=Q[10],W=Q[11],U=Q[12],D=Q[13],H=Q[14],j=Q[15];return K[0]=B*(O*j-W*H)-X*(F*j-C*H)+D*(F*W-C*O),K[1]=-(Z*(O*j-W*H)-X*(J*j-V*H)+D*(J*W-V*O)),K[2]=Z*(F*j-C*H)-B*(J*j-V*H)+D*(J*C-V*F),K[3]=-(Z*(F*W-C*O)-B*(J*W-V*O)+X*(J*C-V*F)),K[4]=-(Y*(O*j-W*H)-P*(F*j-C*H)+U*(F*W-C*O)),K[5]=$*(O*j-W*H)-P*(J*j-V*H)+U*(J*W-V*O),K[6]=-($*(F*j-C*H)-Y*(J*j-V*H)+U*(J*C-V*F)),K[7]=$*(F*W-C*O)-Y*(J*W-V*O)+P*(J*C-V*F),K[8]=Y*(X*j-W*D)-P*(B*j-C*D)+U*(B*W-C*X),K[9]=-($*(X*j-W*D)-P*(Z*j-V*D)+U*(Z*W-V*X)),K[10]=$*(B*j-C*D)-Y*(Z*j-V*D)+U*(Z*C-V*B),K[11]=-($*(B*W-C*X)-Y*(Z*W-V*X)+P*(Z*C-V*B)),K[12]=-(Y*(X*H-O*D)-P*(B*H-F*D)+U*(B*O-F*X)),K[13]=$*(X*H-O*D)-P*(Z*H-J*D)+U*(Z*O-J*X),K[14]=-($*(B*H-F*D)-Y*(Z*H-J*D)+U*(Z*F-J*B)),K[15]=$*(B*O-F*X)-Y*(Z*O-J*X)+P*(Z*F-J*B),K}function cK(K){var Q=K[0],$=K[1],Z=K[2],J=K[3],V=K[4],Y=K[5],B=K[6],F=K[7],C=K[8],P=K[9],X=K[10],O=K[11],W=K[12],U=K[13],D=K[14],H=K[15],j=Q*Y-$*V,G=Q*B-Z*V,N=Q*F-J*V,_=$*B-Z*Y,A=$*F-J*Y,R=Z*F-J*B,I=C*U-P*W,L=C*D-X*W,h=C*H-O*W,S=P*D-X*U,p=P*H-O*U,v=X*H-O*D;return j*v-G*p+N*S+_*h-A*L+R*I}function l0(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Q[4],F=Q[5],C=Q[6],P=Q[7],X=Q[8],O=Q[9],W=Q[10],U=Q[11],D=Q[12],H=Q[13],j=Q[14],G=Q[15],N=$[0],_=$[1],A=$[2],R=$[3];return K[0]=N*Z+_*B+A*X+R*D,K[1]=N*J+_*F+A*O+R*H,K[2]=N*V+_*C+A*W+R*j,K[3]=N*Y+_*P+A*U+R*G,N=$[4],_=$[5],A=$[6],R=$[7],K[4]=N*Z+_*B+A*X+R*D,K[5]=N*J+_*F+A*O+R*H,K[6]=N*V+_*C+A*W+R*j,K[7]=N*Y+_*P+A*U+R*G,N=$[8],_=$[9],A=$[10],R=$[11],K[8]=N*Z+_*B+A*X+R*D,K[9]=N*J+_*F+A*O+R*H,K[10]=N*V+_*C+A*W+R*j,K[11]=N*Y+_*P+A*U+R*G,N=$[12],_=$[13],A=$[14],R=$[15],K[12]=N*Z+_*B+A*X+R*D,K[13]=N*J+_*F+A*O+R*H,K[14]=N*V+_*C+A*W+R*j,K[15]=N*Y+_*P+A*U+R*G,K}function mK(K,Q,$){var Z=$[0],J=$[1],V=$[2],Y,B,F,C,P,X,O,W,U,D,H,j;if(Q===K)K[12]=Q[0]*Z+Q[4]*J+Q[8]*V+Q[12],K[13]=Q[1]*Z+Q[5]*J+Q[9]*V+Q[13],K[14]=Q[2]*Z+Q[6]*J+Q[10]*V+Q[14],K[15]=Q[3]*Z+Q[7]*J+Q[11]*V+Q[15];else Y=Q[0],B=Q[1],F=Q[2],C=Q[3],P=Q[4],X=Q[5],O=Q[6],W=Q[7],U=Q[8],D=Q[9],H=Q[10],j=Q[11],K[0]=Y,K[1]=B,K[2]=F,K[3]=C,K[4]=P,K[5]=X,K[6]=O,K[7]=W,K[8]=U,K[9]=D,K[10]=H,K[11]=j,K[12]=Y*Z+P*J+U*V+Q[12],K[13]=B*Z+X*J+D*V+Q[13],K[14]=F*Z+O*J+H*V+Q[14],K[15]=C*Z+W*J+j*V+Q[15];return K}function lK(K,Q,$){var Z=$[0],J=$[1],V=$[2];return K[0]=Q[0]*Z,K[1]=Q[1]*Z,K[2]=Q[2]*Z,K[3]=Q[3]*Z,K[4]=Q[4]*J,K[5]=Q[5]*J,K[6]=Q[6]*J,K[7]=Q[7]*J,K[8]=Q[8]*V,K[9]=Q[9]*V,K[10]=Q[10]*V,K[11]=Q[11]*V,K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function dK(K,Q,$,Z){var J=Z[0],V=Z[1],Y=Z[2],B=Math.hypot(J,V,Y),F,C,P,X,O,W,U,D,H,j,G,N,_,A,R,I,L,h,S,p,v,f,T,z;if(B<M)return null;if(B=1/B,J*=B,V*=B,Y*=B,F=Math.sin($),C=Math.cos($),P=1-C,X=Q[0],O=Q[1],W=Q[2],U=Q[3],D=Q[4],H=Q[5],j=Q[6],G=Q[7],N=Q[8],_=Q[9],A=Q[10],R=Q[11],I=J*J*P+C,L=V*J*P+Y*F,h=Y*J*P-V*F,S=J*V*P-Y*F,p=V*V*P+C,v=Y*V*P+J*F,f=J*Y*P+V*F,T=V*Y*P-J*F,z=Y*Y*P+C,K[0]=X*I+D*L+N*h,K[1]=O*I+H*L+_*h,K[2]=W*I+j*L+A*h,K[3]=U*I+G*L+R*h,K[4]=X*S+D*p+N*v,K[5]=O*S+H*p+_*v,K[6]=W*S+j*p+A*v,K[7]=U*S+G*p+R*v,K[8]=X*f+D*T+N*z,K[9]=O*f+H*T+_*z,K[10]=W*f+j*T+A*z,K[11]=U*f+G*T+R*z,Q!==K)K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K}function iK(K,Q,$){var Z=Math.sin($),J=Math.cos($),V=Q[4],Y=Q[5],B=Q[6],F=Q[7],C=Q[8],P=Q[9],X=Q[10],O=Q[11];if(Q!==K)K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[4]=V*J+C*Z,K[5]=Y*J+P*Z,K[6]=B*J+X*Z,K[7]=F*J+O*Z,K[8]=C*J-V*Z,K[9]=P*J-Y*Z,K[10]=X*J-B*Z,K[11]=O*J-F*Z,K}function nK(K,Q,$){var Z=Math.sin($),J=Math.cos($),V=Q[0],Y=Q[1],B=Q[2],F=Q[3],C=Q[8],P=Q[9],X=Q[10],O=Q[11];if(Q!==K)K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=V*J-C*Z,K[1]=Y*J-P*Z,K[2]=B*J-X*Z,K[3]=F*J-O*Z,K[8]=V*Z+C*J,K[9]=Y*Z+P*J,K[10]=B*Z+X*J,K[11]=F*Z+O*J,K}function sK(K,Q,$){var Z=Math.sin($),J=Math.cos($),V=Q[0],Y=Q[1],B=Q[2],F=Q[3],C=Q[4],P=Q[5],X=Q[6],O=Q[7];if(Q!==K)K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=V*J+C*Z,K[1]=Y*J+P*Z,K[2]=B*J+X*Z,K[3]=F*J+O*Z,K[4]=C*J-V*Z,K[5]=P*J-Y*Z,K[6]=X*J-B*Z,K[7]=O*J-F*Z,K}function rK(K,Q){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=Q[0],K[13]=Q[1],K[14]=Q[2],K[15]=1,K}function bK(K,Q){return K[0]=Q[0],K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Q[1],K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=Q[2],K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function eK(K,Q,$){var Z=$[0],J=$[1],V=$[2],Y=Math.hypot(Z,J,V),B,F,C;if(Y<M)return null;return Y=1/Y,Z*=Y,J*=Y,V*=Y,B=Math.sin(Q),F=Math.cos(Q),C=1-F,K[0]=Z*Z*C+F,K[1]=J*Z*C+V*B,K[2]=V*Z*C-J*B,K[3]=0,K[4]=Z*J*C-V*B,K[5]=J*J*C+F,K[6]=V*J*C+Z*B,K[7]=0,K[8]=Z*V*C+J*B,K[9]=J*V*C-Z*B,K[10]=V*V*C+F,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function uK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Z,K[6]=$,K[7]=0,K[8]=0,K[9]=-$,K[10]=Z,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function oK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=Z,K[1]=0,K[2]=-$,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=$,K[9]=0,K[10]=Z,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function aK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=Z,K[1]=$,K[2]=0,K[3]=0,K[4]=-$,K[5]=Z,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function d0(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Z+Z,F=J+J,C=V+V,P=Z*B,X=Z*F,O=Z*C,W=J*F,U=J*C,D=V*C,H=Y*B,j=Y*F,G=Y*C;return K[0]=1-(W+D),K[1]=X+G,K[2]=O-j,K[3]=0,K[4]=X-G,K[5]=1-(P+D),K[6]=U+H,K[7]=0,K[8]=O+j,K[9]=U-H,K[10]=1-(P+W),K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function tK(K,Q){var $=new k(3),Z=-Q[0],J=-Q[1],V=-Q[2],Y=Q[3],B=Q[4],F=Q[5],C=Q[6],P=Q[7],X=Z*Z+J*J+V*V+Y*Y;if(X>0)$[0]=(B*Y+P*Z+F*V-C*J)*2/X,$[1]=(F*Y+P*J+C*Z-B*V)*2/X,$[2]=(C*Y+P*V+B*J-F*Z)*2/X;else $[0]=(B*Y+P*Z+F*V-C*J)*2,$[1]=(F*Y+P*J+C*Z-B*V)*2,$[2]=(C*Y+P*V+B*J-F*Z)*2;return d0(K,Q,$),K}function KQ(K,Q){return K[0]=Q[12],K[1]=Q[13],K[2]=Q[14],K}function i0(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[4],Y=Q[5],B=Q[6],F=Q[8],C=Q[9],P=Q[10];return K[0]=Math.hypot($,Z,J),K[1]=Math.hypot(V,Y,B),K[2]=Math.hypot(F,C,P),K}function QQ(K,Q){var $=new k(3);i0($,Q);var Z=1/$[0],J=1/$[1],V=1/$[2],Y=Q[0]*Z,B=Q[1]*J,F=Q[2]*V,C=Q[4]*Z,P=Q[5]*J,X=Q[6]*V,O=Q[8]*Z,W=Q[9]*J,U=Q[10]*V,D=Y+P+U,H=0;if(D>0)H=Math.sqrt(D+1)*2,K[3]=0.25*H,K[0]=(X-W)/H,K[1]=(O-F)/H,K[2]=(B-C)/H;else if(Y>P&&Y>U)H=Math.sqrt(1+Y-P-U)*2,K[3]=(X-W)/H,K[0]=0.25*H,K[1]=(B+C)/H,K[2]=(O+F)/H;else if(P>U)H=Math.sqrt(1+P-Y-U)*2,K[3]=(O-F)/H,K[0]=(B+C)/H,K[1]=0.25*H,K[2]=(X+W)/H;else H=Math.sqrt(1+U-Y-P)*2,K[3]=(B-C)/H,K[0]=(O+F)/H,K[1]=(X+W)/H,K[2]=0.25*H;return K}function $Q(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Q[3],F=J+J,C=V+V,P=Y+Y,X=J*F,O=J*C,W=J*P,U=V*C,D=V*P,H=Y*P,j=B*F,G=B*C,N=B*P,_=Z[0],A=Z[1],R=Z[2];return K[0]=(1-(U+H))*_,K[1]=(O+N)*_,K[2]=(W-G)*_,K[3]=0,K[4]=(O-N)*A,K[5]=(1-(X+H))*A,K[6]=(D+j)*A,K[7]=0,K[8]=(W+G)*R,K[9]=(D-j)*R,K[10]=(1-(X+U))*R,K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function ZQ(K,Q,$,Z,J){var V=Q[0],Y=Q[1],B=Q[2],F=Q[3],C=V+V,P=Y+Y,X=B+B,O=V*C,W=V*P,U=V*X,D=Y*P,H=Y*X,j=B*X,G=F*C,N=F*P,_=F*X,A=Z[0],R=Z[1],I=Z[2],L=J[0],h=J[1],S=J[2],p=(1-(D+j))*A,v=(W+_)*A,f=(U-N)*A,T=(W-_)*R,z=(1-(O+j))*R,n=(H+G)*R,s=(U+N)*I,q0=(H-G)*I,L0=(1-(O+D))*I;return K[0]=p,K[1]=v,K[2]=f,K[3]=0,K[4]=T,K[5]=z,K[6]=n,K[7]=0,K[8]=s,K[9]=q0,K[10]=L0,K[11]=0,K[12]=$[0]+L-(p*L+T*h+s*S),K[13]=$[1]+h-(v*L+z*h+q0*S),K[14]=$[2]+S-(f*L+n*h+L0*S),K[15]=1,K}function JQ(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=$+$,B=Z+Z,F=J+J,C=$*Y,P=Z*Y,X=Z*B,O=J*Y,W=J*B,U=J*F,D=V*Y,H=V*B,j=V*F;return K[0]=1-X-U,K[1]=P+j,K[2]=O-H,K[3]=0,K[4]=P-j,K[5]=1-C-U,K[6]=W+D,K[7]=0,K[8]=O+H,K[9]=W-D,K[10]=1-C-X,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function VQ(K,Q,$,Z,J,V,Y){var B=1/($-Q),F=1/(J-Z),C=1/(V-Y);return K[0]=V*2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=V*2*F,K[6]=0,K[7]=0,K[8]=($+Q)*B,K[9]=(J+Z)*F,K[10]=(Y+V)*C,K[11]=-1,K[12]=0,K[13]=0,K[14]=Y*V*2*C,K[15]=0,K}function n0(K,Q,$,Z,J){var V=1/Math.tan(Q/2),Y;if(K[0]=V/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=V,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,J!=null&&J!==Infinity)Y=1/(Z-J),K[10]=(J+Z)*Y,K[14]=2*J*Z*Y;else K[10]=-1,K[14]=-2*Z;return K}function BQ(K,Q,$,Z,J){var V=1/Math.tan(Q/2),Y;if(K[0]=V/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=V,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,J!=null&&J!==Infinity)Y=1/(Z-J),K[10]=J*Y,K[14]=J*Z*Y;else K[10]=-1,K[14]=-Z;return K}function FQ(K,Q,$,Z){var J=Math.tan(Q.upDegrees*Math.PI/180),V=Math.tan(Q.downDegrees*Math.PI/180),Y=Math.tan(Q.leftDegrees*Math.PI/180),B=Math.tan(Q.rightDegrees*Math.PI/180),F=2/(Y+B),C=2/(J+V);return K[0]=F,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=C,K[6]=0,K[7]=0,K[8]=-((Y-B)*F*0.5),K[9]=(J-V)*C*0.5,K[10]=Z/($-Z),K[11]=-1,K[12]=0,K[13]=0,K[14]=Z*$/($-Z),K[15]=0,K}function s0(K,Q,$,Z,J,V,Y){var B=1/(Q-$),F=1/(Z-J),C=1/(V-Y);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*F,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=2*C,K[11]=0,K[12]=(Q+$)*B,K[13]=(J+Z)*F,K[14]=(Y+V)*C,K[15]=1,K}function CQ(K,Q,$,Z,J,V,Y){var B=1/(Q-$),F=1/(Z-J),C=1/(V-Y);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*F,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=C,K[11]=0,K[12]=(Q+$)*B,K[13]=(J+Z)*F,K[14]=V*C,K[15]=1,K}function XQ(K,Q,$,Z){var J,V,Y,B,F,C,P,X,O,W,U=Q[0],D=Q[1],H=Q[2],j=Z[0],G=Z[1],N=Z[2],_=$[0],A=$[1],R=$[2];if(Math.abs(U-_)<M&&Math.abs(D-A)<M&&Math.abs(H-R)<M)return m0(K);if(P=U-_,X=D-A,O=H-R,W=1/Math.hypot(P,X,O),P*=W,X*=W,O*=W,J=G*O-N*X,V=N*P-j*O,Y=j*X-G*P,W=Math.hypot(J,V,Y),!W)J=0,V=0,Y=0;else W=1/W,J*=W,V*=W,Y*=W;if(B=X*Y-O*V,F=O*J-P*Y,C=P*V-X*J,W=Math.hypot(B,F,C),!W)B=0,F=0,C=0;else W=1/W,B*=W,F*=W,C*=W;return K[0]=J,K[1]=B,K[2]=P,K[3]=0,K[4]=V,K[5]=F,K[6]=X,K[7]=0,K[8]=Y,K[9]=C,K[10]=O,K[11]=0,K[12]=-(J*U+V*D+Y*H),K[13]=-(B*U+F*D+C*H),K[14]=-(P*U+X*D+O*H),K[15]=1,K}function HQ(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Z[0],F=Z[1],C=Z[2],P=J-$[0],X=V-$[1],O=Y-$[2],W=P*P+X*X+O*O;if(W>0)W=1/Math.sqrt(W),P*=W,X*=W,O*=W;var U=F*O-C*X,D=C*P-B*O,H=B*X-F*P;if(W=U*U+D*D+H*H,W>0)W=1/Math.sqrt(W),U*=W,D*=W,H*=W;return K[0]=U,K[1]=D,K[2]=H,K[3]=0,K[4]=X*H-O*D,K[5]=O*U-P*H,K[6]=P*D-X*U,K[7]=0,K[8]=P,K[9]=X,K[10]=O,K[11]=0,K[12]=J,K[13]=V,K[14]=Y,K[15]=1,K}function OQ(K){return"mat4("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+", "+K[4]+", "+K[5]+", "+K[6]+", "+K[7]+", "+K[8]+", "+K[9]+", "+K[10]+", "+K[11]+", "+K[12]+", "+K[13]+", "+K[14]+", "+K[15]+")"}function WQ(K){return Math.hypot(K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12],K[13],K[14],K[15])}function UQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K[4]=Q[4]+$[4],K[5]=Q[5]+$[5],K[6]=Q[6]+$[6],K[7]=Q[7]+$[7],K[8]=Q[8]+$[8],K[9]=Q[9]+$[9],K[10]=Q[10]+$[10],K[11]=Q[11]+$[11],K[12]=Q[12]+$[12],K[13]=Q[13]+$[13],K[14]=Q[14]+$[14],K[15]=Q[15]+$[15],K}function r0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K[3]=Q[3]-$[3],K[4]=Q[4]-$[4],K[5]=Q[5]-$[5],K[6]=Q[6]-$[6],K[7]=Q[7]-$[7],K[8]=Q[8]-$[8],K[9]=Q[9]-$[9],K[10]=Q[10]-$[10],K[11]=Q[11]-$[11],K[12]=Q[12]-$[12],K[13]=Q[13]-$[13],K[14]=Q[14]-$[14],K[15]=Q[15]-$[15],K}function DQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K[4]=Q[4]*$,K[5]=Q[5]*$,K[6]=Q[6]*$,K[7]=Q[7]*$,K[8]=Q[8]*$,K[9]=Q[9]*$,K[10]=Q[10]*$,K[11]=Q[11]*$,K[12]=Q[12]*$,K[13]=Q[13]*$,K[14]=Q[14]*$,K[15]=Q[15]*$,K}function jQ(K,Q,$,Z){return K[0]=Q[0]+$[0]*Z,K[1]=Q[1]+$[1]*Z,K[2]=Q[2]+$[2]*Z,K[3]=Q[3]+$[3]*Z,K[4]=Q[4]+$[4]*Z,K[5]=Q[5]+$[5]*Z,K[6]=Q[6]+$[6]*Z,K[7]=Q[7]+$[7]*Z,K[8]=Q[8]+$[8]*Z,K[9]=Q[9]+$[9]*Z,K[10]=Q[10]+$[10]*Z,K[11]=Q[11]+$[11]*Z,K[12]=Q[12]+$[12]*Z,K[13]=Q[13]+$[13]*Z,K[14]=Q[14]+$[14]*Z,K[15]=Q[15]+$[15]*Z,K}function EQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]&&K[4]===Q[4]&&K[5]===Q[5]&&K[6]===Q[6]&&K[7]===Q[7]&&K[8]===Q[8]&&K[9]===Q[9]&&K[10]===Q[10]&&K[11]===Q[11]&&K[12]===Q[12]&&K[13]===Q[13]&&K[14]===Q[14]&&K[15]===Q[15]}function AQ(K,Q){var $=K[0],Z=K[1],J=K[2],V=K[3],Y=K[4],B=K[5],F=K[6],C=K[7],P=K[8],X=K[9],O=K[10],W=K[11],U=K[12],D=K[13],H=K[14],j=K[15],G=Q[0],N=Q[1],_=Q[2],A=Q[3],R=Q[4],I=Q[5],L=Q[6],h=Q[7],S=Q[8],p=Q[9],v=Q[10],f=Q[11],T=Q[12],z=Q[13],n=Q[14],s=Q[15];return Math.abs($-G)<=M*Math.max(1,Math.abs($),Math.abs(G))&&Math.abs(Z-N)<=M*Math.max(1,Math.abs(Z),Math.abs(N))&&Math.abs(J-_)<=M*Math.max(1,Math.abs(J),Math.abs(_))&&Math.abs(V-A)<=M*Math.max(1,Math.abs(V),Math.abs(A))&&Math.abs(Y-R)<=M*Math.max(1,Math.abs(Y),Math.abs(R))&&Math.abs(B-I)<=M*Math.max(1,Math.abs(B),Math.abs(I))&&Math.abs(F-L)<=M*Math.max(1,Math.abs(F),Math.abs(L))&&Math.abs(C-h)<=M*Math.max(1,Math.abs(C),Math.abs(h))&&Math.abs(P-S)<=M*Math.max(1,Math.abs(P),Math.abs(S))&&Math.abs(X-p)<=M*Math.max(1,Math.abs(X),Math.abs(p))&&Math.abs(O-v)<=M*Math.max(1,Math.abs(O),Math.abs(v))&&Math.abs(W-f)<=M*Math.max(1,Math.abs(W),Math.abs(f))&&Math.abs(U-T)<=M*Math.max(1,Math.abs(U),Math.abs(T))&&Math.abs(D-z)<=M*Math.max(1,Math.abs(D),Math.abs(z))&&Math.abs(H-n)<=M*Math.max(1,Math.abs(H),Math.abs(n))&&Math.abs(j-s)<=M*Math.max(1,Math.abs(j),Math.abs(s))}var YQ=n0,PQ=s0,RQ=l0,_Q=r0;var e={};F0(e,{str:()=>{{return j$}},squaredLength:()=>{{return NK}},sqrLen:()=>{{return k$}},sqlerp:()=>{{return S$}},slerp:()=>{{return B0}},setAxisAngle:()=>{{return WK}},setAxes:()=>{{return I$}},set:()=>{{return _$}},scale:()=>{{return AK}},rotationTo:()=>{{return h$}},rotateZ:()=>{{return C$}},rotateY:()=>{{return P$}},rotateX:()=>{{return F$}},random:()=>{{return O$}},pow:()=>{{return H$}},normalize:()=>{{return T0}},multiply:()=>{{return UK}},mul:()=>{{return M$}},ln:()=>{{return jK}},lerp:()=>{{return G$}},length:()=>{{return _K}},len:()=>{{return T$}},invert:()=>{{return W$}},identity:()=>{{return V$}},getAxisAngle:()=>{{return Y$}},getAngle:()=>{{return B$}},fromValues:()=>{{return A$}},fromMat3:()=>{{return EK}},fromEuler:()=>{{return D$}},exp:()=>{{return DK}},exactEquals:()=>{{return q$}},equals:()=>{{return L$}},dot:()=>{{return RK}},create:()=>{{return G0}},copy:()=>{{return R$}},conjugate:()=>{{return U$}},clone:()=>{{return E$}},calculateW:()=>{{return X$}},add:()=>{{return N$}}});var d={};F0(d,{zero:()=>{{return sQ}},transformQuat:()=>{{return mQ}},transformMat4:()=>{{return xQ}},transformMat3:()=>{{return cQ}},subtract:()=>{{return e0}},sub:()=>{{return uQ}},str:()=>{{return rQ}},squaredLength:()=>{{return KK}},squaredDistance:()=>{{return t0}},sqrLen:()=>{{return Q$}},sqrDist:()=>{{return K$}},set:()=>{{return GQ}},scaleAndAdd:()=>{{return wQ}},scale:()=>{{return IQ}},round:()=>{{return SQ}},rotateZ:()=>{{return iQ}},rotateY:()=>{{return dQ}},rotateX:()=>{{return lQ}},random:()=>{{return yQ}},normalize:()=>{{return N0}},negate:()=>{{return pQ}},multiply:()=>{{return u0}},mul:()=>{{return oQ}},min:()=>{{return LQ}},max:()=>{{return hQ}},lerp:()=>{{return gQ}},length:()=>{{return b0}},len:()=>{{return M0}},inverse:()=>{{return vQ}},hermite:()=>{{return fQ}},fromValues:()=>{{return V0}},forEach:()=>{{return $$}},floor:()=>{{return qQ}},exactEquals:()=>{{return bQ}},equals:()=>{{return eQ}},dot:()=>{{return Y0}},divide:()=>{{return o0}},div:()=>{{return aQ}},distance:()=>{{return a0}},dist:()=>{{return tQ}},cross:()=>{{return b}},create:()=>{{return J0}},copy:()=>{{return MQ}},clone:()=>{{return NQ}},ceil:()=>{{return kQ}},bezier:()=>{{return zQ}},angle:()=>{{return nQ}},add:()=>{{return TQ}}});function J0(){var K=new k(3);if(k!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K}function NQ(K){var Q=new k(3);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q}function b0(K){var Q=K[0],$=K[1],Z=K[2];return Math.hypot(Q,$,Z)}function V0(K,Q,$){var Z=new k(3);return Z[0]=K,Z[1]=Q,Z[2]=$,Z}function MQ(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K}function GQ(K,Q,$,Z){return K[0]=Q,K[1]=$,K[2]=Z,K}function TQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K}function e0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K}function u0(K,Q,$){return K[0]=Q[0]*$[0],K[1]=Q[1]*$[1],K[2]=Q[2]*$[2],K}function o0(K,Q,$){return K[0]=Q[0]/$[0],K[1]=Q[1]/$[1],K[2]=Q[2]/$[2],K}function kQ(K,Q){return K[0]=Math.ceil(Q[0]),K[1]=Math.ceil(Q[1]),K[2]=Math.ceil(Q[2]),K}function qQ(K,Q){return K[0]=Math.floor(Q[0]),K[1]=Math.floor(Q[1]),K[2]=Math.floor(Q[2]),K}function LQ(K,Q,$){return K[0]=Math.min(Q[0],$[0]),K[1]=Math.min(Q[1],$[1]),K[2]=Math.min(Q[2],$[2]),K}function hQ(K,Q,$){return K[0]=Math.max(Q[0],$[0]),K[1]=Math.max(Q[1],$[1]),K[2]=Math.max(Q[2],$[2]),K}function SQ(K,Q){return K[0]=Math.round(Q[0]),K[1]=Math.round(Q[1]),K[2]=Math.round(Q[2]),K}function IQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K}function wQ(K,Q,$,Z){return K[0]=Q[0]+$[0]*Z,K[1]=Q[1]+$[1]*Z,K[2]=Q[2]+$[2]*Z,K}function a0(K,Q){var $=Q[0]-K[0],Z=Q[1]-K[1],J=Q[2]-K[2];return Math.hypot($,Z,J)}function t0(K,Q){var $=Q[0]-K[0],Z=Q[1]-K[1],J=Q[2]-K[2];return $*$+Z*Z+J*J}function KK(K){var Q=K[0],$=K[1],Z=K[2];return Q*Q+$*$+Z*Z}function pQ(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K}function vQ(K,Q){return K[0]=1/Q[0],K[1]=1/Q[1],K[2]=1/Q[2],K}function N0(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=$*$+Z*Z+J*J;if(V>0)V=1/Math.sqrt(V);return K[0]=Q[0]*V,K[1]=Q[1]*V,K[2]=Q[2]*V,K}function Y0(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]}function b(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=$[0],B=$[1],F=$[2];return K[0]=J*F-V*B,K[1]=V*Y-Z*F,K[2]=Z*B-J*Y,K}function gQ(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2];return K[0]=J+Z*($[0]-J),K[1]=V+Z*($[1]-V),K[2]=Y+Z*($[2]-Y),K}function fQ(K,Q,$,Z,J,V){var Y=V*V,B=Y*(2*V-3)+1,F=Y*(V-2)+V,C=Y*(V-1),P=Y*(3-2*V);return K[0]=Q[0]*B+$[0]*F+Z[0]*C+J[0]*P,K[1]=Q[1]*B+$[1]*F+Z[1]*C+J[1]*P,K[2]=Q[2]*B+$[2]*F+Z[2]*C+J[2]*P,K}function zQ(K,Q,$,Z,J,V){var Y=1-V,B=Y*Y,F=V*V,C=B*Y,P=3*V*B,X=3*F*Y,O=F*V;return K[0]=Q[0]*C+$[0]*P+Z[0]*X+J[0]*O,K[1]=Q[1]*C+$[1]*P+Z[1]*X+J[1]*O,K[2]=Q[2]*C+$[2]*P+Z[2]*X+J[2]*O,K}function yQ(K,Q){Q=Q||1;var $=m()*2*Math.PI,Z=m()*2-1,J=Math.sqrt(1-Z*Z)*Q;return K[0]=Math.cos($)*J,K[1]=Math.sin($)*J,K[2]=Z*Q,K}function xQ(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=$[3]*Z+$[7]*J+$[11]*V+$[15];return Y=Y||1,K[0]=($[0]*Z+$[4]*J+$[8]*V+$[12])/Y,K[1]=($[1]*Z+$[5]*J+$[9]*V+$[13])/Y,K[2]=($[2]*Z+$[6]*J+$[10]*V+$[14])/Y,K}function cQ(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2];return K[0]=Z*$[0]+J*$[3]+V*$[6],K[1]=Z*$[1]+J*$[4]+V*$[7],K[2]=Z*$[2]+J*$[5]+V*$[8],K}function mQ(K,Q,$){var Z=$[0],J=$[1],V=$[2],Y=$[3],B=Q[0],F=Q[1],C=Q[2],P=J*C-V*F,X=V*B-Z*C,O=Z*F-J*B,W=J*O-V*X,U=V*P-Z*O,D=Z*X-J*P,H=Y*2;return P*=H,X*=H,O*=H,W*=2,U*=2,D*=2,K[0]=B+P+W,K[1]=F+X+U,K[2]=C+O+D,K}function lQ(K,Q,$,Z){var J=[],V=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],V[0]=J[0],V[1]=J[1]*Math.cos(Z)-J[2]*Math.sin(Z),V[2]=J[1]*Math.sin(Z)+J[2]*Math.cos(Z),K[0]=V[0]+$[0],K[1]=V[1]+$[1],K[2]=V[2]+$[2],K}function dQ(K,Q,$,Z){var J=[],V=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],V[0]=J[2]*Math.sin(Z)+J[0]*Math.cos(Z),V[1]=J[1],V[2]=J[2]*Math.cos(Z)-J[0]*Math.sin(Z),K[0]=V[0]+$[0],K[1]=V[1]+$[1],K[2]=V[2]+$[2],K}function iQ(K,Q,$,Z){var J=[],V=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],V[0]=J[0]*Math.cos(Z)-J[1]*Math.sin(Z),V[1]=J[0]*Math.sin(Z)+J[1]*Math.cos(Z),V[2]=J[2],K[0]=V[0]+$[0],K[1]=V[1]+$[1],K[2]=V[2]+$[2],K}function nQ(K,Q){var $=K[0],Z=K[1],J=K[2],V=Q[0],Y=Q[1],B=Q[2],F=Math.sqrt($*$+Z*Z+J*J),C=Math.sqrt(V*V+Y*Y+B*B),P=F*C,X=P&&Y0(K,Q)/P;return Math.acos(Math.min(Math.max(X,-1),1))}function sQ(K){return K[0]=0,K[1]=0,K[2]=0,K}function rQ(K){return"vec3("+K[0]+", "+K[1]+", "+K[2]+")"}function bQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]}function eQ(K,Q){var $=K[0],Z=K[1],J=K[2],V=Q[0],Y=Q[1],B=Q[2];return Math.abs($-V)<=M*Math.max(1,Math.abs($),Math.abs(V))&&Math.abs(Z-Y)<=M*Math.max(1,Math.abs(Z),Math.abs(Y))&&Math.abs(J-B)<=M*Math.max(1,Math.abs(J),Math.abs(B))}var uQ=e0,oQ=u0,aQ=o0,tQ=a0,K$=t0,M0=b0,Q$=KK,$$=function(){var K=J0();return function(Q,$,Z,J,V,Y){var B,F;if(!$)$=3;if(!Z)Z=0;if(J)F=Math.min(J*$+Z,Q.length);else F=Q.length;for(B=Z;B<F;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],V(K,K,Y),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2];return Q}}();function Z$(){var K=new k(4);if(k!=Float32Array)K[0]=0,K[1]=0,K[2]=0,K[3]=0;return K}function QK(K){var Q=new k(4);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q}function $K(K,Q,$,Z){var J=new k(4);return J[0]=K,J[1]=Q,J[2]=$,J[3]=Z,J}function ZK(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K}function JK(K,Q,$,Z,J){return K[0]=Q,K[1]=$,K[2]=Z,K[3]=J,K}function VK(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K}function YK(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K}function BK(K){var Q=K[0],$=K[1],Z=K[2],J=K[3];return Math.hypot(Q,$,Z,J)}function FK(K){var Q=K[0],$=K[1],Z=K[2],J=K[3];return Q*Q+$*$+Z*Z+J*J}function PK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=$*$+Z*Z+J*J+V*V;if(Y>0)Y=1/Math.sqrt(Y);return K[0]=$*Y,K[1]=Z*Y,K[2]=J*Y,K[3]=V*Y,K}function CK(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]+K[3]*Q[3]}function XK(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Q[3];return K[0]=J+Z*($[0]-J),K[1]=V+Z*($[1]-V),K[2]=Y+Z*($[2]-Y),K[3]=B+Z*($[3]-B),K}function HK(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]}function OK(K,Q){var $=K[0],Z=K[1],J=K[2],V=K[3],Y=Q[0],B=Q[1],F=Q[2],C=Q[3];return Math.abs($-Y)<=M*Math.max(1,Math.abs($),Math.abs(Y))&&Math.abs(Z-B)<=M*Math.max(1,Math.abs(Z),Math.abs(B))&&Math.abs(J-F)<=M*Math.max(1,Math.abs(J),Math.abs(F))&&Math.abs(V-C)<=M*Math.max(1,Math.abs(V),Math.abs(C))}var RZ=function(){var K=Z$();return function(Q,$,Z,J,V,Y){var B,F;if(!$)$=4;if(!Z)Z=0;if(J)F=Math.min(J*$+Z,Q.length);else F=Q.length;for(B=Z;B<F;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],K[3]=Q[B+3],V(K,K,Y),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2],Q[B+3]=K[3];return Q}}();function G0(){var K=new k(4);if(k!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K[3]=1,K}function V$(K){return K[0]=0,K[1]=0,K[2]=0,K[3]=1,K}function WK(K,Q,$){$=$*0.5;var Z=Math.sin($);return K[0]=Z*Q[0],K[1]=Z*Q[1],K[2]=Z*Q[2],K[3]=Math.cos($),K}function Y$(K,Q){var $=Math.acos(Q[3])*2,Z=Math.sin($/2);if(Z>M)K[0]=Q[0]/Z,K[1]=Q[1]/Z,K[2]=Q[2]/Z;else K[0]=1,K[1]=0,K[2]=0;return $}function B$(K,Q){var $=RK(K,Q);return Math.acos(2*$*$-1)}function UK(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=$[0],F=$[1],C=$[2],P=$[3];return K[0]=Z*P+Y*B+J*C-V*F,K[1]=J*P+Y*F+V*B-Z*C,K[2]=V*P+Y*C+Z*F-J*B,K[3]=Y*P-Z*B-J*F-V*C,K}function F$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Math.sin($),F=Math.cos($);return K[0]=Z*F+Y*B,K[1]=J*F+V*B,K[2]=V*F-J*B,K[3]=Y*F-Z*B,K}function P$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Math.sin($),F=Math.cos($);return K[0]=Z*F-V*B,K[1]=J*F+Y*B,K[2]=V*F+Z*B,K[3]=Y*F-J*B,K}function C$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Math.sin($),F=Math.cos($);return K[0]=Z*F+J*B,K[1]=J*F-Z*B,K[2]=V*F+Y*B,K[3]=Y*F-V*B,K}function X$(K,Q){var $=Q[0],Z=Q[1],J=Q[2];return K[0]=$,K[1]=Z,K[2]=J,K[3]=Math.sqrt(Math.abs(1-$*$-Z*Z-J*J)),K}function DK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Math.sqrt($*$+Z*Z+J*J),B=Math.exp(V),F=Y>0?B*Math.sin(Y)/Y:0;return K[0]=$*F,K[1]=Z*F,K[2]=J*F,K[3]=B*Math.cos(Y),K}function jK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Math.sqrt($*$+Z*Z+J*J),B=Y>0?Math.atan2(Y,V)/Y:0;return K[0]=$*B,K[1]=Z*B,K[2]=J*B,K[3]=0.5*Math.log($*$+Z*Z+J*J+V*V),K}function H$(K,Q,$){return jK(K,Q),AK(K,K,$),DK(K,K),K}function B0(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Q[3],F=$[0],C=$[1],P=$[2],X=$[3],O,W,U,D,H;if(W=J*F+V*C+Y*P+B*X,W<0)W=-W,F=-F,C=-C,P=-P,X=-X;if(1-W>M)O=Math.acos(W),U=Math.sin(O),D=Math.sin((1-Z)*O)/U,H=Math.sin(Z*O)/U;else D=1-Z,H=Z;return K[0]=D*J+H*F,K[1]=D*V+H*C,K[2]=D*Y+H*P,K[3]=D*B+H*X,K}function O$(K){var Q=m(),$=m(),Z=m(),J=Math.sqrt(1-Q),V=Math.sqrt(Q);return K[0]=J*Math.sin(2*Math.PI*$),K[1]=J*Math.cos(2*Math.PI*$),K[2]=V*Math.sin(2*Math.PI*Z),K[3]=V*Math.cos(2*Math.PI*Z),K}function W$(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=$*$+Z*Z+J*J+V*V,B=Y?1/Y:0;return K[0]=-$*B,K[1]=-Z*B,K[2]=-J*B,K[3]=V*B,K}function U$(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K[3]=Q[3],K}function EK(K,Q){var $=Q[0]+Q[4]+Q[8],Z;if($>0)Z=Math.sqrt($+1),K[3]=0.5*Z,Z=0.5/Z,K[0]=(Q[5]-Q[7])*Z,K[1]=(Q[6]-Q[2])*Z,K[2]=(Q[1]-Q[3])*Z;else{var J=0;if(Q[4]>Q[0])J=1;if(Q[8]>Q[J*3+J])J=2;var V=(J+1)%3,Y=(J+2)%3;Z=Math.sqrt(Q[J*3+J]-Q[V*3+V]-Q[Y*3+Y]+1),K[J]=0.5*Z,Z=0.5/Z,K[3]=(Q[V*3+Y]-Q[Y*3+V])*Z,K[V]=(Q[V*3+J]+Q[J*3+V])*Z,K[Y]=(Q[Y*3+J]+Q[J*3+Y])*Z}return K}function D$(K,Q,$,Z){var J=0.5*Math.PI/180;Q*=J,$*=J,Z*=J;var V=Math.sin(Q),Y=Math.cos(Q),B=Math.sin($),F=Math.cos($),C=Math.sin(Z),P=Math.cos(Z);return K[0]=V*F*P-Y*B*C,K[1]=Y*B*P+V*F*C,K[2]=Y*F*C-V*B*P,K[3]=Y*F*P+V*B*C,K}function j$(K){return"quat("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+")"}var E$=QK,A$=$K,R$=ZK,_$=JK,N$=VK,M$=UK,AK=YK,RK=CK,G$=XK,_K=BK,T$=_K,NK=FK,k$=NK,T0=PK,q$=HK,L$=OK,h$=function(){var K=J0(),Q=V0(1,0,0),$=V0(0,1,0);return function(Z,J,V){var Y=Y0(J,V);if(Y<-0.999999){if(b(K,Q,J),M0(K)<0.000001)b(K,$,J);return N0(K,K),WK(Z,K,Math.PI),Z}else if(Y>0.999999)return Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z;else return b(K,J,V),Z[0]=K[0],Z[1]=K[1],Z[2]=K[2],Z[3]=1+Y,T0(Z,Z)}}(),S$=function(){var K=G0(),Q=G0();return function($,Z,J,V,Y,B){return B0(K,Z,Y,B),B0(Q,J,V,B),B0($,K,Q,2*B*(1-B)),$}}(),I$=function(){var K=c0();return function(Q,$,Z,J){return K[0]=Z[0],K[3]=Z[1],K[6]=Z[2],K[1]=J[0],K[4]=J[1],K[7]=J[2],K[2]=-$[0],K[5]=-$[1],K[8]=-$[2],T0(Q,EK(Q,K))}}();var w$=Math.PI/90;class c{m4=Float32Array.from(q.create());constructor(){this.identity()}static create(){return new c}identity(){return q.identity(this.m4),this}invert(K){return q.invert(this.m4,K.getMatrix()),this}multiply(K){return q.multiply(this.m4,this.m4,K.getMatrix()),this}multiply2(K,Q){return q.multiply(this.m4,K.getMatrix(),Q.getMatrix()),this}multiply3(K,Q,$){return this.multiply2(K,Q),this.multiply($),this}translate(K,Q,$){return q.translate(this.m4,this.m4,[K,Q,$]),this}translateToMatrix(K){const Q=K.getMatrix();return this.translate(-Q[12],-Q[13],-Q[14]),this}rotateX(K){return q.rotateX(this.m4,this.m4,K),this}rotateY(K){return q.rotateY(this.m4,this.m4,K),this}rotateZ(K){return q.rotateZ(this.m4,this.m4,K),this}scale(K,Q,$){return q.scale(this.m4,this.m4,[K,Q,$]),this}perspective(K,Q,$,Z){return q.perspective(this.m4,K*w$,Q,$,Z),this}ortho(K,Q,$,Z,J,V){return q.ortho(this.m4,K,Q,$,Z,J,V),this}static aTemp=q.create();static bTemp=q.create();combine(K,Q,$=0.5){return q.multiplyScalar(c.aTemp,K.getMatrix(),1-$),q.multiplyScalar(c.bTemp,Q.getMatrix(),$),q.add(this.m4,c.aTemp,c.bTemp),this}static tempQuat=e.create();moveMatrix(K,Q,$,Z){const J=d.fromValues(-K,Q,$);if(Z)q.getRotation(c.tempQuat,Z.getMatrix()),e.invert(c.tempQuat,c.tempQuat),d.transformQuat(J,J,c.tempQuat);return q.translate(this.m4,this.m4,J),this}getMatrix(){return this.m4}}var w=c;class k0{gl;uniforms;camPositionMatrix=w.create().translate(0,0,-1);perspectiveMatrix=w.create();orthoMatrix=w.create();projectionMatrix=w.create();perspectiveLevel=1;needsRefresh=!1;constructor(K,Q){this.gl=K,this.uniforms=Q}configPerspectiveMatrix(K){this.perspectiveMatrix.perspective(45,K,0.01,1000),this.updatePerspective()}configOrthoMatrix(K){this.orthoMatrix.ortho(-K,K,-1,1,-1000,1000),this.updatePerspective()}camTiltMatrix=w.create();camTurnMatrix=w.create();camMatrix=w.create();refresh(){if(!this.needsRefresh)return;this.camMatrix.multiply3(this.camTiltMatrix,this.camTurnMatrix,this.camPositionMatrix);const K=this.uniforms.getUniformLocation(w0);this.gl.uniformMatrix4fv(K,!1,this.camMatrix.getMatrix())}updatePerspective(K){if(K!==void 0)this.perspectiveLevel=K;this.projectionMatrix.combine(this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel);const Q=this.uniforms.getUniformLocation(p0);this.gl.uniformMatrix4fv(Q,!1,this.projectionMatrix.getMatrix()),this.needsRefresh=!0}moveCam(K,Q,$){this.camPositionMatrix.moveMatrix(K,Q,$,this.camTurnMatrix),this.needsRefresh=!0}turnCam(K){this.camTurnMatrix.rotateY(K),this.needsRefresh=!0}tilt(K){this.camTiltMatrix.rotateX(K),this.needsRefresh=!0}}var g$=function(K){if(!v$)return K;return new Proxy(K,{get($,Z){const J=$,V=J[Z];if(typeof V==="function")return(...B)=>{const F=V.apply(J,B);return console.log(`gl.${String(Z)}(`,B,") = ",F),F};else return console.log(`gl.${String(Z)} = `,V),V}})},p$={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},v$=!1;class i extends g{gl;programs;attributeBuffers;uniforms;canvas;textureManager;imageManager;camera;constructor(K,{attributes:Q,world:$}={}){super();this.gl=g$(K.getContext("webgl2",{...p$,...Q})),this.canvas=K,this.programs=this.own(new X0(this.gl)),this.uniforms=this.own(new W0(this.gl,this.programs)),this.attributeBuffers=this.own(new O0(this.gl,this.programs)),this.textureManager=new A0(this.gl,this.uniforms),this.imageManager=new R0,this.camera=new k0(this.gl,this.uniforms),window.addEventListener("resize",this.checkCanvasSize.bind(this))}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const K=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configOrthoMatrix(K),this.camera.configPerspectiveMatrix(K)}async initialize(){const Q={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",_0(y0,Q),_0(x0,Q)),this.programs.useProgram("main"),this.gl.enable(E.DEPTH_TEST),this.gl.depthFunc(E.LESS),this.gl.clearDepth(1),this.gl.enable(E.BLEND),this.gl.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const $=S0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(E.ELEMENT_ARRAY_BUFFER,Z),this.attributeBuffers.bufferData(E.ELEMENT_ARRAY_BUFFER,$,Uint16Array.from([0,1,2,2,3,0]),0,E.STATIC_DRAW)}{const $=h0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(E.ARRAY_BUFFER,Z),this.gl.vertexAttribPointer(Z.location,4,E.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(Z.location),this.attributeBuffers.bufferData(E.ARRAY_BUFFER,$,Float32Array.from([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),0,E.STATIC_DRAW)}{const $=P0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(E.ARRAY_BUFFER,Z);for(let J=0;J<4;J++){const V=Z.location+J;this.gl.vertexAttribPointer(V,4,E.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,J*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(V),this.gl.vertexAttribDivisor(V,1)}this.attributeBuffers.bufferData(E.ARRAY_BUFFER,$,Float32Array.from([...w.create().translate(0,0,0).getMatrix(),...w.create().translate(-1,0,1).rotateY(Math.PI/2).scale(1,1,1).getMatrix(),...w.create().translate(1,0,1).rotateY(-Math.PI/2).scale(1,1,1).getMatrix(),...w.create().translate(0,-1,1).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),...w.create().translate(0,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),...w.create().translate(-2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),...w.create().translate(2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),...w.create().getMatrix()]),0,E.DYNAMIC_DRAW),this.textureManager.initialize()}await this.loadTextures(),this.checkCanvasSize()}static syncHudMatrix=w.create();static invertedCamTurnMatrix=w.create();static invertedCamTiltMatrix=w.create();syncHud(){this.attributeBuffers.bindBuffer(E.ARRAY_BUFFER,this.attributeBuffers.getAttributeBuffer(P0)),this.attributeBuffers.bufferSubData(E.ARRAY_BUFFER,i.syncHudMatrix.identity().translateToMatrix(this.camera.camPositionMatrix).multiply(i.invertedCamTurnMatrix.invert(this.camera.camTurnMatrix)).multiply(i.invertedCamTiltMatrix.invert(this.camera.camTiltMatrix)).translate(0,0,-0.9).getMatrix(),16*Float32Array.BYTES_PER_ELEMENT*7)}async loadTextures(){await this.imageManager.drawImage(0,(P)=>{const{canvas:X}=P;X.width=512,X.height=512;const O=X.width/2,W=X.height/2,U=X.width/2;P.imageSmoothingEnabled=!0,P.fillStyle="#ddd",P.lineWidth=X.width/50,P.fillRect(0,0,X.width,X.height),P.strokeStyle="black",P.fillStyle="gold",P.beginPath(),P.arc(O,W,U*0.8,0,2*Math.PI),P.fill(),P.stroke(),P.beginPath(),P.arc(O,W,U*0.5,0,Math.PI),P.stroke(),P.beginPath(),P.arc(X.width/3,X.height/3,U*0.1,0,Math.PI,!0),P.stroke(),P.beginPath(),P.arc(X.width/3*2,X.height/3,U*0.1,0,Math.PI*2,!0),P.stroke()}),await this.imageManager.drawImage(1,(P)=>{const{canvas:X}=P;X.width=512,X.height=512,P.imageSmoothingEnabled=!0,P.fillStyle="#ddd",P.lineWidth=X.width/50,P.fillRect(0,0,X.width,X.height),P.strokeStyle="black",P.fillStyle="silver",P.beginPath(),P.rect(X.width*0.2,X.height*0.2,X.width*0.6,X.height*0.6),P.fill(),P.stroke()}),await this.imageManager.drawImage(2,(P)=>{const{canvas:X}=P;X.width=512,X.height=512,P.imageSmoothingEnabled=!0,P.fillStyle="#ddd",P.lineWidth=X.width/50,P.strokeStyle="black",P.fillStyle="silver",P.beginPath(),P.rect(30,30,X.width-60,X.height-60),P.stroke()});const J=this.imageManager.getMedia(0),{slot:V}=this.textureManager.allocateSlotForImage(J),Y=this.imageManager.getMedia(1),{slot:B}=this.textureManager.allocateSlotForImage(Y),F=this.imageManager.getMedia(2),{slot:C}=this.textureManager.allocateSlotForImage(F);this.textureManager.generateMipMaps();{const P=I0;this.attributeBuffers.createBuffer(P);const X=this.attributeBuffers.getAttributeBuffer(P);this.attributeBuffers.bindBuffer(E.ARRAY_BUFFER,X);const O=X.location;this.gl.vertexAttribPointer(O,3,E.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(O),this.gl.vertexAttribDivisor(O,1),this.attributeBuffers.bufferData(E.ARRAY_BUFFER,P,Float32Array.from([...V.size,V.slotNumber,...V.size,V.slotNumber,...V.size,V.slotNumber,...B.size,B.slotNumber,...B.size,B.slotNumber,...B.size,B.slotNumber,...B.size,B.slotNumber,...C.size,C.slotNumber]),0,E.DYNAMIC_DRAW)}}drawElementsInstanced(K,Q){this.gl.drawElementsInstanced(E.TRIANGLES,K,E.UNSIGNED_SHORT,0,Q)}refresh(){this.gl.clear(E.COLOR_BUFFER_BIT|E.DEPTH_BUFFER_BIT);const K=6,Q=8;this.camera.refresh(),this.syncHud(),this.drawElementsInstanced(K,Q)}bindVertexArray(){return this.own(new H0(this.gl))}}async function dZ(){console.log("Hello World!")}function iZ(K){K.style.border="2px solid silver",K.style.cursor="grab",K.addEventListener("mouseenter",()=>{K.style.borderColor="black"}),K.addEventListener("mouseleave",()=>{K.style.borderColor="silver"});const Q=new i(K);Q.initialize();const $={};document.addEventListener("keydown",(J)=>{$[J.code]=!0}),document.addEventListener("keyup",(J)=>{$[J.code]=!1});function Z(){if($.KeyW)Q.camera.moveCam(0,0,0.25);if($.KeyS)Q.camera.moveCam(0,0,-0.25);if($.ArrowUp&&!$.ShiftRight)Q.camera.moveCam(0,-0.25,0);if($.ArrowDown&&!$.ShiftRight)Q.camera.moveCam(0,0.25,0);if($.KeyA||$.ArrowLeft&&!$.ShiftRight)Q.camera.moveCam(-0.25,0,0);if($.KeyD||$.ArrowRight&&!$.ShiftRight)Q.camera.moveCam(0.25,0,0);if($.KeyQ||$.ArrowLeft&&$.ShiftRight)Q.camera.turnCam(-0.05);if($.KeyE||$.ArrowRight&&$.ShiftRight)Q.camera.turnCam(0.05);if($.ArrowUp&&$.ShiftRight)Q.camera.tilt(-0.05);if($.ArrowDown&&$.ShiftRight)Q.camera.tilt(0.05);Q.refresh(),requestAnimationFrame(Z)}return Q.refresh(),Z(),Q}export{iZ as testCanvas,dZ as hello};

//# debugId=288486745D2EC7B664756e2164756e21
