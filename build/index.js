var IQ=Object.defineProperty;var H0=(Q,$)=>{for(var K in $)IQ(Q,K,{get:$[K],enumerable:!0,configurable:!0,set:(J)=>$[K]=()=>J})};var k=0.000001,T=typeof Float32Array!=="undefined"?Float32Array:Array,l=Math.random,sK=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var Q=0,$=arguments.length;while($--)Q+=arguments[$]*arguments[$];return Math.sqrt(Q)};function z0(){var Q=new T(9);if(T!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[5]=0,Q[6]=0,Q[7]=0;return Q[0]=1,Q[4]=1,Q[8]=1,Q}var q={};H0(q,{transpose:()=>{{return zQ}},translate:()=>{{return mQ}},targetTo:()=>{{return W$}},subtract:()=>{{return i0}},sub:()=>{{return N$}},str:()=>{{return A$}},set:()=>{{return yQ}},scale:()=>{{return nQ}},rotateZ:()=>{{return rQ}},rotateY:()=>{{return sQ}},rotateX:()=>{{return iQ}},rotate:()=>{{return dQ}},perspectiveZO:()=>{{return P$}},perspectiveNO:()=>{{return n0}},perspectiveFromFieldOfView:()=>{{return F$}},perspective:()=>{{return Y$}},orthoZO:()=>{{return C$}},orthoNO:()=>{{return d0}},ortho:()=>{{return H$}},multiplyScalarAndAdd:()=>{{return E$}},multiplyScalar:()=>{{return O$}},multiply:()=>{{return c0}},mul:()=>{{return _$}},lookAt:()=>{{return X$}},invert:()=>{{return xQ}},identity:()=>{{return x0}},getTranslation:()=>{{return $$}},getScaling:()=>{{return m0}},getRotation:()=>{{return K$}},frustum:()=>{{return V$}},fromZRotation:()=>{{return tQ}},fromYRotation:()=>{{return aQ}},fromXRotation:()=>{{return oQ}},fromValues:()=>{{return fQ}},fromTranslation:()=>{{return bQ}},fromScaling:()=>{{return eQ}},fromRotationTranslationScaleOrigin:()=>{{return Z$}},fromRotationTranslationScale:()=>{{return J$}},fromRotationTranslation:()=>{{return l0}},fromRotation:()=>{{return uQ}},fromQuat2:()=>{{return Q$}},fromQuat:()=>{{return B$}},frob:()=>{{return U$}},exactEquals:()=>{{return D$}},equals:()=>{{return R$}},determinant:()=>{{return lQ}},create:()=>{{return vQ}},copy:()=>{{return gQ}},clone:()=>{{return pQ}},adjoint:()=>{{return cQ}},add:()=>{{return j$}}});function vQ(){var Q=new T(16);if(T!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0;return Q[0]=1,Q[5]=1,Q[10]=1,Q[15]=1,Q}function pQ(Q){var $=new T(16);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[3],$[4]=Q[4],$[5]=Q[5],$[6]=Q[6],$[7]=Q[7],$[8]=Q[8],$[9]=Q[9],$[10]=Q[10],$[11]=Q[11],$[12]=Q[12],$[13]=Q[13],$[14]=Q[14],$[15]=Q[15],$}function gQ(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q[4]=$[4],Q[5]=$[5],Q[6]=$[6],Q[7]=$[7],Q[8]=$[8],Q[9]=$[9],Q[10]=$[10],Q[11]=$[11],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15],Q}function fQ(Q,$,K,J,Z,B,V,Y,P,F,H,C,A,W,j,U){var X=new T(16);return X[0]=Q,X[1]=$,X[2]=K,X[3]=J,X[4]=Z,X[5]=B,X[6]=V,X[7]=Y,X[8]=P,X[9]=F,X[10]=H,X[11]=C,X[12]=A,X[13]=W,X[14]=j,X[15]=U,X}function yQ(Q,$,K,J,Z,B,V,Y,P,F,H,C,A,W,j,U,X){return Q[0]=$,Q[1]=K,Q[2]=J,Q[3]=Z,Q[4]=B,Q[5]=V,Q[6]=Y,Q[7]=P,Q[8]=F,Q[9]=H,Q[10]=C,Q[11]=A,Q[12]=W,Q[13]=j,Q[14]=U,Q[15]=X,Q}function x0(Q){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function zQ(Q,$){if(Q===$){var K=$[1],J=$[2],Z=$[3],B=$[6],V=$[7],Y=$[11];Q[1]=$[4],Q[2]=$[8],Q[3]=$[12],Q[4]=K,Q[6]=$[9],Q[7]=$[13],Q[8]=J,Q[9]=B,Q[11]=$[14],Q[12]=Z,Q[13]=V,Q[14]=Y}else Q[0]=$[0],Q[1]=$[4],Q[2]=$[8],Q[3]=$[12],Q[4]=$[1],Q[5]=$[5],Q[6]=$[9],Q[7]=$[13],Q[8]=$[2],Q[9]=$[6],Q[10]=$[10],Q[11]=$[14],Q[12]=$[3],Q[13]=$[7],Q[14]=$[11],Q[15]=$[15];return Q}function xQ(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[3],V=$[4],Y=$[5],P=$[6],F=$[7],H=$[8],C=$[9],A=$[10],W=$[11],j=$[12],U=$[13],X=$[14],E=$[15],M=K*Y-J*V,N=K*P-Z*V,_=K*F-B*V,D=J*P-Z*Y,R=J*F-B*Y,w=Z*F-B*P,S=H*U-C*j,h=H*X-A*j,I=H*E-W*j,v=C*X-A*U,p=C*E-W*U,f=A*E-W*X,G=M*f-N*p+_*v+D*I-R*h+w*S;if(!G)return null;return G=1/G,Q[0]=(Y*f-P*p+F*v)*G,Q[1]=(Z*p-J*f-B*v)*G,Q[2]=(U*w-X*R+E*D)*G,Q[3]=(A*R-C*w-W*D)*G,Q[4]=(P*I-V*f-F*h)*G,Q[5]=(K*f-Z*I+B*h)*G,Q[6]=(X*_-j*w-E*N)*G,Q[7]=(H*w-A*_+W*N)*G,Q[8]=(V*p-Y*I+F*S)*G,Q[9]=(J*I-K*p-B*S)*G,Q[10]=(j*R-U*_+E*M)*G,Q[11]=(C*_-H*R-W*M)*G,Q[12]=(Y*h-V*v-P*S)*G,Q[13]=(K*v-J*h+Z*S)*G,Q[14]=(U*N-j*D-X*M)*G,Q[15]=(H*D-C*N+A*M)*G,Q}function cQ(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[3],V=$[4],Y=$[5],P=$[6],F=$[7],H=$[8],C=$[9],A=$[10],W=$[11],j=$[12],U=$[13],X=$[14],E=$[15];return Q[0]=Y*(A*E-W*X)-C*(P*E-F*X)+U*(P*W-F*A),Q[1]=-(J*(A*E-W*X)-C*(Z*E-B*X)+U*(Z*W-B*A)),Q[2]=J*(P*E-F*X)-Y*(Z*E-B*X)+U*(Z*F-B*P),Q[3]=-(J*(P*W-F*A)-Y*(Z*W-B*A)+C*(Z*F-B*P)),Q[4]=-(V*(A*E-W*X)-H*(P*E-F*X)+j*(P*W-F*A)),Q[5]=K*(A*E-W*X)-H*(Z*E-B*X)+j*(Z*W-B*A),Q[6]=-(K*(P*E-F*X)-V*(Z*E-B*X)+j*(Z*F-B*P)),Q[7]=K*(P*W-F*A)-V*(Z*W-B*A)+H*(Z*F-B*P),Q[8]=V*(C*E-W*U)-H*(Y*E-F*U)+j*(Y*W-F*C),Q[9]=-(K*(C*E-W*U)-H*(J*E-B*U)+j*(J*W-B*C)),Q[10]=K*(Y*E-F*U)-V*(J*E-B*U)+j*(J*F-B*Y),Q[11]=-(K*(Y*W-F*C)-V*(J*W-B*C)+H*(J*F-B*Y)),Q[12]=-(V*(C*X-A*U)-H*(Y*X-P*U)+j*(Y*A-P*C)),Q[13]=K*(C*X-A*U)-H*(J*X-Z*U)+j*(J*A-Z*C),Q[14]=-(K*(Y*X-P*U)-V*(J*X-Z*U)+j*(J*P-Z*Y)),Q[15]=K*(Y*A-P*C)-V*(J*A-Z*C)+H*(J*P-Z*Y),Q}function lQ(Q){var $=Q[0],K=Q[1],J=Q[2],Z=Q[3],B=Q[4],V=Q[5],Y=Q[6],P=Q[7],F=Q[8],H=Q[9],C=Q[10],A=Q[11],W=Q[12],j=Q[13],U=Q[14],X=Q[15],E=$*V-K*B,M=$*Y-J*B,N=$*P-Z*B,_=K*Y-J*V,D=K*P-Z*V,R=J*P-Z*Y,w=F*j-H*W,S=F*U-C*W,h=F*X-A*W,I=H*U-C*j,v=H*X-A*j,p=C*X-A*U;return E*p-M*v+N*I+_*h-D*S+R*w}function c0(Q,$,K){var J=$[0],Z=$[1],B=$[2],V=$[3],Y=$[4],P=$[5],F=$[6],H=$[7],C=$[8],A=$[9],W=$[10],j=$[11],U=$[12],X=$[13],E=$[14],M=$[15],N=K[0],_=K[1],D=K[2],R=K[3];return Q[0]=N*J+_*Y+D*C+R*U,Q[1]=N*Z+_*P+D*A+R*X,Q[2]=N*B+_*F+D*W+R*E,Q[3]=N*V+_*H+D*j+R*M,N=K[4],_=K[5],D=K[6],R=K[7],Q[4]=N*J+_*Y+D*C+R*U,Q[5]=N*Z+_*P+D*A+R*X,Q[6]=N*B+_*F+D*W+R*E,Q[7]=N*V+_*H+D*j+R*M,N=K[8],_=K[9],D=K[10],R=K[11],Q[8]=N*J+_*Y+D*C+R*U,Q[9]=N*Z+_*P+D*A+R*X,Q[10]=N*B+_*F+D*W+R*E,Q[11]=N*V+_*H+D*j+R*M,N=K[12],_=K[13],D=K[14],R=K[15],Q[12]=N*J+_*Y+D*C+R*U,Q[13]=N*Z+_*P+D*A+R*X,Q[14]=N*B+_*F+D*W+R*E,Q[15]=N*V+_*H+D*j+R*M,Q}function mQ(Q,$,K){var J=K[0],Z=K[1],B=K[2],V,Y,P,F,H,C,A,W,j,U,X,E;if($===Q)Q[12]=$[0]*J+$[4]*Z+$[8]*B+$[12],Q[13]=$[1]*J+$[5]*Z+$[9]*B+$[13],Q[14]=$[2]*J+$[6]*Z+$[10]*B+$[14],Q[15]=$[3]*J+$[7]*Z+$[11]*B+$[15];else V=$[0],Y=$[1],P=$[2],F=$[3],H=$[4],C=$[5],A=$[6],W=$[7],j=$[8],U=$[9],X=$[10],E=$[11],Q[0]=V,Q[1]=Y,Q[2]=P,Q[3]=F,Q[4]=H,Q[5]=C,Q[6]=A,Q[7]=W,Q[8]=j,Q[9]=U,Q[10]=X,Q[11]=E,Q[12]=V*J+H*Z+j*B+$[12],Q[13]=Y*J+C*Z+U*B+$[13],Q[14]=P*J+A*Z+X*B+$[14],Q[15]=F*J+W*Z+E*B+$[15];return Q}function nQ(Q,$,K){var J=K[0],Z=K[1],B=K[2];return Q[0]=$[0]*J,Q[1]=$[1]*J,Q[2]=$[2]*J,Q[3]=$[3]*J,Q[4]=$[4]*Z,Q[5]=$[5]*Z,Q[6]=$[6]*Z,Q[7]=$[7]*Z,Q[8]=$[8]*B,Q[9]=$[9]*B,Q[10]=$[10]*B,Q[11]=$[11]*B,Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15],Q}function dQ(Q,$,K,J){var Z=J[0],B=J[1],V=J[2],Y=Math.hypot(Z,B,V),P,F,H,C,A,W,j,U,X,E,M,N,_,D,R,w,S,h,I,v,p,f,G,y;if(Y<k)return null;if(Y=1/Y,Z*=Y,B*=Y,V*=Y,P=Math.sin(K),F=Math.cos(K),H=1-F,C=$[0],A=$[1],W=$[2],j=$[3],U=$[4],X=$[5],E=$[6],M=$[7],N=$[8],_=$[9],D=$[10],R=$[11],w=Z*Z*H+F,S=B*Z*H+V*P,h=V*Z*H-B*P,I=Z*B*H-V*P,v=B*B*H+F,p=V*B*H+Z*P,f=Z*V*H+B*P,G=B*V*H-Z*P,y=V*V*H+F,Q[0]=C*w+U*S+N*h,Q[1]=A*w+X*S+_*h,Q[2]=W*w+E*S+D*h,Q[3]=j*w+M*S+R*h,Q[4]=C*I+U*v+N*p,Q[5]=A*I+X*v+_*p,Q[6]=W*I+E*v+D*p,Q[7]=j*I+M*v+R*p,Q[8]=C*f+U*G+N*y,Q[9]=A*f+X*G+_*y,Q[10]=W*f+E*G+D*y,Q[11]=j*f+M*G+R*y,$!==Q)Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q}function iQ(Q,$,K){var J=Math.sin(K),Z=Math.cos(K),B=$[4],V=$[5],Y=$[6],P=$[7],F=$[8],H=$[9],C=$[10],A=$[11];if($!==Q)Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[4]=B*Z+F*J,Q[5]=V*Z+H*J,Q[6]=Y*Z+C*J,Q[7]=P*Z+A*J,Q[8]=F*Z-B*J,Q[9]=H*Z-V*J,Q[10]=C*Z-Y*J,Q[11]=A*Z-P*J,Q}function sQ(Q,$,K){var J=Math.sin(K),Z=Math.cos(K),B=$[0],V=$[1],Y=$[2],P=$[3],F=$[8],H=$[9],C=$[10],A=$[11];if($!==Q)Q[4]=$[4],Q[5]=$[5],Q[6]=$[6],Q[7]=$[7],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[0]=B*Z-F*J,Q[1]=V*Z-H*J,Q[2]=Y*Z-C*J,Q[3]=P*Z-A*J,Q[8]=B*J+F*Z,Q[9]=V*J+H*Z,Q[10]=Y*J+C*Z,Q[11]=P*J+A*Z,Q}function rQ(Q,$,K){var J=Math.sin(K),Z=Math.cos(K),B=$[0],V=$[1],Y=$[2],P=$[3],F=$[4],H=$[5],C=$[6],A=$[7];if($!==Q)Q[8]=$[8],Q[9]=$[9],Q[10]=$[10],Q[11]=$[11],Q[12]=$[12],Q[13]=$[13],Q[14]=$[14],Q[15]=$[15];return Q[0]=B*Z+F*J,Q[1]=V*Z+H*J,Q[2]=Y*Z+C*J,Q[3]=P*Z+A*J,Q[4]=F*Z-B*J,Q[5]=H*Z-V*J,Q[6]=C*Z-Y*J,Q[7]=A*Z-P*J,Q}function bQ(Q,$){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=$[0],Q[13]=$[1],Q[14]=$[2],Q[15]=1,Q}function eQ(Q,$){return Q[0]=$[0],Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=$[1],Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=$[2],Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function uQ(Q,$,K){var J=K[0],Z=K[1],B=K[2],V=Math.hypot(J,Z,B),Y,P,F;if(V<k)return null;return V=1/V,J*=V,Z*=V,B*=V,Y=Math.sin($),P=Math.cos($),F=1-P,Q[0]=J*J*F+P,Q[1]=Z*J*F+B*Y,Q[2]=B*J*F-Z*Y,Q[3]=0,Q[4]=J*Z*F-B*Y,Q[5]=Z*Z*F+P,Q[6]=B*Z*F+J*Y,Q[7]=0,Q[8]=J*B*F+Z*Y,Q[9]=Z*B*F-J*Y,Q[10]=B*B*F+P,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function oQ(Q,$){var K=Math.sin($),J=Math.cos($);return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=J,Q[6]=K,Q[7]=0,Q[8]=0,Q[9]=-K,Q[10]=J,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function aQ(Q,$){var K=Math.sin($),J=Math.cos($);return Q[0]=J,Q[1]=0,Q[2]=-K,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=K,Q[9]=0,Q[10]=J,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function tQ(Q,$){var K=Math.sin($),J=Math.cos($);return Q[0]=J,Q[1]=K,Q[2]=0,Q[3]=0,Q[4]=-K,Q[5]=J,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function l0(Q,$,K){var J=$[0],Z=$[1],B=$[2],V=$[3],Y=J+J,P=Z+Z,F=B+B,H=J*Y,C=J*P,A=J*F,W=Z*P,j=Z*F,U=B*F,X=V*Y,E=V*P,M=V*F;return Q[0]=1-(W+U),Q[1]=C+M,Q[2]=A-E,Q[3]=0,Q[4]=C-M,Q[5]=1-(H+U),Q[6]=j+X,Q[7]=0,Q[8]=A+E,Q[9]=j-X,Q[10]=1-(H+W),Q[11]=0,Q[12]=K[0],Q[13]=K[1],Q[14]=K[2],Q[15]=1,Q}function Q$(Q,$){var K=new T(3),J=-$[0],Z=-$[1],B=-$[2],V=$[3],Y=$[4],P=$[5],F=$[6],H=$[7],C=J*J+Z*Z+B*B+V*V;if(C>0)K[0]=(Y*V+H*J+P*B-F*Z)*2/C,K[1]=(P*V+H*Z+F*J-Y*B)*2/C,K[2]=(F*V+H*B+Y*Z-P*J)*2/C;else K[0]=(Y*V+H*J+P*B-F*Z)*2,K[1]=(P*V+H*Z+F*J-Y*B)*2,K[2]=(F*V+H*B+Y*Z-P*J)*2;return l0(Q,$,K),Q}function $$(Q,$){return Q[0]=$[12],Q[1]=$[13],Q[2]=$[14],Q}function m0(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[4],V=$[5],Y=$[6],P=$[8],F=$[9],H=$[10];return Q[0]=Math.hypot(K,J,Z),Q[1]=Math.hypot(B,V,Y),Q[2]=Math.hypot(P,F,H),Q}function K$(Q,$){var K=new T(3);m0(K,$);var J=1/K[0],Z=1/K[1],B=1/K[2],V=$[0]*J,Y=$[1]*Z,P=$[2]*B,F=$[4]*J,H=$[5]*Z,C=$[6]*B,A=$[8]*J,W=$[9]*Z,j=$[10]*B,U=V+H+j,X=0;if(U>0)X=Math.sqrt(U+1)*2,Q[3]=0.25*X,Q[0]=(C-W)/X,Q[1]=(A-P)/X,Q[2]=(Y-F)/X;else if(V>H&&V>j)X=Math.sqrt(1+V-H-j)*2,Q[3]=(C-W)/X,Q[0]=0.25*X,Q[1]=(Y+F)/X,Q[2]=(A+P)/X;else if(H>j)X=Math.sqrt(1+H-V-j)*2,Q[3]=(A-P)/X,Q[0]=(Y+F)/X,Q[1]=0.25*X,Q[2]=(C+W)/X;else X=Math.sqrt(1+j-V-H)*2,Q[3]=(Y-F)/X,Q[0]=(A+P)/X,Q[1]=(C+W)/X,Q[2]=0.25*X;return Q}function J$(Q,$,K,J){var Z=$[0],B=$[1],V=$[2],Y=$[3],P=Z+Z,F=B+B,H=V+V,C=Z*P,A=Z*F,W=Z*H,j=B*F,U=B*H,X=V*H,E=Y*P,M=Y*F,N=Y*H,_=J[0],D=J[1],R=J[2];return Q[0]=(1-(j+X))*_,Q[1]=(A+N)*_,Q[2]=(W-M)*_,Q[3]=0,Q[4]=(A-N)*D,Q[5]=(1-(C+X))*D,Q[6]=(U+E)*D,Q[7]=0,Q[8]=(W+M)*R,Q[9]=(U-E)*R,Q[10]=(1-(C+j))*R,Q[11]=0,Q[12]=K[0],Q[13]=K[1],Q[14]=K[2],Q[15]=1,Q}function Z$(Q,$,K,J,Z){var B=$[0],V=$[1],Y=$[2],P=$[3],F=B+B,H=V+V,C=Y+Y,A=B*F,W=B*H,j=B*C,U=V*H,X=V*C,E=Y*C,M=P*F,N=P*H,_=P*C,D=J[0],R=J[1],w=J[2],S=Z[0],h=Z[1],I=Z[2],v=(1-(U+E))*D,p=(W+_)*D,f=(j-N)*D,G=(W-_)*R,y=(1-(A+E))*R,d=(X+M)*R,i=(j+N)*w,f0=(X-M)*w,y0=(1-(A+U))*w;return Q[0]=v,Q[1]=p,Q[2]=f,Q[3]=0,Q[4]=G,Q[5]=y,Q[6]=d,Q[7]=0,Q[8]=i,Q[9]=f0,Q[10]=y0,Q[11]=0,Q[12]=K[0]+S-(v*S+G*h+i*I),Q[13]=K[1]+h-(p*S+y*h+f0*I),Q[14]=K[2]+I-(f*S+d*h+y0*I),Q[15]=1,Q}function B$(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[3],V=K+K,Y=J+J,P=Z+Z,F=K*V,H=J*V,C=J*Y,A=Z*V,W=Z*Y,j=Z*P,U=B*V,X=B*Y,E=B*P;return Q[0]=1-C-j,Q[1]=H+E,Q[2]=A-X,Q[3]=0,Q[4]=H-E,Q[5]=1-F-j,Q[6]=W+U,Q[7]=0,Q[8]=A+X,Q[9]=W-U,Q[10]=1-F-C,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function V$(Q,$,K,J,Z,B,V){var Y=1/(K-$),P=1/(Z-J),F=1/(B-V);return Q[0]=B*2*Y,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=B*2*P,Q[6]=0,Q[7]=0,Q[8]=(K+$)*Y,Q[9]=(Z+J)*P,Q[10]=(V+B)*F,Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=V*B*2*F,Q[15]=0,Q}function n0(Q,$,K,J,Z){var B=1/Math.tan($/2),V;if(Q[0]=B/K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=B,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,Z!=null&&Z!==Infinity)V=1/(J-Z),Q[10]=(Z+J)*V,Q[14]=2*Z*J*V;else Q[10]=-1,Q[14]=-2*J;return Q}function P$(Q,$,K,J,Z){var B=1/Math.tan($/2),V;if(Q[0]=B/K,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=B,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,Z!=null&&Z!==Infinity)V=1/(J-Z),Q[10]=Z*V,Q[14]=Z*J*V;else Q[10]=-1,Q[14]=-J;return Q}function F$(Q,$,K,J){var Z=Math.tan($.upDegrees*Math.PI/180),B=Math.tan($.downDegrees*Math.PI/180),V=Math.tan($.leftDegrees*Math.PI/180),Y=Math.tan($.rightDegrees*Math.PI/180),P=2/(V+Y),F=2/(Z+B);return Q[0]=P,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=F,Q[6]=0,Q[7]=0,Q[8]=-((V-Y)*P*0.5),Q[9]=(Z-B)*F*0.5,Q[10]=J/(K-J),Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=J*K/(K-J),Q[15]=0,Q}function d0(Q,$,K,J,Z,B,V){var Y=1/($-K),P=1/(J-Z),F=1/(B-V);return Q[0]=-2*Y,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*P,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=2*F,Q[11]=0,Q[12]=($+K)*Y,Q[13]=(Z+J)*P,Q[14]=(V+B)*F,Q[15]=1,Q}function C$(Q,$,K,J,Z,B,V){var Y=1/($-K),P=1/(J-Z),F=1/(B-V);return Q[0]=-2*Y,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*P,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=F,Q[11]=0,Q[12]=($+K)*Y,Q[13]=(Z+J)*P,Q[14]=B*F,Q[15]=1,Q}function X$(Q,$,K,J){var Z,B,V,Y,P,F,H,C,A,W,j=$[0],U=$[1],X=$[2],E=J[0],M=J[1],N=J[2],_=K[0],D=K[1],R=K[2];if(Math.abs(j-_)<k&&Math.abs(U-D)<k&&Math.abs(X-R)<k)return x0(Q);if(H=j-_,C=U-D,A=X-R,W=1/Math.hypot(H,C,A),H*=W,C*=W,A*=W,Z=M*A-N*C,B=N*H-E*A,V=E*C-M*H,W=Math.hypot(Z,B,V),!W)Z=0,B=0,V=0;else W=1/W,Z*=W,B*=W,V*=W;if(Y=C*V-A*B,P=A*Z-H*V,F=H*B-C*Z,W=Math.hypot(Y,P,F),!W)Y=0,P=0,F=0;else W=1/W,Y*=W,P*=W,F*=W;return Q[0]=Z,Q[1]=Y,Q[2]=H,Q[3]=0,Q[4]=B,Q[5]=P,Q[6]=C,Q[7]=0,Q[8]=V,Q[9]=F,Q[10]=A,Q[11]=0,Q[12]=-(Z*j+B*U+V*X),Q[13]=-(Y*j+P*U+F*X),Q[14]=-(H*j+C*U+A*X),Q[15]=1,Q}function W$(Q,$,K,J){var Z=$[0],B=$[1],V=$[2],Y=J[0],P=J[1],F=J[2],H=Z-K[0],C=B-K[1],A=V-K[2],W=H*H+C*C+A*A;if(W>0)W=1/Math.sqrt(W),H*=W,C*=W,A*=W;var j=P*A-F*C,U=F*H-Y*A,X=Y*C-P*H;if(W=j*j+U*U+X*X,W>0)W=1/Math.sqrt(W),j*=W,U*=W,X*=W;return Q[0]=j,Q[1]=U,Q[2]=X,Q[3]=0,Q[4]=C*X-A*U,Q[5]=A*j-H*X,Q[6]=H*U-C*j,Q[7]=0,Q[8]=H,Q[9]=C,Q[10]=A,Q[11]=0,Q[12]=Z,Q[13]=B,Q[14]=V,Q[15]=1,Q}function A$(Q){return"mat4("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+", "+Q[4]+", "+Q[5]+", "+Q[6]+", "+Q[7]+", "+Q[8]+", "+Q[9]+", "+Q[10]+", "+Q[11]+", "+Q[12]+", "+Q[13]+", "+Q[14]+", "+Q[15]+")"}function U$(Q){return Math.hypot(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15])}function j$(Q,$,K){return Q[0]=$[0]+K[0],Q[1]=$[1]+K[1],Q[2]=$[2]+K[2],Q[3]=$[3]+K[3],Q[4]=$[4]+K[4],Q[5]=$[5]+K[5],Q[6]=$[6]+K[6],Q[7]=$[7]+K[7],Q[8]=$[8]+K[8],Q[9]=$[9]+K[9],Q[10]=$[10]+K[10],Q[11]=$[11]+K[11],Q[12]=$[12]+K[12],Q[13]=$[13]+K[13],Q[14]=$[14]+K[14],Q[15]=$[15]+K[15],Q}function i0(Q,$,K){return Q[0]=$[0]-K[0],Q[1]=$[1]-K[1],Q[2]=$[2]-K[2],Q[3]=$[3]-K[3],Q[4]=$[4]-K[4],Q[5]=$[5]-K[5],Q[6]=$[6]-K[6],Q[7]=$[7]-K[7],Q[8]=$[8]-K[8],Q[9]=$[9]-K[9],Q[10]=$[10]-K[10],Q[11]=$[11]-K[11],Q[12]=$[12]-K[12],Q[13]=$[13]-K[13],Q[14]=$[14]-K[14],Q[15]=$[15]-K[15],Q}function O$(Q,$,K){return Q[0]=$[0]*K,Q[1]=$[1]*K,Q[2]=$[2]*K,Q[3]=$[3]*K,Q[4]=$[4]*K,Q[5]=$[5]*K,Q[6]=$[6]*K,Q[7]=$[7]*K,Q[8]=$[8]*K,Q[9]=$[9]*K,Q[10]=$[10]*K,Q[11]=$[11]*K,Q[12]=$[12]*K,Q[13]=$[13]*K,Q[14]=$[14]*K,Q[15]=$[15]*K,Q}function E$(Q,$,K,J){return Q[0]=$[0]+K[0]*J,Q[1]=$[1]+K[1]*J,Q[2]=$[2]+K[2]*J,Q[3]=$[3]+K[3]*J,Q[4]=$[4]+K[4]*J,Q[5]=$[5]+K[5]*J,Q[6]=$[6]+K[6]*J,Q[7]=$[7]+K[7]*J,Q[8]=$[8]+K[8]*J,Q[9]=$[9]+K[9]*J,Q[10]=$[10]+K[10]*J,Q[11]=$[11]+K[11]*J,Q[12]=$[12]+K[12]*J,Q[13]=$[13]+K[13]*J,Q[14]=$[14]+K[14]*J,Q[15]=$[15]+K[15]*J,Q}function D$(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]&&Q[3]===$[3]&&Q[4]===$[4]&&Q[5]===$[5]&&Q[6]===$[6]&&Q[7]===$[7]&&Q[8]===$[8]&&Q[9]===$[9]&&Q[10]===$[10]&&Q[11]===$[11]&&Q[12]===$[12]&&Q[13]===$[13]&&Q[14]===$[14]&&Q[15]===$[15]}function R$(Q,$){var K=Q[0],J=Q[1],Z=Q[2],B=Q[3],V=Q[4],Y=Q[5],P=Q[6],F=Q[7],H=Q[8],C=Q[9],A=Q[10],W=Q[11],j=Q[12],U=Q[13],X=Q[14],E=Q[15],M=$[0],N=$[1],_=$[2],D=$[3],R=$[4],w=$[5],S=$[6],h=$[7],I=$[8],v=$[9],p=$[10],f=$[11],G=$[12],y=$[13],d=$[14],i=$[15];return Math.abs(K-M)<=k*Math.max(1,Math.abs(K),Math.abs(M))&&Math.abs(J-N)<=k*Math.max(1,Math.abs(J),Math.abs(N))&&Math.abs(Z-_)<=k*Math.max(1,Math.abs(Z),Math.abs(_))&&Math.abs(B-D)<=k*Math.max(1,Math.abs(B),Math.abs(D))&&Math.abs(V-R)<=k*Math.max(1,Math.abs(V),Math.abs(R))&&Math.abs(Y-w)<=k*Math.max(1,Math.abs(Y),Math.abs(w))&&Math.abs(P-S)<=k*Math.max(1,Math.abs(P),Math.abs(S))&&Math.abs(F-h)<=k*Math.max(1,Math.abs(F),Math.abs(h))&&Math.abs(H-I)<=k*Math.max(1,Math.abs(H),Math.abs(I))&&Math.abs(C-v)<=k*Math.max(1,Math.abs(C),Math.abs(v))&&Math.abs(A-p)<=k*Math.max(1,Math.abs(A),Math.abs(p))&&Math.abs(W-f)<=k*Math.max(1,Math.abs(W),Math.abs(f))&&Math.abs(j-G)<=k*Math.max(1,Math.abs(j),Math.abs(G))&&Math.abs(U-y)<=k*Math.max(1,Math.abs(U),Math.abs(y))&&Math.abs(X-d)<=k*Math.max(1,Math.abs(X),Math.abs(d))&&Math.abs(E-i)<=k*Math.max(1,Math.abs(E),Math.abs(i))}var Y$=n0,H$=d0,_$=c0,N$=i0;var b={};H0(b,{str:()=>{{return EK}},squaredLength:()=>{{return RQ}},sqrLen:()=>{{return TK}},sqlerp:()=>{{return IK}},slerp:()=>{{return t}},setAxisAngle:()=>{{return XQ}},setAxes:()=>{{return wK}},set:()=>{{return NK}},scale:()=>{{return OQ}},rotationTo:()=>{{return hK}},rotateZ:()=>{{return CK}},rotateY:()=>{{return HK}},rotateX:()=>{{return FK}},random:()=>{{return AK}},pow:()=>{{return WK}},normalize:()=>{{return A0}},multiply:()=>{{return WQ}},mul:()=>{{return MK}},ln:()=>{{return UQ}},lerp:()=>{{return GK}},length:()=>{{return DQ}},len:()=>{{return qK}},invert:()=>{{return UK}},identity:()=>{{return VK}},getAxisAngle:()=>{{return YK}},getAngle:()=>{{return PK}},fromValues:()=>{{return RK}},fromMat3:()=>{{return jQ}},fromEuler:()=>{{return OK}},exp:()=>{{return AQ}},exactEquals:()=>{{return LK}},equals:()=>{{return SK}},dot:()=>{{return EQ}},create:()=>{{return W0}},copy:()=>{{return _K}},conjugate:()=>{{return jK}},clone:()=>{{return DK}},calculateW:()=>{{return XK}},add:()=>{{return kK}}});var m={};H0(m,{zero:()=>{{return r$}},transformQuat:()=>{{return m$}},transformMat4:()=>{{return c$}},transformMat3:()=>{{return l$}},subtract:()=>{{return r0}},sub:()=>{{return o$}},str:()=>{{return b$}},squaredLength:()=>{{return a0}},squaredDistance:()=>{{return o0}},sqrLen:()=>{{return KK}},sqrDist:()=>{{return $K}},set:()=>{{return G$}},scaleAndAdd:()=>{{return v$}},scale:()=>{{return w$}},round:()=>{{return I$}},rotateZ:()=>{{return i$}},rotateY:()=>{{return d$}},rotateX:()=>{{return n$}},random:()=>{{return x$}},normalize:()=>{{return C0}},negate:()=>{{return p$}},multiply:()=>{{return b0}},mul:()=>{{return a$}},min:()=>{{return S$}},max:()=>{{return h$}},lerp:()=>{{return f$}},length:()=>{{return s0}},len:()=>{{return X0}},inverse:()=>{{return g$}},hermite:()=>{{return y$}},fromValues:()=>{{return o}},forEach:()=>{{return JK}},floor:()=>{{return L$}},exactEquals:()=>{{return e$}},equals:()=>{{return u$}},dot:()=>{{return a}},divide:()=>{{return e0}},div:()=>{{return t$}},distance:()=>{{return u0}},dist:()=>{{return QK}},cross:()=>{{return r}},create:()=>{{return u}},copy:()=>{{return M$}},clone:()=>{{return k$}},ceil:()=>{{return T$}},bezier:()=>{{return z$}},angle:()=>{{return s$}},add:()=>{{return q$}}});function u(){var Q=new T(3);if(T!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q}function k$(Q){var $=new T(3);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$}function s0(Q){var $=Q[0],K=Q[1],J=Q[2];return Math.hypot($,K,J)}function o(Q,$,K){var J=new T(3);return J[0]=Q,J[1]=$,J[2]=K,J}function M$(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q}function G$(Q,$,K,J){return Q[0]=$,Q[1]=K,Q[2]=J,Q}function q$(Q,$,K){return Q[0]=$[0]+K[0],Q[1]=$[1]+K[1],Q[2]=$[2]+K[2],Q}function r0(Q,$,K){return Q[0]=$[0]-K[0],Q[1]=$[1]-K[1],Q[2]=$[2]-K[2],Q}function b0(Q,$,K){return Q[0]=$[0]*K[0],Q[1]=$[1]*K[1],Q[2]=$[2]*K[2],Q}function e0(Q,$,K){return Q[0]=$[0]/K[0],Q[1]=$[1]/K[1],Q[2]=$[2]/K[2],Q}function T$(Q,$){return Q[0]=Math.ceil($[0]),Q[1]=Math.ceil($[1]),Q[2]=Math.ceil($[2]),Q}function L$(Q,$){return Q[0]=Math.floor($[0]),Q[1]=Math.floor($[1]),Q[2]=Math.floor($[2]),Q}function S$(Q,$,K){return Q[0]=Math.min($[0],K[0]),Q[1]=Math.min($[1],K[1]),Q[2]=Math.min($[2],K[2]),Q}function h$(Q,$,K){return Q[0]=Math.max($[0],K[0]),Q[1]=Math.max($[1],K[1]),Q[2]=Math.max($[2],K[2]),Q}function I$(Q,$){return Q[0]=Math.round($[0]),Q[1]=Math.round($[1]),Q[2]=Math.round($[2]),Q}function w$(Q,$,K){return Q[0]=$[0]*K,Q[1]=$[1]*K,Q[2]=$[2]*K,Q}function v$(Q,$,K,J){return Q[0]=$[0]+K[0]*J,Q[1]=$[1]+K[1]*J,Q[2]=$[2]+K[2]*J,Q}function u0(Q,$){var K=$[0]-Q[0],J=$[1]-Q[1],Z=$[2]-Q[2];return Math.hypot(K,J,Z)}function o0(Q,$){var K=$[0]-Q[0],J=$[1]-Q[1],Z=$[2]-Q[2];return K*K+J*J+Z*Z}function a0(Q){var $=Q[0],K=Q[1],J=Q[2];return $*$+K*K+J*J}function p$(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q[2]=-$[2],Q}function g$(Q,$){return Q[0]=1/$[0],Q[1]=1/$[1],Q[2]=1/$[2],Q}function C0(Q,$){var K=$[0],J=$[1],Z=$[2],B=K*K+J*J+Z*Z;if(B>0)B=1/Math.sqrt(B);return Q[0]=$[0]*B,Q[1]=$[1]*B,Q[2]=$[2]*B,Q}function a(Q,$){return Q[0]*$[0]+Q[1]*$[1]+Q[2]*$[2]}function r(Q,$,K){var J=$[0],Z=$[1],B=$[2],V=K[0],Y=K[1],P=K[2];return Q[0]=Z*P-B*Y,Q[1]=B*V-J*P,Q[2]=J*Y-Z*V,Q}function f$(Q,$,K,J){var Z=$[0],B=$[1],V=$[2];return Q[0]=Z+J*(K[0]-Z),Q[1]=B+J*(K[1]-B),Q[2]=V+J*(K[2]-V),Q}function y$(Q,$,K,J,Z,B){var V=B*B,Y=V*(2*B-3)+1,P=V*(B-2)+B,F=V*(B-1),H=V*(3-2*B);return Q[0]=$[0]*Y+K[0]*P+J[0]*F+Z[0]*H,Q[1]=$[1]*Y+K[1]*P+J[1]*F+Z[1]*H,Q[2]=$[2]*Y+K[2]*P+J[2]*F+Z[2]*H,Q}function z$(Q,$,K,J,Z,B){var V=1-B,Y=V*V,P=B*B,F=Y*V,H=3*B*Y,C=3*P*V,A=P*B;return Q[0]=$[0]*F+K[0]*H+J[0]*C+Z[0]*A,Q[1]=$[1]*F+K[1]*H+J[1]*C+Z[1]*A,Q[2]=$[2]*F+K[2]*H+J[2]*C+Z[2]*A,Q}function x$(Q,$){$=$||1;var K=l()*2*Math.PI,J=l()*2-1,Z=Math.sqrt(1-J*J)*$;return Q[0]=Math.cos(K)*Z,Q[1]=Math.sin(K)*Z,Q[2]=J*$,Q}function c$(Q,$,K){var J=$[0],Z=$[1],B=$[2],V=K[3]*J+K[7]*Z+K[11]*B+K[15];return V=V||1,Q[0]=(K[0]*J+K[4]*Z+K[8]*B+K[12])/V,Q[1]=(K[1]*J+K[5]*Z+K[9]*B+K[13])/V,Q[2]=(K[2]*J+K[6]*Z+K[10]*B+K[14])/V,Q}function l$(Q,$,K){var J=$[0],Z=$[1],B=$[2];return Q[0]=J*K[0]+Z*K[3]+B*K[6],Q[1]=J*K[1]+Z*K[4]+B*K[7],Q[2]=J*K[2]+Z*K[5]+B*K[8],Q}function m$(Q,$,K){var J=K[0],Z=K[1],B=K[2],V=K[3],Y=$[0],P=$[1],F=$[2],H=Z*F-B*P,C=B*Y-J*F,A=J*P-Z*Y,W=Z*A-B*C,j=B*H-J*A,U=J*C-Z*H,X=V*2;return H*=X,C*=X,A*=X,W*=2,j*=2,U*=2,Q[0]=Y+H+W,Q[1]=P+C+j,Q[2]=F+A+U,Q}function n$(Q,$,K,J){var Z=[],B=[];return Z[0]=$[0]-K[0],Z[1]=$[1]-K[1],Z[2]=$[2]-K[2],B[0]=Z[0],B[1]=Z[1]*Math.cos(J)-Z[2]*Math.sin(J),B[2]=Z[1]*Math.sin(J)+Z[2]*Math.cos(J),Q[0]=B[0]+K[0],Q[1]=B[1]+K[1],Q[2]=B[2]+K[2],Q}function d$(Q,$,K,J){var Z=[],B=[];return Z[0]=$[0]-K[0],Z[1]=$[1]-K[1],Z[2]=$[2]-K[2],B[0]=Z[2]*Math.sin(J)+Z[0]*Math.cos(J),B[1]=Z[1],B[2]=Z[2]*Math.cos(J)-Z[0]*Math.sin(J),Q[0]=B[0]+K[0],Q[1]=B[1]+K[1],Q[2]=B[2]+K[2],Q}function i$(Q,$,K,J){var Z=[],B=[];return Z[0]=$[0]-K[0],Z[1]=$[1]-K[1],Z[2]=$[2]-K[2],B[0]=Z[0]*Math.cos(J)-Z[1]*Math.sin(J),B[1]=Z[0]*Math.sin(J)+Z[1]*Math.cos(J),B[2]=Z[2],Q[0]=B[0]+K[0],Q[1]=B[1]+K[1],Q[2]=B[2]+K[2],Q}function s$(Q,$){var K=Q[0],J=Q[1],Z=Q[2],B=$[0],V=$[1],Y=$[2],P=Math.sqrt(K*K+J*J+Z*Z),F=Math.sqrt(B*B+V*V+Y*Y),H=P*F,C=H&&a(Q,$)/H;return Math.acos(Math.min(Math.max(C,-1),1))}function r$(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q}function b$(Q){return"vec3("+Q[0]+", "+Q[1]+", "+Q[2]+")"}function e$(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]}function u$(Q,$){var K=Q[0],J=Q[1],Z=Q[2],B=$[0],V=$[1],Y=$[2];return Math.abs(K-B)<=k*Math.max(1,Math.abs(K),Math.abs(B))&&Math.abs(J-V)<=k*Math.max(1,Math.abs(J),Math.abs(V))&&Math.abs(Z-Y)<=k*Math.max(1,Math.abs(Z),Math.abs(Y))}var o$=r0,a$=b0,t$=e0,QK=u0,$K=o0,X0=s0,KK=a0,JK=function(){var Q=u();return function($,K,J,Z,B,V){var Y,P;if(!K)K=3;if(!J)J=0;if(Z)P=Math.min(Z*K+J,$.length);else P=$.length;for(Y=J;Y<P;Y+=K)Q[0]=$[Y],Q[1]=$[Y+1],Q[2]=$[Y+2],B(Q,Q,V),$[Y]=Q[0],$[Y+1]=Q[1],$[Y+2]=Q[2];return $}}();function ZK(){var Q=new T(4);if(T!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0;return Q}function t0(Q){var $=new T(4);return $[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=Q[3],$}function QQ(Q,$,K,J){var Z=new T(4);return Z[0]=Q,Z[1]=$,Z[2]=K,Z[3]=J,Z}function $Q(Q,$){return Q[0]=$[0],Q[1]=$[1],Q[2]=$[2],Q[3]=$[3],Q}function KQ(Q,$,K,J,Z){return Q[0]=$,Q[1]=K,Q[2]=J,Q[3]=Z,Q}function JQ(Q,$,K){return Q[0]=$[0]+K[0],Q[1]=$[1]+K[1],Q[2]=$[2]+K[2],Q[3]=$[3]+K[3],Q}function ZQ(Q,$,K){return Q[0]=$[0]*K,Q[1]=$[1]*K,Q[2]=$[2]*K,Q[3]=$[3]*K,Q}function BQ(Q){var $=Q[0],K=Q[1],J=Q[2],Z=Q[3];return Math.hypot($,K,J,Z)}function VQ(Q){var $=Q[0],K=Q[1],J=Q[2],Z=Q[3];return $*$+K*K+J*J+Z*Z}function YQ(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[3],V=K*K+J*J+Z*Z+B*B;if(V>0)V=1/Math.sqrt(V);return Q[0]=K*V,Q[1]=J*V,Q[2]=Z*V,Q[3]=B*V,Q}function PQ(Q,$){return Q[0]*$[0]+Q[1]*$[1]+Q[2]*$[2]+Q[3]*$[3]}function FQ(Q,$,K,J){var Z=$[0],B=$[1],V=$[2],Y=$[3];return Q[0]=Z+J*(K[0]-Z),Q[1]=B+J*(K[1]-B),Q[2]=V+J*(K[2]-V),Q[3]=Y+J*(K[3]-Y),Q}function HQ(Q,$){return Q[0]===$[0]&&Q[1]===$[1]&&Q[2]===$[2]&&Q[3]===$[3]}function CQ(Q,$){var K=Q[0],J=Q[1],Z=Q[2],B=Q[3],V=$[0],Y=$[1],P=$[2],F=$[3];return Math.abs(K-V)<=k*Math.max(1,Math.abs(K),Math.abs(V))&&Math.abs(J-Y)<=k*Math.max(1,Math.abs(J),Math.abs(Y))&&Math.abs(Z-P)<=k*Math.max(1,Math.abs(Z),Math.abs(P))&&Math.abs(B-F)<=k*Math.max(1,Math.abs(B),Math.abs(F))}var rK=function(){var Q=ZK();return function($,K,J,Z,B,V){var Y,P;if(!K)K=4;if(!J)J=0;if(Z)P=Math.min(Z*K+J,$.length);else P=$.length;for(Y=J;Y<P;Y+=K)Q[0]=$[Y],Q[1]=$[Y+1],Q[2]=$[Y+2],Q[3]=$[Y+3],B(Q,Q,V),$[Y]=Q[0],$[Y+1]=Q[1],$[Y+2]=Q[2],$[Y+3]=Q[3];return $}}();function W0(){var Q=new T(4);if(T!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q[3]=1,Q}function VK(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q}function XQ(Q,$,K){K=K*0.5;var J=Math.sin(K);return Q[0]=J*$[0],Q[1]=J*$[1],Q[2]=J*$[2],Q[3]=Math.cos(K),Q}function YK(Q,$){var K=Math.acos($[3])*2,J=Math.sin(K/2);if(J>k)Q[0]=$[0]/J,Q[1]=$[1]/J,Q[2]=$[2]/J;else Q[0]=1,Q[1]=0,Q[2]=0;return K}function PK(Q,$){var K=EQ(Q,$);return Math.acos(2*K*K-1)}function WQ(Q,$,K){var J=$[0],Z=$[1],B=$[2],V=$[3],Y=K[0],P=K[1],F=K[2],H=K[3];return Q[0]=J*H+V*Y+Z*F-B*P,Q[1]=Z*H+V*P+B*Y-J*F,Q[2]=B*H+V*F+J*P-Z*Y,Q[3]=V*H-J*Y-Z*P-B*F,Q}function FK(Q,$,K){K*=0.5;var J=$[0],Z=$[1],B=$[2],V=$[3],Y=Math.sin(K),P=Math.cos(K);return Q[0]=J*P+V*Y,Q[1]=Z*P+B*Y,Q[2]=B*P-Z*Y,Q[3]=V*P-J*Y,Q}function HK(Q,$,K){K*=0.5;var J=$[0],Z=$[1],B=$[2],V=$[3],Y=Math.sin(K),P=Math.cos(K);return Q[0]=J*P-B*Y,Q[1]=Z*P+V*Y,Q[2]=B*P+J*Y,Q[3]=V*P-Z*Y,Q}function CK(Q,$,K){K*=0.5;var J=$[0],Z=$[1],B=$[2],V=$[3],Y=Math.sin(K),P=Math.cos(K);return Q[0]=J*P+Z*Y,Q[1]=Z*P-J*Y,Q[2]=B*P+V*Y,Q[3]=V*P-B*Y,Q}function XK(Q,$){var K=$[0],J=$[1],Z=$[2];return Q[0]=K,Q[1]=J,Q[2]=Z,Q[3]=Math.sqrt(Math.abs(1-K*K-J*J-Z*Z)),Q}function AQ(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[3],V=Math.sqrt(K*K+J*J+Z*Z),Y=Math.exp(B),P=V>0?Y*Math.sin(V)/V:0;return Q[0]=K*P,Q[1]=J*P,Q[2]=Z*P,Q[3]=Y*Math.cos(V),Q}function UQ(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[3],V=Math.sqrt(K*K+J*J+Z*Z),Y=V>0?Math.atan2(V,B)/V:0;return Q[0]=K*Y,Q[1]=J*Y,Q[2]=Z*Y,Q[3]=0.5*Math.log(K*K+J*J+Z*Z+B*B),Q}function WK(Q,$,K){return UQ(Q,$),OQ(Q,Q,K),AQ(Q,Q),Q}function t(Q,$,K,J){var Z=$[0],B=$[1],V=$[2],Y=$[3],P=K[0],F=K[1],H=K[2],C=K[3],A,W,j,U,X;if(W=Z*P+B*F+V*H+Y*C,W<0)W=-W,P=-P,F=-F,H=-H,C=-C;if(1-W>k)A=Math.acos(W),j=Math.sin(A),U=Math.sin((1-J)*A)/j,X=Math.sin(J*A)/j;else U=1-J,X=J;return Q[0]=U*Z+X*P,Q[1]=U*B+X*F,Q[2]=U*V+X*H,Q[3]=U*Y+X*C,Q}function AK(Q){var $=l(),K=l(),J=l(),Z=Math.sqrt(1-$),B=Math.sqrt($);return Q[0]=Z*Math.sin(2*Math.PI*K),Q[1]=Z*Math.cos(2*Math.PI*K),Q[2]=B*Math.sin(2*Math.PI*J),Q[3]=B*Math.cos(2*Math.PI*J),Q}function UK(Q,$){var K=$[0],J=$[1],Z=$[2],B=$[3],V=K*K+J*J+Z*Z+B*B,Y=V?1/V:0;return Q[0]=-K*Y,Q[1]=-J*Y,Q[2]=-Z*Y,Q[3]=B*Y,Q}function jK(Q,$){return Q[0]=-$[0],Q[1]=-$[1],Q[2]=-$[2],Q[3]=$[3],Q}function jQ(Q,$){var K=$[0]+$[4]+$[8],J;if(K>0)J=Math.sqrt(K+1),Q[3]=0.5*J,J=0.5/J,Q[0]=($[5]-$[7])*J,Q[1]=($[6]-$[2])*J,Q[2]=($[1]-$[3])*J;else{var Z=0;if($[4]>$[0])Z=1;if($[8]>$[Z*3+Z])Z=2;var B=(Z+1)%3,V=(Z+2)%3;J=Math.sqrt($[Z*3+Z]-$[B*3+B]-$[V*3+V]+1),Q[Z]=0.5*J,J=0.5/J,Q[3]=($[B*3+V]-$[V*3+B])*J,Q[B]=($[B*3+Z]+$[Z*3+B])*J,Q[V]=($[V*3+Z]+$[Z*3+V])*J}return Q}function OK(Q,$,K,J){var Z=0.5*Math.PI/180;$*=Z,K*=Z,J*=Z;var B=Math.sin($),V=Math.cos($),Y=Math.sin(K),P=Math.cos(K),F=Math.sin(J),H=Math.cos(J);return Q[0]=B*P*H-V*Y*F,Q[1]=V*Y*H+B*P*F,Q[2]=V*P*F-B*Y*H,Q[3]=V*P*H+B*Y*F,Q}function EK(Q){return"quat("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+")"}var DK=t0,RK=QQ,_K=$Q,NK=KQ,kK=JQ,MK=WQ,OQ=ZQ,EQ=PQ,GK=FQ,DQ=BQ,qK=DQ,RQ=VQ,TK=RQ,A0=YQ,LK=HQ,SK=CQ,hK=function(){var Q=u(),$=o(1,0,0),K=o(0,1,0);return function(J,Z,B){var V=a(Z,B);if(V<-0.999999){if(r(Q,$,Z),X0(Q)<0.000001)r(Q,K,Z);return C0(Q,Q),XQ(J,Q,Math.PI),J}else if(V>0.999999)return J[0]=0,J[1]=0,J[2]=0,J[3]=1,J;else return r(Q,Z,B),J[0]=Q[0],J[1]=Q[1],J[2]=Q[2],J[3]=1+V,A0(J,J)}}(),IK=function(){var Q=W0(),$=W0();return function(K,J,Z,B,V,Y){return t(Q,J,V,Y),t($,Z,B,Y),t(K,Q,$,2*Y*(1-Y)),K}}(),wK=function(){var Q=z0();return function($,K,J,Z){return Q[0]=J[0],Q[3]=J[1],Q[6]=J[2],Q[1]=Z[0],Q[4]=Z[1],Q[7]=Z[2],Q[2]=-K[0],Q[5]=-K[1],Q[8]=-K[2],A0($,jQ($,Q))}}();var vK=Math.PI/90;class z{m4=Float32Array.from(q.create());constructor(){this.identity()}static create(){return new z}identity(){return q.identity(this.m4),this}invert(Q){return q.invert(this.m4,Q.getMatrix()),this}multiply(Q){return q.multiply(this.m4,this.m4,Q.getMatrix()),this}multiply2(Q,$){return q.multiply(this.m4,Q.getMatrix(),$.getMatrix()),this}multiply3(Q,$,K){return this.multiply2(Q,$),this.multiply(K),this}translate(Q,$,K){return q.translate(this.m4,this.m4,[Q,$,K]),this}translateToMatrix(Q){const $=Q.getMatrix();return this.translate(-$[12],-$[13],-$[14])}rotateX(Q){return q.rotateX(this.m4,this.m4,Q),this}rotateY(Q){return q.rotateY(this.m4,this.m4,Q),this}rotateZ(Q){return q.rotateZ(this.m4,this.m4,Q),this}scale(Q,$,K){return q.scale(this.m4,this.m4,[Q,$,K]),this}perspective(Q,$,K,J){return q.perspective(this.m4,Q*vK,$,K,J),this}ortho(Q,$,K,J,Z,B){return q.ortho(this.m4,Q,$,K,J,Z,B),this}static aTemp=q.create();static bTemp=q.create();combine(Q,$,K=0.5){return q.multiplyScalar(z.aTemp,Q.getMatrix(),1-K),q.multiplyScalar(z.bTemp,$.getMatrix(),K),q.add(this.m4,z.aTemp,z.bTemp),this}static tempQuat=b.create();moveMatrix(Q,$,K,J){const Z=m.fromValues(-Q,$,K);if(J)q.getRotation(z.tempQuat,J.getMatrix()),b.invert(z.tempQuat,z.tempQuat),m.transformQuat(Z,Z,z.tempQuat);return q.translate(this.m4,this.m4,Z),this}getMatrix(){return this.m4}}var L=z;var U0=0,j0=1,O0=2,E0=3,D0=4;class R0{updatedSpriteTransforms=new Set;updatedSpriteTextureSlots=new Set;updateSpriteIds=new Set;hudSpriteId=0;constructor(){this.sprites.forEach((Q,$)=>{this.updatedSpriteTransforms.add($),this.updatedSpriteTextureSlots.add($)}),[j0,O0,E0,U0,D0].forEach((Q)=>this.updateSpriteIds.add(Q))}getUpdateImageIds(){return this.updateSpriteIds}getUpdatedSpriteTextureSlot(){return this.updatedSpriteTextureSlots}async drawImage(Q,$){switch(Q){case D0:await $.loadVideo(Q,"sample.mp4",0);break;case U0:await $.loadImage(Q,"dobuki.png");break;case j0:$.drawImage(Q,(J)=>{const{canvas:Z}=J;Z.width=512,Z.height=512;const B=Z.width/2,V=Z.height/2,Y=Z.width/2;J.imageSmoothingEnabled=!0,J.fillStyle="#ddd",J.lineWidth=Z.width/50,J.fillRect(0,0,Z.width,Z.height),J.strokeStyle="black",J.fillStyle="gold",J.beginPath(),J.arc(B,V,Y*0.8,0,2*Math.PI),J.fill(),J.stroke(),J.beginPath(),J.arc(B,V,Y*0.5,0,Math.PI),J.stroke(),J.beginPath(),J.arc(Z.width/3,Z.height/3,Y*0.1,0,Math.PI,!0),J.stroke(),J.beginPath(),J.arc(Z.width/3*2,Z.height/3,Y*0.1,0,Math.PI*2,!0),J.stroke()});break;case O0:$.drawImage(Q,(J)=>{const{canvas:Z}=J;Z.width=512,Z.height=512,J.imageSmoothingEnabled=!0,J.fillStyle="#ddd",J.lineWidth=Z.width/50,J.fillRect(0,0,Z.width,Z.height),J.strokeStyle="black",J.fillStyle="silver",J.beginPath(),J.rect(Z.width*0.2,Z.height*0.2,Z.width*0.6,Z.height*0.6),J.fill(),J.stroke()});break;case E0:$.drawImage(Q,(J)=>{const{canvas:Z}=J;Z.width=512,Z.height=512,J.imageSmoothingEnabled=!0,J.fillStyle="#ddd",J.lineWidth=Z.width/50,J.strokeStyle="black",J.fillStyle="silver",J.beginPath(),J.rect(30,30,Z.width-60,Z.height-60),J.stroke()});break}}hudMatrix=L.create();sprites=[{imageId:E0,transforms:[this.hudMatrix.getMatrix()]},{imageId:U0,transforms:[L.create().translate(0,0,0).getMatrix()]},...[L.create().translate(-1,0,1).rotateY(Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(1,0,1).rotateY(-Math.PI/2).scale(1,1,1).getMatrix()].map((Q)=>({imageId:j0,transforms:[Q]})),...[L.create().translate(0,-1,1).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(0,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(-2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix()].map((Q)=>({imageId:O0,transforms:[Q]})),{imageId:D0,transforms:[L.create().translate(0,5,-10).scale(9.6,5.4,1).getMatrix()]}];getMaxSpriteCount(){return this.sprites.length}getSprite(Q){return this.sprites[Q]}syncWithCamera(Q){if(this.keys.KeyW)Q.moveCam(0,0,0.25);if(this.keys.KeyS)Q.moveCam(0,0,-0.25);if(this.keys.ArrowUp&&!this.keys.ShiftRight)Q.moveCam(0,-0.25,0);if(this.keys.ArrowDown&&!this.keys.ShiftRight)Q.moveCam(0,0.25,0);if(this.keys.KeyA||this.keys.ArrowLeft&&!this.keys.ShiftRight)Q.moveCam(-0.25,0,0);if(this.keys.KeyD||this.keys.ArrowRight&&!this.keys.ShiftRight)Q.moveCam(0.25,0,0);if(this.keys.KeyQ||this.keys.ArrowLeft&&this.keys.ShiftRight)Q.turnCam(-0.05);if(this.keys.KeyE||this.keys.ArrowRight&&this.keys.ShiftRight)Q.turnCam(0.05);if(this.keys.ArrowUp&&this.keys.ShiftRight)Q.tilt(-0.05);if(this.keys.ArrowDown&&this.keys.ShiftRight)Q.tilt(0.05);if(Q.refresh())Q.syncHud(this.hudMatrix),this.updatedSpriteTransforms.add(this.hudSpriteId)}getUpdatedSpriteTransforms(){return this.updatedSpriteTransforms}keys={};activate(){const Q=(K)=>this.keys[K.code]=!0,$=(K)=>this.keys[K.code]=!1;return document.addEventListener("keydown",Q),document.addEventListener("keyup",$),()=>{document.removeEventListener("keydown",Q),document.removeEventListener("keyup",$)}}}class g{disposables;own(Q){if(!this.disposables)this.disposables=new Set;return this.disposables.add(Q),Q}addOnDestroy(Q){this.disposables?.add({destroy:Q})}destroy(){this.disposables?.forEach((Q)=>Q.destroy())}}var O=globalThis.WebGL2RenderingContext??{},_Q="position",NQ="index",_0="transform",N0="slotSize_and_number",kQ="cam",MQ="projection",GQ="maxTextureSize",qQ="uTextures";var pK=function(Q,$,K){function J(H,C){function A(j){return j===Q?.VERTEX_SHADER?"vertex":j===Q?.FRAGMENT_SHADER?"fragment":void 0}if(C!==Q.VERTEX_SHADER&&C!==Q.FRAGMENT_SHADER)throw new Error(`Shader error in ${A(C)}`);const W=Q.createShader(C);if(!W)throw new Error(`Unable to generate ${A(C)} shader.`);if(Q.shaderSource(W,H),Q.compileShader(W),!Q.getShaderParameter(W,Q.COMPILE_STATUS))console.error(`Shader compile error in ${A(C)}:`+Q.getShaderInfoLog(W));return W}const Z=Q.createProgram();if(!Z)throw new Error("Unable to create program.");const B=J($,Q.VERTEX_SHADER),V=J(K,Q.FRAGMENT_SHADER),Y=Q.getShaderInfoLog(B),P=Q.getShaderInfoLog(V);if(Y)console.log("VERTEX",Y);if(P)console.log("FRAGMENT",P);Q.attachShader(Z,B),Q.attachShader(Z,V),Q.linkProgram(Z);const F=Q.getProgramInfoLog(Z);if(F)console.log("PROGRAM",F);if(Q.detachShader(Z,B),Q.detachShader(Z,V),Q.deleteShader(B),Q.deleteShader(V),Q.validateProgram(Z),Object.entries(O).forEach(([H,C])=>{if(C&&Q.getError()===C)console.log(`gl.${H}`)}),!Q.getProgramParameter(Z,Q.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+Q.getProgramInfoLog(Z));return Z},gK=function(Q,$){Q.deleteProgram($)};class k0 extends g{gl;program;constructor(Q,$,K){super();this.gl=Q,this.program=pK(Q,$.trim(),K.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),gK(this.gl,this.program)}}class M0 extends g{activeProgramId="";gl;programs={};constructor(Q){super();this.gl=Q}addProgram(Q,$,K){if(this.programs[Q])this.removeProgram(Q);this.programs[Q]=this.own(new k0(this.gl,$,K))}useProgram(Q){if(this.activeProgramId!==Q)this.activeProgramId=Q,this.programs[Q].use()}removeProgram(Q){this.programs[Q].destroy(),delete this.programs[Q]}getProgram(Q){return this.programs[Q??this.activeProgramId]?.program}}class G0 extends g{gl;triangleArray;constructor(Q){super();this.gl=Q,this.triangleArray=Q.createVertexArray(),Q.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class q0 extends g{bufferRecord={};gl;programs;constructor(Q,$){super();this.gl=Q,this.programs=$}getAttributeLocation(Q,$){const K=this.programs.getProgram($);return K?this.gl.getAttribLocation(K,Q)??-1:-1}createBuffer(Q){this.deleteBuffer(Q);const $=this.gl?.createBuffer();if(!$)throw new Error(`Unable to create buffer "${Q}"`);const K={buffer:$,location:this.getAttributeLocation(Q)};return this.bufferRecord[Q]=K,K}deleteBuffer(Q){if(this.bufferRecord[Q])this.gl.deleteBuffer(this.bufferRecord[Q].buffer),delete this.bufferRecord[Q]}getAttributeBuffer(Q){const $=this.bufferRecord[Q];if(!$)throw new Error(`Attribute "${Q}" not created. Make sure "createBuffer" is called.`);return $}destroy(){Object.keys(this.bufferRecord).forEach((Q)=>this.deleteBuffer(Q))}}class T0 extends g{gl;programs;constructor(Q,$){super();this.gl=Q,this.programs=$}getUniformLocation(Q,$){const K=this.programs.getProgram($);return this.gl.getUniformLocation(K,Q)}}function TQ(Q,$=(K)=>K.key){var K=[];return L0(Q,"",!0,(J)=>K.push(J),$),K.join("")}var L0=function(Q,$,K,J,Z){if(Q){J(`${$}${K?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${Z(Q)}\n`);const B=$+(K?"    ":"\u2502   ");if(Q.left)L0(Q.left,B,!1,J,Z);if(Q.right)L0(Q.right,B,!0,J,Z)}};function Q0(Q){if(Q===null)return!0;var $=$0(Q.left),K=$0(Q.right);if(Math.abs($-K)<=1&&Q0(Q.left)&&Q0(Q.right))return!0;return!1}var $0=function(Q){return Q?1+Math.max($0(Q.left),$0(Q.right)):0};function K0(Q,$,K,J,Z){const B=Z-J;if(B>0){const V=J+Math.floor(B/2),Y=$[V],P=K[V],F={key:Y,data:P,parent:Q};return F.left=K0(F,$,K,J,V),F.right=K0(F,$,K,V+1,Z),F}return null}function J0(Q){if(Q===null)return 0;const $=J0(Q.left),K=J0(Q.right);return Q.balanceFactor=$-K,Math.max($,K)+1}function Z0(Q,$,K,J,Z){if(K>=J)return;const B=Q[K+J>>1];let V=K-1,Y=J+1;while(!0){do V++;while(Z(Q[V],B)<0);do Y--;while(Z(Q[Y],B)>0);if(V>=Y)break;let P=Q[V];Q[V]=Q[Y],Q[Y]=P,P=$[V],$[V]=$[Y],$[Y]=P}Z0(Q,$,K,Y,Z),Z0(Q,$,Y+1,J,Z)}var fK=function(Q,$){return Q>$?1:Q<$?-1:0},B0=function(Q){var $=Q.right;if(Q.right=$.left,$.left)$.left.parent=Q;if($.parent=Q.parent,$.parent)if($.parent.left===Q)$.parent.left=$;else $.parent.right=$;if(Q.parent=$,$.left=Q,Q.balanceFactor+=1,$.balanceFactor<0)Q.balanceFactor-=$.balanceFactor;if($.balanceFactor+=1,Q.balanceFactor>0)$.balanceFactor+=Q.balanceFactor;return $},V0=function(Q){var $=Q.left;if(Q.left=$.right,Q.left)Q.left.parent=Q;if($.parent=Q.parent,$.parent)if($.parent.left===Q)$.parent.left=$;else $.parent.right=$;if(Q.parent=$,$.right=Q,Q.balanceFactor-=1,$.balanceFactor>0)Q.balanceFactor-=$.balanceFactor;if($.balanceFactor-=1,Q.balanceFactor<0)$.balanceFactor+=Q.balanceFactor;return $};class n{constructor(Q,$=!1){this._comparator=Q||fK,this._root=null,this._size=0,this._noDuplicates=!!$}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(Q){if(this._root){var $=this._root,K=this._comparator;while($){var J=K(Q,$.key);if(J===0)return!0;else if(J<0)$=$.left;else $=$.right}}return!1}next(Q){var $=Q;if($)if($.right){$=$.right;while($.left)$=$.left}else{$=Q.parent;while($&&$.right===Q)Q=$,$=$.parent}return $}prev(Q){var $=Q;if($)if($.left){$=$.left;while($.right)$=$.right}else{$=Q.parent;while($&&$.left===Q)Q=$,$=$.parent}return $}forEach(Q){var $=this._root,K=[],J=!1,Z=0;while(!J)if($)K.push($),$=$.left;else if(K.length>0)$=K.pop(),Q($,Z++),$=$.right;else J=!0;return this}range(Q,$,K,J){const Z=[],B=this._comparator;let V=this._root,Y;while(Z.length!==0||V)if(V)Z.push(V),V=V.left;else{if(V=Z.pop(),Y=B(V.key,$),Y>0)break;else if(B(V.key,Q)>=0){if(K.call(J,V))return this}V=V.right}return this}keys(){var Q=this._root,$=[],K=[],J=!1;while(!J)if(Q)$.push(Q),Q=Q.left;else if($.length>0)Q=$.pop(),K.push(Q.key),Q=Q.right;else J=!0;return K}values(){var Q=this._root,$=[],K=[],J=!1;while(!J)if(Q)$.push(Q),Q=Q.left;else if($.length>0)Q=$.pop(),K.push(Q.data),Q=Q.right;else J=!0;return K}at(Q){var $=this._root,K=[],J=!1,Z=0;while(!J)if($)K.push($),$=$.left;else if(K.length>0){if($=K.pop(),Z===Q)return $;Z++,$=$.right}else J=!0;return null}minNode(){var Q=this._root;if(!Q)return null;while(Q.left)Q=Q.left;return Q}maxNode(){var Q=this._root;if(!Q)return null;while(Q.right)Q=Q.right;return Q}min(){var Q=this._root;if(!Q)return null;while(Q.left)Q=Q.left;return Q.key}max(){var Q=this._root;if(!Q)return null;while(Q.right)Q=Q.right;return Q.key}isEmpty(){return!this._root}pop(){var Q=this._root,$=null;if(Q){while(Q.left)Q=Q.left;$={key:Q.key,data:Q.data},this.remove(Q.key)}return $}popMax(){var Q=this._root,$=null;if(Q){while(Q.right)Q=Q.right;$={key:Q.key,data:Q.data},this.remove(Q.key)}return $}find(Q){var $=this._root,K=$,J,Z=this._comparator;while(K)if(J=Z(Q,K.key),J===0)return K;else if(J<0)K=K.left;else K=K.right;return null}insert(Q,$){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:Q,data:$},this._size++,this._root;var K=this._comparator,J=this._root,Z=null,B=0;if(this._noDuplicates)while(J)if(B=K(Q,J.key),Z=J,B===0)return null;else if(B<0)J=J.left;else J=J.right;else while(J)if(B=K(Q,J.key),Z=J,B<=0)J=J.left;else J=J.right;var V={left:null,right:null,balanceFactor:0,parent:Z,key:Q,data:$},Y;if(B<=0)Z.left=V;else Z.right=V;while(Z){if(B=K(Z.key,Q),B<0)Z.balanceFactor-=1;else Z.balanceFactor+=1;if(Z.balanceFactor===0)break;else if(Z.balanceFactor<-1){if(Z.right.balanceFactor===1)V0(Z.right);if(Y=B0(Z),Z===this._root)this._root=Y;break}else if(Z.balanceFactor>1){if(Z.left.balanceFactor===-1)B0(Z.left);if(Y=V0(Z),Z===this._root)this._root=Y;break}Z=Z.parent}return this._size++,V}remove(Q){if(!this._root)return null;var $=this._root,K=this._comparator,J=0;while($)if(J=K(Q,$.key),J===0)break;else if(J<0)$=$.left;else $=$.right;if(!$)return null;var Z=$.key,B,V;if($.left){B=$.left;while(B.left||B.right){while(B.right)B=B.right;if($.key=B.key,$.data=B.data,B.left)$=B,B=B.left}$.key=B.key,$.data=B.data,$=B}if($.right){V=$.right;while(V.left||V.right){while(V.left)V=V.left;if($.key=V.key,$.data=V.data,V.right)$=V,V=V.right}$.key=V.key,$.data=V.data,$=V}var Y=$.parent,P=$,F;while(Y){if(Y.left===P)Y.balanceFactor-=1;else Y.balanceFactor+=1;if(Y.balanceFactor<-1){if(Y.right.balanceFactor===1)V0(Y.right);if(F=B0(Y),Y===this._root)this._root=F;Y=F}else if(Y.balanceFactor>1){if(Y.left.balanceFactor===-1)B0(Y.left);if(F=V0(Y),Y===this._root)this._root=F;Y=F}if(Y.balanceFactor===-1||Y.balanceFactor===1)break;P=Y,Y=Y.parent}if($.parent)if($.parent.left===$)$.parent.left=null;else $.parent.right=null;if($===this._root)this._root=null;return this._size--,Z}load(Q=[],$=[],K){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const J=Q.length;if(K)Z0(Q,$,0,J-1,this._comparator);return this._root=K0(null,Q,$,0,J),J0(this._root),this._size=J,this}isBalanced(){return Q0(this._root)}toString(Q){return TQ(this._root,Q)}}n.default=n;class x{size;slotNumber;x;y;textureIndex;parent;sibbling;textureSizeLimits;constructor(Q,$,K,J){this.textureSizeLimits=K?.textureSizeLimits??J??{min:S0,max:h0},this.size=Q,this.slotNumber=$,this.parent=K,this.sibbling=void 0;const{x:Z,y:B,textureIndex:V}=this.calculatePosition(Q,$);this.x=Z,this.y=B,this.textureIndex=V}calculateTextureIndex(Q,$){const[K,J]=Q,Z=this.textureSizeLimits.max/K*(this.textureSizeLimits.max/J);return Math.floor($/Z)}calculatePosition(Q,$){const[K,J]=Q,Z=this.textureSizeLimits.max/K,B=this.textureSizeLimits.max/J,V=$%Z*K,Y=Math.floor($/Z)%B*J;return{x:V,y:Y,textureIndex:this.calculateTextureIndex(Q,$)}}getTag(){return x.getTag(this)}static getTag(Q){return`${Q.size[0]}x${Q.size[1]}-#${Q.slotNumber}`}static positionToTextureSlot(Q,$,K,J,Z){const[B,V]=K,Y=Z.textureSizeLimits.max/B,F=Z.textureSizeLimits.max/B*(Z.textureSizeLimits.max/V)*J+$/V*Y+Q/B;return new x(K,F,Z)}getPosition(){return{x:this.x,y:this.y,size:this.size,textureIndex:this.textureIndex}}canSplitHorizontally(){const[,Q]=this.size;return Q>this.textureSizeLimits.min}canSplitVertically(){const[Q]=this.size;return Q>this.textureSizeLimits.min}splitHorizontally(){const{x:Q,y:$,size:K,textureIndex:J}=this,[Z,B]=K;if(!this.canSplitHorizontally())throw new Error(`Cannot split texture slot of size ${Z} horizontally`);const V=Z/2,Y=x.positionToTextureSlot(Q,$,[V,B],J,this),P=x.positionToTextureSlot(Q+V,$,[V,B],J,this);return Y.sibbling=P,P.sibbling=Y,[Y,P]}splitVertically(){const{x:Q,y:$,size:K,textureIndex:J}=this,[Z,B]=K;if(!this.canSplitVertically())throw new Error(`Cannot split texture slot of size ${B} vertically`);const V=B/2,Y=x.positionToTextureSlot(Q,$,[Z,V],J,this),P=x.positionToTextureSlot(Q,$+V,[Z,V],J,this);return Y.sibbling=P,P.sibbling=Y,[Y,P]}}function Y0(Q,$){return Math.max($,Math.pow(2,Math.ceil(Math.log(Q)/Math.log(2))))}function LQ(Q,$,K,J){if(K<1)throw new Error("Invalid count");const Z=Y0(Q,J.min),B=Y0($,J.min),V=new Map;let Y=J.min;for(let P=1;P<=K;P++){Y=Y0(Z*P,J.min);const F=Y0(B*Math.ceil(K/P),J.min);V.set(Y,F)}for(let P=Y;P<=J.max;P*=2)if(!V.has(P))V.set(P,B);return V}var yK=!1,S0=16,h0=4096,zK=16;class P0{textureSlots=new n((Q,$)=>{const K=Q.size[0]*Q.size[1]-$.size[0]*$.size[1];if(K!==0)return K;return Q.slotNumber-$.slotNumber},!1);allocatedTextures={};minTextureSize;maxTextureSize;numTextureSheets;initialSlots=[];constructor({numTextureSheets:Q,minTextureSize:$,maxTextureSize:K,excludeTexture:J}={},Z){if(this.numTextureSheets=Q??zK,this.minTextureSize=$??S0,this.maxTextureSize=K??h0,Z)this.numTextureSheets=Math.min(this.numTextureSheets,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_IMAGE_UNITS)),this.maxTextureSize=Math.min(this.maxTextureSize,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_SIZE)),this.minTextureSize=Math.min(this.minTextureSize,this.maxTextureSize);for(let B=0;B<this.numTextureSheets;B++){if(J?.(B))continue;this.initialSlots.push(new x([this.maxTextureSize,this.maxTextureSize],B,void 0,{min:this.minTextureSize,max:this.maxTextureSize}))}this.initialSlots.forEach((B)=>this.textureSlots.insert(B))}allocate(Q,$,K=1){const{size:J,slotNumber:Z,x:B,y:V,textureIndex:Y}=this.allocateHelper(Q,$,K);return{size:J,slotNumber:Z,x:B,y:V,textureIndex:Y}}deallocate(Q){if(!this.isSlotUsed(Q))throw new Error("Slot is not allocated");const $=this.allocatedTextures[x.getTag(Q)];this.deallocateHelper($)}get countUsedTextureSheets(){return this.initialSlots.filter((Q)=>this.isSlotUsed(Q)).length}allocateHelper(Q,$,K=1){const J=LQ(Q,$,K,{min:this.minTextureSize,max:this.maxTextureSize}),Z=this.findSlot(J);if(!Z)throw new Error(`Could not find a slot for texture to fit ${K} sprites of size ${Q}x${$}`);this.textureSlots.remove(Z);const[B,V]=this.bestFit(J,Z);return this.fitSlot(Z,B,V)}findSlot(Q){for(let $=0;$<this.textureSlots.size;$++){const J=this.textureSlots.at($).key,[Z,B]=J.size;if(Q.get(Z)<=B)return J}return null}calculateRatio(Q,$){return Math.max(Q/$,$/Q)}bestFit(Q,$){const[K,J]=$.size;let Z=$.textureSizeLimits.max;return Q.forEach((B,V)=>{if(V<=K&&B<=J){const Y=V*B,P=Q.get(Z)*Z;if(Y<P)Z=V;else if(Y===P){if(this.calculateRatio(V,B)<this.calculateRatio(Z,Q.get(Z)))Z=V}}}),[Z,Q.get(Z)]}isSlotUsed(Q){return!!this.allocatedTextures[x.getTag(Q)]}deallocateHelper(Q){if(Q.parent&&Q.sibbling&&!this.isSlotUsed(Q.sibbling)){const $=Q.sibbling;if(this.textureSlots.remove($),yK&&this.textureSlots.find(Q))throw new Error("Slot is not expected to be in the tree");const K=Q.parent;this.deallocateHelper(K);return}this.textureSlots.insert(Q),delete this.allocatedTextures[Q.getTag()]}trySplitHorizontally(Q,$,K){if(Q.canSplitHorizontally()){const[J,Z]=Q.splitHorizontally();if(J.size[0]>=$)return this.textureSlots.insert(Z),this.fitSlot(J,$,K)}return null}trySplitVertically(Q,$,K){if(Q.canSplitVertically()){const[J,Z]=Q.splitVertically();if(J.size[1]>=K)return this.textureSlots.insert(Z),this.fitSlot(J,$,K)}return null}fitSlot(Q,$,K){if(this.allocatedTextures[Q.getTag()]=Q,Q.size[0]>Q.size[1]){const J=this.trySplitHorizontally(Q,$,K)??this.trySplitVertically(Q,$,K);if(J)return J}else{const J=this.trySplitVertically(Q,$,K)??this.trySplitHorizontally(Q,$,K);if(J)return J}return Q}listSlots(){this.textureSlots.forEach((Q)=>{console.log(Q.key?.getTag())})}}var F0=15;class I0 extends g{gl;uniforms;textureBuffers={};tempContext=new OffscreenCanvas(1,1).getContext("2d");textureSlotAllocator=new P0({excludeTexture:(Q)=>Q===F0});textureSlotAllocatorForVideo=new P0({excludeTexture:(Q)=>Q!==F0});constructor(Q,$){super();this.gl=Q,this.uniforms=$,this.tempContext.imageSmoothingEnabled=!0}initialize(){this.initTextureUniforms(),this.initMaxTexture()}getTexture(Q){if(!this.textureBuffers[Q]){const $=this.gl.createTexture();if(!$)return;this.gl.bindTexture(O.TEXTURE_2D,$),this.gl.texImage2D(O.TEXTURE_2D,0,O.RGBA,this.textureSlotAllocator.maxTextureSize,this.textureSlotAllocator.maxTextureSize,0,O.RGBA,O.UNSIGNED_BYTE,null),this.textureBuffers[Q]=$,this.addOnDestroy(()=>this.gl.deleteTexture($))}return this.textureBuffers[Q]}loadTexture(Q,$,K,J,Z){this.gl.activeTexture(O[$]),this.gl.bindTexture(O.TEXTURE_2D,K),this.applyTexImage2d(Q,J,Z),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR)}applyTexImage2d(Q,[$,K,J,Z],[B,V,Y,P]){if(J===Y&&Z===P&&!$&&!K)this.gl.texSubImage2D(O.TEXTURE_2D,0,B,V,Y,P,O.RGBA,O.UNSIGNED_BYTE,Q.texImgSrc);else{const F=this.tempContext.canvas;if(Q.texImgSrc instanceof ImageData){if(F.width=Y||Q.width,F.height=P||Q.height,this.tempContext.putImageData(Q.texImgSrc,0,0),$||K)console.warn("Offset not available when sending imageData")}else{const H=J||Q.width,C=Z||Q.height;F.width=Y||H,F.height=P||C,this.tempContext.drawImage(Q.texImgSrc,$,K,H,C,0,0,F.width,F.height)}this.gl.texSubImage2D(O.TEXTURE_2D,0,B,V,F.width,F.height,O.RGBA,O.UNSIGNED_BYTE,F)}}allocateSlotForImage(Q){const K=(Q.isVideo?this.textureSlotAllocatorForVideo:this.textureSlotAllocator).allocate(Q.width,Q.height),J=`TEXTURE${K.textureIndex}`,Z=this.getTexture(J);if(!Z)throw new Error(`Invalid texture Id ${J}`);const B=this.assignImageToTexture(Q,J,Z,[0,0,Q.width,Q.height],[K.x,K.y,...K.size]);return{slot:K,refreshCallback:B}}assignImageToTexture(Q,$,K,J,Z){if(Q){const B=J??[0,0,Q.width,Q.height],V=Z??[0,0,B[2],B[3]],Y=()=>{this.gl.bindTexture(O.TEXTURE_2D,K),this.applyTexImage2d(Q,B,V)};if(Q.active)Y();else this.loadTexture(Q,$,K,B,V),Q.active=!0;return Y}return null}setupTextureForVideo(Q){const $=this.getTexture(Q);if($)this.gl.activeTexture(O[Q]),this.gl.bindTexture(O.TEXTURE_2D,$),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.NEAREST),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR)}generateMipMap(Q){const $=this.getTexture(Q);if($)this.gl.activeTexture(O[Q]),this.gl.bindTexture(O.TEXTURE_2D,$),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),this.gl.generateMipmap(O.TEXTURE_2D)}initTextureUniforms(){const Q=this.gl.getParameter(O.MAX_TEXTURE_IMAGE_UNITS),$=new Array(Q).fill(null).map((J,Z)=>Z),K=this.uniforms.getUniformLocation(qQ);this.gl.uniform1iv(K,$)}initMaxTexture(){const Q=this.uniforms.getUniformLocation(GQ);this.gl.uniform1f(Q,this.textureSlotAllocator.maxTextureSize)}}class c extends g{$;texImgSrc;active=!1;width;height;isVideo;constructor(Q,$=25){super();this.fps=$;this.texImgSrc=Q;const K=Q;if(this.isVideo=!!(K.videoWidth||K.videoHeight),this.width=K.naturalWidth??K.videoWidth??K.displayWidth??K.width?.baseValue?.value??K.width,this.height=K.naturalHeight??K.videoHeight??K.displayHeight??K.height?.baseValue?.value??K.height,!this.width||!this.height)throw new Error("Invalid image")}static createFromCanvas(Q){return new c(Q)}static async loadImage(Q){const $=await new Promise((K,J)=>{const Z=new Image,B=(V)=>J(V.error);Z.addEventListener("error",B),Z.addEventListener("load",()=>K(Z),{once:!0}),Z.src=Q});return new c($)}static async loadVideo(Q,$,K=30){const J=await new Promise((B,V)=>{const Y=document.createElement("video");if(Y.loop=!0,$!==void 0)Y.volume=$;Y.addEventListener("loadedmetadata",()=>{Y.play(),B(Y)},{once:!0}),Y.addEventListener("error",(P)=>V(P.error)),Y.src=Q}),Z=new c(J,K);return Z.addOnDestroy(()=>J.pause()),Z}static async loadWebcam(Q){const $=await new Promise((Z,B)=>{const V=document.createElement("video");V.loop=!0,V.addEventListener("loadedmetadata",()=>V.play()),V.addEventListener("playing",()=>Z(V),{once:!0}),V.addEventListener("error",(Y)=>B(Y.error))}),K=new c($);let J=!1;return navigator.mediaDevices.getUserMedia({video:{deviceId:Q}}).then((Z)=>{if(!J)$.srcObject=Z,K.addOnDestroy(()=>Z.getTracks().forEach((B)=>B.stop()))}),K.addOnDestroy(()=>{J=!0,$.pause()}),K}}class w0 extends g{constructor(){super(...arguments)}images=[];hasImageId(Q){return!!this.getMedia(Q)}getMedia(Q){return this.images[Q]}setImage(Q,$){this.images[Q]=$}async drawImage(Q,$){const K=new OffscreenCanvas(1,1);$(K.getContext("2d"));const J=c.createFromCanvas(K);return this.images[Q]=this.own(J),J}async loadCanvas(Q,$){const K=c.createFromCanvas($);return $.getContext("2d"),this.images[Q]=this.own(K),K}async loadImage(Q,$){const K=await c.loadImage($);return this.images[Q]=this.own(K),K}async loadVideo(Q,$,K,J){const Z=await c.loadVideo($,K,J);return this.images[Q]=this.own(Z),Z}async loadWebCam(Q,$){const K=await c.loadWebcam($);return this.images[Q]=this.own(K),K}}var SQ=`#version 300 es
//  ~{AUTHOR}

precision highp float;

//  IN
//  shape
layout(location = 0) in vec2 position;
layout(location = 1) in mat4 transform;
//  2, 3, 4 reserved for transform
//  animation
layout(location = 5) in vec2 slotSize_and_number;

//  UNIFORM
uniform float maxTextureSize;
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  vec2 tex = position.xy * vec2(0.49, -0.49) + 0.5;
  vec2 slotSize = vec2(
    pow(2.0, floor(slotSize_and_number.x / 16.0)),
    pow(2.0, mod(slotSize_and_number.x, 16.0)));
  float slotNumber = slotSize_and_number.y;
  float maxCols = maxTextureSize / slotSize.x;
  float maxRows = maxTextureSize / slotSize.y;
  float slotX = mod(slotNumber, maxCols);
  float slotY = mod(floor(slotNumber / maxCols), maxRows);

  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = (vec2(slotX, slotY) + tex) * slotSize / maxTextureSize;
  textureIndex = floor(slotNumber / (maxCols * maxRows));
}
`;var hQ=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .0001) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function v0(Q,$){return Q.replace(/~\{(\w+)\}/g,(K,J)=>{return $?.[J]||K})}class p0 extends L{constructor(){super(...arguments)}perspectiveMatrix=L.create();orthoMatrix=L.create();perspectiveLevel=1;configPerspectiveMatrix(Q){this.perspectiveMatrix.perspective(45,Q,0.01,1000)}configOrthoMatrix(Q){this.orthoMatrix.ortho(-Q,Q,-1,1,-1000,1000)}configure(Q){this.configPerspectiveMatrix(Q),this.configOrthoMatrix(Q)}setPerspective(Q){this.perspectiveLevel=Q,this.combine(this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel)}}class g0{gl;uniforms;camPositionMatrix=L.create().translate(0,0,-1);projectionMatrix=new p0;needsRefresh=!1;constructor(Q,$){this.gl=Q,this.uniforms=$}configProjectionMatrix(Q){this.projectionMatrix.configure(Q),this.updatePerspective(1)}camTiltMatrix=L.create();camTurnMatrix=L.create();camMatrix=L.create();refresh(){if(!this.needsRefresh)return!1;this.invertedCamTiltMatrix.invert(this.camTiltMatrix),this.invertedCamTurnMatrix.invert(this.camTurnMatrix),this.camMatrix.multiply3(this.camTiltMatrix,this.camTurnMatrix,this.camPositionMatrix);const Q=this.uniforms.getUniformLocation(kQ);return this.gl.uniformMatrix4fv(Q,!1,this.camMatrix.getMatrix()),this.needsRefresh=!1,!0}updatePerspective(Q){this.projectionMatrix.setPerspective(Q);const $=this.uniforms.getUniformLocation(MQ);this.gl.uniformMatrix4fv($,!1,this.projectionMatrix.getMatrix()),this.needsRefresh=!0}moveCam(Q,$,K){this.camPositionMatrix.moveMatrix(Q,$,K,this.camTurnMatrix),this.needsRefresh=!0}turnCam(Q){this.camTurnMatrix.rotateY(Q),this.needsRefresh=!0}tilt(Q){this.camTiltMatrix.rotateX(Q),this.needsRefresh=!0}invertedCamTurnMatrix=L.create();invertedCamTiltMatrix=L.create();syncHud(Q){Q?.identity().translateToMatrix(this.camPositionMatrix).multiply(this.invertedCamTurnMatrix).multiply(this.invertedCamTiltMatrix).translate(0,0,-0.9)}}var dK=function(Q){if(!nK)return Q;return new Proxy(Q,{get(K,J){const Z=K,B=Z[J];if(typeof B==="function")return(...Y)=>{const P=B.apply(Z,Y);return console.log(`gl.${String(J)}(`,Y,") = ",P),P};else return console.log(`gl.${String(J)} = `,B),B}})},lK={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},mK=6,nK=!1;class e extends g{gl;programs;attributeBuffers;uniforms;canvas;textureManager;imageManager;camera;textureSlots=[];world;onDeactivateWorlds=new Set;onCleanupBuffers=new Set;topVisibleSprite=-1;refreshers=new Set;constructor(Q,{attributes:$}={}){super();this.gl=dK(Q.getContext("webgl2",{...lK,...$})),this.canvas=Q,this.programs=this.own(new M0(this.gl)),this.uniforms=this.own(new T0(this.gl,this.programs)),this.attributeBuffers=this.own(new q0(this.gl,this.programs)),this.textureManager=new I0(this.gl,this.uniforms),this.imageManager=new w0,this.camera=new g0(this.gl,this.uniforms);const K=this.checkCanvasSize.bind(this);window.addEventListener("resize",K),this.addOnDestroy(()=>window.removeEventListener("resize",K)),this.addOnDestroy(()=>this.resetWorld()),this.initialize()}resetWorld(){this.refreshers.clear(),this.textureSlots.length=0,this.onDeactivateWorlds.forEach((Q)=>Q()),this.onDeactivateWorlds.clear(),this.onCleanupBuffers.forEach((Q)=>Q()),this.onCleanupBuffers.clear()}setWorld(Q){this.resetWorld(),this.world=Q,this.initializeBuffers(Q?.getMaxSpriteCount()??0);const $=this.world?.activate();if($)this.onDeactivateWorlds.add($)}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const Q=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configProjectionMatrix(Q)}initialize(){const $={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",v0(SQ,$),v0(hQ,$)),this.programs.useProgram("main"),this.gl.enable(O.DEPTH_TEST),this.gl.depthFunc(O.LESS),this.gl.clearDepth(1),this.gl.enable(O.BLEND),this.gl.blendFunc(O.SRC_ALPHA,O.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.disable(this.gl.CULL_FACE);const K=this.world?.getMaxSpriteCount()??0;this.initializeBuffers(K),this.textureManager.initialize(),this.checkCanvasSize()}initializeBuffers(Q){if(this.onCleanupBuffers.forEach(($)=>$()),this.onCleanupBuffers.clear(),Q)[this.initializeIndexBuffer(NQ),this.initializePositionBuffer(_Q),this.initializeTransformBuffer(_0,Q),this.initializeSlotSizeBuffer(N0,Q)].forEach((K)=>this.onCleanupBuffers.add(K))}initializeIndexBuffer(Q){const $=this.attributeBuffers.createBuffer(Q);return this.gl.bindBuffer(O.ELEMENT_ARRAY_BUFFER,$.buffer),this.gl.bufferData(O.ELEMENT_ARRAY_BUFFER,Uint16Array.from([0,1,2,2,3,0]),O.STATIC_DRAW),()=>{this.attributeBuffers.deleteBuffer(Q)}}initializePositionBuffer(Q){const $=this.attributeBuffers.createBuffer(Q);return this.gl.bindBuffer(O.ARRAY_BUFFER,$.buffer),this.gl.vertexAttribPointer($.location,2,O.FLOAT,!1,0,0),this.gl.enableVertexAttribArray($.location),this.gl.bufferData(O.ARRAY_BUFFER,Float32Array.from([-1,-1,1,-1,1,1,-1,1]),O.STATIC_DRAW),()=>{this.gl.disableVertexAttribArray($.location),this.attributeBuffers.deleteBuffer(Q)}}initializeTransformBuffer(Q,$){const K=this.attributeBuffers.createBuffer(Q);this.gl.bindBuffer(O.ARRAY_BUFFER,K.buffer);for(let J=0;J<4;J++){const Z=K.location+J;this.gl.vertexAttribPointer(Z,4,O.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,J*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(Z),this.gl.vertexAttribDivisor(Z,1)}return this.gl.bufferData(O.ARRAY_BUFFER,$*4*4*Float32Array.BYTES_PER_ELEMENT,O.DYNAMIC_DRAW),()=>{this.gl.disableVertexAttribArray(K.location),this.attributeBuffers.deleteBuffer(Q)}}initializeSlotSizeBuffer(Q,$){const K=this.attributeBuffers.createBuffer(Q);this.gl.bindBuffer(O.ARRAY_BUFFER,K.buffer);const J=K.location;return this.gl.vertexAttribPointer(J,2,O.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(J),this.gl.vertexAttribDivisor(J,1),this.gl.bufferData(O.ARRAY_BUFFER,$*2*Float32Array.BYTES_PER_ELEMENT,O.DYNAMIC_DRAW),()=>{this.gl.disableVertexAttribArray(K.location),this.attributeBuffers.deleteBuffer(Q)}}static spriteMatrix=L.create();updateSprite(Q){e.spriteMatrix.identity();const $=e.spriteMatrix.getMatrix(),K=this.world?.getSprite(Q);return K?.transforms.forEach((J)=>q.multiply($,$,J)),this.gl.bufferSubData(O.ARRAY_BUFFER,16*Float32Array.BYTES_PER_ELEMENT*Q,$),!!K}async updateTextures(Q,$){const K=await Promise.all(Q.map((Z)=>new Promise(async(B)=>{await $.drawImage(Z,this.imageManager);const V=this.imageManager.getMedia(Z),{slot:Y,refreshCallback:P}=this.textureManager.allocateSlotForImage(V),F=Math.log2(Y.size[0]),H=Math.log2(Y.size[1]),C=F*16+H;if(this.textureSlots[Z]={refreshCallback:P,buffer:Float32Array.from([C,Y.slotNumber])},V.isVideo&&P)this.refreshers.add(P);return B(Y.textureIndex)})));new Set(K).forEach((Z)=>{if(Z===F0)this.textureManager.setupTextureForVideo(`TEXTURE${Z}`);else this.textureManager.generateMipMap(`TEXTURE${Z}`)})}drawElementsInstanced(Q,$){this.gl.drawElementsInstanced(O.TRIANGLES,Q,O.UNSIGNED_SHORT,0,$)}updateSprites(Q){const $=Q.getUpdatedSpriteTransforms();if($.size){const J=this.attributeBuffers.getAttributeBuffer(_0);this.gl.bindBuffer(O.ARRAY_BUFFER,J.buffer),$?.forEach((Z)=>{if(this.updateSprite(Z))this.topVisibleSprite=Math.max(this.topVisibleSprite,Z)}),$.clear()}const K=Q.getUpdatedSpriteTextureSlot();if(K.size){const J=this.attributeBuffers.getAttributeBuffer(N0);this.gl.bindBuffer(O.ARRAY_BUFFER,J.buffer),K?.forEach((Z)=>{const B=Q.getSprite(Z),V=this.textureSlots[B?.imageId??-1];if(V){const{buffer:Y}=V;this.gl.bufferSubData(O.ARRAY_BUFFER,2*Float32Array.BYTES_PER_ELEMENT*Z,Y),K.delete(Z)}})}while(!Q.getSprite(this.topVisibleSprite))this.topVisibleSprite--;return this.topVisibleSprite+1}toggle=0;refresh(Q,$){if(this.toggle=(this.toggle+1)%2,this.toggle)this.refreshers.forEach((Z)=>Z());Q.refresh?.($),Q.syncWithCamera(this.camera);const K=Q.getUpdateImageIds();if(K.size){const Z=Array.from(K.keys());K.clear(),this.updateTextures(Z,Q)}const J=this.updateSprites(Q);this.drawElementsInstanced(mK,J)}bindVertexArray(){return this.own(new G0(this.gl))}start(){let Q=0,$=0;const K=(J)=>{const Z=J-$;if(Q=requestAnimationFrame(K),$=J,this.world)this.refresh(this.world,Z)};requestAnimationFrame(K),this.stop=()=>cancelAnimationFrame(Q)}stop=()=>{}}async function PZ(){console.log("Hello World!")}async function FZ(Q){Q.style.border="2px solid silver",Q.style.cursor="grab",Q.addEventListener("mouseenter",()=>{Q.style.borderColor="black"}),Q.addEventListener("mouseleave",()=>{Q.style.borderColor="silver"});const $=new e(Q);return $.start(),$.setWorld(new R0),$}export{FZ as testCanvas,PZ as hello,R0 as DemoWorld};

//# debugId=B8F9D6F2AD9BB10964756e2164756e21
