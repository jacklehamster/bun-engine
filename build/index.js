var LK=Object.defineProperty;var P0=(K,Q)=>{for(var $ in Q)LK(K,$,{get:Q[$],enumerable:!0,configurable:!0,set:(J)=>Q[$]=()=>J})};var k=0.000001,q=typeof Float32Array!=="undefined"?Float32Array:Array,c=Math.random,m$=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var K=0,Q=arguments.length;while(Q--)K+=arguments[Q]*arguments[Q];return Math.sqrt(K)};function w0(){var K=new q(9);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0;return K[0]=1,K[4]=1,K[8]=1,K}var T={};P0(T,{transpose:()=>{{return gK}},translate:()=>{{return xK}},targetTo:()=>{{return CQ}},subtract:()=>{{return x0}},sub:()=>{{return AQ}},str:()=>{{return XQ}},set:()=>{{return pK}},scale:()=>{{return lK}},rotateZ:()=>{{return nK}},rotateY:()=>{{return dK}},rotateX:()=>{{return mK}},rotate:()=>{{return cK}},perspectiveZO:()=>{{return YQ}},perspectiveNO:()=>{{return f0}},perspectiveFromFieldOfView:()=>{{return VQ}},perspective:()=>{{return ZQ}},orthoZO:()=>{{return PQ}},orthoNO:()=>{{return y0}},ortho:()=>{{return BQ}},multiplyScalarAndAdd:()=>{{return EQ}},multiplyScalar:()=>{{return OQ}},multiply:()=>{{return p0}},mul:()=>{{return UQ}},lookAt:()=>{{return FQ}},invert:()=>{{return zK}},identity:()=>{{return v0}},getTranslation:()=>{{return aK}},getScaling:()=>{{return z0}},getRotation:()=>{{return tK}},frustum:()=>{{return JQ}},fromZRotation:()=>{{return uK}},fromYRotation:()=>{{return eK}},fromXRotation:()=>{{return bK}},fromValues:()=>{{return vK}},fromTranslation:()=>{{return iK}},fromScaling:()=>{{return sK}},fromRotationTranslationScaleOrigin:()=>{{return QQ}},fromRotationTranslationScale:()=>{{return KQ}},fromRotationTranslation:()=>{{return g0}},fromRotation:()=>{{return rK}},fromQuat2:()=>{{return oK}},fromQuat:()=>{{return $Q}},frob:()=>{{return HQ}},exactEquals:()=>{{return jQ}},equals:()=>{{return DQ}},determinant:()=>{{return yK}},create:()=>{{return hK}},copy:()=>{{return wK}},clone:()=>{{return IK}},adjoint:()=>{{return fK}},add:()=>{{return WQ}}});function hK(){var K=new q(16);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0;return K[0]=1,K[5]=1,K[10]=1,K[15]=1,K}function IK(K){var Q=new q(16);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function wK(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function vK(K,Q,$,J,Z,Y,V,B,P,F,C,X,O,W,j,E){var H=new q(16);return H[0]=K,H[1]=Q,H[2]=$,H[3]=J,H[4]=Z,H[5]=Y,H[6]=V,H[7]=B,H[8]=P,H[9]=F,H[10]=C,H[11]=X,H[12]=O,H[13]=W,H[14]=j,H[15]=E,H}function pK(K,Q,$,J,Z,Y,V,B,P,F,C,X,O,W,j,E,H){return K[0]=Q,K[1]=$,K[2]=J,K[3]=Z,K[4]=Y,K[5]=V,K[6]=B,K[7]=P,K[8]=F,K[9]=C,K[10]=X,K[11]=O,K[12]=W,K[13]=j,K[14]=E,K[15]=H,K}function v0(K){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function gK(K,Q){if(K===Q){var $=Q[1],J=Q[2],Z=Q[3],Y=Q[6],V=Q[7],B=Q[11];K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=$,K[6]=Q[9],K[7]=Q[13],K[8]=J,K[9]=Y,K[11]=Q[14],K[12]=Z,K[13]=V,K[14]=B}else K[0]=Q[0],K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=Q[1],K[5]=Q[5],K[6]=Q[9],K[7]=Q[13],K[8]=Q[2],K[9]=Q[6],K[10]=Q[10],K[11]=Q[14],K[12]=Q[3],K[13]=Q[7],K[14]=Q[11],K[15]=Q[15];return K}function zK(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[3],V=Q[4],B=Q[5],P=Q[6],F=Q[7],C=Q[8],X=Q[9],O=Q[10],W=Q[11],j=Q[12],E=Q[13],H=Q[14],D=Q[15],M=$*B-J*V,N=$*P-Z*V,_=$*F-Y*V,A=J*P-Z*B,R=J*F-Y*B,w=Z*F-Y*P,S=C*E-X*j,h=C*H-O*j,I=C*D-W*j,v=X*H-O*E,p=X*D-W*E,z=O*D-W*H,G=M*z-N*p+_*v+A*I-R*h+w*S;if(!G)return null;return G=1/G,K[0]=(B*z-P*p+F*v)*G,K[1]=(Z*p-J*z-Y*v)*G,K[2]=(E*w-H*R+D*A)*G,K[3]=(O*R-X*w-W*A)*G,K[4]=(P*I-V*z-F*h)*G,K[5]=($*z-Z*I+Y*h)*G,K[6]=(H*_-j*w-D*N)*G,K[7]=(C*w-O*_+W*N)*G,K[8]=(V*p-B*I+F*S)*G,K[9]=(J*I-$*p-Y*S)*G,K[10]=(j*R-E*_+D*M)*G,K[11]=(X*_-C*R-W*M)*G,K[12]=(B*h-V*v-P*S)*G,K[13]=($*v-J*h+Z*S)*G,K[14]=(E*N-j*A-H*M)*G,K[15]=(C*A-X*N+O*M)*G,K}function fK(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[3],V=Q[4],B=Q[5],P=Q[6],F=Q[7],C=Q[8],X=Q[9],O=Q[10],W=Q[11],j=Q[12],E=Q[13],H=Q[14],D=Q[15];return K[0]=B*(O*D-W*H)-X*(P*D-F*H)+E*(P*W-F*O),K[1]=-(J*(O*D-W*H)-X*(Z*D-Y*H)+E*(Z*W-Y*O)),K[2]=J*(P*D-F*H)-B*(Z*D-Y*H)+E*(Z*F-Y*P),K[3]=-(J*(P*W-F*O)-B*(Z*W-Y*O)+X*(Z*F-Y*P)),K[4]=-(V*(O*D-W*H)-C*(P*D-F*H)+j*(P*W-F*O)),K[5]=$*(O*D-W*H)-C*(Z*D-Y*H)+j*(Z*W-Y*O),K[6]=-($*(P*D-F*H)-V*(Z*D-Y*H)+j*(Z*F-Y*P)),K[7]=$*(P*W-F*O)-V*(Z*W-Y*O)+C*(Z*F-Y*P),K[8]=V*(X*D-W*E)-C*(B*D-F*E)+j*(B*W-F*X),K[9]=-($*(X*D-W*E)-C*(J*D-Y*E)+j*(J*W-Y*X)),K[10]=$*(B*D-F*E)-V*(J*D-Y*E)+j*(J*F-Y*B),K[11]=-($*(B*W-F*X)-V*(J*W-Y*X)+C*(J*F-Y*B)),K[12]=-(V*(X*H-O*E)-C*(B*H-P*E)+j*(B*O-P*X)),K[13]=$*(X*H-O*E)-C*(J*H-Z*E)+j*(J*O-Z*X),K[14]=-($*(B*H-P*E)-V*(J*H-Z*E)+j*(J*P-Z*B)),K[15]=$*(B*O-P*X)-V*(J*O-Z*X)+C*(J*P-Z*B),K}function yK(K){var Q=K[0],$=K[1],J=K[2],Z=K[3],Y=K[4],V=K[5],B=K[6],P=K[7],F=K[8],C=K[9],X=K[10],O=K[11],W=K[12],j=K[13],E=K[14],H=K[15],D=Q*V-$*Y,M=Q*B-J*Y,N=Q*P-Z*Y,_=$*B-J*V,A=$*P-Z*V,R=J*P-Z*B,w=F*j-C*W,S=F*E-X*W,h=F*H-O*W,I=C*E-X*j,v=C*H-O*j,p=X*H-O*E;return D*p-M*v+N*I+_*h-A*S+R*w}function p0(K,Q,$){var J=Q[0],Z=Q[1],Y=Q[2],V=Q[3],B=Q[4],P=Q[5],F=Q[6],C=Q[7],X=Q[8],O=Q[9],W=Q[10],j=Q[11],E=Q[12],H=Q[13],D=Q[14],M=Q[15],N=$[0],_=$[1],A=$[2],R=$[3];return K[0]=N*J+_*B+A*X+R*E,K[1]=N*Z+_*P+A*O+R*H,K[2]=N*Y+_*F+A*W+R*D,K[3]=N*V+_*C+A*j+R*M,N=$[4],_=$[5],A=$[6],R=$[7],K[4]=N*J+_*B+A*X+R*E,K[5]=N*Z+_*P+A*O+R*H,K[6]=N*Y+_*F+A*W+R*D,K[7]=N*V+_*C+A*j+R*M,N=$[8],_=$[9],A=$[10],R=$[11],K[8]=N*J+_*B+A*X+R*E,K[9]=N*Z+_*P+A*O+R*H,K[10]=N*Y+_*F+A*W+R*D,K[11]=N*V+_*C+A*j+R*M,N=$[12],_=$[13],A=$[14],R=$[15],K[12]=N*J+_*B+A*X+R*E,K[13]=N*Z+_*P+A*O+R*H,K[14]=N*Y+_*F+A*W+R*D,K[15]=N*V+_*C+A*j+R*M,K}function xK(K,Q,$){var J=$[0],Z=$[1],Y=$[2],V,B,P,F,C,X,O,W,j,E,H,D;if(Q===K)K[12]=Q[0]*J+Q[4]*Z+Q[8]*Y+Q[12],K[13]=Q[1]*J+Q[5]*Z+Q[9]*Y+Q[13],K[14]=Q[2]*J+Q[6]*Z+Q[10]*Y+Q[14],K[15]=Q[3]*J+Q[7]*Z+Q[11]*Y+Q[15];else V=Q[0],B=Q[1],P=Q[2],F=Q[3],C=Q[4],X=Q[5],O=Q[6],W=Q[7],j=Q[8],E=Q[9],H=Q[10],D=Q[11],K[0]=V,K[1]=B,K[2]=P,K[3]=F,K[4]=C,K[5]=X,K[6]=O,K[7]=W,K[8]=j,K[9]=E,K[10]=H,K[11]=D,K[12]=V*J+C*Z+j*Y+Q[12],K[13]=B*J+X*Z+E*Y+Q[13],K[14]=P*J+O*Z+H*Y+Q[14],K[15]=F*J+W*Z+D*Y+Q[15];return K}function lK(K,Q,$){var J=$[0],Z=$[1],Y=$[2];return K[0]=Q[0]*J,K[1]=Q[1]*J,K[2]=Q[2]*J,K[3]=Q[3]*J,K[4]=Q[4]*Z,K[5]=Q[5]*Z,K[6]=Q[6]*Z,K[7]=Q[7]*Z,K[8]=Q[8]*Y,K[9]=Q[9]*Y,K[10]=Q[10]*Y,K[11]=Q[11]*Y,K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function cK(K,Q,$,J){var Z=J[0],Y=J[1],V=J[2],B=Math.hypot(Z,Y,V),P,F,C,X,O,W,j,E,H,D,M,N,_,A,R,w,S,h,I,v,p,z,G,f;if(B<k)return null;if(B=1/B,Z*=B,Y*=B,V*=B,P=Math.sin($),F=Math.cos($),C=1-F,X=Q[0],O=Q[1],W=Q[2],j=Q[3],E=Q[4],H=Q[5],D=Q[6],M=Q[7],N=Q[8],_=Q[9],A=Q[10],R=Q[11],w=Z*Z*C+F,S=Y*Z*C+V*P,h=V*Z*C-Y*P,I=Z*Y*C-V*P,v=Y*Y*C+F,p=V*Y*C+Z*P,z=Z*V*C+Y*P,G=Y*V*C-Z*P,f=V*V*C+F,K[0]=X*w+E*S+N*h,K[1]=O*w+H*S+_*h,K[2]=W*w+D*S+A*h,K[3]=j*w+M*S+R*h,K[4]=X*I+E*v+N*p,K[5]=O*I+H*v+_*p,K[6]=W*I+D*v+A*p,K[7]=j*I+M*v+R*p,K[8]=X*z+E*G+N*f,K[9]=O*z+H*G+_*f,K[10]=W*z+D*G+A*f,K[11]=j*z+M*G+R*f,Q!==K)K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K}function mK(K,Q,$){var J=Math.sin($),Z=Math.cos($),Y=Q[4],V=Q[5],B=Q[6],P=Q[7],F=Q[8],C=Q[9],X=Q[10],O=Q[11];if(Q!==K)K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[4]=Y*Z+F*J,K[5]=V*Z+C*J,K[6]=B*Z+X*J,K[7]=P*Z+O*J,K[8]=F*Z-Y*J,K[9]=C*Z-V*J,K[10]=X*Z-B*J,K[11]=O*Z-P*J,K}function dK(K,Q,$){var J=Math.sin($),Z=Math.cos($),Y=Q[0],V=Q[1],B=Q[2],P=Q[3],F=Q[8],C=Q[9],X=Q[10],O=Q[11];if(Q!==K)K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=Y*Z-F*J,K[1]=V*Z-C*J,K[2]=B*Z-X*J,K[3]=P*Z-O*J,K[8]=Y*J+F*Z,K[9]=V*J+C*Z,K[10]=B*J+X*Z,K[11]=P*J+O*Z,K}function nK(K,Q,$){var J=Math.sin($),Z=Math.cos($),Y=Q[0],V=Q[1],B=Q[2],P=Q[3],F=Q[4],C=Q[5],X=Q[6],O=Q[7];if(Q!==K)K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=Y*Z+F*J,K[1]=V*Z+C*J,K[2]=B*Z+X*J,K[3]=P*Z+O*J,K[4]=F*Z-Y*J,K[5]=C*Z-V*J,K[6]=X*Z-B*J,K[7]=O*Z-P*J,K}function iK(K,Q){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=Q[0],K[13]=Q[1],K[14]=Q[2],K[15]=1,K}function sK(K,Q){return K[0]=Q[0],K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Q[1],K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=Q[2],K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function rK(K,Q,$){var J=$[0],Z=$[1],Y=$[2],V=Math.hypot(J,Z,Y),B,P,F;if(V<k)return null;return V=1/V,J*=V,Z*=V,Y*=V,B=Math.sin(Q),P=Math.cos(Q),F=1-P,K[0]=J*J*F+P,K[1]=Z*J*F+Y*B,K[2]=Y*J*F-Z*B,K[3]=0,K[4]=J*Z*F-Y*B,K[5]=Z*Z*F+P,K[6]=Y*Z*F+J*B,K[7]=0,K[8]=J*Y*F+Z*B,K[9]=Z*Y*F-J*B,K[10]=Y*Y*F+P,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function bK(K,Q){var $=Math.sin(Q),J=Math.cos(Q);return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=J,K[6]=$,K[7]=0,K[8]=0,K[9]=-$,K[10]=J,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function eK(K,Q){var $=Math.sin(Q),J=Math.cos(Q);return K[0]=J,K[1]=0,K[2]=-$,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=$,K[9]=0,K[10]=J,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function uK(K,Q){var $=Math.sin(Q),J=Math.cos(Q);return K[0]=J,K[1]=$,K[2]=0,K[3]=0,K[4]=-$,K[5]=J,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function g0(K,Q,$){var J=Q[0],Z=Q[1],Y=Q[2],V=Q[3],B=J+J,P=Z+Z,F=Y+Y,C=J*B,X=J*P,O=J*F,W=Z*P,j=Z*F,E=Y*F,H=V*B,D=V*P,M=V*F;return K[0]=1-(W+E),K[1]=X+M,K[2]=O-D,K[3]=0,K[4]=X-M,K[5]=1-(C+E),K[6]=j+H,K[7]=0,K[8]=O+D,K[9]=j-H,K[10]=1-(C+W),K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function oK(K,Q){var $=new q(3),J=-Q[0],Z=-Q[1],Y=-Q[2],V=Q[3],B=Q[4],P=Q[5],F=Q[6],C=Q[7],X=J*J+Z*Z+Y*Y+V*V;if(X>0)$[0]=(B*V+C*J+P*Y-F*Z)*2/X,$[1]=(P*V+C*Z+F*J-B*Y)*2/X,$[2]=(F*V+C*Y+B*Z-P*J)*2/X;else $[0]=(B*V+C*J+P*Y-F*Z)*2,$[1]=(P*V+C*Z+F*J-B*Y)*2,$[2]=(F*V+C*Y+B*Z-P*J)*2;return g0(K,Q,$),K}function aK(K,Q){return K[0]=Q[12],K[1]=Q[13],K[2]=Q[14],K}function z0(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[4],V=Q[5],B=Q[6],P=Q[8],F=Q[9],C=Q[10];return K[0]=Math.hypot($,J,Z),K[1]=Math.hypot(Y,V,B),K[2]=Math.hypot(P,F,C),K}function tK(K,Q){var $=new q(3);z0($,Q);var J=1/$[0],Z=1/$[1],Y=1/$[2],V=Q[0]*J,B=Q[1]*Z,P=Q[2]*Y,F=Q[4]*J,C=Q[5]*Z,X=Q[6]*Y,O=Q[8]*J,W=Q[9]*Z,j=Q[10]*Y,E=V+C+j,H=0;if(E>0)H=Math.sqrt(E+1)*2,K[3]=0.25*H,K[0]=(X-W)/H,K[1]=(O-P)/H,K[2]=(B-F)/H;else if(V>C&&V>j)H=Math.sqrt(1+V-C-j)*2,K[3]=(X-W)/H,K[0]=0.25*H,K[1]=(B+F)/H,K[2]=(O+P)/H;else if(C>j)H=Math.sqrt(1+C-V-j)*2,K[3]=(O-P)/H,K[0]=(B+F)/H,K[1]=0.25*H,K[2]=(X+W)/H;else H=Math.sqrt(1+j-V-C)*2,K[3]=(B-F)/H,K[0]=(O+P)/H,K[1]=(X+W)/H,K[2]=0.25*H;return K}function KQ(K,Q,$,J){var Z=Q[0],Y=Q[1],V=Q[2],B=Q[3],P=Z+Z,F=Y+Y,C=V+V,X=Z*P,O=Z*F,W=Z*C,j=Y*F,E=Y*C,H=V*C,D=B*P,M=B*F,N=B*C,_=J[0],A=J[1],R=J[2];return K[0]=(1-(j+H))*_,K[1]=(O+N)*_,K[2]=(W-M)*_,K[3]=0,K[4]=(O-N)*A,K[5]=(1-(X+H))*A,K[6]=(E+D)*A,K[7]=0,K[8]=(W+M)*R,K[9]=(E-D)*R,K[10]=(1-(X+j))*R,K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function QQ(K,Q,$,J,Z){var Y=Q[0],V=Q[1],B=Q[2],P=Q[3],F=Y+Y,C=V+V,X=B+B,O=Y*F,W=Y*C,j=Y*X,E=V*C,H=V*X,D=B*X,M=P*F,N=P*C,_=P*X,A=J[0],R=J[1],w=J[2],S=Z[0],h=Z[1],I=Z[2],v=(1-(E+D))*A,p=(W+_)*A,z=(j-N)*A,G=(W-_)*R,f=(1-(O+D))*R,n=(H+M)*R,i=(j+N)*w,h0=(H-M)*w,I0=(1-(O+E))*w;return K[0]=v,K[1]=p,K[2]=z,K[3]=0,K[4]=G,K[5]=f,K[6]=n,K[7]=0,K[8]=i,K[9]=h0,K[10]=I0,K[11]=0,K[12]=$[0]+S-(v*S+G*h+i*I),K[13]=$[1]+h-(p*S+f*h+h0*I),K[14]=$[2]+I-(z*S+n*h+I0*I),K[15]=1,K}function $Q(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[3],V=$+$,B=J+J,P=Z+Z,F=$*V,C=J*V,X=J*B,O=Z*V,W=Z*B,j=Z*P,E=Y*V,H=Y*B,D=Y*P;return K[0]=1-X-j,K[1]=C+D,K[2]=O-H,K[3]=0,K[4]=C-D,K[5]=1-F-j,K[6]=W+E,K[7]=0,K[8]=O+H,K[9]=W-E,K[10]=1-F-X,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function JQ(K,Q,$,J,Z,Y,V){var B=1/($-Q),P=1/(Z-J),F=1/(Y-V);return K[0]=Y*2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Y*2*P,K[6]=0,K[7]=0,K[8]=($+Q)*B,K[9]=(Z+J)*P,K[10]=(V+Y)*F,K[11]=-1,K[12]=0,K[13]=0,K[14]=V*Y*2*F,K[15]=0,K}function f0(K,Q,$,J,Z){var Y=1/Math.tan(Q/2),V;if(K[0]=Y/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Y,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,Z!=null&&Z!==Infinity)V=1/(J-Z),K[10]=(Z+J)*V,K[14]=2*Z*J*V;else K[10]=-1,K[14]=-2*J;return K}function YQ(K,Q,$,J,Z){var Y=1/Math.tan(Q/2),V;if(K[0]=Y/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Y,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,Z!=null&&Z!==Infinity)V=1/(J-Z),K[10]=Z*V,K[14]=Z*J*V;else K[10]=-1,K[14]=-J;return K}function VQ(K,Q,$,J){var Z=Math.tan(Q.upDegrees*Math.PI/180),Y=Math.tan(Q.downDegrees*Math.PI/180),V=Math.tan(Q.leftDegrees*Math.PI/180),B=Math.tan(Q.rightDegrees*Math.PI/180),P=2/(V+B),F=2/(Z+Y);return K[0]=P,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=F,K[6]=0,K[7]=0,K[8]=-((V-B)*P*0.5),K[9]=(Z-Y)*F*0.5,K[10]=J/($-J),K[11]=-1,K[12]=0,K[13]=0,K[14]=J*$/($-J),K[15]=0,K}function y0(K,Q,$,J,Z,Y,V){var B=1/(Q-$),P=1/(J-Z),F=1/(Y-V);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*P,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=2*F,K[11]=0,K[12]=(Q+$)*B,K[13]=(Z+J)*P,K[14]=(V+Y)*F,K[15]=1,K}function PQ(K,Q,$,J,Z,Y,V){var B=1/(Q-$),P=1/(J-Z),F=1/(Y-V);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*P,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=F,K[11]=0,K[12]=(Q+$)*B,K[13]=(Z+J)*P,K[14]=Y*F,K[15]=1,K}function FQ(K,Q,$,J){var Z,Y,V,B,P,F,C,X,O,W,j=Q[0],E=Q[1],H=Q[2],D=J[0],M=J[1],N=J[2],_=$[0],A=$[1],R=$[2];if(Math.abs(j-_)<k&&Math.abs(E-A)<k&&Math.abs(H-R)<k)return v0(K);if(C=j-_,X=E-A,O=H-R,W=1/Math.hypot(C,X,O),C*=W,X*=W,O*=W,Z=M*O-N*X,Y=N*C-D*O,V=D*X-M*C,W=Math.hypot(Z,Y,V),!W)Z=0,Y=0,V=0;else W=1/W,Z*=W,Y*=W,V*=W;if(B=X*V-O*Y,P=O*Z-C*V,F=C*Y-X*Z,W=Math.hypot(B,P,F),!W)B=0,P=0,F=0;else W=1/W,B*=W,P*=W,F*=W;return K[0]=Z,K[1]=B,K[2]=C,K[3]=0,K[4]=Y,K[5]=P,K[6]=X,K[7]=0,K[8]=V,K[9]=F,K[10]=O,K[11]=0,K[12]=-(Z*j+Y*E+V*H),K[13]=-(B*j+P*E+F*H),K[14]=-(C*j+X*E+O*H),K[15]=1,K}function CQ(K,Q,$,J){var Z=Q[0],Y=Q[1],V=Q[2],B=J[0],P=J[1],F=J[2],C=Z-$[0],X=Y-$[1],O=V-$[2],W=C*C+X*X+O*O;if(W>0)W=1/Math.sqrt(W),C*=W,X*=W,O*=W;var j=P*O-F*X,E=F*C-B*O,H=B*X-P*C;if(W=j*j+E*E+H*H,W>0)W=1/Math.sqrt(W),j*=W,E*=W,H*=W;return K[0]=j,K[1]=E,K[2]=H,K[3]=0,K[4]=X*H-O*E,K[5]=O*j-C*H,K[6]=C*E-X*j,K[7]=0,K[8]=C,K[9]=X,K[10]=O,K[11]=0,K[12]=Z,K[13]=Y,K[14]=V,K[15]=1,K}function XQ(K){return"mat4("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+", "+K[4]+", "+K[5]+", "+K[6]+", "+K[7]+", "+K[8]+", "+K[9]+", "+K[10]+", "+K[11]+", "+K[12]+", "+K[13]+", "+K[14]+", "+K[15]+")"}function HQ(K){return Math.hypot(K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12],K[13],K[14],K[15])}function WQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K[4]=Q[4]+$[4],K[5]=Q[5]+$[5],K[6]=Q[6]+$[6],K[7]=Q[7]+$[7],K[8]=Q[8]+$[8],K[9]=Q[9]+$[9],K[10]=Q[10]+$[10],K[11]=Q[11]+$[11],K[12]=Q[12]+$[12],K[13]=Q[13]+$[13],K[14]=Q[14]+$[14],K[15]=Q[15]+$[15],K}function x0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K[3]=Q[3]-$[3],K[4]=Q[4]-$[4],K[5]=Q[5]-$[5],K[6]=Q[6]-$[6],K[7]=Q[7]-$[7],K[8]=Q[8]-$[8],K[9]=Q[9]-$[9],K[10]=Q[10]-$[10],K[11]=Q[11]-$[11],K[12]=Q[12]-$[12],K[13]=Q[13]-$[13],K[14]=Q[14]-$[14],K[15]=Q[15]-$[15],K}function OQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K[4]=Q[4]*$,K[5]=Q[5]*$,K[6]=Q[6]*$,K[7]=Q[7]*$,K[8]=Q[8]*$,K[9]=Q[9]*$,K[10]=Q[10]*$,K[11]=Q[11]*$,K[12]=Q[12]*$,K[13]=Q[13]*$,K[14]=Q[14]*$,K[15]=Q[15]*$,K}function EQ(K,Q,$,J){return K[0]=Q[0]+$[0]*J,K[1]=Q[1]+$[1]*J,K[2]=Q[2]+$[2]*J,K[3]=Q[3]+$[3]*J,K[4]=Q[4]+$[4]*J,K[5]=Q[5]+$[5]*J,K[6]=Q[6]+$[6]*J,K[7]=Q[7]+$[7]*J,K[8]=Q[8]+$[8]*J,K[9]=Q[9]+$[9]*J,K[10]=Q[10]+$[10]*J,K[11]=Q[11]+$[11]*J,K[12]=Q[12]+$[12]*J,K[13]=Q[13]+$[13]*J,K[14]=Q[14]+$[14]*J,K[15]=Q[15]+$[15]*J,K}function jQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]&&K[4]===Q[4]&&K[5]===Q[5]&&K[6]===Q[6]&&K[7]===Q[7]&&K[8]===Q[8]&&K[9]===Q[9]&&K[10]===Q[10]&&K[11]===Q[11]&&K[12]===Q[12]&&K[13]===Q[13]&&K[14]===Q[14]&&K[15]===Q[15]}function DQ(K,Q){var $=K[0],J=K[1],Z=K[2],Y=K[3],V=K[4],B=K[5],P=K[6],F=K[7],C=K[8],X=K[9],O=K[10],W=K[11],j=K[12],E=K[13],H=K[14],D=K[15],M=Q[0],N=Q[1],_=Q[2],A=Q[3],R=Q[4],w=Q[5],S=Q[6],h=Q[7],I=Q[8],v=Q[9],p=Q[10],z=Q[11],G=Q[12],f=Q[13],n=Q[14],i=Q[15];return Math.abs($-M)<=k*Math.max(1,Math.abs($),Math.abs(M))&&Math.abs(J-N)<=k*Math.max(1,Math.abs(J),Math.abs(N))&&Math.abs(Z-_)<=k*Math.max(1,Math.abs(Z),Math.abs(_))&&Math.abs(Y-A)<=k*Math.max(1,Math.abs(Y),Math.abs(A))&&Math.abs(V-R)<=k*Math.max(1,Math.abs(V),Math.abs(R))&&Math.abs(B-w)<=k*Math.max(1,Math.abs(B),Math.abs(w))&&Math.abs(P-S)<=k*Math.max(1,Math.abs(P),Math.abs(S))&&Math.abs(F-h)<=k*Math.max(1,Math.abs(F),Math.abs(h))&&Math.abs(C-I)<=k*Math.max(1,Math.abs(C),Math.abs(I))&&Math.abs(X-v)<=k*Math.max(1,Math.abs(X),Math.abs(v))&&Math.abs(O-p)<=k*Math.max(1,Math.abs(O),Math.abs(p))&&Math.abs(W-z)<=k*Math.max(1,Math.abs(W),Math.abs(z))&&Math.abs(j-G)<=k*Math.max(1,Math.abs(j),Math.abs(G))&&Math.abs(E-f)<=k*Math.max(1,Math.abs(E),Math.abs(f))&&Math.abs(H-n)<=k*Math.max(1,Math.abs(H),Math.abs(n))&&Math.abs(D-i)<=k*Math.max(1,Math.abs(D),Math.abs(i))}var ZQ=f0,BQ=y0,UQ=p0,AQ=x0;var b={};P0(b,{str:()=>{{return E$}},squaredLength:()=>{{return OK}},sqrLen:()=>{{return M$}},sqlerp:()=>{{return L$}},slerp:()=>{{return t}},setAxisAngle:()=>{{return VK}},setAxes:()=>{{return S$}},set:()=>{{return A$}},scale:()=>{{return XK}},rotationTo:()=>{{return q$}},rotateZ:()=>{{return P$}},rotateY:()=>{{return B$}},rotateX:()=>{{return V$}},random:()=>{{return X$}},pow:()=>{{return C$}},normalize:()=>{{return H0}},multiply:()=>{{return BK}},mul:()=>{{return _$}},ln:()=>{{return FK}},lerp:()=>{{return N$}},length:()=>{{return WK}},len:()=>{{return k$}},invert:()=>{{return H$}},identity:()=>{{return J$}},getAxisAngle:()=>{{return Z$}},getAngle:()=>{{return Y$}},fromValues:()=>{{return D$}},fromMat3:()=>{{return CK}},fromEuler:()=>{{return O$}},exp:()=>{{return PK}},exactEquals:()=>{{return G$}},equals:()=>{{return T$}},dot:()=>{{return HK}},create:()=>{{return X0}},copy:()=>{{return U$}},conjugate:()=>{{return W$}},clone:()=>{{return j$}},calculateW:()=>{{return F$}},add:()=>{{return R$}}});var m={};P0(m,{zero:()=>{{return nQ}},transformQuat:()=>{{return xQ}},transformMat4:()=>{{return fQ}},transformMat3:()=>{{return yQ}},subtract:()=>{{return c0}},sub:()=>{{return bQ}},str:()=>{{return iQ}},squaredLength:()=>{{return s0}},squaredDistance:()=>{{return i0}},sqrLen:()=>{{return tQ}},sqrDist:()=>{{return aQ}},set:()=>{{return NQ}},scaleAndAdd:()=>{{return hQ}},scale:()=>{{return SQ}},round:()=>{{return LQ}},rotateZ:()=>{{return mQ}},rotateY:()=>{{return cQ}},rotateX:()=>{{return lQ}},random:()=>{{return zQ}},normalize:()=>{{return F0}},negate:()=>{{return IQ}},multiply:()=>{{return m0}},mul:()=>{{return eQ}},min:()=>{{return TQ}},max:()=>{{return qQ}},lerp:()=>{{return vQ}},length:()=>{{return l0}},len:()=>{{return C0}},inverse:()=>{{return wQ}},hermite:()=>{{return pQ}},fromValues:()=>{{return o}},forEach:()=>{{return K$}},floor:()=>{{return GQ}},exactEquals:()=>{{return sQ}},equals:()=>{{return rQ}},dot:()=>{{return a}},divide:()=>{{return d0}},div:()=>{{return uQ}},distance:()=>{{return n0}},dist:()=>{{return oQ}},cross:()=>{{return r}},create:()=>{{return u}},copy:()=>{{return _Q}},clone:()=>{{return RQ}},ceil:()=>{{return MQ}},bezier:()=>{{return gQ}},angle:()=>{{return dQ}},add:()=>{{return kQ}}});function u(){var K=new q(3);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K}function RQ(K){var Q=new q(3);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q}function l0(K){var Q=K[0],$=K[1],J=K[2];return Math.hypot(Q,$,J)}function o(K,Q,$){var J=new q(3);return J[0]=K,J[1]=Q,J[2]=$,J}function _Q(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K}function NQ(K,Q,$,J){return K[0]=Q,K[1]=$,K[2]=J,K}function kQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K}function c0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K}function m0(K,Q,$){return K[0]=Q[0]*$[0],K[1]=Q[1]*$[1],K[2]=Q[2]*$[2],K}function d0(K,Q,$){return K[0]=Q[0]/$[0],K[1]=Q[1]/$[1],K[2]=Q[2]/$[2],K}function MQ(K,Q){return K[0]=Math.ceil(Q[0]),K[1]=Math.ceil(Q[1]),K[2]=Math.ceil(Q[2]),K}function GQ(K,Q){return K[0]=Math.floor(Q[0]),K[1]=Math.floor(Q[1]),K[2]=Math.floor(Q[2]),K}function TQ(K,Q,$){return K[0]=Math.min(Q[0],$[0]),K[1]=Math.min(Q[1],$[1]),K[2]=Math.min(Q[2],$[2]),K}function qQ(K,Q,$){return K[0]=Math.max(Q[0],$[0]),K[1]=Math.max(Q[1],$[1]),K[2]=Math.max(Q[2],$[2]),K}function LQ(K,Q){return K[0]=Math.round(Q[0]),K[1]=Math.round(Q[1]),K[2]=Math.round(Q[2]),K}function SQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K}function hQ(K,Q,$,J){return K[0]=Q[0]+$[0]*J,K[1]=Q[1]+$[1]*J,K[2]=Q[2]+$[2]*J,K}function n0(K,Q){var $=Q[0]-K[0],J=Q[1]-K[1],Z=Q[2]-K[2];return Math.hypot($,J,Z)}function i0(K,Q){var $=Q[0]-K[0],J=Q[1]-K[1],Z=Q[2]-K[2];return $*$+J*J+Z*Z}function s0(K){var Q=K[0],$=K[1],J=K[2];return Q*Q+$*$+J*J}function IQ(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K}function wQ(K,Q){return K[0]=1/Q[0],K[1]=1/Q[1],K[2]=1/Q[2],K}function F0(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=$*$+J*J+Z*Z;if(Y>0)Y=1/Math.sqrt(Y);return K[0]=Q[0]*Y,K[1]=Q[1]*Y,K[2]=Q[2]*Y,K}function a(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]}function r(K,Q,$){var J=Q[0],Z=Q[1],Y=Q[2],V=$[0],B=$[1],P=$[2];return K[0]=Z*P-Y*B,K[1]=Y*V-J*P,K[2]=J*B-Z*V,K}function vQ(K,Q,$,J){var Z=Q[0],Y=Q[1],V=Q[2];return K[0]=Z+J*($[0]-Z),K[1]=Y+J*($[1]-Y),K[2]=V+J*($[2]-V),K}function pQ(K,Q,$,J,Z,Y){var V=Y*Y,B=V*(2*Y-3)+1,P=V*(Y-2)+Y,F=V*(Y-1),C=V*(3-2*Y);return K[0]=Q[0]*B+$[0]*P+J[0]*F+Z[0]*C,K[1]=Q[1]*B+$[1]*P+J[1]*F+Z[1]*C,K[2]=Q[2]*B+$[2]*P+J[2]*F+Z[2]*C,K}function gQ(K,Q,$,J,Z,Y){var V=1-Y,B=V*V,P=Y*Y,F=B*V,C=3*Y*B,X=3*P*V,O=P*Y;return K[0]=Q[0]*F+$[0]*C+J[0]*X+Z[0]*O,K[1]=Q[1]*F+$[1]*C+J[1]*X+Z[1]*O,K[2]=Q[2]*F+$[2]*C+J[2]*X+Z[2]*O,K}function zQ(K,Q){Q=Q||1;var $=c()*2*Math.PI,J=c()*2-1,Z=Math.sqrt(1-J*J)*Q;return K[0]=Math.cos($)*Z,K[1]=Math.sin($)*Z,K[2]=J*Q,K}function fQ(K,Q,$){var J=Q[0],Z=Q[1],Y=Q[2],V=$[3]*J+$[7]*Z+$[11]*Y+$[15];return V=V||1,K[0]=($[0]*J+$[4]*Z+$[8]*Y+$[12])/V,K[1]=($[1]*J+$[5]*Z+$[9]*Y+$[13])/V,K[2]=($[2]*J+$[6]*Z+$[10]*Y+$[14])/V,K}function yQ(K,Q,$){var J=Q[0],Z=Q[1],Y=Q[2];return K[0]=J*$[0]+Z*$[3]+Y*$[6],K[1]=J*$[1]+Z*$[4]+Y*$[7],K[2]=J*$[2]+Z*$[5]+Y*$[8],K}function xQ(K,Q,$){var J=$[0],Z=$[1],Y=$[2],V=$[3],B=Q[0],P=Q[1],F=Q[2],C=Z*F-Y*P,X=Y*B-J*F,O=J*P-Z*B,W=Z*O-Y*X,j=Y*C-J*O,E=J*X-Z*C,H=V*2;return C*=H,X*=H,O*=H,W*=2,j*=2,E*=2,K[0]=B+C+W,K[1]=P+X+j,K[2]=F+O+E,K}function lQ(K,Q,$,J){var Z=[],Y=[];return Z[0]=Q[0]-$[0],Z[1]=Q[1]-$[1],Z[2]=Q[2]-$[2],Y[0]=Z[0],Y[1]=Z[1]*Math.cos(J)-Z[2]*Math.sin(J),Y[2]=Z[1]*Math.sin(J)+Z[2]*Math.cos(J),K[0]=Y[0]+$[0],K[1]=Y[1]+$[1],K[2]=Y[2]+$[2],K}function cQ(K,Q,$,J){var Z=[],Y=[];return Z[0]=Q[0]-$[0],Z[1]=Q[1]-$[1],Z[2]=Q[2]-$[2],Y[0]=Z[2]*Math.sin(J)+Z[0]*Math.cos(J),Y[1]=Z[1],Y[2]=Z[2]*Math.cos(J)-Z[0]*Math.sin(J),K[0]=Y[0]+$[0],K[1]=Y[1]+$[1],K[2]=Y[2]+$[2],K}function mQ(K,Q,$,J){var Z=[],Y=[];return Z[0]=Q[0]-$[0],Z[1]=Q[1]-$[1],Z[2]=Q[2]-$[2],Y[0]=Z[0]*Math.cos(J)-Z[1]*Math.sin(J),Y[1]=Z[0]*Math.sin(J)+Z[1]*Math.cos(J),Y[2]=Z[2],K[0]=Y[0]+$[0],K[1]=Y[1]+$[1],K[2]=Y[2]+$[2],K}function dQ(K,Q){var $=K[0],J=K[1],Z=K[2],Y=Q[0],V=Q[1],B=Q[2],P=Math.sqrt($*$+J*J+Z*Z),F=Math.sqrt(Y*Y+V*V+B*B),C=P*F,X=C&&a(K,Q)/C;return Math.acos(Math.min(Math.max(X,-1),1))}function nQ(K){return K[0]=0,K[1]=0,K[2]=0,K}function iQ(K){return"vec3("+K[0]+", "+K[1]+", "+K[2]+")"}function sQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]}function rQ(K,Q){var $=K[0],J=K[1],Z=K[2],Y=Q[0],V=Q[1],B=Q[2];return Math.abs($-Y)<=k*Math.max(1,Math.abs($),Math.abs(Y))&&Math.abs(J-V)<=k*Math.max(1,Math.abs(J),Math.abs(V))&&Math.abs(Z-B)<=k*Math.max(1,Math.abs(Z),Math.abs(B))}var bQ=c0,eQ=m0,uQ=d0,oQ=n0,aQ=i0,C0=l0,tQ=s0,K$=function(){var K=u();return function(Q,$,J,Z,Y,V){var B,P;if(!$)$=3;if(!J)J=0;if(Z)P=Math.min(Z*$+J,Q.length);else P=Q.length;for(B=J;B<P;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],Y(K,K,V),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2];return Q}}();function Q$(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0,K[3]=0;return K}function r0(K){var Q=new q(4);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q}function b0(K,Q,$,J){var Z=new q(4);return Z[0]=K,Z[1]=Q,Z[2]=$,Z[3]=J,Z}function e0(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K}function u0(K,Q,$,J,Z){return K[0]=Q,K[1]=$,K[2]=J,K[3]=Z,K}function o0(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K}function a0(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K}function t0(K){var Q=K[0],$=K[1],J=K[2],Z=K[3];return Math.hypot(Q,$,J,Z)}function KK(K){var Q=K[0],$=K[1],J=K[2],Z=K[3];return Q*Q+$*$+J*J+Z*Z}function QK(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[3],V=$*$+J*J+Z*Z+Y*Y;if(V>0)V=1/Math.sqrt(V);return K[0]=$*V,K[1]=J*V,K[2]=Z*V,K[3]=Y*V,K}function $K(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]+K[3]*Q[3]}function JK(K,Q,$,J){var Z=Q[0],Y=Q[1],V=Q[2],B=Q[3];return K[0]=Z+J*($[0]-Z),K[1]=Y+J*($[1]-Y),K[2]=V+J*($[2]-V),K[3]=B+J*($[3]-B),K}function ZK(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]}function YK(K,Q){var $=K[0],J=K[1],Z=K[2],Y=K[3],V=Q[0],B=Q[1],P=Q[2],F=Q[3];return Math.abs($-V)<=k*Math.max(1,Math.abs($),Math.abs(V))&&Math.abs(J-B)<=k*Math.max(1,Math.abs(J),Math.abs(B))&&Math.abs(Z-P)<=k*Math.max(1,Math.abs(Z),Math.abs(P))&&Math.abs(Y-F)<=k*Math.max(1,Math.abs(Y),Math.abs(F))}var d$=function(){var K=Q$();return function(Q,$,J,Z,Y,V){var B,P;if(!$)$=4;if(!J)J=0;if(Z)P=Math.min(Z*$+J,Q.length);else P=Q.length;for(B=J;B<P;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],K[3]=Q[B+3],Y(K,K,V),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2],Q[B+3]=K[3];return Q}}();function X0(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K[3]=1,K}function J$(K){return K[0]=0,K[1]=0,K[2]=0,K[3]=1,K}function VK(K,Q,$){$=$*0.5;var J=Math.sin($);return K[0]=J*Q[0],K[1]=J*Q[1],K[2]=J*Q[2],K[3]=Math.cos($),K}function Z$(K,Q){var $=Math.acos(Q[3])*2,J=Math.sin($/2);if(J>k)K[0]=Q[0]/J,K[1]=Q[1]/J,K[2]=Q[2]/J;else K[0]=1,K[1]=0,K[2]=0;return $}function Y$(K,Q){var $=HK(K,Q);return Math.acos(2*$*$-1)}function BK(K,Q,$){var J=Q[0],Z=Q[1],Y=Q[2],V=Q[3],B=$[0],P=$[1],F=$[2],C=$[3];return K[0]=J*C+V*B+Z*F-Y*P,K[1]=Z*C+V*P+Y*B-J*F,K[2]=Y*C+V*F+J*P-Z*B,K[3]=V*C-J*B-Z*P-Y*F,K}function V$(K,Q,$){$*=0.5;var J=Q[0],Z=Q[1],Y=Q[2],V=Q[3],B=Math.sin($),P=Math.cos($);return K[0]=J*P+V*B,K[1]=Z*P+Y*B,K[2]=Y*P-Z*B,K[3]=V*P-J*B,K}function B$(K,Q,$){$*=0.5;var J=Q[0],Z=Q[1],Y=Q[2],V=Q[3],B=Math.sin($),P=Math.cos($);return K[0]=J*P-Y*B,K[1]=Z*P+V*B,K[2]=Y*P+J*B,K[3]=V*P-Z*B,K}function P$(K,Q,$){$*=0.5;var J=Q[0],Z=Q[1],Y=Q[2],V=Q[3],B=Math.sin($),P=Math.cos($);return K[0]=J*P+Z*B,K[1]=Z*P-J*B,K[2]=Y*P+V*B,K[3]=V*P-Y*B,K}function F$(K,Q){var $=Q[0],J=Q[1],Z=Q[2];return K[0]=$,K[1]=J,K[2]=Z,K[3]=Math.sqrt(Math.abs(1-$*$-J*J-Z*Z)),K}function PK(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[3],V=Math.sqrt($*$+J*J+Z*Z),B=Math.exp(Y),P=V>0?B*Math.sin(V)/V:0;return K[0]=$*P,K[1]=J*P,K[2]=Z*P,K[3]=B*Math.cos(V),K}function FK(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[3],V=Math.sqrt($*$+J*J+Z*Z),B=V>0?Math.atan2(V,Y)/V:0;return K[0]=$*B,K[1]=J*B,K[2]=Z*B,K[3]=0.5*Math.log($*$+J*J+Z*Z+Y*Y),K}function C$(K,Q,$){return FK(K,Q),XK(K,K,$),PK(K,K),K}function t(K,Q,$,J){var Z=Q[0],Y=Q[1],V=Q[2],B=Q[3],P=$[0],F=$[1],C=$[2],X=$[3],O,W,j,E,H;if(W=Z*P+Y*F+V*C+B*X,W<0)W=-W,P=-P,F=-F,C=-C,X=-X;if(1-W>k)O=Math.acos(W),j=Math.sin(O),E=Math.sin((1-J)*O)/j,H=Math.sin(J*O)/j;else E=1-J,H=J;return K[0]=E*Z+H*P,K[1]=E*Y+H*F,K[2]=E*V+H*C,K[3]=E*B+H*X,K}function X$(K){var Q=c(),$=c(),J=c(),Z=Math.sqrt(1-Q),Y=Math.sqrt(Q);return K[0]=Z*Math.sin(2*Math.PI*$),K[1]=Z*Math.cos(2*Math.PI*$),K[2]=Y*Math.sin(2*Math.PI*J),K[3]=Y*Math.cos(2*Math.PI*J),K}function H$(K,Q){var $=Q[0],J=Q[1],Z=Q[2],Y=Q[3],V=$*$+J*J+Z*Z+Y*Y,B=V?1/V:0;return K[0]=-$*B,K[1]=-J*B,K[2]=-Z*B,K[3]=Y*B,K}function W$(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K[3]=Q[3],K}function CK(K,Q){var $=Q[0]+Q[4]+Q[8],J;if($>0)J=Math.sqrt($+1),K[3]=0.5*J,J=0.5/J,K[0]=(Q[5]-Q[7])*J,K[1]=(Q[6]-Q[2])*J,K[2]=(Q[1]-Q[3])*J;else{var Z=0;if(Q[4]>Q[0])Z=1;if(Q[8]>Q[Z*3+Z])Z=2;var Y=(Z+1)%3,V=(Z+2)%3;J=Math.sqrt(Q[Z*3+Z]-Q[Y*3+Y]-Q[V*3+V]+1),K[Z]=0.5*J,J=0.5/J,K[3]=(Q[Y*3+V]-Q[V*3+Y])*J,K[Y]=(Q[Y*3+Z]+Q[Z*3+Y])*J,K[V]=(Q[V*3+Z]+Q[Z*3+V])*J}return K}function O$(K,Q,$,J){var Z=0.5*Math.PI/180;Q*=Z,$*=Z,J*=Z;var Y=Math.sin(Q),V=Math.cos(Q),B=Math.sin($),P=Math.cos($),F=Math.sin(J),C=Math.cos(J);return K[0]=Y*P*C-V*B*F,K[1]=V*B*C+Y*P*F,K[2]=V*P*F-Y*B*C,K[3]=V*P*C+Y*B*F,K}function E$(K){return"quat("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+")"}var j$=r0,D$=b0,U$=e0,A$=u0,R$=o0,_$=BK,XK=a0,HK=$K,N$=JK,WK=t0,k$=WK,OK=KK,M$=OK,H0=QK,G$=ZK,T$=YK,q$=function(){var K=u(),Q=o(1,0,0),$=o(0,1,0);return function(J,Z,Y){var V=a(Z,Y);if(V<-0.999999){if(r(K,Q,Z),C0(K)<0.000001)r(K,$,Z);return F0(K,K),VK(J,K,Math.PI),J}else if(V>0.999999)return J[0]=0,J[1]=0,J[2]=0,J[3]=1,J;else return r(K,Z,Y),J[0]=K[0],J[1]=K[1],J[2]=K[2],J[3]=1+V,H0(J,J)}}(),L$=function(){var K=X0(),Q=X0();return function($,J,Z,Y,V,B){return t(K,J,V,B),t(Q,Z,Y,B),t($,K,Q,2*B*(1-B)),$}}(),S$=function(){var K=w0();return function(Q,$,J,Z){return K[0]=J[0],K[3]=J[1],K[6]=J[2],K[1]=Z[0],K[4]=Z[1],K[7]=Z[2],K[2]=-$[0],K[5]=-$[1],K[8]=-$[2],H0(Q,CK(Q,K))}}();var h$=Math.PI/90;class y{m4=Float32Array.from(T.create());constructor(){this.identity()}static create(){return new y}identity(){return T.identity(this.m4),this}invert(K){return T.invert(this.m4,K.getMatrix()),this}multiply(K){return T.multiply(this.m4,this.m4,K.getMatrix()),this}multiply2(K,Q){return T.multiply(this.m4,K.getMatrix(),Q.getMatrix()),this}multiply3(K,Q,$){return this.multiply2(K,Q),this.multiply($),this}translate(K,Q,$){return T.translate(this.m4,this.m4,[K,Q,$]),this}translateToMatrix(K){const Q=K.getMatrix();return this.translate(-Q[12],-Q[13],-Q[14]),this}rotateX(K){return T.rotateX(this.m4,this.m4,K),this}rotateY(K){return T.rotateY(this.m4,this.m4,K),this}rotateZ(K){return T.rotateZ(this.m4,this.m4,K),this}scale(K,Q,$){return T.scale(this.m4,this.m4,[K,Q,$]),this}perspective(K,Q,$,J){return T.perspective(this.m4,K*h$,Q,$,J),this}ortho(K,Q,$,J,Z,Y){return T.ortho(this.m4,K,Q,$,J,Z,Y),this}static aTemp=T.create();static bTemp=T.create();combine(K,Q,$=0.5){return T.multiplyScalar(y.aTemp,K.getMatrix(),1-$),T.multiplyScalar(y.bTemp,Q.getMatrix(),$),T.add(this.m4,y.aTemp,y.bTemp),this}static tempQuat=b.create();moveMatrix(K,Q,$,J){const Z=m.fromValues(-K,Q,$);if(J)T.getRotation(y.tempQuat,J.getMatrix()),b.invert(y.tempQuat,y.tempQuat),m.transformQuat(Z,Z,y.tempQuat);return T.translate(this.m4,this.m4,Z),this}getMatrix(){return this.m4}}var L=y;var EK=0,jK=1,DK=2;class W0{updatedSpriteTransforms=new Set;updatedSpriteTextureSlots=new Set;hudSpriteId=0;constructor(){this.sprites.forEach((K,Q)=>{this.updatedSpriteTransforms.add(Q),this.updatedSpriteTextureSlots.add(Q)})}getUpdatedSpriteTextureSlot(){return this.updatedSpriteTextureSlots}getNumImages(){return 3}async drawImage(K,Q){switch(K){case EK:Q.drawImage(K,(J)=>{const{canvas:Z}=J;Z.width=512,Z.height=512;const Y=Z.width/2,V=Z.height/2,B=Z.width/2;J.imageSmoothingEnabled=!0,J.fillStyle="#ddd",J.lineWidth=Z.width/50,J.fillRect(0,0,Z.width,Z.height),J.strokeStyle="black",J.fillStyle="gold",J.beginPath(),J.arc(Y,V,B*0.8,0,2*Math.PI),J.fill(),J.stroke(),J.beginPath(),J.arc(Y,V,B*0.5,0,Math.PI),J.stroke(),J.beginPath(),J.arc(Z.width/3,Z.height/3,B*0.1,0,Math.PI,!0),J.stroke(),J.beginPath(),J.arc(Z.width/3*2,Z.height/3,B*0.1,0,Math.PI*2,!0),J.stroke()});break;case jK:Q.drawImage(K,(J)=>{const{canvas:Z}=J;Z.width=512,Z.height=512,J.imageSmoothingEnabled=!0,J.fillStyle="#ddd",J.lineWidth=Z.width/50,J.fillRect(0,0,Z.width,Z.height),J.strokeStyle="black",J.fillStyle="silver",J.beginPath(),J.rect(Z.width*0.2,Z.height*0.2,Z.width*0.6,Z.height*0.6),J.fill(),J.stroke()});break;case DK:Q.drawImage(K,(J)=>{const{canvas:Z}=J;Z.width=512,Z.height=512,J.imageSmoothingEnabled=!0,J.fillStyle="#ddd",J.lineWidth=Z.width/50,J.strokeStyle="black",J.fillStyle="silver",J.beginPath(),J.rect(30,30,Z.width-60,Z.height-60),J.stroke()});break}}hudMatrix=L.create();sprites=[{imageId:DK,transforms:[this.hudMatrix.getMatrix()]},...[L.create().translate(0,0,0).getMatrix(),L.create().translate(-1,0,1).rotateY(Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(1,0,1).rotateY(-Math.PI/2).scale(1,1,1).getMatrix()].map((K)=>({imageId:EK,transforms:[K]})),...[L.create().translate(0,-1,1).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(0,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(-2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix()].map((K)=>({imageId:jK,transforms:[K]}))];getMaxSpriteCount(){return this.sprites.length}getSprite(K){return this.sprites[K]}syncWithCamera(K){if(this.keys.KeyW)K.moveCam(0,0,0.25);if(this.keys.KeyS)K.moveCam(0,0,-0.25);if(this.keys.ArrowUp&&!this.keys.ShiftRight)K.moveCam(0,-0.25,0);if(this.keys.ArrowDown&&!this.keys.ShiftRight)K.moveCam(0,0.25,0);if(this.keys.KeyA||this.keys.ArrowLeft&&!this.keys.ShiftRight)K.moveCam(-0.25,0,0);if(this.keys.KeyD||this.keys.ArrowRight&&!this.keys.ShiftRight)K.moveCam(0.25,0,0);if(this.keys.KeyQ||this.keys.ArrowLeft&&this.keys.ShiftRight)K.turnCam(-0.05);if(this.keys.KeyE||this.keys.ArrowRight&&this.keys.ShiftRight)K.turnCam(0.05);if(this.keys.ArrowUp&&this.keys.ShiftRight)K.tilt(-0.05);if(this.keys.ArrowDown&&this.keys.ShiftRight)K.tilt(0.05);if(K.refresh())K.syncHud(this.hudMatrix),this.updatedSpriteTransforms.add(this.hudSpriteId)}getUpdatedSpriteTransforms(){return this.updatedSpriteTransforms}keys={};activate(){const K=($)=>this.keys[$.code]=!0,Q=($)=>this.keys[$.code]=!1;return document.addEventListener("keydown",K),document.addEventListener("keyup",Q),()=>{document.removeEventListener("keydown",K),document.removeEventListener("keyup",Q)}}}class g{disposables;own(K){if(!this.disposables)this.disposables=new Set;return this.disposables.add(K),K}addOnDestroy(K){this.disposables?.add({destroy:K})}destroy(){this.disposables?.forEach((K)=>K.destroy())}}var U=globalThis.WebGL2RenderingContext??{},UK="position",AK="index",O0="transform",E0="slotSize_and_number",RK="cam",_K="projection",NK="maxTextureSize",kK="uTextures";var I$=function(K,Q,$){function J(C,X){function O(j){return j===K?.VERTEX_SHADER?"vertex":j===K?.FRAGMENT_SHADER?"fragment":void 0}if(X!==K.VERTEX_SHADER&&X!==K.FRAGMENT_SHADER)throw new Error(`Shader error in ${O(X)}`);const W=K.createShader(X);if(!W)throw new Error(`Unable to generate ${O(X)} shader.`);if(K.shaderSource(W,C),K.compileShader(W),!K.getShaderParameter(W,K.COMPILE_STATUS))console.error(`Shader compile error in ${O(X)}:`+K.getShaderInfoLog(W));return W}const Z=K.createProgram();if(!Z)throw new Error("Unable to create program.");const Y=J(Q,K.VERTEX_SHADER),V=J($,K.FRAGMENT_SHADER),B=K.getShaderInfoLog(Y),P=K.getShaderInfoLog(V);if(B)console.log("VERTEX",B);if(P)console.log("FRAGMENT",P);K.attachShader(Z,Y),K.attachShader(Z,V),K.linkProgram(Z);const F=K.getProgramInfoLog(Z);if(F)console.log("PROGRAM",F);if(K.detachShader(Z,Y),K.detachShader(Z,V),K.deleteShader(Y),K.deleteShader(V),K.validateProgram(Z),Object.entries(U).forEach(([C,X])=>{if(X&&K.getError()===X)console.log(`gl.${C}`)}),!K.getProgramParameter(Z,K.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+K.getProgramInfoLog(Z));return Z},w$=function(K,Q){K.deleteProgram(Q)};class j0 extends g{gl;program;constructor(K,Q,$){super();this.gl=K,this.program=I$(K,Q.trim(),$.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),w$(this.gl,this.program)}}class D0 extends g{activeProgramId="";gl;programs={};constructor(K){super();this.gl=K}addProgram(K,Q,$){if(this.programs[K])this.removeProgram(K);this.programs[K]=this.own(new j0(this.gl,Q,$))}useProgram(K){if(this.activeProgramId!==K)this.activeProgramId=K,this.programs[K].use()}removeProgram(K){this.programs[K].destroy(),delete this.programs[K]}getProgram(K){return this.programs[K??this.activeProgramId]?.program}}class U0 extends g{gl;triangleArray;constructor(K){super();this.gl=K,this.triangleArray=K.createVertexArray(),K.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class A0 extends g{bufferRecord={};lastBoundBuffer;gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getAttributeLocation(K,Q){const $=this.programs.getProgram(Q);return $?this.gl.getAttribLocation($,K)??-1:-1}createBuffer(K){this.deleteBuffer(K);const Q=this.gl?.createBuffer();if(!Q)throw new Error(`Unable to create buffer "${K}"`);const $={buffer:Q,location:this.getAttributeLocation(K)};return this.bufferRecord[K]=$,$}deleteBuffer(K){if(this.bufferRecord[K])this.gl.deleteBuffer(this.bufferRecord[K].buffer),delete this.bufferRecord[K]}getAttributeBuffer(K,Q){const $=this.bufferRecord[K];if(!$){if(Q)return this.createBuffer(K);throw new Error(`Attribute "${K}" not created. Make sure "createBuffer" is called.`)}return $}bufferData(K,Q,$,J,Z){const Y=this.getAttributeBuffer(Q);if($)this.gl.bufferData(K,$,Z);else this.gl.bufferData(K,J,Z);Y.bufferSize=J||$?.length,Y.bufferArray=$??new Float32Array(Y.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),Y.usage=Z,Y.target=K}bufferSubData(K,Q,$,J,Z){if(J)this.gl.bufferSubData(K,$,Q,J,Z);else this.gl.bufferSubData(K,$,Q)}bindBuffer(K,Q){if(this.lastBoundBuffer!==Q)this.lastBoundBuffer=Q,this.gl.bindBuffer(K,Q.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((K)=>this.deleteBuffer(K))}}class R0 extends g{gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getUniformLocation(K,Q){const $=this.programs.getProgram(Q);return this.gl.getUniformLocation($,K)}}function MK(K,Q=($)=>$.key){var $=[];return _0(K,"",!0,(J)=>$.push(J),Q),$.join("")}var _0=function(K,Q,$,J,Z){if(K){J(`${Q}${$?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${Z(K)}\n`);const Y=Q+($?"    ":"\u2502   ");if(K.left)_0(K.left,Y,!1,J,Z);if(K.right)_0(K.right,Y,!0,J,Z)}};function K0(K){if(K===null)return!0;var Q=Q0(K.left),$=Q0(K.right);if(Math.abs(Q-$)<=1&&K0(K.left)&&K0(K.right))return!0;return!1}var Q0=function(K){return K?1+Math.max(Q0(K.left),Q0(K.right)):0};function $0(K,Q,$,J,Z){const Y=Z-J;if(Y>0){const V=J+Math.floor(Y/2),B=Q[V],P=$[V],F={key:B,data:P,parent:K};return F.left=$0(F,Q,$,J,V),F.right=$0(F,Q,$,V+1,Z),F}return null}function J0(K){if(K===null)return 0;const Q=J0(K.left),$=J0(K.right);return K.balanceFactor=Q-$,Math.max(Q,$)+1}function Z0(K,Q,$,J,Z){if($>=J)return;const Y=K[$+J>>1];let V=$-1,B=J+1;while(!0){do V++;while(Z(K[V],Y)<0);do B--;while(Z(K[B],Y)>0);if(V>=B)break;let P=K[V];K[V]=K[B],K[B]=P,P=Q[V],Q[V]=Q[B],Q[B]=P}Z0(K,Q,$,B,Z),Z0(K,Q,B+1,J,Z)}var v$=function(K,Q){return K>Q?1:K<Q?-1:0},Y0=function(K){var Q=K.right;if(K.right=Q.left,Q.left)Q.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.left=K,K.balanceFactor+=1,Q.balanceFactor<0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor+=1,K.balanceFactor>0)Q.balanceFactor+=K.balanceFactor;return Q},V0=function(K){var Q=K.left;if(K.left=Q.right,K.left)K.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.right=K,K.balanceFactor-=1,Q.balanceFactor>0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor-=1,K.balanceFactor<0)Q.balanceFactor+=K.balanceFactor;return Q};class d{constructor(K,Q=!1){this._comparator=K||v$,this._root=null,this._size=0,this._noDuplicates=!!Q}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(K){if(this._root){var Q=this._root,$=this._comparator;while(Q){var J=$(K,Q.key);if(J===0)return!0;else if(J<0)Q=Q.left;else Q=Q.right}}return!1}next(K){var Q=K;if(Q)if(Q.right){Q=Q.right;while(Q.left)Q=Q.left}else{Q=K.parent;while(Q&&Q.right===K)K=Q,Q=Q.parent}return Q}prev(K){var Q=K;if(Q)if(Q.left){Q=Q.left;while(Q.right)Q=Q.right}else{Q=K.parent;while(Q&&Q.left===K)K=Q,Q=Q.parent}return Q}forEach(K){var Q=this._root,$=[],J=!1,Z=0;while(!J)if(Q)$.push(Q),Q=Q.left;else if($.length>0)Q=$.pop(),K(Q,Z++),Q=Q.right;else J=!0;return this}range(K,Q,$,J){const Z=[],Y=this._comparator;let V=this._root,B;while(Z.length!==0||V)if(V)Z.push(V),V=V.left;else{if(V=Z.pop(),B=Y(V.key,Q),B>0)break;else if(Y(V.key,K)>=0){if($.call(J,V))return this}V=V.right}return this}keys(){var K=this._root,Q=[],$=[],J=!1;while(!J)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.key),K=K.right;else J=!0;return $}values(){var K=this._root,Q=[],$=[],J=!1;while(!J)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.data),K=K.right;else J=!0;return $}at(K){var Q=this._root,$=[],J=!1,Z=0;while(!J)if(Q)$.push(Q),Q=Q.left;else if($.length>0){if(Q=$.pop(),Z===K)return Q;Z++,Q=Q.right}else J=!0;return null}minNode(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K}maxNode(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K}min(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K.key}max(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K.key}isEmpty(){return!this._root}pop(){var K=this._root,Q=null;if(K){while(K.left)K=K.left;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}popMax(){var K=this._root,Q=null;if(K){while(K.right)K=K.right;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}find(K){var Q=this._root,$=Q,J,Z=this._comparator;while($)if(J=Z(K,$.key),J===0)return $;else if(J<0)$=$.left;else $=$.right;return null}insert(K,Q){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:K,data:Q},this._size++,this._root;var $=this._comparator,J=this._root,Z=null,Y=0;if(this._noDuplicates)while(J)if(Y=$(K,J.key),Z=J,Y===0)return null;else if(Y<0)J=J.left;else J=J.right;else while(J)if(Y=$(K,J.key),Z=J,Y<=0)J=J.left;else J=J.right;var V={left:null,right:null,balanceFactor:0,parent:Z,key:K,data:Q},B;if(Y<=0)Z.left=V;else Z.right=V;while(Z){if(Y=$(Z.key,K),Y<0)Z.balanceFactor-=1;else Z.balanceFactor+=1;if(Z.balanceFactor===0)break;else if(Z.balanceFactor<-1){if(Z.right.balanceFactor===1)V0(Z.right);if(B=Y0(Z),Z===this._root)this._root=B;break}else if(Z.balanceFactor>1){if(Z.left.balanceFactor===-1)Y0(Z.left);if(B=V0(Z),Z===this._root)this._root=B;break}Z=Z.parent}return this._size++,V}remove(K){if(!this._root)return null;var Q=this._root,$=this._comparator,J=0;while(Q)if(J=$(K,Q.key),J===0)break;else if(J<0)Q=Q.left;else Q=Q.right;if(!Q)return null;var Z=Q.key,Y,V;if(Q.left){Y=Q.left;while(Y.left||Y.right){while(Y.right)Y=Y.right;if(Q.key=Y.key,Q.data=Y.data,Y.left)Q=Y,Y=Y.left}Q.key=Y.key,Q.data=Y.data,Q=Y}if(Q.right){V=Q.right;while(V.left||V.right){while(V.left)V=V.left;if(Q.key=V.key,Q.data=V.data,V.right)Q=V,V=V.right}Q.key=V.key,Q.data=V.data,Q=V}var B=Q.parent,P=Q,F;while(B){if(B.left===P)B.balanceFactor-=1;else B.balanceFactor+=1;if(B.balanceFactor<-1){if(B.right.balanceFactor===1)V0(B.right);if(F=Y0(B),B===this._root)this._root=F;B=F}else if(B.balanceFactor>1){if(B.left.balanceFactor===-1)Y0(B.left);if(F=V0(B),B===this._root)this._root=F;B=F}if(B.balanceFactor===-1||B.balanceFactor===1)break;P=B,B=B.parent}if(Q.parent)if(Q.parent.left===Q)Q.parent.left=null;else Q.parent.right=null;if(Q===this._root)this._root=null;return this._size--,Z}load(K=[],Q=[],$){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const J=K.length;if($)Z0(K,Q,0,J-1,this._comparator);return this._root=$0(null,K,Q,0,J),J0(this._root),this._size=J,this}isBalanced(){return K0(this._root)}toString(K){return MK(this._root,K)}}d.default=d;class x{size;slotNumber;x;y;textureIndex;parent;sibbling;textureSizeLimits;constructor(K,Q,$,J){this.textureSizeLimits=$?.textureSizeLimits??J??{min:N0,max:k0},this.size=K,this.slotNumber=Q,this.parent=$,this.sibbling=void 0;const{x:Z,y:Y,textureIndex:V}=this.calculatePosition(K,Q);this.x=Z,this.y=Y,this.textureIndex=V}calculateTextureIndex(K,Q){const[$,J]=K,Z=this.textureSizeLimits.max/$*(this.textureSizeLimits.max/J);return Math.floor(Q/Z)}calculatePosition(K,Q){const[$,J]=K,Z=this.textureSizeLimits.max/$,Y=this.textureSizeLimits.max/J,V=Q%Z*$,B=Math.floor(Q/Z)%Y*J;return{x:V,y:B,textureIndex:this.calculateTextureIndex(K,Q)}}getTag(){return x.getTag(this)}static getTag(K){return`${K.size[0]}x${K.size[1]}-#${K.slotNumber}`}static positionToTextureSlot(K,Q,$,J,Z){const[Y,V]=$,B=Z.textureSizeLimits.max/Y,F=Z.textureSizeLimits.max/Y*(Z.textureSizeLimits.max/V)*J+Q/V*B+K/Y;return new x($,F,Z)}getPosition(){return{x:this.x,y:this.y,size:this.size,textureIndex:this.textureIndex}}canSplitHorizontally(){const[,K]=this.size;return K>this.textureSizeLimits.min}canSplitVertically(){const[K]=this.size;return K>this.textureSizeLimits.min}splitHorizontally(){const{x:K,y:Q,size:$,textureIndex:J}=this,[Z,Y]=$;if(!this.canSplitHorizontally())throw new Error(`Cannot split texture slot of size ${Z} horizontally`);const V=Z/2,B=x.positionToTextureSlot(K,Q,[V,Y],J,this),P=x.positionToTextureSlot(K+V,Q,[V,Y],J,this);return B.sibbling=P,P.sibbling=B,[B,P]}splitVertically(){const{x:K,y:Q,size:$,textureIndex:J}=this,[Z,Y]=$;if(!this.canSplitVertically())throw new Error(`Cannot split texture slot of size ${Y} vertically`);const V=Y/2,B=x.positionToTextureSlot(K,Q,[Z,V],J,this),P=x.positionToTextureSlot(K,Q+V,[Z,V],J,this);return B.sibbling=P,P.sibbling=B,[B,P]}}function B0(K,Q){return Math.max(Q,Math.pow(2,Math.ceil(Math.log(K)/Math.log(2))))}function GK(K,Q,$,J){if($<1)throw new Error("Invalid count");const Z=B0(K,J.min),Y=B0(Q,J.min),V=new Map;let B=J.min;for(let P=1;P<=$;P++){B=B0(Z*P,J.min);const F=B0(Y*Math.ceil($/P),J.min);V.set(B,F)}for(let P=B;P<=J.max;P*=2)if(!V.has(P))V.set(P,Y);return V}var p$=!1,N0=16,k0=4096,g$=16;class M0{textureSlots=new d((K,Q)=>{const $=K.size[0]*K.size[1]-Q.size[0]*Q.size[1];if($!==0)return $;return K.slotNumber-Q.slotNumber},!1);allocatedTextures={};minTextureSize;maxTextureSize;numTextureSheets;initialSlots=[];constructor({numTextureSheets:K,minTextureSize:Q,maxTextureSize:$}={},J){if(this.numTextureSheets=K??g$,this.minTextureSize=Q??N0,this.maxTextureSize=$??k0,J)this.numTextureSheets=Math.min(this.numTextureSheets,J.getParameter(WebGL2RenderingContext.MAX_TEXTURE_IMAGE_UNITS)),this.maxTextureSize=Math.min(this.maxTextureSize,J.getParameter(WebGL2RenderingContext.MAX_TEXTURE_SIZE)),this.minTextureSize=Math.min(this.minTextureSize,this.maxTextureSize);for(let Z=0;Z<this.numTextureSheets;Z++)this.initialSlots.push(new x([this.maxTextureSize,this.maxTextureSize],Z,void 0,{min:this.minTextureSize,max:this.maxTextureSize}));this.initialSlots.forEach((Z)=>this.textureSlots.insert(Z))}allocate(K,Q,$=1){const{size:J,slotNumber:Z,x:Y,y:V,textureIndex:B}=this.allocateHelper(K,Q,$);return{size:J,slotNumber:Z,x:Y,y:V,textureIndex:B}}deallocate(K){if(!this.isSlotUsed(K))throw new Error("Slot is not allocated");const Q=this.allocatedTextures[x.getTag(K)];this.deallocateHelper(Q)}get countUsedTextureSheets(){return this.initialSlots.filter((K)=>this.isSlotUsed(K)).length}allocateHelper(K,Q,$=1){const J=GK(K,Q,$,{min:this.minTextureSize,max:this.maxTextureSize}),Z=this.findSlot(J);if(!Z)throw new Error(`Could not find a slot for texture to fit ${$} sprites of size ${K}x${Q}`);this.textureSlots.remove(Z);const[Y,V]=this.bestFit(J,Z);return this.fitSlot(Z,Y,V)}findSlot(K){for(let Q=0;Q<this.textureSlots.size;Q++){const J=this.textureSlots.at(Q).key,[Z,Y]=J.size;if(K.get(Z)<=Y)return J}return null}calculateRatio(K,Q){return Math.max(K/Q,Q/K)}bestFit(K,Q){const[$,J]=Q.size;let Z=Q.textureSizeLimits.max;return K.forEach((Y,V)=>{if(V<=$&&Y<=J){const B=V*Y,P=K.get(Z)*Z;if(B<P)Z=V;else if(B===P){if(this.calculateRatio(V,Y)<this.calculateRatio(Z,K.get(Z)))Z=V}}}),[Z,K.get(Z)]}isSlotUsed(K){return!!this.allocatedTextures[x.getTag(K)]}deallocateHelper(K){if(K.parent&&K.sibbling&&!this.isSlotUsed(K.sibbling)){const Q=K.sibbling;if(this.textureSlots.remove(Q),p$&&this.textureSlots.find(K))throw new Error("Slot is not expected to be in the tree");const $=K.parent;this.deallocateHelper($);return}this.textureSlots.insert(K),delete this.allocatedTextures[K.getTag()]}trySplitHorizontally(K,Q,$){if(K.canSplitHorizontally()){const[J,Z]=K.splitHorizontally();if(J.size[0]>=Q)return this.textureSlots.insert(Z),this.fitSlot(J,Q,$)}return null}trySplitVertically(K,Q,$){if(K.canSplitVertically()){const[J,Z]=K.splitVertically();if(J.size[1]>=$)return this.textureSlots.insert(Z),this.fitSlot(J,Q,$)}return null}fitSlot(K,Q,$){if(this.allocatedTextures[K.getTag()]=K,K.size[0]>K.size[1]){const J=this.trySplitHorizontally(K,Q,$)??this.trySplitVertically(K,Q,$);if(J)return J}else{const J=this.trySplitVertically(K,Q,$)??this.trySplitHorizontally(K,Q,$);if(J)return J}return K}listSlots(){this.textureSlots.forEach((K)=>{console.log(K.key?.getTag())})}}class G0 extends g{gl;uniforms;textureBuffers={};tempContext=new OffscreenCanvas(1,1).getContext("2d");textureSlotAllocator=new M0;constructor(K,Q){super();this.gl=K,this.uniforms=Q,this.tempContext.imageSmoothingEnabled=!0}initialize(){this.initTextureUniforms(),this.initMaxTexture()}getTexture(K){if(!this.textureBuffers[K]){const Q=this.gl.createTexture();if(!Q)return;this.gl.bindTexture(U.TEXTURE_2D,Q),this.gl.texImage2D(U.TEXTURE_2D,0,U.RGBA,this.textureSlotAllocator.maxTextureSize,this.textureSlotAllocator.maxTextureSize,0,U.RGBA,U.UNSIGNED_BYTE,null),this.textureBuffers[K]=Q,this.addOnDestroy(()=>this.gl.deleteTexture(Q))}return this.textureBuffers[K]}loadTexture(K,Q,$,J,Z){this.gl.activeTexture(U[Q]),this.gl.bindTexture(U.TEXTURE_2D,$),this.applyTexImage2d(K,J,Z),this.gl.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR)}applyTexImage2d(K,[Q,$,J,Z],[Y,V,B,P]){if(J===B&&Z===P&&!Q&&!$)this.gl.texSubImage2D(U.TEXTURE_2D,0,Y,V,B,P,U.RGBA,U.UNSIGNED_BYTE,K.texImgSrc);else{const F=this.tempContext.canvas;if(K.texImgSrc instanceof ImageData){if(F.width=B||K.width,F.height=P||K.height,this.tempContext.putImageData(K.texImgSrc,0,0),Q||$)console.warn("Offset not available when sending imageData")}else{const C=J||K.width,X=Z||K.height;F.width=B||C,F.height=P||X,this.tempContext.drawImage(K.texImgSrc,Q,$,C,X,0,0,F.width,F.height)}this.gl.texSubImage2D(U.TEXTURE_2D,0,Y,V,F.width,F.height,U.RGBA,U.UNSIGNED_BYTE,F)}}allocateSlotForImage(K){const Q=this.textureSlotAllocator.allocate(K.width,K.height),$=`TEXTURE${Q.textureIndex}`,J=this.getTexture($);if(!J)throw new Error(`Invalid texture Id ${$}`);const Z=this.assignImageToTexture(K,$,J,[0,0,K.width,K.height],[Q.x,Q.y,...Q.size]);return{slot:Q,refreshCallback:Z}}assignImageToTexture(K,Q,$,J,Z){if(K){const Y=J??[0,0,K.width,K.height],V=Z??[0,0,Y[2],Y[3]];if(K.active){const B=()=>{this.gl.bindTexture(U.TEXTURE_2D,$),this.applyTexImage2d(K,Y,V)};return B(),B}else this.loadTexture(K,Q,$,Y,V),K.active=!0}return null}generateMipMap(K){const Q=this.getTexture(K);if(Q)this.gl.activeTexture(U[K]),this.gl.bindTexture(U.TEXTURE_2D,Q),this.gl.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),this.gl.generateMipmap(U.TEXTURE_2D)}generateMipMaps(){const K=this.textureSlotAllocator.countUsedTextureSheets;for(let Q=0;Q<K;Q++){const $=`TEXTURE${Q}`;this.generateMipMap($)}}initTextureUniforms(){const K=this.gl.getParameter(U.MAX_TEXTURE_IMAGE_UNITS),Q=new Array(K).fill(null).map((J,Z)=>Z),$=this.uniforms.getUniformLocation(kK);this.gl.uniform1iv($,Q)}initMaxTexture(){const K=this.uniforms.getUniformLocation(NK);this.gl.uniform1f(K,this.textureSlotAllocator.maxTextureSize)}}class l extends g{texImgSrc;active=!1;width;height;constructor(K){super();if(this.texImgSrc=K,this.width=K instanceof Image?K.naturalWidth:K instanceof VideoFrame?K.displayWidth:K.width,this.height=K instanceof Image?K.naturalHeight:K instanceof VideoFrame?K.displayHeight:K.height,!this.width||!this.height)throw new Error("Invalid image")}static createFromCanvas(K){return new l(K)}static async loadImage(K){return new Promise((Q,$)=>{const J=new Image,Z=new l(J),Y=()=>Q(Z),V=(B)=>$(B.error);J.addEventListener("error",V),J.addEventListener("load",Y,{once:!0}),Z.addOnDestroy(()=>J.removeEventListener("load",Y)),J.src=K})}static async loadVideo(K,Q){return new Promise(($,J)=>{const Z=document.createElement("video"),Y=new l(Z);if(Z.loop=!0,Q!==void 0)Z.volume=Q;const V=()=>Z.play(),B=()=>$(Y);Z.addEventListener("loadedmetadata",V),Z.addEventListener("playing",B,{once:!0}),Z.addEventListener("error",(P)=>J(P.error)),Z.src=K,Y.addOnDestroy(()=>{Z.pause(),Z.removeEventListener("playing",B),Z.removeEventListener("loadmetadata",V)})})}static async loadWebcam(K){return new Promise((Q,$)=>{const J=document.createElement("video"),Z=new l(J);J.loop=!0;const Y=()=>J.play(),V=()=>Q(Z);J.addEventListener("loadedmetadata",Y),J.addEventListener("playing",V,{once:!0}),J.addEventListener("error",(P)=>$(P.error));let B=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:K}}).then((P)=>{if(!B)J.srcObject=P,Z.addOnDestroy(()=>P.getTracks().forEach((F)=>F.stop()))}),Z.addOnDestroy(()=>{B=!0,J.pause(),J.removeEventListener("playing",V),J.removeEventListener("loadmetadata",Y)})})}}class T0 extends g{constructor(){super(...arguments)}images=[];hasImageId(K){return!!this.getMedia(K)}getMedia(K){return this.images[K]}setImage(K,Q){this.images[K]=Q}async drawImage(K,Q){const $=new OffscreenCanvas(1,1);Q($.getContext("2d"));const J=l.createFromCanvas($);return this.images[K]=this.own(J),J}async loadCanvas(K,Q){const $=l.createFromCanvas(Q);return Q.getContext("2d"),this.images[K]=this.own($),$}async loadImage(K,Q){const $=await l.loadImage(Q);return this.images[K]=this.own($),$}async loadVideo(K,Q,$){const J=await l.loadVideo(Q,$);return this.images[K]=this.own(J),J}async loadWebCam(K,Q){const $=await l.loadWebcam(Q);return this.images[K]=this.own($),$}}var TK=`#version 300 es
//  ~{AUTHOR}

precision highp float;

//  IN
//  shape
layout(location = 0) in vec2 position;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec3 slotSize_and_number;

//  UNIFORM
uniform float maxTextureSize;
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  vec2 tex = position.xy * -0.5 + 0.5;
  vec2 slotSize = slotSize_and_number.xy;
  float slotNumber = slotSize_and_number.z;
  float maxCols = maxTextureSize / slotSize.x;
  float maxRows = maxTextureSize / slotSize.y;
  float slotX = mod(slotNumber, maxCols);
  float slotY = mod(floor(slotNumber / maxCols), maxRows);

  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = (vec2(slotX, slotY) + tex) * slotSize / maxTextureSize;
  textureIndex = floor(slotNumber / (maxCols * maxRows));
}
`;var qK=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function q0(K,Q){return K.replace(/~\{(\w+)\}/g,($,J)=>{return Q?.[J]||$})}class L0 extends L{constructor(){super(...arguments)}perspectiveMatrix=L.create();orthoMatrix=L.create();perspectiveLevel=1;configPerspectiveMatrix(K){this.perspectiveMatrix.perspective(45,K,0.01,1000)}configOrthoMatrix(K){this.orthoMatrix.ortho(-K,K,-1,1,-1000,1000)}configure(K){this.configPerspectiveMatrix(K),this.configOrthoMatrix(K)}setPerspective(K){this.perspectiveLevel=K,this.combine(this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel)}}class S0{gl;uniforms;camPositionMatrix=L.create().translate(0,0,-1);projectionMatrix=new L0;needsRefresh=!1;constructor(K,Q){this.gl=K,this.uniforms=Q}configProjectionMatrix(K){this.projectionMatrix.configure(K),this.updatePerspective(1)}camTiltMatrix=L.create();camTurnMatrix=L.create();camMatrix=L.create();refresh(){if(!this.needsRefresh)return!1;this.invertedCamTiltMatrix.invert(this.camTiltMatrix),this.invertedCamTurnMatrix.invert(this.camTurnMatrix),this.camMatrix.multiply3(this.camTiltMatrix,this.camTurnMatrix,this.camPositionMatrix);const K=this.uniforms.getUniformLocation(RK);return this.gl.uniformMatrix4fv(K,!1,this.camMatrix.getMatrix()),this.needsRefresh=!1,!0}updatePerspective(K){this.projectionMatrix.setPerspective(K);const Q=this.uniforms.getUniformLocation(_K);this.gl.uniformMatrix4fv(Q,!1,this.projectionMatrix.getMatrix()),this.needsRefresh=!0}moveCam(K,Q,$){this.camPositionMatrix.moveMatrix(K,Q,$,this.camTurnMatrix),this.needsRefresh=!0}turnCam(K){this.camTurnMatrix.rotateY(K),this.needsRefresh=!0}tilt(K){this.camTiltMatrix.rotateX(K),this.needsRefresh=!0}invertedCamTurnMatrix=L.create();invertedCamTiltMatrix=L.create();syncHud(K){K?.identity().translateToMatrix(this.camPositionMatrix).multiply(this.invertedCamTurnMatrix).multiply(this.invertedCamTiltMatrix).translate(0,0,-0.9)}}var l$=function(K){if(!x$)return K;return new Proxy(K,{get($,J){const Z=$,Y=Z[J];if(typeof Y==="function")return(...B)=>{const P=Y.apply(Z,B);return console.log(`gl.${String(J)}(`,B,") = ",P),P};else return console.log(`gl.${String(J)} = `,Y),Y}})},y$={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},x$=!1;class e extends g{gl;programs;attributeBuffers;uniforms;canvas;textureManager;imageManager;camera;textureSlots=[];world;onDeactivateWorld=()=>{};topVisibleSprite=-1;constructor(K,{attributes:Q,world:$}={}){super();this.gl=l$(K.getContext("webgl2",{...y$,...Q})),this.canvas=K,this.programs=this.own(new D0(this.gl)),this.uniforms=this.own(new R0(this.gl,this.programs)),this.attributeBuffers=this.own(new A0(this.gl,this.programs)),this.textureManager=new G0(this.gl,this.uniforms),this.imageManager=new T0,this.camera=new S0(this.gl,this.uniforms),window.addEventListener("resize",this.checkCanvasSize.bind(this)),this.setWorld($)}resetWorld(){this.textureSlots.length=0,this.onDeactivateWorld()}setWorld(K){this.resetWorld(),this.world=K;const Q=this.world?.activate();if(Q)this.onDeactivateWorld=Q}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const K=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configProjectionMatrix(K)}async initialize(){const Q={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",q0(TK,Q),q0(qK,Q)),this.programs.useProgram("main"),this.gl.enable(U.DEPTH_TEST),this.gl.depthFunc(U.LESS),this.gl.clearDepth(1),this.gl.enable(U.BLEND),this.gl.blendFunc(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const $=AK;this.attributeBuffers.createBuffer($);const J=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(U.ELEMENT_ARRAY_BUFFER,J),this.attributeBuffers.bufferData(U.ELEMENT_ARRAY_BUFFER,$,Uint16Array.from([0,1,2,2,3,0]),0,U.STATIC_DRAW)}{const $=UK;this.attributeBuffers.createBuffer($);const J=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(U.ARRAY_BUFFER,J),this.gl.vertexAttribPointer(J.location,2,U.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(J.location),this.attributeBuffers.bufferData(U.ARRAY_BUFFER,$,Float32Array.from([-1,-1,1,-1,1,1,-1,1]),0,U.STATIC_DRAW)}{const $=O0;this.attributeBuffers.createBuffer($);const J=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(U.ARRAY_BUFFER,J);for(let Y=0;Y<4;Y++){const V=J.location+Y;this.gl.vertexAttribPointer(V,4,U.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,Y*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(V),this.gl.vertexAttribDivisor(V,1)}const Z=this.world?.getMaxSpriteCount()??0;this.attributeBuffers.bufferData(U.ARRAY_BUFFER,$,new Float32Array(Z*4*4),0,U.DYNAMIC_DRAW),this.textureManager.initialize()}await this.loadTextures(),this.checkCanvasSize()}static spriteMatrix=L.create();updateSprite(K){e.spriteMatrix.identity();const Q=e.spriteMatrix.getMatrix(),$=this.world?.getSprite(K);return $?.transforms.forEach((J)=>T.multiply(Q,Q,J)),this.attributeBuffers.bufferSubData(U.ARRAY_BUFFER,Q,16*Float32Array.BYTES_PER_ELEMENT*K),!!$}async loadTextures(){const K=this.world?.getNumImages()??0;for(let Q=0;Q<K;Q++){await this.world?.drawImage(Q,this.imageManager);const $=this.imageManager.getMedia(Q),{slot:J,refreshCallback:Z}=this.textureManager.allocateSlotForImage($);this.textureSlots[Q]={refreshCallback:Z,buffer:Float32Array.from([...J.size,J.slotNumber])}}this.textureManager.generateMipMaps();{const Q=E0;this.attributeBuffers.createBuffer(Q);const $=this.attributeBuffers.getAttributeBuffer(Q);this.attributeBuffers.bindBuffer(U.ARRAY_BUFFER,$);const J=$.location;this.gl.vertexAttribPointer(J,3,U.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(J),this.gl.vertexAttribDivisor(J,1),this.attributeBuffers.bufferData(U.ARRAY_BUFFER,Q,new Float32Array((this.world?.getMaxSpriteCount()??0)*3),0,U.DYNAMIC_DRAW)}}drawElementsInstanced(K,Q){this.gl.drawElementsInstanced(U.TRIANGLES,K,U.UNSIGNED_SHORT,0,Q)}updateSprites(){const K=this.world?.getUpdatedSpriteTransforms();if(K?.size){const $=this.attributeBuffers.getAttributeBuffer(O0);this.attributeBuffers.bindBuffer(U.ARRAY_BUFFER,$),K?.forEach((J)=>{if(this.updateSprite(J))this.topVisibleSprite=Math.max(this.topVisibleSprite,J)}),K?.clear()}const Q=this.world?.getUpdatedSpriteTextureSlot();if(Q?.size){const $=this.attributeBuffers.getAttributeBuffer(E0);this.attributeBuffers.bindBuffer(U.ARRAY_BUFFER,$),Q?.forEach((J)=>{const Z=this.world?.getSprite(J);if(Z?.imageId!==void 0){const{buffer:Y}=this.textureSlots[Z.imageId];this.attributeBuffers.bufferSubData(U.ARRAY_BUFFER,Y,3*Float32Array.BYTES_PER_ELEMENT*J)}})}Q?.clear();while(!this.world?.getSprite(this.topVisibleSprite))this.topVisibleSprite--;return this.topVisibleSprite+1}refresh(){this.gl.clear(U.COLOR_BUFFER_BIT|U.DEPTH_BUFFER_BIT);const K=6;this.world?.syncWithCamera(this.camera);const Q=this.updateSprites();this.drawElementsInstanced(K,Q)}bindVertexArray(){return this.own(new U0(this.gl))}start(){let K=0;const Q=()=>{this.refresh(),K=requestAnimationFrame(Q)};this.refresh(),Q()}}async function QZ(){console.log("Hello World!")}async function $Z(K){K.style.border="2px solid silver",K.style.cursor="grab",K.addEventListener("mouseenter",()=>{K.style.borderColor="black"}),K.addEventListener("mouseleave",()=>{K.style.borderColor="silver"});const Q=new e(K,{world:new W0});return await Q.initialize(),Q.start(),Q}export{$Z as testCanvas,QZ as hello};

//# debugId=A19DD49F9F99A4FC64756e2164756e21
