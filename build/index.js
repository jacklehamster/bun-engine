var LK=Object.defineProperty;var P0=(K,Q)=>{for(var $ in Q)LK(K,$,{get:Q[$],enumerable:!0,configurable:!0,set:(Z)=>Q[$]=()=>Z})};var k=0.000001,q=typeof Float32Array!=="undefined"?Float32Array:Array,c=Math.random,d$=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var K=0,Q=arguments.length;while(Q--)K+=arguments[Q]*arguments[Q];return Math.sqrt(K)};function I0(){var K=new q(9);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0;return K[0]=1,K[4]=1,K[8]=1,K}var T={};P0(T,{transpose:()=>{{return gK}},translate:()=>{{return xK}},targetTo:()=>{{return XQ}},subtract:()=>{{return y0}},sub:()=>{{return AQ}},str:()=>{{return CQ}},set:()=>{{return vK}},scale:()=>{{return lK}},rotateZ:()=>{{return nK}},rotateY:()=>{{return mK}},rotateX:()=>{{return dK}},rotate:()=>{{return cK}},perspectiveZO:()=>{{return YQ}},perspectiveNO:()=>{{return z0}},perspectiveFromFieldOfView:()=>{{return VQ}},perspective:()=>{{return JQ}},orthoZO:()=>{{return FQ}},orthoNO:()=>{{return f0}},ortho:()=>{{return BQ}},multiplyScalarAndAdd:()=>{{return UQ}},multiplyScalar:()=>{{return WQ}},multiply:()=>{{return p0}},mul:()=>{{return DQ}},lookAt:()=>{{return PQ}},invert:()=>{{return zK}},identity:()=>{{return w0}},getTranslation:()=>{{return aK}},getScaling:()=>{{return g0}},getRotation:()=>{{return tK}},frustum:()=>{{return ZQ}},fromZRotation:()=>{{return uK}},fromYRotation:()=>{{return eK}},fromXRotation:()=>{{return bK}},fromValues:()=>{{return pK}},fromTranslation:()=>{{return iK}},fromScaling:()=>{{return sK}},fromRotationTranslationScaleOrigin:()=>{{return QQ}},fromRotationTranslationScale:()=>{{return KQ}},fromRotationTranslation:()=>{{return v0}},fromRotation:()=>{{return rK}},fromQuat2:()=>{{return oK}},fromQuat:()=>{{return $Q}},frob:()=>{{return HQ}},exactEquals:()=>{{return EQ}},equals:()=>{{return jQ}},determinant:()=>{{return yK}},create:()=>{{return hK}},copy:()=>{{return wK}},clone:()=>{{return IK}},adjoint:()=>{{return fK}},add:()=>{{return OQ}}});function hK(){var K=new q(16);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0;return K[0]=1,K[5]=1,K[10]=1,K[15]=1,K}function IK(K){var Q=new q(16);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function wK(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function pK(K,Q,$,Z,J,Y,V,B,F,P,X,C,W,O,E,U){var H=new q(16);return H[0]=K,H[1]=Q,H[2]=$,H[3]=Z,H[4]=J,H[5]=Y,H[6]=V,H[7]=B,H[8]=F,H[9]=P,H[10]=X,H[11]=C,H[12]=W,H[13]=O,H[14]=E,H[15]=U,H}function vK(K,Q,$,Z,J,Y,V,B,F,P,X,C,W,O,E,U,H){return K[0]=Q,K[1]=$,K[2]=Z,K[3]=J,K[4]=Y,K[5]=V,K[6]=B,K[7]=F,K[8]=P,K[9]=X,K[10]=C,K[11]=W,K[12]=O,K[13]=E,K[14]=U,K[15]=H,K}function w0(K){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function gK(K,Q){if(K===Q){var $=Q[1],Z=Q[2],J=Q[3],Y=Q[6],V=Q[7],B=Q[11];K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=$,K[6]=Q[9],K[7]=Q[13],K[8]=Z,K[9]=Y,K[11]=Q[14],K[12]=J,K[13]=V,K[14]=B}else K[0]=Q[0],K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=Q[1],K[5]=Q[5],K[6]=Q[9],K[7]=Q[13],K[8]=Q[2],K[9]=Q[6],K[10]=Q[10],K[11]=Q[14],K[12]=Q[3],K[13]=Q[7],K[14]=Q[11],K[15]=Q[15];return K}function zK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[3],V=Q[4],B=Q[5],F=Q[6],P=Q[7],X=Q[8],C=Q[9],W=Q[10],O=Q[11],E=Q[12],U=Q[13],H=Q[14],j=Q[15],M=$*B-Z*V,N=$*F-J*V,R=$*P-Y*V,A=Z*F-J*B,_=Z*P-Y*B,w=J*P-Y*F,S=X*U-C*E,h=X*H-W*E,I=X*j-O*E,p=C*H-W*U,v=C*j-O*U,z=W*j-O*H,G=M*z-N*v+R*p+A*I-_*h+w*S;if(!G)return null;return G=1/G,K[0]=(B*z-F*v+P*p)*G,K[1]=(J*v-Z*z-Y*p)*G,K[2]=(U*w-H*_+j*A)*G,K[3]=(W*_-C*w-O*A)*G,K[4]=(F*I-V*z-P*h)*G,K[5]=($*z-J*I+Y*h)*G,K[6]=(H*R-E*w-j*N)*G,K[7]=(X*w-W*R+O*N)*G,K[8]=(V*v-B*I+P*S)*G,K[9]=(Z*I-$*v-Y*S)*G,K[10]=(E*_-U*R+j*M)*G,K[11]=(C*R-X*_-O*M)*G,K[12]=(B*h-V*p-F*S)*G,K[13]=($*p-Z*h+J*S)*G,K[14]=(U*N-E*A-H*M)*G,K[15]=(X*A-C*N+W*M)*G,K}function fK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[3],V=Q[4],B=Q[5],F=Q[6],P=Q[7],X=Q[8],C=Q[9],W=Q[10],O=Q[11],E=Q[12],U=Q[13],H=Q[14],j=Q[15];return K[0]=B*(W*j-O*H)-C*(F*j-P*H)+U*(F*O-P*W),K[1]=-(Z*(W*j-O*H)-C*(J*j-Y*H)+U*(J*O-Y*W)),K[2]=Z*(F*j-P*H)-B*(J*j-Y*H)+U*(J*P-Y*F),K[3]=-(Z*(F*O-P*W)-B*(J*O-Y*W)+C*(J*P-Y*F)),K[4]=-(V*(W*j-O*H)-X*(F*j-P*H)+E*(F*O-P*W)),K[5]=$*(W*j-O*H)-X*(J*j-Y*H)+E*(J*O-Y*W),K[6]=-($*(F*j-P*H)-V*(J*j-Y*H)+E*(J*P-Y*F)),K[7]=$*(F*O-P*W)-V*(J*O-Y*W)+X*(J*P-Y*F),K[8]=V*(C*j-O*U)-X*(B*j-P*U)+E*(B*O-P*C),K[9]=-($*(C*j-O*U)-X*(Z*j-Y*U)+E*(Z*O-Y*C)),K[10]=$*(B*j-P*U)-V*(Z*j-Y*U)+E*(Z*P-Y*B),K[11]=-($*(B*O-P*C)-V*(Z*O-Y*C)+X*(Z*P-Y*B)),K[12]=-(V*(C*H-W*U)-X*(B*H-F*U)+E*(B*W-F*C)),K[13]=$*(C*H-W*U)-X*(Z*H-J*U)+E*(Z*W-J*C),K[14]=-($*(B*H-F*U)-V*(Z*H-J*U)+E*(Z*F-J*B)),K[15]=$*(B*W-F*C)-V*(Z*W-J*C)+X*(Z*F-J*B),K}function yK(K){var Q=K[0],$=K[1],Z=K[2],J=K[3],Y=K[4],V=K[5],B=K[6],F=K[7],P=K[8],X=K[9],C=K[10],W=K[11],O=K[12],E=K[13],U=K[14],H=K[15],j=Q*V-$*Y,M=Q*B-Z*Y,N=Q*F-J*Y,R=$*B-Z*V,A=$*F-J*V,_=Z*F-J*B,w=P*E-X*O,S=P*U-C*O,h=P*H-W*O,I=X*U-C*E,p=X*H-W*E,v=C*H-W*U;return j*v-M*p+N*I+R*h-A*S+_*w}function p0(K,Q,$){var Z=Q[0],J=Q[1],Y=Q[2],V=Q[3],B=Q[4],F=Q[5],P=Q[6],X=Q[7],C=Q[8],W=Q[9],O=Q[10],E=Q[11],U=Q[12],H=Q[13],j=Q[14],M=Q[15],N=$[0],R=$[1],A=$[2],_=$[3];return K[0]=N*Z+R*B+A*C+_*U,K[1]=N*J+R*F+A*W+_*H,K[2]=N*Y+R*P+A*O+_*j,K[3]=N*V+R*X+A*E+_*M,N=$[4],R=$[5],A=$[6],_=$[7],K[4]=N*Z+R*B+A*C+_*U,K[5]=N*J+R*F+A*W+_*H,K[6]=N*Y+R*P+A*O+_*j,K[7]=N*V+R*X+A*E+_*M,N=$[8],R=$[9],A=$[10],_=$[11],K[8]=N*Z+R*B+A*C+_*U,K[9]=N*J+R*F+A*W+_*H,K[10]=N*Y+R*P+A*O+_*j,K[11]=N*V+R*X+A*E+_*M,N=$[12],R=$[13],A=$[14],_=$[15],K[12]=N*Z+R*B+A*C+_*U,K[13]=N*J+R*F+A*W+_*H,K[14]=N*Y+R*P+A*O+_*j,K[15]=N*V+R*X+A*E+_*M,K}function xK(K,Q,$){var Z=$[0],J=$[1],Y=$[2],V,B,F,P,X,C,W,O,E,U,H,j;if(Q===K)K[12]=Q[0]*Z+Q[4]*J+Q[8]*Y+Q[12],K[13]=Q[1]*Z+Q[5]*J+Q[9]*Y+Q[13],K[14]=Q[2]*Z+Q[6]*J+Q[10]*Y+Q[14],K[15]=Q[3]*Z+Q[7]*J+Q[11]*Y+Q[15];else V=Q[0],B=Q[1],F=Q[2],P=Q[3],X=Q[4],C=Q[5],W=Q[6],O=Q[7],E=Q[8],U=Q[9],H=Q[10],j=Q[11],K[0]=V,K[1]=B,K[2]=F,K[3]=P,K[4]=X,K[5]=C,K[6]=W,K[7]=O,K[8]=E,K[9]=U,K[10]=H,K[11]=j,K[12]=V*Z+X*J+E*Y+Q[12],K[13]=B*Z+C*J+U*Y+Q[13],K[14]=F*Z+W*J+H*Y+Q[14],K[15]=P*Z+O*J+j*Y+Q[15];return K}function lK(K,Q,$){var Z=$[0],J=$[1],Y=$[2];return K[0]=Q[0]*Z,K[1]=Q[1]*Z,K[2]=Q[2]*Z,K[3]=Q[3]*Z,K[4]=Q[4]*J,K[5]=Q[5]*J,K[6]=Q[6]*J,K[7]=Q[7]*J,K[8]=Q[8]*Y,K[9]=Q[9]*Y,K[10]=Q[10]*Y,K[11]=Q[11]*Y,K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function cK(K,Q,$,Z){var J=Z[0],Y=Z[1],V=Z[2],B=Math.hypot(J,Y,V),F,P,X,C,W,O,E,U,H,j,M,N,R,A,_,w,S,h,I,p,v,z,G,f;if(B<k)return null;if(B=1/B,J*=B,Y*=B,V*=B,F=Math.sin($),P=Math.cos($),X=1-P,C=Q[0],W=Q[1],O=Q[2],E=Q[3],U=Q[4],H=Q[5],j=Q[6],M=Q[7],N=Q[8],R=Q[9],A=Q[10],_=Q[11],w=J*J*X+P,S=Y*J*X+V*F,h=V*J*X-Y*F,I=J*Y*X-V*F,p=Y*Y*X+P,v=V*Y*X+J*F,z=J*V*X+Y*F,G=Y*V*X-J*F,f=V*V*X+P,K[0]=C*w+U*S+N*h,K[1]=W*w+H*S+R*h,K[2]=O*w+j*S+A*h,K[3]=E*w+M*S+_*h,K[4]=C*I+U*p+N*v,K[5]=W*I+H*p+R*v,K[6]=O*I+j*p+A*v,K[7]=E*I+M*p+_*v,K[8]=C*z+U*G+N*f,K[9]=W*z+H*G+R*f,K[10]=O*z+j*G+A*f,K[11]=E*z+M*G+_*f,Q!==K)K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K}function dK(K,Q,$){var Z=Math.sin($),J=Math.cos($),Y=Q[4],V=Q[5],B=Q[6],F=Q[7],P=Q[8],X=Q[9],C=Q[10],W=Q[11];if(Q!==K)K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[4]=Y*J+P*Z,K[5]=V*J+X*Z,K[6]=B*J+C*Z,K[7]=F*J+W*Z,K[8]=P*J-Y*Z,K[9]=X*J-V*Z,K[10]=C*J-B*Z,K[11]=W*J-F*Z,K}function mK(K,Q,$){var Z=Math.sin($),J=Math.cos($),Y=Q[0],V=Q[1],B=Q[2],F=Q[3],P=Q[8],X=Q[9],C=Q[10],W=Q[11];if(Q!==K)K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=Y*J-P*Z,K[1]=V*J-X*Z,K[2]=B*J-C*Z,K[3]=F*J-W*Z,K[8]=Y*Z+P*J,K[9]=V*Z+X*J,K[10]=B*Z+C*J,K[11]=F*Z+W*J,K}function nK(K,Q,$){var Z=Math.sin($),J=Math.cos($),Y=Q[0],V=Q[1],B=Q[2],F=Q[3],P=Q[4],X=Q[5],C=Q[6],W=Q[7];if(Q!==K)K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=Y*J+P*Z,K[1]=V*J+X*Z,K[2]=B*J+C*Z,K[3]=F*J+W*Z,K[4]=P*J-Y*Z,K[5]=X*J-V*Z,K[6]=C*J-B*Z,K[7]=W*J-F*Z,K}function iK(K,Q){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=Q[0],K[13]=Q[1],K[14]=Q[2],K[15]=1,K}function sK(K,Q){return K[0]=Q[0],K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Q[1],K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=Q[2],K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function rK(K,Q,$){var Z=$[0],J=$[1],Y=$[2],V=Math.hypot(Z,J,Y),B,F,P;if(V<k)return null;return V=1/V,Z*=V,J*=V,Y*=V,B=Math.sin(Q),F=Math.cos(Q),P=1-F,K[0]=Z*Z*P+F,K[1]=J*Z*P+Y*B,K[2]=Y*Z*P-J*B,K[3]=0,K[4]=Z*J*P-Y*B,K[5]=J*J*P+F,K[6]=Y*J*P+Z*B,K[7]=0,K[8]=Z*Y*P+J*B,K[9]=J*Y*P-Z*B,K[10]=Y*Y*P+F,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function bK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Z,K[6]=$,K[7]=0,K[8]=0,K[9]=-$,K[10]=Z,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function eK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=Z,K[1]=0,K[2]=-$,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=$,K[9]=0,K[10]=Z,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function uK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=Z,K[1]=$,K[2]=0,K[3]=0,K[4]=-$,K[5]=Z,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function v0(K,Q,$){var Z=Q[0],J=Q[1],Y=Q[2],V=Q[3],B=Z+Z,F=J+J,P=Y+Y,X=Z*B,C=Z*F,W=Z*P,O=J*F,E=J*P,U=Y*P,H=V*B,j=V*F,M=V*P;return K[0]=1-(O+U),K[1]=C+M,K[2]=W-j,K[3]=0,K[4]=C-M,K[5]=1-(X+U),K[6]=E+H,K[7]=0,K[8]=W+j,K[9]=E-H,K[10]=1-(X+O),K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function oK(K,Q){var $=new q(3),Z=-Q[0],J=-Q[1],Y=-Q[2],V=Q[3],B=Q[4],F=Q[5],P=Q[6],X=Q[7],C=Z*Z+J*J+Y*Y+V*V;if(C>0)$[0]=(B*V+X*Z+F*Y-P*J)*2/C,$[1]=(F*V+X*J+P*Z-B*Y)*2/C,$[2]=(P*V+X*Y+B*J-F*Z)*2/C;else $[0]=(B*V+X*Z+F*Y-P*J)*2,$[1]=(F*V+X*J+P*Z-B*Y)*2,$[2]=(P*V+X*Y+B*J-F*Z)*2;return v0(K,Q,$),K}function aK(K,Q){return K[0]=Q[12],K[1]=Q[13],K[2]=Q[14],K}function g0(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[4],V=Q[5],B=Q[6],F=Q[8],P=Q[9],X=Q[10];return K[0]=Math.hypot($,Z,J),K[1]=Math.hypot(Y,V,B),K[2]=Math.hypot(F,P,X),K}function tK(K,Q){var $=new q(3);g0($,Q);var Z=1/$[0],J=1/$[1],Y=1/$[2],V=Q[0]*Z,B=Q[1]*J,F=Q[2]*Y,P=Q[4]*Z,X=Q[5]*J,C=Q[6]*Y,W=Q[8]*Z,O=Q[9]*J,E=Q[10]*Y,U=V+X+E,H=0;if(U>0)H=Math.sqrt(U+1)*2,K[3]=0.25*H,K[0]=(C-O)/H,K[1]=(W-F)/H,K[2]=(B-P)/H;else if(V>X&&V>E)H=Math.sqrt(1+V-X-E)*2,K[3]=(C-O)/H,K[0]=0.25*H,K[1]=(B+P)/H,K[2]=(W+F)/H;else if(X>E)H=Math.sqrt(1+X-V-E)*2,K[3]=(W-F)/H,K[0]=(B+P)/H,K[1]=0.25*H,K[2]=(C+O)/H;else H=Math.sqrt(1+E-V-X)*2,K[3]=(B-P)/H,K[0]=(W+F)/H,K[1]=(C+O)/H,K[2]=0.25*H;return K}function KQ(K,Q,$,Z){var J=Q[0],Y=Q[1],V=Q[2],B=Q[3],F=J+J,P=Y+Y,X=V+V,C=J*F,W=J*P,O=J*X,E=Y*P,U=Y*X,H=V*X,j=B*F,M=B*P,N=B*X,R=Z[0],A=Z[1],_=Z[2];return K[0]=(1-(E+H))*R,K[1]=(W+N)*R,K[2]=(O-M)*R,K[3]=0,K[4]=(W-N)*A,K[5]=(1-(C+H))*A,K[6]=(U+j)*A,K[7]=0,K[8]=(O+M)*_,K[9]=(U-j)*_,K[10]=(1-(C+E))*_,K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function QQ(K,Q,$,Z,J){var Y=Q[0],V=Q[1],B=Q[2],F=Q[3],P=Y+Y,X=V+V,C=B+B,W=Y*P,O=Y*X,E=Y*C,U=V*X,H=V*C,j=B*C,M=F*P,N=F*X,R=F*C,A=Z[0],_=Z[1],w=Z[2],S=J[0],h=J[1],I=J[2],p=(1-(U+j))*A,v=(O+R)*A,z=(E-N)*A,G=(O-R)*_,f=(1-(W+j))*_,i=(H+M)*_,s=(E+N)*w,S0=(H-M)*w,h0=(1-(W+U))*w;return K[0]=p,K[1]=v,K[2]=z,K[3]=0,K[4]=G,K[5]=f,K[6]=i,K[7]=0,K[8]=s,K[9]=S0,K[10]=h0,K[11]=0,K[12]=$[0]+S-(p*S+G*h+s*I),K[13]=$[1]+h-(v*S+f*h+S0*I),K[14]=$[2]+I-(z*S+i*h+h0*I),K[15]=1,K}function $Q(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[3],V=$+$,B=Z+Z,F=J+J,P=$*V,X=Z*V,C=Z*B,W=J*V,O=J*B,E=J*F,U=Y*V,H=Y*B,j=Y*F;return K[0]=1-C-E,K[1]=X+j,K[2]=W-H,K[3]=0,K[4]=X-j,K[5]=1-P-E,K[6]=O+U,K[7]=0,K[8]=W+H,K[9]=O-U,K[10]=1-P-C,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function ZQ(K,Q,$,Z,J,Y,V){var B=1/($-Q),F=1/(J-Z),P=1/(Y-V);return K[0]=Y*2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Y*2*F,K[6]=0,K[7]=0,K[8]=($+Q)*B,K[9]=(J+Z)*F,K[10]=(V+Y)*P,K[11]=-1,K[12]=0,K[13]=0,K[14]=V*Y*2*P,K[15]=0,K}function z0(K,Q,$,Z,J){var Y=1/Math.tan(Q/2),V;if(K[0]=Y/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Y,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,J!=null&&J!==Infinity)V=1/(Z-J),K[10]=(J+Z)*V,K[14]=2*J*Z*V;else K[10]=-1,K[14]=-2*Z;return K}function YQ(K,Q,$,Z,J){var Y=1/Math.tan(Q/2),V;if(K[0]=Y/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Y,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,J!=null&&J!==Infinity)V=1/(Z-J),K[10]=J*V,K[14]=J*Z*V;else K[10]=-1,K[14]=-Z;return K}function VQ(K,Q,$,Z){var J=Math.tan(Q.upDegrees*Math.PI/180),Y=Math.tan(Q.downDegrees*Math.PI/180),V=Math.tan(Q.leftDegrees*Math.PI/180),B=Math.tan(Q.rightDegrees*Math.PI/180),F=2/(V+B),P=2/(J+Y);return K[0]=F,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=P,K[6]=0,K[7]=0,K[8]=-((V-B)*F*0.5),K[9]=(J-Y)*P*0.5,K[10]=Z/($-Z),K[11]=-1,K[12]=0,K[13]=0,K[14]=Z*$/($-Z),K[15]=0,K}function f0(K,Q,$,Z,J,Y,V){var B=1/(Q-$),F=1/(Z-J),P=1/(Y-V);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*F,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=2*P,K[11]=0,K[12]=(Q+$)*B,K[13]=(J+Z)*F,K[14]=(V+Y)*P,K[15]=1,K}function FQ(K,Q,$,Z,J,Y,V){var B=1/(Q-$),F=1/(Z-J),P=1/(Y-V);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*F,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=P,K[11]=0,K[12]=(Q+$)*B,K[13]=(J+Z)*F,K[14]=Y*P,K[15]=1,K}function PQ(K,Q,$,Z){var J,Y,V,B,F,P,X,C,W,O,E=Q[0],U=Q[1],H=Q[2],j=Z[0],M=Z[1],N=Z[2],R=$[0],A=$[1],_=$[2];if(Math.abs(E-R)<k&&Math.abs(U-A)<k&&Math.abs(H-_)<k)return w0(K);if(X=E-R,C=U-A,W=H-_,O=1/Math.hypot(X,C,W),X*=O,C*=O,W*=O,J=M*W-N*C,Y=N*X-j*W,V=j*C-M*X,O=Math.hypot(J,Y,V),!O)J=0,Y=0,V=0;else O=1/O,J*=O,Y*=O,V*=O;if(B=C*V-W*Y,F=W*J-X*V,P=X*Y-C*J,O=Math.hypot(B,F,P),!O)B=0,F=0,P=0;else O=1/O,B*=O,F*=O,P*=O;return K[0]=J,K[1]=B,K[2]=X,K[3]=0,K[4]=Y,K[5]=F,K[6]=C,K[7]=0,K[8]=V,K[9]=P,K[10]=W,K[11]=0,K[12]=-(J*E+Y*U+V*H),K[13]=-(B*E+F*U+P*H),K[14]=-(X*E+C*U+W*H),K[15]=1,K}function XQ(K,Q,$,Z){var J=Q[0],Y=Q[1],V=Q[2],B=Z[0],F=Z[1],P=Z[2],X=J-$[0],C=Y-$[1],W=V-$[2],O=X*X+C*C+W*W;if(O>0)O=1/Math.sqrt(O),X*=O,C*=O,W*=O;var E=F*W-P*C,U=P*X-B*W,H=B*C-F*X;if(O=E*E+U*U+H*H,O>0)O=1/Math.sqrt(O),E*=O,U*=O,H*=O;return K[0]=E,K[1]=U,K[2]=H,K[3]=0,K[4]=C*H-W*U,K[5]=W*E-X*H,K[6]=X*U-C*E,K[7]=0,K[8]=X,K[9]=C,K[10]=W,K[11]=0,K[12]=J,K[13]=Y,K[14]=V,K[15]=1,K}function CQ(K){return"mat4("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+", "+K[4]+", "+K[5]+", "+K[6]+", "+K[7]+", "+K[8]+", "+K[9]+", "+K[10]+", "+K[11]+", "+K[12]+", "+K[13]+", "+K[14]+", "+K[15]+")"}function HQ(K){return Math.hypot(K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12],K[13],K[14],K[15])}function OQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K[4]=Q[4]+$[4],K[5]=Q[5]+$[5],K[6]=Q[6]+$[6],K[7]=Q[7]+$[7],K[8]=Q[8]+$[8],K[9]=Q[9]+$[9],K[10]=Q[10]+$[10],K[11]=Q[11]+$[11],K[12]=Q[12]+$[12],K[13]=Q[13]+$[13],K[14]=Q[14]+$[14],K[15]=Q[15]+$[15],K}function y0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K[3]=Q[3]-$[3],K[4]=Q[4]-$[4],K[5]=Q[5]-$[5],K[6]=Q[6]-$[6],K[7]=Q[7]-$[7],K[8]=Q[8]-$[8],K[9]=Q[9]-$[9],K[10]=Q[10]-$[10],K[11]=Q[11]-$[11],K[12]=Q[12]-$[12],K[13]=Q[13]-$[13],K[14]=Q[14]-$[14],K[15]=Q[15]-$[15],K}function WQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K[4]=Q[4]*$,K[5]=Q[5]*$,K[6]=Q[6]*$,K[7]=Q[7]*$,K[8]=Q[8]*$,K[9]=Q[9]*$,K[10]=Q[10]*$,K[11]=Q[11]*$,K[12]=Q[12]*$,K[13]=Q[13]*$,K[14]=Q[14]*$,K[15]=Q[15]*$,K}function UQ(K,Q,$,Z){return K[0]=Q[0]+$[0]*Z,K[1]=Q[1]+$[1]*Z,K[2]=Q[2]+$[2]*Z,K[3]=Q[3]+$[3]*Z,K[4]=Q[4]+$[4]*Z,K[5]=Q[5]+$[5]*Z,K[6]=Q[6]+$[6]*Z,K[7]=Q[7]+$[7]*Z,K[8]=Q[8]+$[8]*Z,K[9]=Q[9]+$[9]*Z,K[10]=Q[10]+$[10]*Z,K[11]=Q[11]+$[11]*Z,K[12]=Q[12]+$[12]*Z,K[13]=Q[13]+$[13]*Z,K[14]=Q[14]+$[14]*Z,K[15]=Q[15]+$[15]*Z,K}function EQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]&&K[4]===Q[4]&&K[5]===Q[5]&&K[6]===Q[6]&&K[7]===Q[7]&&K[8]===Q[8]&&K[9]===Q[9]&&K[10]===Q[10]&&K[11]===Q[11]&&K[12]===Q[12]&&K[13]===Q[13]&&K[14]===Q[14]&&K[15]===Q[15]}function jQ(K,Q){var $=K[0],Z=K[1],J=K[2],Y=K[3],V=K[4],B=K[5],F=K[6],P=K[7],X=K[8],C=K[9],W=K[10],O=K[11],E=K[12],U=K[13],H=K[14],j=K[15],M=Q[0],N=Q[1],R=Q[2],A=Q[3],_=Q[4],w=Q[5],S=Q[6],h=Q[7],I=Q[8],p=Q[9],v=Q[10],z=Q[11],G=Q[12],f=Q[13],i=Q[14],s=Q[15];return Math.abs($-M)<=k*Math.max(1,Math.abs($),Math.abs(M))&&Math.abs(Z-N)<=k*Math.max(1,Math.abs(Z),Math.abs(N))&&Math.abs(J-R)<=k*Math.max(1,Math.abs(J),Math.abs(R))&&Math.abs(Y-A)<=k*Math.max(1,Math.abs(Y),Math.abs(A))&&Math.abs(V-_)<=k*Math.max(1,Math.abs(V),Math.abs(_))&&Math.abs(B-w)<=k*Math.max(1,Math.abs(B),Math.abs(w))&&Math.abs(F-S)<=k*Math.max(1,Math.abs(F),Math.abs(S))&&Math.abs(P-h)<=k*Math.max(1,Math.abs(P),Math.abs(h))&&Math.abs(X-I)<=k*Math.max(1,Math.abs(X),Math.abs(I))&&Math.abs(C-p)<=k*Math.max(1,Math.abs(C),Math.abs(p))&&Math.abs(W-v)<=k*Math.max(1,Math.abs(W),Math.abs(v))&&Math.abs(O-z)<=k*Math.max(1,Math.abs(O),Math.abs(z))&&Math.abs(E-G)<=k*Math.max(1,Math.abs(E),Math.abs(G))&&Math.abs(U-f)<=k*Math.max(1,Math.abs(U),Math.abs(f))&&Math.abs(H-i)<=k*Math.max(1,Math.abs(H),Math.abs(i))&&Math.abs(j-s)<=k*Math.max(1,Math.abs(j),Math.abs(s))}var JQ=z0,BQ=f0,DQ=p0,AQ=y0;var e={};P0(e,{str:()=>{{return U$}},squaredLength:()=>{{return OK}},sqrLen:()=>{{return M$}},sqlerp:()=>{{return L$}},slerp:()=>{{return K0}},setAxisAngle:()=>{{return YK}},setAxes:()=>{{return S$}},set:()=>{{return A$}},scale:()=>{{return XK}},rotationTo:()=>{{return q$}},rotateZ:()=>{{return F$}},rotateY:()=>{{return B$}},rotateX:()=>{{return V$}},random:()=>{{return C$}},pow:()=>{{return X$}},normalize:()=>{{return O0}},multiply:()=>{{return VK}},mul:()=>{{return R$}},ln:()=>{{return FK}},lerp:()=>{{return N$}},length:()=>{{return HK}},len:()=>{{return k$}},invert:()=>{{return H$}},identity:()=>{{return Z$}},getAxisAngle:()=>{{return J$}},getAngle:()=>{{return Y$}},fromValues:()=>{{return j$}},fromMat3:()=>{{return PK}},fromEuler:()=>{{return W$}},exp:()=>{{return BK}},exactEquals:()=>{{return G$}},equals:()=>{{return T$}},dot:()=>{{return CK}},create:()=>{{return H0}},copy:()=>{{return D$}},conjugate:()=>{{return O$}},clone:()=>{{return E$}},calculateW:()=>{{return P$}},add:()=>{{return _$}}});var m={};P0(m,{zero:()=>{{return nQ}},transformQuat:()=>{{return xQ}},transformMat4:()=>{{return fQ}},transformMat3:()=>{{return yQ}},subtract:()=>{{return l0}},sub:()=>{{return bQ}},str:()=>{{return iQ}},squaredLength:()=>{{return i0}},squaredDistance:()=>{{return n0}},sqrLen:()=>{{return tQ}},sqrDist:()=>{{return aQ}},set:()=>{{return NQ}},scaleAndAdd:()=>{{return hQ}},scale:()=>{{return SQ}},round:()=>{{return LQ}},rotateZ:()=>{{return dQ}},rotateY:()=>{{return cQ}},rotateX:()=>{{return lQ}},random:()=>{{return zQ}},normalize:()=>{{return X0}},negate:()=>{{return IQ}},multiply:()=>{{return c0}},mul:()=>{{return eQ}},min:()=>{{return TQ}},max:()=>{{return qQ}},lerp:()=>{{return pQ}},length:()=>{{return x0}},len:()=>{{return C0}},inverse:()=>{{return wQ}},hermite:()=>{{return vQ}},fromValues:()=>{{return a}},forEach:()=>{{return K$}},floor:()=>{{return GQ}},exactEquals:()=>{{return sQ}},equals:()=>{{return rQ}},dot:()=>{{return t}},divide:()=>{{return d0}},div:()=>{{return uQ}},distance:()=>{{return m0}},dist:()=>{{return oQ}},cross:()=>{{return b}},create:()=>{{return o}},copy:()=>{{return RQ}},clone:()=>{{return _Q}},ceil:()=>{{return MQ}},bezier:()=>{{return gQ}},angle:()=>{{return mQ}},add:()=>{{return kQ}}});function o(){var K=new q(3);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K}function _Q(K){var Q=new q(3);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q}function x0(K){var Q=K[0],$=K[1],Z=K[2];return Math.hypot(Q,$,Z)}function a(K,Q,$){var Z=new q(3);return Z[0]=K,Z[1]=Q,Z[2]=$,Z}function RQ(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K}function NQ(K,Q,$,Z){return K[0]=Q,K[1]=$,K[2]=Z,K}function kQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K}function l0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K}function c0(K,Q,$){return K[0]=Q[0]*$[0],K[1]=Q[1]*$[1],K[2]=Q[2]*$[2],K}function d0(K,Q,$){return K[0]=Q[0]/$[0],K[1]=Q[1]/$[1],K[2]=Q[2]/$[2],K}function MQ(K,Q){return K[0]=Math.ceil(Q[0]),K[1]=Math.ceil(Q[1]),K[2]=Math.ceil(Q[2]),K}function GQ(K,Q){return K[0]=Math.floor(Q[0]),K[1]=Math.floor(Q[1]),K[2]=Math.floor(Q[2]),K}function TQ(K,Q,$){return K[0]=Math.min(Q[0],$[0]),K[1]=Math.min(Q[1],$[1]),K[2]=Math.min(Q[2],$[2]),K}function qQ(K,Q,$){return K[0]=Math.max(Q[0],$[0]),K[1]=Math.max(Q[1],$[1]),K[2]=Math.max(Q[2],$[2]),K}function LQ(K,Q){return K[0]=Math.round(Q[0]),K[1]=Math.round(Q[1]),K[2]=Math.round(Q[2]),K}function SQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K}function hQ(K,Q,$,Z){return K[0]=Q[0]+$[0]*Z,K[1]=Q[1]+$[1]*Z,K[2]=Q[2]+$[2]*Z,K}function m0(K,Q){var $=Q[0]-K[0],Z=Q[1]-K[1],J=Q[2]-K[2];return Math.hypot($,Z,J)}function n0(K,Q){var $=Q[0]-K[0],Z=Q[1]-K[1],J=Q[2]-K[2];return $*$+Z*Z+J*J}function i0(K){var Q=K[0],$=K[1],Z=K[2];return Q*Q+$*$+Z*Z}function IQ(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K}function wQ(K,Q){return K[0]=1/Q[0],K[1]=1/Q[1],K[2]=1/Q[2],K}function X0(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=$*$+Z*Z+J*J;if(Y>0)Y=1/Math.sqrt(Y);return K[0]=Q[0]*Y,K[1]=Q[1]*Y,K[2]=Q[2]*Y,K}function t(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]}function b(K,Q,$){var Z=Q[0],J=Q[1],Y=Q[2],V=$[0],B=$[1],F=$[2];return K[0]=J*F-Y*B,K[1]=Y*V-Z*F,K[2]=Z*B-J*V,K}function pQ(K,Q,$,Z){var J=Q[0],Y=Q[1],V=Q[2];return K[0]=J+Z*($[0]-J),K[1]=Y+Z*($[1]-Y),K[2]=V+Z*($[2]-V),K}function vQ(K,Q,$,Z,J,Y){var V=Y*Y,B=V*(2*Y-3)+1,F=V*(Y-2)+Y,P=V*(Y-1),X=V*(3-2*Y);return K[0]=Q[0]*B+$[0]*F+Z[0]*P+J[0]*X,K[1]=Q[1]*B+$[1]*F+Z[1]*P+J[1]*X,K[2]=Q[2]*B+$[2]*F+Z[2]*P+J[2]*X,K}function gQ(K,Q,$,Z,J,Y){var V=1-Y,B=V*V,F=Y*Y,P=B*V,X=3*Y*B,C=3*F*V,W=F*Y;return K[0]=Q[0]*P+$[0]*X+Z[0]*C+J[0]*W,K[1]=Q[1]*P+$[1]*X+Z[1]*C+J[1]*W,K[2]=Q[2]*P+$[2]*X+Z[2]*C+J[2]*W,K}function zQ(K,Q){Q=Q||1;var $=c()*2*Math.PI,Z=c()*2-1,J=Math.sqrt(1-Z*Z)*Q;return K[0]=Math.cos($)*J,K[1]=Math.sin($)*J,K[2]=Z*Q,K}function fQ(K,Q,$){var Z=Q[0],J=Q[1],Y=Q[2],V=$[3]*Z+$[7]*J+$[11]*Y+$[15];return V=V||1,K[0]=($[0]*Z+$[4]*J+$[8]*Y+$[12])/V,K[1]=($[1]*Z+$[5]*J+$[9]*Y+$[13])/V,K[2]=($[2]*Z+$[6]*J+$[10]*Y+$[14])/V,K}function yQ(K,Q,$){var Z=Q[0],J=Q[1],Y=Q[2];return K[0]=Z*$[0]+J*$[3]+Y*$[6],K[1]=Z*$[1]+J*$[4]+Y*$[7],K[2]=Z*$[2]+J*$[5]+Y*$[8],K}function xQ(K,Q,$){var Z=$[0],J=$[1],Y=$[2],V=$[3],B=Q[0],F=Q[1],P=Q[2],X=J*P-Y*F,C=Y*B-Z*P,W=Z*F-J*B,O=J*W-Y*C,E=Y*X-Z*W,U=Z*C-J*X,H=V*2;return X*=H,C*=H,W*=H,O*=2,E*=2,U*=2,K[0]=B+X+O,K[1]=F+C+E,K[2]=P+W+U,K}function lQ(K,Q,$,Z){var J=[],Y=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],Y[0]=J[0],Y[1]=J[1]*Math.cos(Z)-J[2]*Math.sin(Z),Y[2]=J[1]*Math.sin(Z)+J[2]*Math.cos(Z),K[0]=Y[0]+$[0],K[1]=Y[1]+$[1],K[2]=Y[2]+$[2],K}function cQ(K,Q,$,Z){var J=[],Y=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],Y[0]=J[2]*Math.sin(Z)+J[0]*Math.cos(Z),Y[1]=J[1],Y[2]=J[2]*Math.cos(Z)-J[0]*Math.sin(Z),K[0]=Y[0]+$[0],K[1]=Y[1]+$[1],K[2]=Y[2]+$[2],K}function dQ(K,Q,$,Z){var J=[],Y=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],Y[0]=J[0]*Math.cos(Z)-J[1]*Math.sin(Z),Y[1]=J[0]*Math.sin(Z)+J[1]*Math.cos(Z),Y[2]=J[2],K[0]=Y[0]+$[0],K[1]=Y[1]+$[1],K[2]=Y[2]+$[2],K}function mQ(K,Q){var $=K[0],Z=K[1],J=K[2],Y=Q[0],V=Q[1],B=Q[2],F=Math.sqrt($*$+Z*Z+J*J),P=Math.sqrt(Y*Y+V*V+B*B),X=F*P,C=X&&t(K,Q)/X;return Math.acos(Math.min(Math.max(C,-1),1))}function nQ(K){return K[0]=0,K[1]=0,K[2]=0,K}function iQ(K){return"vec3("+K[0]+", "+K[1]+", "+K[2]+")"}function sQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]}function rQ(K,Q){var $=K[0],Z=K[1],J=K[2],Y=Q[0],V=Q[1],B=Q[2];return Math.abs($-Y)<=k*Math.max(1,Math.abs($),Math.abs(Y))&&Math.abs(Z-V)<=k*Math.max(1,Math.abs(Z),Math.abs(V))&&Math.abs(J-B)<=k*Math.max(1,Math.abs(J),Math.abs(B))}var bQ=l0,eQ=c0,uQ=d0,oQ=m0,aQ=n0,C0=x0,tQ=i0,K$=function(){var K=o();return function(Q,$,Z,J,Y,V){var B,F;if(!$)$=3;if(!Z)Z=0;if(J)F=Math.min(J*$+Z,Q.length);else F=Q.length;for(B=Z;B<F;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],Y(K,K,V),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2];return Q}}();function Q$(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0,K[3]=0;return K}function s0(K){var Q=new q(4);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q}function r0(K,Q,$,Z){var J=new q(4);return J[0]=K,J[1]=Q,J[2]=$,J[3]=Z,J}function b0(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K}function e0(K,Q,$,Z,J){return K[0]=Q,K[1]=$,K[2]=Z,K[3]=J,K}function u0(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K}function o0(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K}function a0(K){var Q=K[0],$=K[1],Z=K[2],J=K[3];return Math.hypot(Q,$,Z,J)}function t0(K){var Q=K[0],$=K[1],Z=K[2],J=K[3];return Q*Q+$*$+Z*Z+J*J}function KK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[3],V=$*$+Z*Z+J*J+Y*Y;if(V>0)V=1/Math.sqrt(V);return K[0]=$*V,K[1]=Z*V,K[2]=J*V,K[3]=Y*V,K}function QK(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]+K[3]*Q[3]}function $K(K,Q,$,Z){var J=Q[0],Y=Q[1],V=Q[2],B=Q[3];return K[0]=J+Z*($[0]-J),K[1]=Y+Z*($[1]-Y),K[2]=V+Z*($[2]-V),K[3]=B+Z*($[3]-B),K}function ZK(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]}function JK(K,Q){var $=K[0],Z=K[1],J=K[2],Y=K[3],V=Q[0],B=Q[1],F=Q[2],P=Q[3];return Math.abs($-V)<=k*Math.max(1,Math.abs($),Math.abs(V))&&Math.abs(Z-B)<=k*Math.max(1,Math.abs(Z),Math.abs(B))&&Math.abs(J-F)<=k*Math.max(1,Math.abs(J),Math.abs(F))&&Math.abs(Y-P)<=k*Math.max(1,Math.abs(Y),Math.abs(P))}var m$=function(){var K=Q$();return function(Q,$,Z,J,Y,V){var B,F;if(!$)$=4;if(!Z)Z=0;if(J)F=Math.min(J*$+Z,Q.length);else F=Q.length;for(B=Z;B<F;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],K[3]=Q[B+3],Y(K,K,V),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2],Q[B+3]=K[3];return Q}}();function H0(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K[3]=1,K}function Z$(K){return K[0]=0,K[1]=0,K[2]=0,K[3]=1,K}function YK(K,Q,$){$=$*0.5;var Z=Math.sin($);return K[0]=Z*Q[0],K[1]=Z*Q[1],K[2]=Z*Q[2],K[3]=Math.cos($),K}function J$(K,Q){var $=Math.acos(Q[3])*2,Z=Math.sin($/2);if(Z>k)K[0]=Q[0]/Z,K[1]=Q[1]/Z,K[2]=Q[2]/Z;else K[0]=1,K[1]=0,K[2]=0;return $}function Y$(K,Q){var $=CK(K,Q);return Math.acos(2*$*$-1)}function VK(K,Q,$){var Z=Q[0],J=Q[1],Y=Q[2],V=Q[3],B=$[0],F=$[1],P=$[2],X=$[3];return K[0]=Z*X+V*B+J*P-Y*F,K[1]=J*X+V*F+Y*B-Z*P,K[2]=Y*X+V*P+Z*F-J*B,K[3]=V*X-Z*B-J*F-Y*P,K}function V$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],Y=Q[2],V=Q[3],B=Math.sin($),F=Math.cos($);return K[0]=Z*F+V*B,K[1]=J*F+Y*B,K[2]=Y*F-J*B,K[3]=V*F-Z*B,K}function B$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],Y=Q[2],V=Q[3],B=Math.sin($),F=Math.cos($);return K[0]=Z*F-Y*B,K[1]=J*F+V*B,K[2]=Y*F+Z*B,K[3]=V*F-J*B,K}function F$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],Y=Q[2],V=Q[3],B=Math.sin($),F=Math.cos($);return K[0]=Z*F+J*B,K[1]=J*F-Z*B,K[2]=Y*F+V*B,K[3]=V*F-Y*B,K}function P$(K,Q){var $=Q[0],Z=Q[1],J=Q[2];return K[0]=$,K[1]=Z,K[2]=J,K[3]=Math.sqrt(Math.abs(1-$*$-Z*Z-J*J)),K}function BK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[3],V=Math.sqrt($*$+Z*Z+J*J),B=Math.exp(Y),F=V>0?B*Math.sin(V)/V:0;return K[0]=$*F,K[1]=Z*F,K[2]=J*F,K[3]=B*Math.cos(V),K}function FK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[3],V=Math.sqrt($*$+Z*Z+J*J),B=V>0?Math.atan2(V,Y)/V:0;return K[0]=$*B,K[1]=Z*B,K[2]=J*B,K[3]=0.5*Math.log($*$+Z*Z+J*J+Y*Y),K}function X$(K,Q,$){return FK(K,Q),XK(K,K,$),BK(K,K),K}function K0(K,Q,$,Z){var J=Q[0],Y=Q[1],V=Q[2],B=Q[3],F=$[0],P=$[1],X=$[2],C=$[3],W,O,E,U,H;if(O=J*F+Y*P+V*X+B*C,O<0)O=-O,F=-F,P=-P,X=-X,C=-C;if(1-O>k)W=Math.acos(O),E=Math.sin(W),U=Math.sin((1-Z)*W)/E,H=Math.sin(Z*W)/E;else U=1-Z,H=Z;return K[0]=U*J+H*F,K[1]=U*Y+H*P,K[2]=U*V+H*X,K[3]=U*B+H*C,K}function C$(K){var Q=c(),$=c(),Z=c(),J=Math.sqrt(1-Q),Y=Math.sqrt(Q);return K[0]=J*Math.sin(2*Math.PI*$),K[1]=J*Math.cos(2*Math.PI*$),K[2]=Y*Math.sin(2*Math.PI*Z),K[3]=Y*Math.cos(2*Math.PI*Z),K}function H$(K,Q){var $=Q[0],Z=Q[1],J=Q[2],Y=Q[3],V=$*$+Z*Z+J*J+Y*Y,B=V?1/V:0;return K[0]=-$*B,K[1]=-Z*B,K[2]=-J*B,K[3]=Y*B,K}function O$(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K[3]=Q[3],K}function PK(K,Q){var $=Q[0]+Q[4]+Q[8],Z;if($>0)Z=Math.sqrt($+1),K[3]=0.5*Z,Z=0.5/Z,K[0]=(Q[5]-Q[7])*Z,K[1]=(Q[6]-Q[2])*Z,K[2]=(Q[1]-Q[3])*Z;else{var J=0;if(Q[4]>Q[0])J=1;if(Q[8]>Q[J*3+J])J=2;var Y=(J+1)%3,V=(J+2)%3;Z=Math.sqrt(Q[J*3+J]-Q[Y*3+Y]-Q[V*3+V]+1),K[J]=0.5*Z,Z=0.5/Z,K[3]=(Q[Y*3+V]-Q[V*3+Y])*Z,K[Y]=(Q[Y*3+J]+Q[J*3+Y])*Z,K[V]=(Q[V*3+J]+Q[J*3+V])*Z}return K}function W$(K,Q,$,Z){var J=0.5*Math.PI/180;Q*=J,$*=J,Z*=J;var Y=Math.sin(Q),V=Math.cos(Q),B=Math.sin($),F=Math.cos($),P=Math.sin(Z),X=Math.cos(Z);return K[0]=Y*F*X-V*B*P,K[1]=V*B*X+Y*F*P,K[2]=V*F*P-Y*B*X,K[3]=V*F*X+Y*B*P,K}function U$(K){return"quat("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+")"}var E$=s0,j$=r0,D$=b0,A$=e0,_$=u0,R$=VK,XK=o0,CK=QK,N$=$K,HK=a0,k$=HK,OK=t0,M$=OK,O0=KK,G$=ZK,T$=JK,q$=function(){var K=o(),Q=a(1,0,0),$=a(0,1,0);return function(Z,J,Y){var V=t(J,Y);if(V<-0.999999){if(b(K,Q,J),C0(K)<0.000001)b(K,$,J);return X0(K,K),YK(Z,K,Math.PI),Z}else if(V>0.999999)return Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z;else return b(K,J,Y),Z[0]=K[0],Z[1]=K[1],Z[2]=K[2],Z[3]=1+V,O0(Z,Z)}}(),L$=function(){var K=H0(),Q=H0();return function($,Z,J,Y,V,B){return K0(K,Z,V,B),K0(Q,J,Y,B),K0($,K,Q,2*B*(1-B)),$}}(),S$=function(){var K=I0();return function(Q,$,Z,J){return K[0]=Z[0],K[3]=Z[1],K[6]=Z[2],K[1]=J[0],K[4]=J[1],K[7]=J[2],K[2]=-$[0],K[5]=-$[1],K[8]=-$[2],O0(Q,PK(Q,K))}}();var h$=Math.PI/90;class y{m4=Float32Array.from(T.create());constructor(){this.identity()}static create(){return new y}identity(){return T.identity(this.m4),this}invert(K){return T.invert(this.m4,K.getMatrix()),this}multiply(K){return T.multiply(this.m4,this.m4,K.getMatrix()),this}multiply2(K,Q){return T.multiply(this.m4,K.getMatrix(),Q.getMatrix()),this}multiply3(K,Q,$){return this.multiply2(K,Q),this.multiply($),this}translate(K,Q,$){return T.translate(this.m4,this.m4,[K,Q,$]),this}translateToMatrix(K){const Q=K.getMatrix();return this.translate(-Q[12],-Q[13],-Q[14]),this}rotateX(K){return T.rotateX(this.m4,this.m4,K),this}rotateY(K){return T.rotateY(this.m4,this.m4,K),this}rotateZ(K){return T.rotateZ(this.m4,this.m4,K),this}scale(K,Q,$){return T.scale(this.m4,this.m4,[K,Q,$]),this}perspective(K,Q,$,Z){return T.perspective(this.m4,K*h$,Q,$,Z),this}ortho(K,Q,$,Z,J,Y){return T.ortho(this.m4,K,Q,$,Z,J,Y),this}static aTemp=T.create();static bTemp=T.create();combine(K,Q,$=0.5){return T.multiplyScalar(y.aTemp,K.getMatrix(),1-$),T.multiplyScalar(y.bTemp,Q.getMatrix(),$),T.add(this.m4,y.aTemp,y.bTemp),this}static tempQuat=e.create();moveMatrix(K,Q,$,Z){const J=m.fromValues(-K,Q,$);if(Z)T.getRotation(y.tempQuat,Z.getMatrix()),e.invert(y.tempQuat,y.tempQuat),m.transformQuat(J,J,y.tempQuat);return T.translate(this.m4,this.m4,J),this}getMatrix(){return this.m4}}var L=y;var D=globalThis.WebGL2RenderingContext??{},WK="position_and_tex",UK="index",W0="transform",EK="slotSize_and_number",jK="cam",DK="projection",AK="maxTextureSize",_K="uTextures";class U0 extends L{constructor(){super(...arguments)}perspectiveMatrix=L.create();orthoMatrix=L.create();perspectiveLevel=1;configPerspectiveMatrix(K){this.perspectiveMatrix.perspective(45,K,0.01,1000)}configOrthoMatrix(K){this.orthoMatrix.ortho(-K,K,-1,1,-1000,1000)}configure(K){this.configPerspectiveMatrix(K),this.configOrthoMatrix(K)}setPerspective(K){this.perspectiveLevel=K,this.combine(this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel)}}class d{gl;uniforms;camPositionMatrix=L.create().translate(0,0,-1);projectionMatrix=new U0;needsRefresh=!1;constructor(K,Q){this.gl=K,this.uniforms=Q}configProjectionMatrix(K){this.projectionMatrix.configure(K),this.updatePerspective(1)}camTiltMatrix=L.create();camTurnMatrix=L.create();camMatrix=L.create();refresh(){if(!this.needsRefresh)return!1;this.camMatrix.multiply3(this.camTiltMatrix,this.camTurnMatrix,this.camPositionMatrix);const K=this.uniforms.getUniformLocation(jK);return this.gl.uniformMatrix4fv(K,!1,this.camMatrix.getMatrix()),!0}updatePerspective(K){this.projectionMatrix.setPerspective(K);const Q=this.uniforms.getUniformLocation(DK);this.gl.uniformMatrix4fv(Q,!1,this.projectionMatrix.getMatrix()),this.needsRefresh=!0}moveCam(K,Q,$){this.camPositionMatrix.moveMatrix(K,Q,$,this.camTurnMatrix),this.needsRefresh=!0}turnCam(K){this.camTurnMatrix.rotateY(K),this.needsRefresh=!0}tilt(K){this.camTiltMatrix.rotateX(K),this.needsRefresh=!0}static invertedCamTurnMatrix=L.create();static invertedCamTiltMatrix=L.create();static syncHud(K,Q){Q?.identity().translateToMatrix(K.camPositionMatrix).multiply(d.invertedCamTurnMatrix.invert(K.camTurnMatrix)).multiply(d.invertedCamTiltMatrix.invert(K.camTiltMatrix)).translate(0,0,-0.9)}}var RK=0,NK=1,kK=2;class E0{updatedSprites=new Set;hudSpriteId=0;constructor(){this.sprites.forEach((K,Q)=>this.updatedSprites.add(Q))}reset(){}getNumImages(){return 3}async drawImage(K,Q){switch(K){case RK:Q.drawImage(K,(Z)=>{const{canvas:J}=Z;J.width=512,J.height=512;const Y=J.width/2,V=J.height/2,B=J.width/2;Z.imageSmoothingEnabled=!0,Z.fillStyle="#ddd",Z.lineWidth=J.width/50,Z.fillRect(0,0,J.width,J.height),Z.strokeStyle="black",Z.fillStyle="gold",Z.beginPath(),Z.arc(Y,V,B*0.8,0,2*Math.PI),Z.fill(),Z.stroke(),Z.beginPath(),Z.arc(Y,V,B*0.5,0,Math.PI),Z.stroke(),Z.beginPath(),Z.arc(J.width/3,J.height/3,B*0.1,0,Math.PI,!0),Z.stroke(),Z.beginPath(),Z.arc(J.width/3*2,J.height/3,B*0.1,0,Math.PI*2,!0),Z.stroke()});break;case NK:Q.drawImage(K,(Z)=>{const{canvas:J}=Z;J.width=512,J.height=512,Z.imageSmoothingEnabled=!0,Z.fillStyle="#ddd",Z.lineWidth=J.width/50,Z.fillRect(0,0,J.width,J.height),Z.strokeStyle="black",Z.fillStyle="silver",Z.beginPath(),Z.rect(J.width*0.2,J.height*0.2,J.width*0.6,J.height*0.6),Z.fill(),Z.stroke()});break;case kK:Q.drawImage(K,(Z)=>{const{canvas:J}=Z;J.width=512,J.height=512,Z.imageSmoothingEnabled=!0,Z.fillStyle="#ddd",Z.lineWidth=J.width/50,Z.strokeStyle="black",Z.fillStyle="silver",Z.beginPath(),Z.rect(30,30,J.width-60,J.height-60),Z.stroke()});break}}hudMatrix=L.create();sprites=[{imageId:kK,transforms:[this.hudMatrix.getMatrix()]},...[L.create().translate(0,0,0).getMatrix(),L.create().translate(-1,0,1).rotateY(Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(1,0,1).rotateY(-Math.PI/2).scale(1,1,1).getMatrix()].map((K)=>({imageId:RK,transforms:[K]})),...[L.create().translate(0,-1,1).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(0,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(-2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix()].map((K)=>({imageId:NK,transforms:[K]}))];getSpriteCount(){return this.sprites.length}getSprite(K){return this.sprites[K]}syncWithCamera(K){if(this.keys.KeyW)K.moveCam(0,0,0.25);if(this.keys.KeyS)K.moveCam(0,0,-0.25);if(this.keys.ArrowUp&&!this.keys.ShiftRight)K.moveCam(0,-0.25,0);if(this.keys.ArrowDown&&!this.keys.ShiftRight)K.moveCam(0,0.25,0);if(this.keys.KeyA||this.keys.ArrowLeft&&!this.keys.ShiftRight)K.moveCam(-0.25,0,0);if(this.keys.KeyD||this.keys.ArrowRight&&!this.keys.ShiftRight)K.moveCam(0.25,0,0);if(this.keys.KeyQ||this.keys.ArrowLeft&&this.keys.ShiftRight)K.turnCam(-0.05);if(this.keys.KeyE||this.keys.ArrowRight&&this.keys.ShiftRight)K.turnCam(0.05);if(this.keys.ArrowUp&&this.keys.ShiftRight)K.tilt(-0.05);if(this.keys.ArrowDown&&this.keys.ShiftRight)K.tilt(0.05);if(K.refresh())d.syncHud(K,this.hudMatrix),this.updatedSprites.add(this.hudSpriteId)}getUpdatedSprites(){return this.updatedSprites}keys={};activate(){const K=($)=>this.keys[$.code]=!0,Q=($)=>this.keys[$.code]=!1;return document.addEventListener("keydown",K),document.addEventListener("keyup",Q),()=>{document.removeEventListener("keydown",K),document.removeEventListener("keyup",Q)}}}class g{disposables;own(K){if(!this.disposables)this.disposables=new Set;return this.disposables.add(K),K}addOnDestroy(K){this.disposables?.add({destroy:K})}destroy(){this.disposables?.forEach((K)=>K.destroy())}}var I$=function(K,Q,$){function Z(X,C){function W(E){return E===K?.VERTEX_SHADER?"vertex":E===K?.FRAGMENT_SHADER?"fragment":void 0}if(C!==K.VERTEX_SHADER&&C!==K.FRAGMENT_SHADER)throw new Error(`Shader error in ${W(C)}`);const O=K.createShader(C);if(!O)throw new Error(`Unable to generate ${W(C)} shader.`);if(K.shaderSource(O,X),K.compileShader(O),!K.getShaderParameter(O,K.COMPILE_STATUS))console.error(`Shader compile error in ${W(C)}:`+K.getShaderInfoLog(O));return O}const J=K.createProgram();if(!J)throw new Error("Unable to create program.");const Y=Z(Q,K.VERTEX_SHADER),V=Z($,K.FRAGMENT_SHADER),B=K.getShaderInfoLog(Y),F=K.getShaderInfoLog(V);if(B)console.log("VERTEX",B);if(F)console.log("FRAGMENT",F);K.attachShader(J,Y),K.attachShader(J,V),K.linkProgram(J);const P=K.getProgramInfoLog(J);if(P)console.log("PROGRAM",P);if(K.detachShader(J,Y),K.detachShader(J,V),K.deleteShader(Y),K.deleteShader(V),K.validateProgram(J),Object.entries(D).forEach(([X,C])=>{if(C&&K.getError()===C)console.log(`gl.${X}`)}),!K.getProgramParameter(J,K.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+K.getProgramInfoLog(J));return J},w$=function(K,Q){K.deleteProgram(Q)};class j0 extends g{gl;program;constructor(K,Q,$){super();this.gl=K,this.program=I$(K,Q.trim(),$.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),w$(this.gl,this.program)}}class D0 extends g{activeProgramId="";gl;programs={};constructor(K){super();this.gl=K}addProgram(K,Q,$){if(this.programs[K])this.removeProgram(K);this.programs[K]=this.own(new j0(this.gl,Q,$))}useProgram(K){if(this.activeProgramId!==K)this.activeProgramId=K,this.programs[K].use()}removeProgram(K){this.programs[K].destroy(),delete this.programs[K]}getProgram(K){return this.programs[K??this.activeProgramId]?.program}}class A0 extends g{gl;triangleArray;constructor(K){super();this.gl=K,this.triangleArray=K.createVertexArray(),K.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class _0 extends g{bufferRecord={};lastBoundBuffer;gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getAttributeLocation(K,Q){const $=this.programs.getProgram(Q);return $?this.gl.getAttribLocation($,K)??-1:-1}createBuffer(K){this.deleteBuffer(K);const Q=this.gl?.createBuffer();if(!Q)throw new Error(`Unable to create buffer "${K}"`);const $={buffer:Q,location:this.getAttributeLocation(K)};return this.bufferRecord[K]=$,$}deleteBuffer(K){if(this.bufferRecord[K])this.gl.deleteBuffer(this.bufferRecord[K].buffer),delete this.bufferRecord[K]}getAttributeBuffer(K,Q){const $=this.bufferRecord[K];if(!$){if(Q)return this.createBuffer(K);throw new Error(`Attribute "${K}" not created. Make sure "createBuffer" is called.`)}return $}bufferData(K,Q,$,Z,J){const Y=this.getAttributeBuffer(Q);if($)this.gl.bufferData(K,$,J);else this.gl.bufferData(K,Z,J);Y.bufferSize=Z||$?.length,Y.bufferArray=$??new Float32Array(Y.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),Y.usage=J,Y.target=K}bufferSubData(K,Q,$,Z,J){if(Z)this.gl.bufferSubData(K,$,Q,Z,J);else this.gl.bufferSubData(K,$,Q)}bindBuffer(K,Q){if(this.lastBoundBuffer!==Q)this.lastBoundBuffer=Q,this.gl.bindBuffer(K,Q.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((K)=>this.deleteBuffer(K))}}class R0 extends g{gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getUniformLocation(K,Q){const $=this.programs.getProgram(Q);return this.gl.getUniformLocation($,K)}}function MK(K,Q=($)=>$.key){var $=[];return N0(K,"",!0,(Z)=>$.push(Z),Q),$.join("")}var N0=function(K,Q,$,Z,J){if(K){Z(`${Q}${$?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${J(K)}\n`);const Y=Q+($?"    ":"\u2502   ");if(K.left)N0(K.left,Y,!1,Z,J);if(K.right)N0(K.right,Y,!0,Z,J)}};function Q0(K){if(K===null)return!0;var Q=$0(K.left),$=$0(K.right);if(Math.abs(Q-$)<=1&&Q0(K.left)&&Q0(K.right))return!0;return!1}var $0=function(K){return K?1+Math.max($0(K.left),$0(K.right)):0};function Z0(K,Q,$,Z,J){const Y=J-Z;if(Y>0){const V=Z+Math.floor(Y/2),B=Q[V],F=$[V],P={key:B,data:F,parent:K};return P.left=Z0(P,Q,$,Z,V),P.right=Z0(P,Q,$,V+1,J),P}return null}function J0(K){if(K===null)return 0;const Q=J0(K.left),$=J0(K.right);return K.balanceFactor=Q-$,Math.max(Q,$)+1}function Y0(K,Q,$,Z,J){if($>=Z)return;const Y=K[$+Z>>1];let V=$-1,B=Z+1;while(!0){do V++;while(J(K[V],Y)<0);do B--;while(J(K[B],Y)>0);if(V>=B)break;let F=K[V];K[V]=K[B],K[B]=F,F=Q[V],Q[V]=Q[B],Q[B]=F}Y0(K,Q,$,B,J),Y0(K,Q,B+1,Z,J)}var p$=function(K,Q){return K>Q?1:K<Q?-1:0},V0=function(K){var Q=K.right;if(K.right=Q.left,Q.left)Q.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.left=K,K.balanceFactor+=1,Q.balanceFactor<0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor+=1,K.balanceFactor>0)Q.balanceFactor+=K.balanceFactor;return Q},B0=function(K){var Q=K.left;if(K.left=Q.right,K.left)K.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.right=K,K.balanceFactor-=1,Q.balanceFactor>0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor-=1,K.balanceFactor<0)Q.balanceFactor+=K.balanceFactor;return Q};class n{constructor(K,Q=!1){this._comparator=K||p$,this._root=null,this._size=0,this._noDuplicates=!!Q}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(K){if(this._root){var Q=this._root,$=this._comparator;while(Q){var Z=$(K,Q.key);if(Z===0)return!0;else if(Z<0)Q=Q.left;else Q=Q.right}}return!1}next(K){var Q=K;if(Q)if(Q.right){Q=Q.right;while(Q.left)Q=Q.left}else{Q=K.parent;while(Q&&Q.right===K)K=Q,Q=Q.parent}return Q}prev(K){var Q=K;if(Q)if(Q.left){Q=Q.left;while(Q.right)Q=Q.right}else{Q=K.parent;while(Q&&Q.left===K)K=Q,Q=Q.parent}return Q}forEach(K){var Q=this._root,$=[],Z=!1,J=0;while(!Z)if(Q)$.push(Q),Q=Q.left;else if($.length>0)Q=$.pop(),K(Q,J++),Q=Q.right;else Z=!0;return this}range(K,Q,$,Z){const J=[],Y=this._comparator;let V=this._root,B;while(J.length!==0||V)if(V)J.push(V),V=V.left;else{if(V=J.pop(),B=Y(V.key,Q),B>0)break;else if(Y(V.key,K)>=0){if($.call(Z,V))return this}V=V.right}return this}keys(){var K=this._root,Q=[],$=[],Z=!1;while(!Z)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.key),K=K.right;else Z=!0;return $}values(){var K=this._root,Q=[],$=[],Z=!1;while(!Z)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.data),K=K.right;else Z=!0;return $}at(K){var Q=this._root,$=[],Z=!1,J=0;while(!Z)if(Q)$.push(Q),Q=Q.left;else if($.length>0){if(Q=$.pop(),J===K)return Q;J++,Q=Q.right}else Z=!0;return null}minNode(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K}maxNode(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K}min(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K.key}max(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K.key}isEmpty(){return!this._root}pop(){var K=this._root,Q=null;if(K){while(K.left)K=K.left;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}popMax(){var K=this._root,Q=null;if(K){while(K.right)K=K.right;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}find(K){var Q=this._root,$=Q,Z,J=this._comparator;while($)if(Z=J(K,$.key),Z===0)return $;else if(Z<0)$=$.left;else $=$.right;return null}insert(K,Q){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:K,data:Q},this._size++,this._root;var $=this._comparator,Z=this._root,J=null,Y=0;if(this._noDuplicates)while(Z)if(Y=$(K,Z.key),J=Z,Y===0)return null;else if(Y<0)Z=Z.left;else Z=Z.right;else while(Z)if(Y=$(K,Z.key),J=Z,Y<=0)Z=Z.left;else Z=Z.right;var V={left:null,right:null,balanceFactor:0,parent:J,key:K,data:Q},B;if(Y<=0)J.left=V;else J.right=V;while(J){if(Y=$(J.key,K),Y<0)J.balanceFactor-=1;else J.balanceFactor+=1;if(J.balanceFactor===0)break;else if(J.balanceFactor<-1){if(J.right.balanceFactor===1)B0(J.right);if(B=V0(J),J===this._root)this._root=B;break}else if(J.balanceFactor>1){if(J.left.balanceFactor===-1)V0(J.left);if(B=B0(J),J===this._root)this._root=B;break}J=J.parent}return this._size++,V}remove(K){if(!this._root)return null;var Q=this._root,$=this._comparator,Z=0;while(Q)if(Z=$(K,Q.key),Z===0)break;else if(Z<0)Q=Q.left;else Q=Q.right;if(!Q)return null;var J=Q.key,Y,V;if(Q.left){Y=Q.left;while(Y.left||Y.right){while(Y.right)Y=Y.right;if(Q.key=Y.key,Q.data=Y.data,Y.left)Q=Y,Y=Y.left}Q.key=Y.key,Q.data=Y.data,Q=Y}if(Q.right){V=Q.right;while(V.left||V.right){while(V.left)V=V.left;if(Q.key=V.key,Q.data=V.data,V.right)Q=V,V=V.right}Q.key=V.key,Q.data=V.data,Q=V}var B=Q.parent,F=Q,P;while(B){if(B.left===F)B.balanceFactor-=1;else B.balanceFactor+=1;if(B.balanceFactor<-1){if(B.right.balanceFactor===1)B0(B.right);if(P=V0(B),B===this._root)this._root=P;B=P}else if(B.balanceFactor>1){if(B.left.balanceFactor===-1)V0(B.left);if(P=B0(B),B===this._root)this._root=P;B=P}if(B.balanceFactor===-1||B.balanceFactor===1)break;F=B,B=B.parent}if(Q.parent)if(Q.parent.left===Q)Q.parent.left=null;else Q.parent.right=null;if(Q===this._root)this._root=null;return this._size--,J}load(K=[],Q=[],$){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const Z=K.length;if($)Y0(K,Q,0,Z-1,this._comparator);return this._root=Z0(null,K,Q,0,Z),J0(this._root),this._size=Z,this}isBalanced(){return Q0(this._root)}toString(K){return MK(this._root,K)}}n.default=n;class x{size;slotNumber;x;y;textureIndex;parent;sibbling;textureSizeLimits;constructor(K,Q,$,Z){this.textureSizeLimits=$?.textureSizeLimits??Z??{min:k0,max:M0},this.size=K,this.slotNumber=Q,this.parent=$,this.sibbling=void 0;const{x:J,y:Y,textureIndex:V}=this.calculatePosition(K,Q);this.x=J,this.y=Y,this.textureIndex=V}calculateTextureIndex(K,Q){const[$,Z]=K,J=this.textureSizeLimits.max/$*(this.textureSizeLimits.max/Z);return Math.floor(Q/J)}calculatePosition(K,Q){const[$,Z]=K,J=this.textureSizeLimits.max/$,Y=this.textureSizeLimits.max/Z,V=Q%J*$,B=Math.floor(Q/J)%Y*Z;return{x:V,y:B,textureIndex:this.calculateTextureIndex(K,Q)}}getTag(){return x.getTag(this)}static getTag(K){return`${K.size[0]}x${K.size[1]}-#${K.slotNumber}`}static positionToTextureSlot(K,Q,$,Z,J){const[Y,V]=$,B=J.textureSizeLimits.max/Y,P=J.textureSizeLimits.max/Y*(J.textureSizeLimits.max/V)*Z+Q/V*B+K/Y;return new x($,P,J)}getPosition(){return{x:this.x,y:this.y,size:this.size,textureIndex:this.textureIndex}}canSplitHorizontally(){const[,K]=this.size;return K>this.textureSizeLimits.min}canSplitVertically(){const[K]=this.size;return K>this.textureSizeLimits.min}splitHorizontally(){const{x:K,y:Q,size:$,textureIndex:Z}=this,[J,Y]=$;if(!this.canSplitHorizontally())throw new Error(`Cannot split texture slot of size ${J} horizontally`);const V=J/2,B=x.positionToTextureSlot(K,Q,[V,Y],Z,this),F=x.positionToTextureSlot(K+V,Q,[V,Y],Z,this);return B.sibbling=F,F.sibbling=B,[B,F]}splitVertically(){const{x:K,y:Q,size:$,textureIndex:Z}=this,[J,Y]=$;if(!this.canSplitVertically())throw new Error(`Cannot split texture slot of size ${Y} vertically`);const V=Y/2,B=x.positionToTextureSlot(K,Q,[J,V],Z,this),F=x.positionToTextureSlot(K,Q+V,[J,V],Z,this);return B.sibbling=F,F.sibbling=B,[B,F]}}function F0(K,Q){return Math.max(Q,Math.pow(2,Math.ceil(Math.log(K)/Math.log(2))))}function GK(K,Q,$,Z){if($<1)throw new Error("Invalid count");const J=F0(K,Z.min),Y=F0(Q,Z.min),V=new Map;let B=Z.min;for(let F=1;F<=$;F++){B=F0(J*F,Z.min);const P=F0(Y*Math.ceil($/F),Z.min);V.set(B,P)}for(let F=B;F<=Z.max;F*=2)if(!V.has(F))V.set(F,Y);return V}var v$=!1,k0=16,M0=4096,g$=16;class G0{textureSlots=new n((K,Q)=>{const $=K.size[0]*K.size[1]-Q.size[0]*Q.size[1];if($!==0)return $;return K.slotNumber-Q.slotNumber},!1);allocatedTextures={};minTextureSize;maxTextureSize;numTextureSheets;initialSlots=[];constructor({numTextureSheets:K,minTextureSize:Q,maxTextureSize:$}={},Z){if(this.numTextureSheets=K??g$,this.minTextureSize=Q??k0,this.maxTextureSize=$??M0,Z)this.numTextureSheets=Math.min(this.numTextureSheets,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_IMAGE_UNITS)),this.maxTextureSize=Math.min(this.maxTextureSize,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_SIZE)),this.minTextureSize=Math.min(this.minTextureSize,this.maxTextureSize);for(let J=0;J<this.numTextureSheets;J++)this.initialSlots.push(new x([this.maxTextureSize,this.maxTextureSize],J,void 0,{min:this.minTextureSize,max:this.maxTextureSize}));this.initialSlots.forEach((J)=>this.textureSlots.insert(J))}allocate(K,Q,$=1){const{size:Z,slotNumber:J,x:Y,y:V,textureIndex:B}=this.allocateHelper(K,Q,$);return{size:Z,slotNumber:J,x:Y,y:V,textureIndex:B}}deallocate(K){if(!this.isSlotUsed(K))throw new Error("Slot is not allocated");const Q=this.allocatedTextures[x.getTag(K)];this.deallocateHelper(Q)}get countUsedTextureSheets(){return this.initialSlots.filter((K)=>this.isSlotUsed(K)).length}allocateHelper(K,Q,$=1){const Z=GK(K,Q,$,{min:this.minTextureSize,max:this.maxTextureSize}),J=this.findSlot(Z);if(!J)throw new Error(`Could not find a slot for texture to fit ${$} sprites of size ${K}x${Q}`);this.textureSlots.remove(J);const[Y,V]=this.bestFit(Z,J);return this.fitSlot(J,Y,V)}findSlot(K){for(let Q=0;Q<this.textureSlots.size;Q++){const Z=this.textureSlots.at(Q).key,[J,Y]=Z.size;if(K.get(J)<=Y)return Z}return null}calculateRatio(K,Q){return Math.max(K/Q,Q/K)}bestFit(K,Q){const[$,Z]=Q.size;let J=Q.textureSizeLimits.max;return K.forEach((Y,V)=>{if(V<=$&&Y<=Z){const B=V*Y,F=K.get(J)*J;if(B<F)J=V;else if(B===F){if(this.calculateRatio(V,Y)<this.calculateRatio(J,K.get(J)))J=V}}}),[J,K.get(J)]}isSlotUsed(K){return!!this.allocatedTextures[x.getTag(K)]}deallocateHelper(K){if(K.parent&&K.sibbling&&!this.isSlotUsed(K.sibbling)){const Q=K.sibbling;if(this.textureSlots.remove(Q),v$&&this.textureSlots.find(K))throw new Error("Slot is not expected to be in the tree");const $=K.parent;this.deallocateHelper($);return}this.textureSlots.insert(K),delete this.allocatedTextures[K.getTag()]}trySplitHorizontally(K,Q,$){if(K.canSplitHorizontally()){const[Z,J]=K.splitHorizontally();if(Z.size[0]>=Q)return this.textureSlots.insert(J),this.fitSlot(Z,Q,$)}return null}trySplitVertically(K,Q,$){if(K.canSplitVertically()){const[Z,J]=K.splitVertically();if(Z.size[1]>=$)return this.textureSlots.insert(J),this.fitSlot(Z,Q,$)}return null}fitSlot(K,Q,$){if(this.allocatedTextures[K.getTag()]=K,K.size[0]>K.size[1]){const Z=this.trySplitHorizontally(K,Q,$)??this.trySplitVertically(K,Q,$);if(Z)return Z}else{const Z=this.trySplitVertically(K,Q,$)??this.trySplitHorizontally(K,Q,$);if(Z)return Z}return K}listSlots(){this.textureSlots.forEach((K)=>{console.log(K.key?.getTag())})}}class T0 extends g{gl;uniforms;textureBuffers={};tempContext=new OffscreenCanvas(1,1).getContext("2d");textureSlotAllocator=new G0;constructor(K,Q){super();this.gl=K,this.uniforms=Q,this.tempContext.imageSmoothingEnabled=!0}initialize(){this.initTextureUniforms(),this.initMaxTexture()}getTexture(K){if(!this.textureBuffers[K]){const Q=this.gl.createTexture();if(!Q)return;this.gl.bindTexture(D.TEXTURE_2D,Q),this.gl.texImage2D(D.TEXTURE_2D,0,D.RGBA,this.textureSlotAllocator.maxTextureSize,this.textureSlotAllocator.maxTextureSize,0,D.RGBA,D.UNSIGNED_BYTE,null),this.textureBuffers[K]=Q,this.addOnDestroy(()=>this.gl.deleteTexture(Q))}return this.textureBuffers[K]}loadTexture(K,Q,$,Z,J){this.gl.activeTexture(D[Q]),this.gl.bindTexture(D.TEXTURE_2D,$),this.applyTexImage2d(K,Z,J),this.gl.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR)}applyTexImage2d(K,[Q,$,Z,J],[Y,V,B,F]){if(Z===B&&J===F&&!Q&&!$)this.gl.texSubImage2D(D.TEXTURE_2D,0,Y,V,B,F,D.RGBA,D.UNSIGNED_BYTE,K.texImgSrc);else{const P=this.tempContext.canvas;if(K.texImgSrc instanceof ImageData){if(P.width=B||K.width,P.height=F||K.height,this.tempContext.putImageData(K.texImgSrc,0,0),Q||$)console.warn("Offset not available when sending imageData")}else{const X=Z||K.width,C=J||K.height;P.width=B||X,P.height=F||C,this.tempContext.drawImage(K.texImgSrc,Q,$,X,C,0,0,P.width,P.height)}this.gl.texSubImage2D(D.TEXTURE_2D,0,Y,V,P.width,P.height,D.RGBA,D.UNSIGNED_BYTE,P)}}allocateSlotForImage(K){const Q=this.textureSlotAllocator.allocate(K.width,K.height),$=`TEXTURE${Q.textureIndex}`,Z=this.getTexture($);if(!Z)throw new Error(`Invalid texture Id ${$}`);const J=this.assignImageToTexture(K,$,Z,[0,0,K.width,K.height],[Q.x,Q.y,...Q.size]);return{slot:Q,refreshCallback:J}}assignImageToTexture(K,Q,$,Z,J){if(K){const Y=Z??[0,0,K.width,K.height],V=J??[0,0,Y[2],Y[3]];if(K.active){const B=()=>{this.gl.bindTexture(D.TEXTURE_2D,$),this.applyTexImage2d(K,Y,V)};return B(),B}else this.loadTexture(K,Q,$,Y,V),K.active=!0}return null}generateMipMap(K){const Q=this.getTexture(K);if(Q)this.gl.activeTexture(D[K]),this.gl.bindTexture(D.TEXTURE_2D,Q),this.gl.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),this.gl.generateMipmap(D.TEXTURE_2D)}generateMipMaps(){const K=this.textureSlotAllocator.countUsedTextureSheets;for(let Q=0;Q<K;Q++){const $=`TEXTURE${Q}`;this.generateMipMap($)}}initTextureUniforms(){const K=this.gl.getParameter(D.MAX_TEXTURE_IMAGE_UNITS),Q=new Array(K).fill(null).map((Z,J)=>J),$=this.uniforms.getUniformLocation(_K);this.gl.uniform1iv($,Q)}initMaxTexture(){const K=this.uniforms.getUniformLocation(AK);this.gl.uniform1f(K,this.textureSlotAllocator.maxTextureSize)}}class l extends g{texImgSrc;active=!1;width;height;constructor(K){super();if(this.texImgSrc=K,this.width=K instanceof Image?K.naturalWidth:K instanceof VideoFrame?K.displayWidth:K.width,this.height=K instanceof Image?K.naturalHeight:K instanceof VideoFrame?K.displayHeight:K.height,!this.width||!this.height)throw new Error("Invalid image")}static createFromCanvas(K){return new l(K)}static async loadImage(K){return new Promise((Q,$)=>{const Z=new Image,J=new l(Z),Y=()=>Q(J),V=(B)=>$(B.error);Z.addEventListener("error",V),Z.addEventListener("load",Y,{once:!0}),J.addOnDestroy(()=>Z.removeEventListener("load",Y)),Z.src=K})}static async loadVideo(K,Q){return new Promise(($,Z)=>{const J=document.createElement("video"),Y=new l(J);if(J.loop=!0,Q!==void 0)J.volume=Q;const V=()=>J.play(),B=()=>$(Y);J.addEventListener("loadedmetadata",V),J.addEventListener("playing",B,{once:!0}),J.addEventListener("error",(F)=>Z(F.error)),J.src=K,Y.addOnDestroy(()=>{J.pause(),J.removeEventListener("playing",B),J.removeEventListener("loadmetadata",V)})})}static async loadWebcam(K){return new Promise((Q,$)=>{const Z=document.createElement("video"),J=new l(Z);Z.loop=!0;const Y=()=>Z.play(),V=()=>Q(J);Z.addEventListener("loadedmetadata",Y),Z.addEventListener("playing",V,{once:!0}),Z.addEventListener("error",(F)=>$(F.error));let B=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:K}}).then((F)=>{if(!B)Z.srcObject=F,J.addOnDestroy(()=>F.getTracks().forEach((P)=>P.stop()))}),J.addOnDestroy(()=>{B=!0,Z.pause(),Z.removeEventListener("playing",V),Z.removeEventListener("loadmetadata",Y)})})}}class q0 extends g{constructor(){super(...arguments)}images=[];hasImageId(K){return!!this.getMedia(K)}getMedia(K){return this.images[K]}setImage(K,Q){this.images[K]=Q}async drawImage(K,Q){const $=new OffscreenCanvas(1,1);Q($.getContext("2d"));const Z=l.createFromCanvas($);return this.images[K]=this.own(Z),Z}async loadCanvas(K,Q){const $=l.createFromCanvas(Q);return Q.getContext("2d"),this.images[K]=this.own($),$}async loadImage(K,Q){const $=await l.loadImage(Q);return this.images[K]=this.own($),$}async loadVideo(K,Q,$){const Z=await l.loadVideo(Q,$);return this.images[K]=this.own(Z),Z}async loadWebCam(K,Q){const $=await l.loadWebcam(Q);return this.images[K]=this.own($),$}}var TK=`#version 300 es
//  ~{AUTHOR}

precision highp float;

//  IN
//  shape
layout(location = 0) in vec4 position_and_tex;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec3 slotSize_and_number;

//  UNIFORM
uniform float maxTextureSize;
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  vec2 position = position_and_tex.xy;
  vec2 tex = position_and_tex.zw;
  vec2 slotSize = slotSize_and_number.xy;
  float slotNumber = slotSize_and_number.z;
  float maxCols = maxTextureSize / slotSize.x;
  float maxRows = maxTextureSize / slotSize.y;
  float slotX = mod(slotNumber, maxCols);
  float slotY = mod(floor(slotNumber / maxCols), maxRows);

  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = (vec2(slotX, slotY) + tex) * slotSize / maxTextureSize;
  textureIndex = floor(slotNumber / (maxCols * maxRows));
}
`;var qK=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function L0(K,Q){return K.replace(/~\{(\w+)\}/g,($,Z)=>{return Q?.[Z]||$})}var l$=function(K){if(!x$)return K;return new Proxy(K,{get($,Z){const J=$,Y=J[Z];if(typeof Y==="function")return(...B)=>{const F=Y.apply(J,B);return console.log(`gl.${String(Z)}(`,B,") = ",F),F};else return console.log(`gl.${String(Z)} = `,Y),Y}})},y$={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},x$=!1;class u extends g{gl;programs;attributeBuffers;uniforms;canvas;textureManager;imageManager;camera;textureSlots=[];world;onDeactivateWorld=()=>{};constructor(K,{attributes:Q,world:$}={}){super();this.gl=l$(K.getContext("webgl2",{...y$,...Q})),this.canvas=K,this.programs=this.own(new D0(this.gl)),this.uniforms=this.own(new R0(this.gl,this.programs)),this.attributeBuffers=this.own(new _0(this.gl,this.programs)),this.textureManager=new T0(this.gl,this.uniforms),this.imageManager=new q0,this.camera=new d(this.gl,this.uniforms),window.addEventListener("resize",this.checkCanvasSize.bind(this)),this.setWorld($)}setWorld(K){this.onDeactivateWorld(),this.world=K;const Q=this.world?.activate();if(Q)this.onDeactivateWorld=Q}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const K=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configProjectionMatrix(K)}async initialize(){const Q={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",L0(TK,Q),L0(qK,Q)),this.programs.useProgram("main"),this.gl.enable(D.DEPTH_TEST),this.gl.depthFunc(D.LESS),this.gl.clearDepth(1),this.gl.enable(D.BLEND),this.gl.blendFunc(D.SRC_ALPHA,D.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const $=UK;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(D.ELEMENT_ARRAY_BUFFER,Z),this.attributeBuffers.bufferData(D.ELEMENT_ARRAY_BUFFER,$,Uint16Array.from([0,1,2,2,3,0]),0,D.STATIC_DRAW)}{const $=WK;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(D.ARRAY_BUFFER,Z),this.gl.vertexAttribPointer(Z.location,4,D.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(Z.location),this.attributeBuffers.bufferData(D.ARRAY_BUFFER,$,Float32Array.from([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),0,D.STATIC_DRAW)}{const $=W0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(D.ARRAY_BUFFER,Z);for(let Y=0;Y<4;Y++){const V=Z.location+Y;this.gl.vertexAttribPointer(V,4,D.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,Y*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(V),this.gl.vertexAttribDivisor(V,1)}const J=this.world?.getSpriteCount()??0;this.attributeBuffers.bufferData(D.ARRAY_BUFFER,$,new Float32Array(J*4*4),0,D.DYNAMIC_DRAW),this.textureManager.initialize()}await this.loadTextures(),this.checkCanvasSize()}static spriteMatrix=L.create();updateSprite(K){u.spriteMatrix.identity();const Q=u.spriteMatrix.getMatrix();this.world?.getSprite(K)?.transforms.forEach((Z)=>T.multiply(Q,Q,Z)),this.attributeBuffers.bufferSubData(D.ARRAY_BUFFER,Q,16*Float32Array.BYTES_PER_ELEMENT*K)}async loadTextures(){const K=this.world?.getSpriteCount()??0;for(let $=0;$<K;$++)await this.world?.drawImage($,this.imageManager);this.textureManager.generateMipMaps();{const $=EK;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(D.ARRAY_BUFFER,Z);const J=Z.location;this.gl.vertexAttribPointer(J,3,D.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(J),this.gl.vertexAttribDivisor(J,1),this.attributeBuffers.bufferData(D.ARRAY_BUFFER,$,new Float32Array((this.world?.getSpriteCount()??0)*3),0,D.DYNAMIC_DRAW)}const Q=this.world?.getSpriteCount()??0;for(let $=0;$<Q;$++){const Z=this.world?.getSprite($);if(Z?.imageId!==void 0){const J=this.imageManager.getMedia(Z.imageId),{slot:Y,refreshCallback:V}=this.textureManager.allocateSlotForImage(J);this.attributeBuffers.bufferSubData(D.ARRAY_BUFFER,Float32Array.from([...Y.size,Y.slotNumber]),3*Float32Array.BYTES_PER_ELEMENT*$),this.textureSlots.push({slot:Y,refreshCallback:V})}}}drawElementsInstanced(K,Q){this.gl.drawElementsInstanced(D.TRIANGLES,K,D.UNSIGNED_SHORT,0,Q)}updateSprites(){const K=this.world?.getUpdatedSprites();if(K?.size){const Q=this.attributeBuffers.getAttributeBuffer(W0);this.attributeBuffers.bindBuffer(D.ARRAY_BUFFER,Q),K?.forEach(($)=>this.updateSprite($)),K?.clear()}}refresh(){this.gl.clear(D.COLOR_BUFFER_BIT|D.DEPTH_BUFFER_BIT);const K=6,Q=this.world?.getSpriteCount()??0;this.world?.syncWithCamera(this.camera),this.updateSprites(),this.drawElementsInstanced(K,Q)}bindVertexArray(){return this.own(new A0(this.gl))}start(){let K=0;const Q=()=>{this.refresh(),K=requestAnimationFrame(Q)};this.refresh(),Q()}}async function $J(){console.log("Hello World!")}function ZJ(K){K.style.border="2px solid silver",K.style.cursor="grab",K.addEventListener("mouseenter",()=>{K.style.borderColor="black"}),K.addEventListener("mouseleave",()=>{K.style.borderColor="silver"});const Q=new u(K,{world:new E0});return Q.initialize(),Q.start(),Q}export{ZJ as testCanvas,$J as hello};

//# debugId=62F0057530F7061964756e2164756e21
