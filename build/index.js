var BQ=Object.defineProperty;var u=(Q,K)=>{for(var Z in K)BQ(Q,Z,{get:K[Z],enumerable:!0,configurable:!0,set:($)=>K[Z]=()=>$})};class v{disposables;own(Q){if(!this.disposables)this.disposables=new Set;return this.disposables.add(Q),Q}addOnDestroy(Q){this.disposables?.add({destroy:Q})}destroy(){this.disposables?.forEach((Q)=>Q.destroy())}}var FQ=function(Q,K,Z){function $(C,P){function X(U){return U===Q?.VERTEX_SHADER?"vertex":U===Q?.FRAGMENT_SHADER?"fragment":void 0}if(P!==Q.VERTEX_SHADER&&P!==Q.FRAGMENT_SHADER)throw new Error(`Shader error in ${X(P)}`);const W=Q.createShader(P);if(!W)throw new Error(`Unable to generate ${X(P)} shader.`);if(Q.shaderSource(W,C),Q.compileShader(W),!Q.getShaderParameter(W,Q.COMPILE_STATUS))console.error(`Shader compile error in ${X(P)}:`+Q.getShaderInfoLog(W));return W}const J=Q.createProgram();if(!J)throw new Error("Unable to create program.");const N=$(K,Q.VERTEX_SHADER),V=$(Z,Q.FRAGMENT_SHADER),B=Q.getShaderInfoLog(N),F=Q.getShaderInfoLog(V);if(B)console.log("VERTEX",B);if(F)console.log("FRAGMENT",F);Q.attachShader(J,N),Q.attachShader(J,V),Q.linkProgram(J);const Y=Q.getProgramInfoLog(J);if(Y)console.log("PROGRAM",Y);if(Q.detachShader(J,N),Q.detachShader(J,V),Q.deleteShader(N),Q.deleteShader(V),Q.validateProgram(J),Object.entries(WebGL2RenderingContext).forEach(([C,P])=>{if(P&&Q.getError()===P)console.log(`gl.${C}`)}),!Q.getProgramParameter(J,Q.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+Q.getProgramInfoLog(J));return J},YQ=function(Q,K){Q.deleteProgram(K)};class o extends v{gl;program;constructor(Q,K,Z){super();this.gl=Q,this.program=FQ(Q,K.trim(),Z.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),YQ(this.gl,this.program)}}class t extends v{activeProgramId="";gl;programs={};constructor(Q){super();this.gl=Q}addProgram(Q,K,Z){if(this.programs[Q])this.removeProgram(Q);this.programs[Q]=this.own(new o(this.gl,K,Z))}useProgram(Q){if(this.activeProgramId!==Q)this.activeProgramId=Q,this.programs[Q].use()}removeProgram(Q){this.programs[Q].destroy(),delete this.programs[Q]}getProgram(Q){return this.programs[Q??this.activeProgramId]?.program}}class a extends v{gl;triangleArray;constructor(Q){super();this.gl=Q,this.triangleArray=Q.createVertexArray(),Q.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class Q0 extends v{bufferRecord={};lastBoundBuffer;gl;programs;constructor(Q,K){super();this.gl=Q,this.programs=K}getAttributeLocation(Q,K){const Z=this.programs.getProgram(K);return Z?this.gl.getAttribLocation(Z,Q)??-1:-1}createBuffer(Q){this.deleteBuffer(Q);const K=this.gl?.createBuffer();if(!K)throw new Error(`Unable to create buffer "${Q}"`);const Z={buffer:K,location:this.getAttributeLocation(Q)};return this.bufferRecord[Q]=Z,Z}deleteBuffer(Q){if(this.bufferRecord[Q])this.gl.deleteBuffer(this.bufferRecord[Q].buffer),delete this.bufferRecord[Q]}getAttributeBuffer(Q,K){const Z=this.bufferRecord[Q];if(!Z){if(K)return this.createBuffer(Q);throw new Error(`Attribute "${Q}" not created. Make sure "createBuffer" is called.`)}return Z}bufferData(Q,K,Z,$,J){const N=this.getAttributeBuffer(K);if(Z)this.gl.bufferData(Q,Z,J);else this.gl.bufferData(Q,$,J);N.bufferSize=$||Z?.length,N.bufferArray=Z??new Float32Array(N.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),N.usage=J,N.target=Q}bufferSubData(Q,K,Z,$,J){if($)this.gl.bufferSubData(Q,Z,K,$,J);else this.gl.bufferSubData(Q,Z,K)}bindBuffer(Q,K){if(this.lastBoundBuffer!==K)this.lastBoundBuffer=K,this.gl.bindBuffer(Q,K.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((Q)=>this.deleteBuffer(Q))}}class K0 extends v{gl;programs;constructor(Q,K){super();this.gl=Q,this.programs=K}getUniformLocation(Q,K){const Z=this.programs.getProgram(K);return Z?this.gl.getUniformLocation(Z,Q)??void 0:void 0}}var A=typeof globalThis.WebGL2RenderingContext!==void 0?globalThis.WebGL2RenderingContext:{},Z0="position",H0="index",U0="transform",D0="tex",A0="slotSize",O0="cam",R0="projection";var M0=4096;class $0 extends v{gl;textureBuffers={};tempCanvas=new OffscreenCanvas(1,1);tempContext=this.tempCanvas.getContext("2d");constructor(Q){super();this.gl=Q,this.tempContext.imageSmoothingEnabled=!0}getTexture(Q){if(!this.textureBuffers[Q]){const K=this.gl.createTexture();if(!K)return;this.gl.bindTexture(A.TEXTURE_2D,K),this.gl.texImage2D(A.TEXTURE_2D,0,A.RGBA,M0,M0,0,A.RGBA,A.UNSIGNED_BYTE,null),this.textureBuffers[Q]=K,this.addOnDestroy(()=>this.gl.deleteTexture(K))}return this.textureBuffers[Q]}loadTexture(Q,K,Z,$,J){this.gl.activeTexture(A[K]),this.gl.bindTexture(A.TEXTURE_2D,Z),this.applyTexImage2d(Q,$,J),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR)}applyTexImage2d(Q,[K,Z,$,J],[N,V,B,F]){if($===B&&J===F&&!K&&!Z)this.gl.texSubImage2D(A.TEXTURE_2D,0,N,V,$,J,A.RGBA,A.UNSIGNED_BYTE,Q.texImgSrc);else{console.log("Used canvas");const Y=this.tempContext.canvas;if(Q.texImgSrc instanceof ImageData){if(Y.width=B||Q.width,Y.height=F||Q.height,this.tempContext.putImageData(Q.texImgSrc,0,0),K||Z)console.warn("Offset not available when sending imageData")}else{const C=$||Q.width,P=J||Q.height;Y.width=B||C,Y.height=F||P,this.tempContext.drawImage(Q.texImgSrc,K,Z,C,P,0,0,Y.width,Y.height)}this.gl.texSubImage2D(A.TEXTURE_2D,0,N,V,Y.width,Y.height,A.RGBA,A.UNSIGNED_BYTE,Y)}}assignImageToTexture(Q,K,Z,$){if(!this.getTexture(K)){console.warn("Invalid texture Id");return}if(Q){const J=this.getTexture(K);if(J){const N=Z??[0,0,Q.width,Q.height],V=$??[0,0,N[2],N[3]];if(Q.activated)this.gl.bindTexture(A.TEXTURE_2D,J),this.applyTexImage2d(Q,N,V);else this.loadTexture(Q,K,J,N,V),Q.activated=!0}else console.warn(`Texture not found: ${K}`)}}generateMipMap(Q){const K=this.getTexture(Q);if(K)this.gl.activeTexture(A[Q]),this.gl.bindTexture(A.TEXTURE_2D,K),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),this.gl.generateMipmap(A.TEXTURE_2D),console.log("GENERATED MIPMAP")}}var T0=`#version 300 es
//  ~{AUTHOR}

precision highp float;

const float TEXTURE_SIZE = 4096.;

//  IN
//  shape
layout(location = 0) in vec2 position;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec2 tex;
layout(location = 6) in vec2 slotSize;

//  UNIFORM
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = tex * (slotSize / TEXTURE_SIZE);
  textureIndex = 0.;
}
`;var j0=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function J0(Q,K){return Q.replace(/~\{(\w+)\}/g,(Z,$)=>{return K?.[$]||Z})}var j=0.000001,S=typeof Float32Array!=="undefined"?Float32Array:Array,d=Math.random,fZ=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var Q=0,K=arguments.length;while(K--)Q+=arguments[K]*arguments[K];return Math.sqrt(Q)};function h0(){var Q=new S(9);if(S!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[5]=0,Q[6]=0,Q[7]=0;return Q[0]=1,Q[4]=1,Q[8]=1,Q}var k={};u(k,{transpose:()=>{{return AQ}},translate:()=>{{return TQ}},targetTo:()=>{{return rQ}},subtract:()=>{{return I0}},sub:()=>{{return ZK}},str:()=>{{return eQ}},set:()=>{{return DQ}},scale:()=>{{return jQ}},rotateZ:()=>{{return SQ}},rotateY:()=>{{return kQ}},rotateX:()=>{{return _Q}},rotate:()=>{{return hQ}},perspectiveZO:()=>{{return lQ}},perspectiveNO:()=>{{return L0}},perspectiveFromFieldOfView:()=>{{return xQ}},perspective:()=>{{return iQ}},orthoZO:()=>{{return mQ}},orthoNO:()=>{{return q0}},ortho:()=>{{return cQ}},multiplyScalarAndAdd:()=>{{return tQ}},multiplyScalar:()=>{{return oQ}},multiply:()=>{{return k0}},mul:()=>{{return KK}},lookAt:()=>{{return sQ}},invert:()=>{{return OQ}},identity:()=>{{return _0}},getTranslation:()=>{{return gQ}},getScaling:()=>{{return G0}},getRotation:()=>{{return zQ}},frustum:()=>{{return yQ}},fromZRotation:()=>{{return pQ}},fromYRotation:()=>{{return wQ}},fromXRotation:()=>{{return IQ}},fromValues:()=>{{return UQ}},fromTranslation:()=>{{return GQ}},fromScaling:()=>{{return LQ}},fromRotationTranslationScaleOrigin:()=>{{return nQ}},fromRotationTranslationScale:()=>{{return fQ}},fromRotationTranslation:()=>{{return S0}},fromRotation:()=>{{return qQ}},fromQuat2:()=>{{return vQ}},fromQuat:()=>{{return dQ}},frob:()=>{{return bQ}},exactEquals:()=>{{return aQ}},equals:()=>{{return QK}},determinant:()=>{{return MQ}},create:()=>{{return WQ}},copy:()=>{{return HQ}},clone:()=>{{return XQ}},adjoint:()=>{{return RQ}},add:()=>{{return uQ}}});function WQ(){var Q=new S(16);if(S!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0;return Q[0]=1,Q[5]=1,Q[10]=1,Q[15]=1,Q}function XQ(Q){var K=new S(16);return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function HQ(Q,K){return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function UQ(Q,K,Z,$,J,N,V,B,F,Y,C,P,X,W,U,H){var E=new S(16);return E[0]=Q,E[1]=K,E[2]=Z,E[3]=$,E[4]=J,E[5]=N,E[6]=V,E[7]=B,E[8]=F,E[9]=Y,E[10]=C,E[11]=P,E[12]=X,E[13]=W,E[14]=U,E[15]=H,E}function DQ(Q,K,Z,$,J,N,V,B,F,Y,C,P,X,W,U,H,E){return Q[0]=K,Q[1]=Z,Q[2]=$,Q[3]=J,Q[4]=N,Q[5]=V,Q[6]=B,Q[7]=F,Q[8]=Y,Q[9]=C,Q[10]=P,Q[11]=X,Q[12]=W,Q[13]=U,Q[14]=H,Q[15]=E,Q}function _0(Q){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function AQ(Q,K){if(Q===K){var Z=K[1],$=K[2],J=K[3],N=K[6],V=K[7],B=K[11];Q[1]=K[4],Q[2]=K[8],Q[3]=K[12],Q[4]=Z,Q[6]=K[9],Q[7]=K[13],Q[8]=$,Q[9]=N,Q[11]=K[14],Q[12]=J,Q[13]=V,Q[14]=B}else Q[0]=K[0],Q[1]=K[4],Q[2]=K[8],Q[3]=K[12],Q[4]=K[1],Q[5]=K[5],Q[6]=K[9],Q[7]=K[13],Q[8]=K[2],Q[9]=K[6],Q[10]=K[10],Q[11]=K[14],Q[12]=K[3],Q[13]=K[7],Q[14]=K[11],Q[15]=K[15];return Q}function OQ(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[3],V=K[4],B=K[5],F=K[6],Y=K[7],C=K[8],P=K[9],X=K[10],W=K[11],U=K[12],H=K[13],E=K[14],D=K[15],h=Z*B-$*V,T=Z*F-J*V,M=Z*Y-N*V,O=$*F-J*B,R=$*Y-N*B,I=J*Y-N*F,G=C*H-P*U,L=C*E-X*U,q=C*D-W*U,w=P*E-X*H,p=P*D-W*H,g=X*D-W*E,_=h*g-T*p+M*w+O*q-R*L+I*G;if(!_)return null;return _=1/_,Q[0]=(B*g-F*p+Y*w)*_,Q[1]=(J*p-$*g-N*w)*_,Q[2]=(H*I-E*R+D*O)*_,Q[3]=(X*R-P*I-W*O)*_,Q[4]=(F*q-V*g-Y*L)*_,Q[5]=(Z*g-J*q+N*L)*_,Q[6]=(E*M-U*I-D*T)*_,Q[7]=(C*I-X*M+W*T)*_,Q[8]=(V*p-B*q+Y*G)*_,Q[9]=($*q-Z*p-N*G)*_,Q[10]=(U*R-H*M+D*h)*_,Q[11]=(P*M-C*R-W*h)*_,Q[12]=(B*L-V*w-F*G)*_,Q[13]=(Z*w-$*L+J*G)*_,Q[14]=(H*T-U*O-E*h)*_,Q[15]=(C*O-P*T+X*h)*_,Q}function RQ(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[3],V=K[4],B=K[5],F=K[6],Y=K[7],C=K[8],P=K[9],X=K[10],W=K[11],U=K[12],H=K[13],E=K[14],D=K[15];return Q[0]=B*(X*D-W*E)-P*(F*D-Y*E)+H*(F*W-Y*X),Q[1]=-($*(X*D-W*E)-P*(J*D-N*E)+H*(J*W-N*X)),Q[2]=$*(F*D-Y*E)-B*(J*D-N*E)+H*(J*Y-N*F),Q[3]=-($*(F*W-Y*X)-B*(J*W-N*X)+P*(J*Y-N*F)),Q[4]=-(V*(X*D-W*E)-C*(F*D-Y*E)+U*(F*W-Y*X)),Q[5]=Z*(X*D-W*E)-C*(J*D-N*E)+U*(J*W-N*X),Q[6]=-(Z*(F*D-Y*E)-V*(J*D-N*E)+U*(J*Y-N*F)),Q[7]=Z*(F*W-Y*X)-V*(J*W-N*X)+C*(J*Y-N*F),Q[8]=V*(P*D-W*H)-C*(B*D-Y*H)+U*(B*W-Y*P),Q[9]=-(Z*(P*D-W*H)-C*($*D-N*H)+U*($*W-N*P)),Q[10]=Z*(B*D-Y*H)-V*($*D-N*H)+U*($*Y-N*B),Q[11]=-(Z*(B*W-Y*P)-V*($*W-N*P)+C*($*Y-N*B)),Q[12]=-(V*(P*E-X*H)-C*(B*E-F*H)+U*(B*X-F*P)),Q[13]=Z*(P*E-X*H)-C*($*E-J*H)+U*($*X-J*P),Q[14]=-(Z*(B*E-F*H)-V*($*E-J*H)+U*($*F-J*B)),Q[15]=Z*(B*X-F*P)-V*($*X-J*P)+C*($*F-J*B),Q}function MQ(Q){var K=Q[0],Z=Q[1],$=Q[2],J=Q[3],N=Q[4],V=Q[5],B=Q[6],F=Q[7],Y=Q[8],C=Q[9],P=Q[10],X=Q[11],W=Q[12],U=Q[13],H=Q[14],E=Q[15],D=K*V-Z*N,h=K*B-$*N,T=K*F-J*N,M=Z*B-$*V,O=Z*F-J*V,R=$*F-J*B,I=Y*U-C*W,G=Y*H-P*W,L=Y*E-X*W,q=C*H-P*U,w=C*E-X*U,p=P*E-X*H;return D*p-h*w+T*q+M*L-O*G+R*I}function k0(Q,K,Z){var $=K[0],J=K[1],N=K[2],V=K[3],B=K[4],F=K[5],Y=K[6],C=K[7],P=K[8],X=K[9],W=K[10],U=K[11],H=K[12],E=K[13],D=K[14],h=K[15],T=Z[0],M=Z[1],O=Z[2],R=Z[3];return Q[0]=T*$+M*B+O*P+R*H,Q[1]=T*J+M*F+O*X+R*E,Q[2]=T*N+M*Y+O*W+R*D,Q[3]=T*V+M*C+O*U+R*h,T=Z[4],M=Z[5],O=Z[6],R=Z[7],Q[4]=T*$+M*B+O*P+R*H,Q[5]=T*J+M*F+O*X+R*E,Q[6]=T*N+M*Y+O*W+R*D,Q[7]=T*V+M*C+O*U+R*h,T=Z[8],M=Z[9],O=Z[10],R=Z[11],Q[8]=T*$+M*B+O*P+R*H,Q[9]=T*J+M*F+O*X+R*E,Q[10]=T*N+M*Y+O*W+R*D,Q[11]=T*V+M*C+O*U+R*h,T=Z[12],M=Z[13],O=Z[14],R=Z[15],Q[12]=T*$+M*B+O*P+R*H,Q[13]=T*J+M*F+O*X+R*E,Q[14]=T*N+M*Y+O*W+R*D,Q[15]=T*V+M*C+O*U+R*h,Q}function TQ(Q,K,Z){var $=Z[0],J=Z[1],N=Z[2],V,B,F,Y,C,P,X,W,U,H,E,D;if(K===Q)Q[12]=K[0]*$+K[4]*J+K[8]*N+K[12],Q[13]=K[1]*$+K[5]*J+K[9]*N+K[13],Q[14]=K[2]*$+K[6]*J+K[10]*N+K[14],Q[15]=K[3]*$+K[7]*J+K[11]*N+K[15];else V=K[0],B=K[1],F=K[2],Y=K[3],C=K[4],P=K[5],X=K[6],W=K[7],U=K[8],H=K[9],E=K[10],D=K[11],Q[0]=V,Q[1]=B,Q[2]=F,Q[3]=Y,Q[4]=C,Q[5]=P,Q[6]=X,Q[7]=W,Q[8]=U,Q[9]=H,Q[10]=E,Q[11]=D,Q[12]=V*$+C*J+U*N+K[12],Q[13]=B*$+P*J+H*N+K[13],Q[14]=F*$+X*J+E*N+K[14],Q[15]=Y*$+W*J+D*N+K[15];return Q}function jQ(Q,K,Z){var $=Z[0],J=Z[1],N=Z[2];return Q[0]=K[0]*$,Q[1]=K[1]*$,Q[2]=K[2]*$,Q[3]=K[3]*$,Q[4]=K[4]*J,Q[5]=K[5]*J,Q[6]=K[6]*J,Q[7]=K[7]*J,Q[8]=K[8]*N,Q[9]=K[9]*N,Q[10]=K[10]*N,Q[11]=K[11]*N,Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function hQ(Q,K,Z,$){var J=$[0],N=$[1],V=$[2],B=Math.hypot(J,N,V),F,Y,C,P,X,W,U,H,E,D,h,T,M,O,R,I,G,L,q,w,p,g,_,f;if(B<j)return null;if(B=1/B,J*=B,N*=B,V*=B,F=Math.sin(Z),Y=Math.cos(Z),C=1-Y,P=K[0],X=K[1],W=K[2],U=K[3],H=K[4],E=K[5],D=K[6],h=K[7],T=K[8],M=K[9],O=K[10],R=K[11],I=J*J*C+Y,G=N*J*C+V*F,L=V*J*C-N*F,q=J*N*C-V*F,w=N*N*C+Y,p=V*N*C+J*F,g=J*V*C+N*F,_=N*V*C-J*F,f=V*V*C+Y,Q[0]=P*I+H*G+T*L,Q[1]=X*I+E*G+M*L,Q[2]=W*I+D*G+O*L,Q[3]=U*I+h*G+R*L,Q[4]=P*q+H*w+T*p,Q[5]=X*q+E*w+M*p,Q[6]=W*q+D*w+O*p,Q[7]=U*q+h*w+R*p,Q[8]=P*g+H*_+T*f,Q[9]=X*g+E*_+M*f,Q[10]=W*g+D*_+O*f,Q[11]=U*g+h*_+R*f,K!==Q)Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q}function _Q(Q,K,Z){var $=Math.sin(Z),J=Math.cos(Z),N=K[4],V=K[5],B=K[6],F=K[7],Y=K[8],C=K[9],P=K[10],X=K[11];if(K!==Q)Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q[4]=N*J+Y*$,Q[5]=V*J+C*$,Q[6]=B*J+P*$,Q[7]=F*J+X*$,Q[8]=Y*J-N*$,Q[9]=C*J-V*$,Q[10]=P*J-B*$,Q[11]=X*J-F*$,Q}function kQ(Q,K,Z){var $=Math.sin(Z),J=Math.cos(Z),N=K[0],V=K[1],B=K[2],F=K[3],Y=K[8],C=K[9],P=K[10],X=K[11];if(K!==Q)Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q[0]=N*J-Y*$,Q[1]=V*J-C*$,Q[2]=B*J-P*$,Q[3]=F*J-X*$,Q[8]=N*$+Y*J,Q[9]=V*$+C*J,Q[10]=B*$+P*J,Q[11]=F*$+X*J,Q}function SQ(Q,K,Z){var $=Math.sin(Z),J=Math.cos(Z),N=K[0],V=K[1],B=K[2],F=K[3],Y=K[4],C=K[5],P=K[6],X=K[7];if(K!==Q)Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q[0]=N*J+Y*$,Q[1]=V*J+C*$,Q[2]=B*J+P*$,Q[3]=F*J+X*$,Q[4]=Y*J-N*$,Q[5]=C*J-V*$,Q[6]=P*J-B*$,Q[7]=X*J-F*$,Q}function GQ(Q,K){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=K[0],Q[13]=K[1],Q[14]=K[2],Q[15]=1,Q}function LQ(Q,K){return Q[0]=K[0],Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=K[1],Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=K[2],Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function qQ(Q,K,Z){var $=Z[0],J=Z[1],N=Z[2],V=Math.hypot($,J,N),B,F,Y;if(V<j)return null;return V=1/V,$*=V,J*=V,N*=V,B=Math.sin(K),F=Math.cos(K),Y=1-F,Q[0]=$*$*Y+F,Q[1]=J*$*Y+N*B,Q[2]=N*$*Y-J*B,Q[3]=0,Q[4]=$*J*Y-N*B,Q[5]=J*J*Y+F,Q[6]=N*J*Y+$*B,Q[7]=0,Q[8]=$*N*Y+J*B,Q[9]=J*N*Y-$*B,Q[10]=N*N*Y+F,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function IQ(Q,K){var Z=Math.sin(K),$=Math.cos(K);return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=$,Q[6]=Z,Q[7]=0,Q[8]=0,Q[9]=-Z,Q[10]=$,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function wQ(Q,K){var Z=Math.sin(K),$=Math.cos(K);return Q[0]=$,Q[1]=0,Q[2]=-Z,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=Z,Q[9]=0,Q[10]=$,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function pQ(Q,K){var Z=Math.sin(K),$=Math.cos(K);return Q[0]=$,Q[1]=Z,Q[2]=0,Q[3]=0,Q[4]=-Z,Q[5]=$,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function S0(Q,K,Z){var $=K[0],J=K[1],N=K[2],V=K[3],B=$+$,F=J+J,Y=N+N,C=$*B,P=$*F,X=$*Y,W=J*F,U=J*Y,H=N*Y,E=V*B,D=V*F,h=V*Y;return Q[0]=1-(W+H),Q[1]=P+h,Q[2]=X-D,Q[3]=0,Q[4]=P-h,Q[5]=1-(C+H),Q[6]=U+E,Q[7]=0,Q[8]=X+D,Q[9]=U-E,Q[10]=1-(C+W),Q[11]=0,Q[12]=Z[0],Q[13]=Z[1],Q[14]=Z[2],Q[15]=1,Q}function vQ(Q,K){var Z=new S(3),$=-K[0],J=-K[1],N=-K[2],V=K[3],B=K[4],F=K[5],Y=K[6],C=K[7],P=$*$+J*J+N*N+V*V;if(P>0)Z[0]=(B*V+C*$+F*N-Y*J)*2/P,Z[1]=(F*V+C*J+Y*$-B*N)*2/P,Z[2]=(Y*V+C*N+B*J-F*$)*2/P;else Z[0]=(B*V+C*$+F*N-Y*J)*2,Z[1]=(F*V+C*J+Y*$-B*N)*2,Z[2]=(Y*V+C*N+B*J-F*$)*2;return S0(Q,K,Z),Q}function gQ(Q,K){return Q[0]=K[12],Q[1]=K[13],Q[2]=K[14],Q}function G0(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[4],V=K[5],B=K[6],F=K[8],Y=K[9],C=K[10];return Q[0]=Math.hypot(Z,$,J),Q[1]=Math.hypot(N,V,B),Q[2]=Math.hypot(F,Y,C),Q}function zQ(Q,K){var Z=new S(3);G0(Z,K);var $=1/Z[0],J=1/Z[1],N=1/Z[2],V=K[0]*$,B=K[1]*J,F=K[2]*N,Y=K[4]*$,C=K[5]*J,P=K[6]*N,X=K[8]*$,W=K[9]*J,U=K[10]*N,H=V+C+U,E=0;if(H>0)E=Math.sqrt(H+1)*2,Q[3]=0.25*E,Q[0]=(P-W)/E,Q[1]=(X-F)/E,Q[2]=(B-Y)/E;else if(V>C&&V>U)E=Math.sqrt(1+V-C-U)*2,Q[3]=(P-W)/E,Q[0]=0.25*E,Q[1]=(B+Y)/E,Q[2]=(X+F)/E;else if(C>U)E=Math.sqrt(1+C-V-U)*2,Q[3]=(X-F)/E,Q[0]=(B+Y)/E,Q[1]=0.25*E,Q[2]=(P+W)/E;else E=Math.sqrt(1+U-V-C)*2,Q[3]=(B-Y)/E,Q[0]=(X+F)/E,Q[1]=(P+W)/E,Q[2]=0.25*E;return Q}function fQ(Q,K,Z,$){var J=K[0],N=K[1],V=K[2],B=K[3],F=J+J,Y=N+N,C=V+V,P=J*F,X=J*Y,W=J*C,U=N*Y,H=N*C,E=V*C,D=B*F,h=B*Y,T=B*C,M=$[0],O=$[1],R=$[2];return Q[0]=(1-(U+E))*M,Q[1]=(X+T)*M,Q[2]=(W-h)*M,Q[3]=0,Q[4]=(X-T)*O,Q[5]=(1-(P+E))*O,Q[6]=(H+D)*O,Q[7]=0,Q[8]=(W+h)*R,Q[9]=(H-D)*R,Q[10]=(1-(P+U))*R,Q[11]=0,Q[12]=Z[0],Q[13]=Z[1],Q[14]=Z[2],Q[15]=1,Q}function nQ(Q,K,Z,$,J){var N=K[0],V=K[1],B=K[2],F=K[3],Y=N+N,C=V+V,P=B+B,X=N*Y,W=N*C,U=N*P,H=V*C,E=V*P,D=B*P,h=F*Y,T=F*C,M=F*P,O=$[0],R=$[1],I=$[2],G=J[0],L=J[1],q=J[2],w=(1-(H+D))*O,p=(W+M)*O,g=(U-T)*O,_=(W-M)*R,f=(1-(X+D))*R,i=(E+h)*R,l=(U+T)*I,W0=(E-h)*I,X0=(1-(X+H))*I;return Q[0]=w,Q[1]=p,Q[2]=g,Q[3]=0,Q[4]=_,Q[5]=f,Q[6]=i,Q[7]=0,Q[8]=l,Q[9]=W0,Q[10]=X0,Q[11]=0,Q[12]=Z[0]+G-(w*G+_*L+l*q),Q[13]=Z[1]+L-(p*G+f*L+W0*q),Q[14]=Z[2]+q-(g*G+i*L+X0*q),Q[15]=1,Q}function dQ(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[3],V=Z+Z,B=$+$,F=J+J,Y=Z*V,C=$*V,P=$*B,X=J*V,W=J*B,U=J*F,H=N*V,E=N*B,D=N*F;return Q[0]=1-P-U,Q[1]=C+D,Q[2]=X-E,Q[3]=0,Q[4]=C-D,Q[5]=1-Y-U,Q[6]=W+H,Q[7]=0,Q[8]=X+E,Q[9]=W-H,Q[10]=1-Y-P,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function yQ(Q,K,Z,$,J,N,V){var B=1/(Z-K),F=1/(J-$),Y=1/(N-V);return Q[0]=N*2*B,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=N*2*F,Q[6]=0,Q[7]=0,Q[8]=(Z+K)*B,Q[9]=(J+$)*F,Q[10]=(V+N)*Y,Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=V*N*2*Y,Q[15]=0,Q}function L0(Q,K,Z,$,J){var N=1/Math.tan(K/2),V;if(Q[0]=N/Z,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=N,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,J!=null&&J!==Infinity)V=1/($-J),Q[10]=(J+$)*V,Q[14]=2*J*$*V;else Q[10]=-1,Q[14]=-2*$;return Q}function lQ(Q,K,Z,$,J){var N=1/Math.tan(K/2),V;if(Q[0]=N/Z,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=N,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,J!=null&&J!==Infinity)V=1/($-J),Q[10]=J*V,Q[14]=J*$*V;else Q[10]=-1,Q[14]=-$;return Q}function xQ(Q,K,Z,$){var J=Math.tan(K.upDegrees*Math.PI/180),N=Math.tan(K.downDegrees*Math.PI/180),V=Math.tan(K.leftDegrees*Math.PI/180),B=Math.tan(K.rightDegrees*Math.PI/180),F=2/(V+B),Y=2/(J+N);return Q[0]=F,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Y,Q[6]=0,Q[7]=0,Q[8]=-((V-B)*F*0.5),Q[9]=(J-N)*Y*0.5,Q[10]=$/(Z-$),Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=$*Z/(Z-$),Q[15]=0,Q}function q0(Q,K,Z,$,J,N,V){var B=1/(K-Z),F=1/($-J),Y=1/(N-V);return Q[0]=-2*B,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*F,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=2*Y,Q[11]=0,Q[12]=(K+Z)*B,Q[13]=(J+$)*F,Q[14]=(V+N)*Y,Q[15]=1,Q}function mQ(Q,K,Z,$,J,N,V){var B=1/(K-Z),F=1/($-J),Y=1/(N-V);return Q[0]=-2*B,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*F,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=Y,Q[11]=0,Q[12]=(K+Z)*B,Q[13]=(J+$)*F,Q[14]=N*Y,Q[15]=1,Q}function sQ(Q,K,Z,$){var J,N,V,B,F,Y,C,P,X,W,U=K[0],H=K[1],E=K[2],D=$[0],h=$[1],T=$[2],M=Z[0],O=Z[1],R=Z[2];if(Math.abs(U-M)<j&&Math.abs(H-O)<j&&Math.abs(E-R)<j)return _0(Q);if(C=U-M,P=H-O,X=E-R,W=1/Math.hypot(C,P,X),C*=W,P*=W,X*=W,J=h*X-T*P,N=T*C-D*X,V=D*P-h*C,W=Math.hypot(J,N,V),!W)J=0,N=0,V=0;else W=1/W,J*=W,N*=W,V*=W;if(B=P*V-X*N,F=X*J-C*V,Y=C*N-P*J,W=Math.hypot(B,F,Y),!W)B=0,F=0,Y=0;else W=1/W,B*=W,F*=W,Y*=W;return Q[0]=J,Q[1]=B,Q[2]=C,Q[3]=0,Q[4]=N,Q[5]=F,Q[6]=P,Q[7]=0,Q[8]=V,Q[9]=Y,Q[10]=X,Q[11]=0,Q[12]=-(J*U+N*H+V*E),Q[13]=-(B*U+F*H+Y*E),Q[14]=-(C*U+P*H+X*E),Q[15]=1,Q}function rQ(Q,K,Z,$){var J=K[0],N=K[1],V=K[2],B=$[0],F=$[1],Y=$[2],C=J-Z[0],P=N-Z[1],X=V-Z[2],W=C*C+P*P+X*X;if(W>0)W=1/Math.sqrt(W),C*=W,P*=W,X*=W;var U=F*X-Y*P,H=Y*C-B*X,E=B*P-F*C;if(W=U*U+H*H+E*E,W>0)W=1/Math.sqrt(W),U*=W,H*=W,E*=W;return Q[0]=U,Q[1]=H,Q[2]=E,Q[3]=0,Q[4]=P*E-X*H,Q[5]=X*U-C*E,Q[6]=C*H-P*U,Q[7]=0,Q[8]=C,Q[9]=P,Q[10]=X,Q[11]=0,Q[12]=J,Q[13]=N,Q[14]=V,Q[15]=1,Q}function eQ(Q){return"mat4("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+", "+Q[4]+", "+Q[5]+", "+Q[6]+", "+Q[7]+", "+Q[8]+", "+Q[9]+", "+Q[10]+", "+Q[11]+", "+Q[12]+", "+Q[13]+", "+Q[14]+", "+Q[15]+")"}function bQ(Q){return Math.hypot(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15])}function uQ(Q,K,Z){return Q[0]=K[0]+Z[0],Q[1]=K[1]+Z[1],Q[2]=K[2]+Z[2],Q[3]=K[3]+Z[3],Q[4]=K[4]+Z[4],Q[5]=K[5]+Z[5],Q[6]=K[6]+Z[6],Q[7]=K[7]+Z[7],Q[8]=K[8]+Z[8],Q[9]=K[9]+Z[9],Q[10]=K[10]+Z[10],Q[11]=K[11]+Z[11],Q[12]=K[12]+Z[12],Q[13]=K[13]+Z[13],Q[14]=K[14]+Z[14],Q[15]=K[15]+Z[15],Q}function I0(Q,K,Z){return Q[0]=K[0]-Z[0],Q[1]=K[1]-Z[1],Q[2]=K[2]-Z[2],Q[3]=K[3]-Z[3],Q[4]=K[4]-Z[4],Q[5]=K[5]-Z[5],Q[6]=K[6]-Z[6],Q[7]=K[7]-Z[7],Q[8]=K[8]-Z[8],Q[9]=K[9]-Z[9],Q[10]=K[10]-Z[10],Q[11]=K[11]-Z[11],Q[12]=K[12]-Z[12],Q[13]=K[13]-Z[13],Q[14]=K[14]-Z[14],Q[15]=K[15]-Z[15],Q}function oQ(Q,K,Z){return Q[0]=K[0]*Z,Q[1]=K[1]*Z,Q[2]=K[2]*Z,Q[3]=K[3]*Z,Q[4]=K[4]*Z,Q[5]=K[5]*Z,Q[6]=K[6]*Z,Q[7]=K[7]*Z,Q[8]=K[8]*Z,Q[9]=K[9]*Z,Q[10]=K[10]*Z,Q[11]=K[11]*Z,Q[12]=K[12]*Z,Q[13]=K[13]*Z,Q[14]=K[14]*Z,Q[15]=K[15]*Z,Q}function tQ(Q,K,Z,$){return Q[0]=K[0]+Z[0]*$,Q[1]=K[1]+Z[1]*$,Q[2]=K[2]+Z[2]*$,Q[3]=K[3]+Z[3]*$,Q[4]=K[4]+Z[4]*$,Q[5]=K[5]+Z[5]*$,Q[6]=K[6]+Z[6]*$,Q[7]=K[7]+Z[7]*$,Q[8]=K[8]+Z[8]*$,Q[9]=K[9]+Z[9]*$,Q[10]=K[10]+Z[10]*$,Q[11]=K[11]+Z[11]*$,Q[12]=K[12]+Z[12]*$,Q[13]=K[13]+Z[13]*$,Q[14]=K[14]+Z[14]*$,Q[15]=K[15]+Z[15]*$,Q}function aQ(Q,K){return Q[0]===K[0]&&Q[1]===K[1]&&Q[2]===K[2]&&Q[3]===K[3]&&Q[4]===K[4]&&Q[5]===K[5]&&Q[6]===K[6]&&Q[7]===K[7]&&Q[8]===K[8]&&Q[9]===K[9]&&Q[10]===K[10]&&Q[11]===K[11]&&Q[12]===K[12]&&Q[13]===K[13]&&Q[14]===K[14]&&Q[15]===K[15]}function QK(Q,K){var Z=Q[0],$=Q[1],J=Q[2],N=Q[3],V=Q[4],B=Q[5],F=Q[6],Y=Q[7],C=Q[8],P=Q[9],X=Q[10],W=Q[11],U=Q[12],H=Q[13],E=Q[14],D=Q[15],h=K[0],T=K[1],M=K[2],O=K[3],R=K[4],I=K[5],G=K[6],L=K[7],q=K[8],w=K[9],p=K[10],g=K[11],_=K[12],f=K[13],i=K[14],l=K[15];return Math.abs(Z-h)<=j*Math.max(1,Math.abs(Z),Math.abs(h))&&Math.abs($-T)<=j*Math.max(1,Math.abs($),Math.abs(T))&&Math.abs(J-M)<=j*Math.max(1,Math.abs(J),Math.abs(M))&&Math.abs(N-O)<=j*Math.max(1,Math.abs(N),Math.abs(O))&&Math.abs(V-R)<=j*Math.max(1,Math.abs(V),Math.abs(R))&&Math.abs(B-I)<=j*Math.max(1,Math.abs(B),Math.abs(I))&&Math.abs(F-G)<=j*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(Y-L)<=j*Math.max(1,Math.abs(Y),Math.abs(L))&&Math.abs(C-q)<=j*Math.max(1,Math.abs(C),Math.abs(q))&&Math.abs(P-w)<=j*Math.max(1,Math.abs(P),Math.abs(w))&&Math.abs(X-p)<=j*Math.max(1,Math.abs(X),Math.abs(p))&&Math.abs(W-g)<=j*Math.max(1,Math.abs(W),Math.abs(g))&&Math.abs(U-_)<=j*Math.max(1,Math.abs(U),Math.abs(_))&&Math.abs(H-f)<=j*Math.max(1,Math.abs(H),Math.abs(f))&&Math.abs(E-i)<=j*Math.max(1,Math.abs(E),Math.abs(i))&&Math.abs(D-l)<=j*Math.max(1,Math.abs(D),Math.abs(l))}var iQ=L0,cQ=q0,KK=k0,ZK=I0;var m={};u(m,{str:()=>{{return tK}},squaredLength:()=>{{return VQ}},sqrLen:()=>{{return BZ}},sqlerp:()=>{{return PZ}},slerp:()=>{{return b}},setAxisAngle:()=>{{return t0}},setAxes:()=>{{return EZ}},set:()=>{{return ZZ}},scale:()=>{{return $Q}},rotationTo:()=>{{return CZ}},rotateZ:()=>{{return mK}},rotateY:()=>{{return cK}},rotateX:()=>{{return xK}},random:()=>{{return eK}},pow:()=>{{return rK}},normalize:()=>{{return F0}},multiply:()=>{{return a0}},mul:()=>{{return JZ}},ln:()=>{{return KQ}},lerp:()=>{{return NZ}},length:()=>{{return NQ}},len:()=>{{return VZ}},invert:()=>{{return bK}},identity:()=>{{return yK}},getAxisAngle:()=>{{return iK}},getAngle:()=>{{return lK}},fromValues:()=>{{return QZ}},fromMat3:()=>{{return ZQ}},fromEuler:()=>{{return oK}},exp:()=>{{return QQ}},exactEquals:()=>{{return FZ}},equals:()=>{{return YZ}},dot:()=>{{return JQ}},create:()=>{{return B0}},copy:()=>{{return KZ}},conjugate:()=>{{return uK}},clone:()=>{{return aK}},calculateW:()=>{{return sK}},add:()=>{{return $Z}}});var y={};u(y,{zero:()=>{{return SK}},transformQuat:()=>{{return TK}},transformMat4:()=>{{return RK}},transformMat3:()=>{{return MK}},subtract:()=>{{return p0}},sub:()=>{{return IK}},str:()=>{{return GK}},squaredLength:()=>{{return n0}},squaredDistance:()=>{{return f0}},sqrLen:()=>{{return zK}},sqrDist:()=>{{return gK}},set:()=>{{return NK}},scaleAndAdd:()=>{{return WK}},scale:()=>{{return EK}},round:()=>{{return PK}},rotateZ:()=>{{return _K}},rotateY:()=>{{return hK}},rotateX:()=>{{return jK}},random:()=>{{return OK}},normalize:()=>{{return N0}},negate:()=>{{return XK}},multiply:()=>{{return v0}},mul:()=>{{return wK}},min:()=>{{return YK}},max:()=>{{return CK}},lerp:()=>{{return UK}},length:()=>{{return w0}},len:()=>{{return V0}},inverse:()=>{{return HK}},hermite:()=>{{return DK}},fromValues:()=>{{return r}},forEach:()=>{{return fK}},floor:()=>{{return FK}},exactEquals:()=>{{return LK}},equals:()=>{{return qK}},dot:()=>{{return e}},divide:()=>{{return g0}},div:()=>{{return pK}},distance:()=>{{return z0}},dist:()=>{{return vK}},cross:()=>{{return c}},create:()=>{{return s}},copy:()=>{{return JK}},clone:()=>{{return $K}},ceil:()=>{{return BK}},bezier:()=>{{return AK}},angle:()=>{{return kK}},add:()=>{{return VK}}});function s(){var Q=new S(3);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q}function $K(Q){var K=new S(3);return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K}function w0(Q){var K=Q[0],Z=Q[1],$=Q[2];return Math.hypot(K,Z,$)}function r(Q,K,Z){var $=new S(3);return $[0]=Q,$[1]=K,$[2]=Z,$}function JK(Q,K){return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q}function NK(Q,K,Z,$){return Q[0]=K,Q[1]=Z,Q[2]=$,Q}function VK(Q,K,Z){return Q[0]=K[0]+Z[0],Q[1]=K[1]+Z[1],Q[2]=K[2]+Z[2],Q}function p0(Q,K,Z){return Q[0]=K[0]-Z[0],Q[1]=K[1]-Z[1],Q[2]=K[2]-Z[2],Q}function v0(Q,K,Z){return Q[0]=K[0]*Z[0],Q[1]=K[1]*Z[1],Q[2]=K[2]*Z[2],Q}function g0(Q,K,Z){return Q[0]=K[0]/Z[0],Q[1]=K[1]/Z[1],Q[2]=K[2]/Z[2],Q}function BK(Q,K){return Q[0]=Math.ceil(K[0]),Q[1]=Math.ceil(K[1]),Q[2]=Math.ceil(K[2]),Q}function FK(Q,K){return Q[0]=Math.floor(K[0]),Q[1]=Math.floor(K[1]),Q[2]=Math.floor(K[2]),Q}function YK(Q,K,Z){return Q[0]=Math.min(K[0],Z[0]),Q[1]=Math.min(K[1],Z[1]),Q[2]=Math.min(K[2],Z[2]),Q}function CK(Q,K,Z){return Q[0]=Math.max(K[0],Z[0]),Q[1]=Math.max(K[1],Z[1]),Q[2]=Math.max(K[2],Z[2]),Q}function PK(Q,K){return Q[0]=Math.round(K[0]),Q[1]=Math.round(K[1]),Q[2]=Math.round(K[2]),Q}function EK(Q,K,Z){return Q[0]=K[0]*Z,Q[1]=K[1]*Z,Q[2]=K[2]*Z,Q}function WK(Q,K,Z,$){return Q[0]=K[0]+Z[0]*$,Q[1]=K[1]+Z[1]*$,Q[2]=K[2]+Z[2]*$,Q}function z0(Q,K){var Z=K[0]-Q[0],$=K[1]-Q[1],J=K[2]-Q[2];return Math.hypot(Z,$,J)}function f0(Q,K){var Z=K[0]-Q[0],$=K[1]-Q[1],J=K[2]-Q[2];return Z*Z+$*$+J*J}function n0(Q){var K=Q[0],Z=Q[1],$=Q[2];return K*K+Z*Z+$*$}function XK(Q,K){return Q[0]=-K[0],Q[1]=-K[1],Q[2]=-K[2],Q}function HK(Q,K){return Q[0]=1/K[0],Q[1]=1/K[1],Q[2]=1/K[2],Q}function N0(Q,K){var Z=K[0],$=K[1],J=K[2],N=Z*Z+$*$+J*J;if(N>0)N=1/Math.sqrt(N);return Q[0]=K[0]*N,Q[1]=K[1]*N,Q[2]=K[2]*N,Q}function e(Q,K){return Q[0]*K[0]+Q[1]*K[1]+Q[2]*K[2]}function c(Q,K,Z){var $=K[0],J=K[1],N=K[2],V=Z[0],B=Z[1],F=Z[2];return Q[0]=J*F-N*B,Q[1]=N*V-$*F,Q[2]=$*B-J*V,Q}function UK(Q,K,Z,$){var J=K[0],N=K[1],V=K[2];return Q[0]=J+$*(Z[0]-J),Q[1]=N+$*(Z[1]-N),Q[2]=V+$*(Z[2]-V),Q}function DK(Q,K,Z,$,J,N){var V=N*N,B=V*(2*N-3)+1,F=V*(N-2)+N,Y=V*(N-1),C=V*(3-2*N);return Q[0]=K[0]*B+Z[0]*F+$[0]*Y+J[0]*C,Q[1]=K[1]*B+Z[1]*F+$[1]*Y+J[1]*C,Q[2]=K[2]*B+Z[2]*F+$[2]*Y+J[2]*C,Q}function AK(Q,K,Z,$,J,N){var V=1-N,B=V*V,F=N*N,Y=B*V,C=3*N*B,P=3*F*V,X=F*N;return Q[0]=K[0]*Y+Z[0]*C+$[0]*P+J[0]*X,Q[1]=K[1]*Y+Z[1]*C+$[1]*P+J[1]*X,Q[2]=K[2]*Y+Z[2]*C+$[2]*P+J[2]*X,Q}function OK(Q,K){K=K||1;var Z=d()*2*Math.PI,$=d()*2-1,J=Math.sqrt(1-$*$)*K;return Q[0]=Math.cos(Z)*J,Q[1]=Math.sin(Z)*J,Q[2]=$*K,Q}function RK(Q,K,Z){var $=K[0],J=K[1],N=K[2],V=Z[3]*$+Z[7]*J+Z[11]*N+Z[15];return V=V||1,Q[0]=(Z[0]*$+Z[4]*J+Z[8]*N+Z[12])/V,Q[1]=(Z[1]*$+Z[5]*J+Z[9]*N+Z[13])/V,Q[2]=(Z[2]*$+Z[6]*J+Z[10]*N+Z[14])/V,Q}function MK(Q,K,Z){var $=K[0],J=K[1],N=K[2];return Q[0]=$*Z[0]+J*Z[3]+N*Z[6],Q[1]=$*Z[1]+J*Z[4]+N*Z[7],Q[2]=$*Z[2]+J*Z[5]+N*Z[8],Q}function TK(Q,K,Z){var $=Z[0],J=Z[1],N=Z[2],V=Z[3],B=K[0],F=K[1],Y=K[2],C=J*Y-N*F,P=N*B-$*Y,X=$*F-J*B,W=J*X-N*P,U=N*C-$*X,H=$*P-J*C,E=V*2;return C*=E,P*=E,X*=E,W*=2,U*=2,H*=2,Q[0]=B+C+W,Q[1]=F+P+U,Q[2]=Y+X+H,Q}function jK(Q,K,Z,$){var J=[],N=[];return J[0]=K[0]-Z[0],J[1]=K[1]-Z[1],J[2]=K[2]-Z[2],N[0]=J[0],N[1]=J[1]*Math.cos($)-J[2]*Math.sin($),N[2]=J[1]*Math.sin($)+J[2]*Math.cos($),Q[0]=N[0]+Z[0],Q[1]=N[1]+Z[1],Q[2]=N[2]+Z[2],Q}function hK(Q,K,Z,$){var J=[],N=[];return J[0]=K[0]-Z[0],J[1]=K[1]-Z[1],J[2]=K[2]-Z[2],N[0]=J[2]*Math.sin($)+J[0]*Math.cos($),N[1]=J[1],N[2]=J[2]*Math.cos($)-J[0]*Math.sin($),Q[0]=N[0]+Z[0],Q[1]=N[1]+Z[1],Q[2]=N[2]+Z[2],Q}function _K(Q,K,Z,$){var J=[],N=[];return J[0]=K[0]-Z[0],J[1]=K[1]-Z[1],J[2]=K[2]-Z[2],N[0]=J[0]*Math.cos($)-J[1]*Math.sin($),N[1]=J[0]*Math.sin($)+J[1]*Math.cos($),N[2]=J[2],Q[0]=N[0]+Z[0],Q[1]=N[1]+Z[1],Q[2]=N[2]+Z[2],Q}function kK(Q,K){var Z=Q[0],$=Q[1],J=Q[2],N=K[0],V=K[1],B=K[2],F=Math.sqrt(Z*Z+$*$+J*J),Y=Math.sqrt(N*N+V*V+B*B),C=F*Y,P=C&&e(Q,K)/C;return Math.acos(Math.min(Math.max(P,-1),1))}function SK(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q}function GK(Q){return"vec3("+Q[0]+", "+Q[1]+", "+Q[2]+")"}function LK(Q,K){return Q[0]===K[0]&&Q[1]===K[1]&&Q[2]===K[2]}function qK(Q,K){var Z=Q[0],$=Q[1],J=Q[2],N=K[0],V=K[1],B=K[2];return Math.abs(Z-N)<=j*Math.max(1,Math.abs(Z),Math.abs(N))&&Math.abs($-V)<=j*Math.max(1,Math.abs($),Math.abs(V))&&Math.abs(J-B)<=j*Math.max(1,Math.abs(J),Math.abs(B))}var IK=p0,wK=v0,pK=g0,vK=z0,gK=f0,V0=w0,zK=n0,fK=function(){var Q=s();return function(K,Z,$,J,N,V){var B,F;if(!Z)Z=3;if(!$)$=0;if(J)F=Math.min(J*Z+$,K.length);else F=K.length;for(B=$;B<F;B+=Z)Q[0]=K[B],Q[1]=K[B+1],Q[2]=K[B+2],N(Q,Q,V),K[B]=Q[0],K[B+1]=Q[1],K[B+2]=Q[2];return K}}();function nK(){var Q=new S(4);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0;return Q}function d0(Q){var K=new S(4);return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K}function y0(Q,K,Z,$){var J=new S(4);return J[0]=Q,J[1]=K,J[2]=Z,J[3]=$,J}function i0(Q,K){return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q}function l0(Q,K,Z,$,J){return Q[0]=K,Q[1]=Z,Q[2]=$,Q[3]=J,Q}function x0(Q,K,Z){return Q[0]=K[0]+Z[0],Q[1]=K[1]+Z[1],Q[2]=K[2]+Z[2],Q[3]=K[3]+Z[3],Q}function c0(Q,K,Z){return Q[0]=K[0]*Z,Q[1]=K[1]*Z,Q[2]=K[2]*Z,Q[3]=K[3]*Z,Q}function m0(Q){var K=Q[0],Z=Q[1],$=Q[2],J=Q[3];return Math.hypot(K,Z,$,J)}function s0(Q){var K=Q[0],Z=Q[1],$=Q[2],J=Q[3];return K*K+Z*Z+$*$+J*J}function r0(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[3],V=Z*Z+$*$+J*J+N*N;if(V>0)V=1/Math.sqrt(V);return Q[0]=Z*V,Q[1]=$*V,Q[2]=J*V,Q[3]=N*V,Q}function e0(Q,K){return Q[0]*K[0]+Q[1]*K[1]+Q[2]*K[2]+Q[3]*K[3]}function b0(Q,K,Z,$){var J=K[0],N=K[1],V=K[2],B=K[3];return Q[0]=J+$*(Z[0]-J),Q[1]=N+$*(Z[1]-N),Q[2]=V+$*(Z[2]-V),Q[3]=B+$*(Z[3]-B),Q}function u0(Q,K){return Q[0]===K[0]&&Q[1]===K[1]&&Q[2]===K[2]&&Q[3]===K[3]}function o0(Q,K){var Z=Q[0],$=Q[1],J=Q[2],N=Q[3],V=K[0],B=K[1],F=K[2],Y=K[3];return Math.abs(Z-V)<=j*Math.max(1,Math.abs(Z),Math.abs(V))&&Math.abs($-B)<=j*Math.max(1,Math.abs($),Math.abs(B))&&Math.abs(J-F)<=j*Math.max(1,Math.abs(J),Math.abs(F))&&Math.abs(N-Y)<=j*Math.max(1,Math.abs(N),Math.abs(Y))}var nZ=function(){var Q=nK();return function(K,Z,$,J,N,V){var B,F;if(!Z)Z=4;if(!$)$=0;if(J)F=Math.min(J*Z+$,K.length);else F=K.length;for(B=$;B<F;B+=Z)Q[0]=K[B],Q[1]=K[B+1],Q[2]=K[B+2],Q[3]=K[B+3],N(Q,Q,V),K[B]=Q[0],K[B+1]=Q[1],K[B+2]=Q[2],K[B+3]=Q[3];return K}}();function B0(){var Q=new S(4);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q[3]=1,Q}function yK(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q}function t0(Q,K,Z){Z=Z*0.5;var $=Math.sin(Z);return Q[0]=$*K[0],Q[1]=$*K[1],Q[2]=$*K[2],Q[3]=Math.cos(Z),Q}function iK(Q,K){var Z=Math.acos(K[3])*2,$=Math.sin(Z/2);if($>j)Q[0]=K[0]/$,Q[1]=K[1]/$,Q[2]=K[2]/$;else Q[0]=1,Q[1]=0,Q[2]=0;return Z}function lK(Q,K){var Z=JQ(Q,K);return Math.acos(2*Z*Z-1)}function a0(Q,K,Z){var $=K[0],J=K[1],N=K[2],V=K[3],B=Z[0],F=Z[1],Y=Z[2],C=Z[3];return Q[0]=$*C+V*B+J*Y-N*F,Q[1]=J*C+V*F+N*B-$*Y,Q[2]=N*C+V*Y+$*F-J*B,Q[3]=V*C-$*B-J*F-N*Y,Q}function xK(Q,K,Z){Z*=0.5;var $=K[0],J=K[1],N=K[2],V=K[3],B=Math.sin(Z),F=Math.cos(Z);return Q[0]=$*F+V*B,Q[1]=J*F+N*B,Q[2]=N*F-J*B,Q[3]=V*F-$*B,Q}function cK(Q,K,Z){Z*=0.5;var $=K[0],J=K[1],N=K[2],V=K[3],B=Math.sin(Z),F=Math.cos(Z);return Q[0]=$*F-N*B,Q[1]=J*F+V*B,Q[2]=N*F+$*B,Q[3]=V*F-J*B,Q}function mK(Q,K,Z){Z*=0.5;var $=K[0],J=K[1],N=K[2],V=K[3],B=Math.sin(Z),F=Math.cos(Z);return Q[0]=$*F+J*B,Q[1]=J*F-$*B,Q[2]=N*F+V*B,Q[3]=V*F-N*B,Q}function sK(Q,K){var Z=K[0],$=K[1],J=K[2];return Q[0]=Z,Q[1]=$,Q[2]=J,Q[3]=Math.sqrt(Math.abs(1-Z*Z-$*$-J*J)),Q}function QQ(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[3],V=Math.sqrt(Z*Z+$*$+J*J),B=Math.exp(N),F=V>0?B*Math.sin(V)/V:0;return Q[0]=Z*F,Q[1]=$*F,Q[2]=J*F,Q[3]=B*Math.cos(V),Q}function KQ(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[3],V=Math.sqrt(Z*Z+$*$+J*J),B=V>0?Math.atan2(V,N)/V:0;return Q[0]=Z*B,Q[1]=$*B,Q[2]=J*B,Q[3]=0.5*Math.log(Z*Z+$*$+J*J+N*N),Q}function rK(Q,K,Z){return KQ(Q,K),$Q(Q,Q,Z),QQ(Q,Q),Q}function b(Q,K,Z,$){var J=K[0],N=K[1],V=K[2],B=K[3],F=Z[0],Y=Z[1],C=Z[2],P=Z[3],X,W,U,H,E;if(W=J*F+N*Y+V*C+B*P,W<0)W=-W,F=-F,Y=-Y,C=-C,P=-P;if(1-W>j)X=Math.acos(W),U=Math.sin(X),H=Math.sin((1-$)*X)/U,E=Math.sin($*X)/U;else H=1-$,E=$;return Q[0]=H*J+E*F,Q[1]=H*N+E*Y,Q[2]=H*V+E*C,Q[3]=H*B+E*P,Q}function eK(Q){var K=d(),Z=d(),$=d(),J=Math.sqrt(1-K),N=Math.sqrt(K);return Q[0]=J*Math.sin(2*Math.PI*Z),Q[1]=J*Math.cos(2*Math.PI*Z),Q[2]=N*Math.sin(2*Math.PI*$),Q[3]=N*Math.cos(2*Math.PI*$),Q}function bK(Q,K){var Z=K[0],$=K[1],J=K[2],N=K[3],V=Z*Z+$*$+J*J+N*N,B=V?1/V:0;return Q[0]=-Z*B,Q[1]=-$*B,Q[2]=-J*B,Q[3]=N*B,Q}function uK(Q,K){return Q[0]=-K[0],Q[1]=-K[1],Q[2]=-K[2],Q[3]=K[3],Q}function ZQ(Q,K){var Z=K[0]+K[4]+K[8],$;if(Z>0)$=Math.sqrt(Z+1),Q[3]=0.5*$,$=0.5/$,Q[0]=(K[5]-K[7])*$,Q[1]=(K[6]-K[2])*$,Q[2]=(K[1]-K[3])*$;else{var J=0;if(K[4]>K[0])J=1;if(K[8]>K[J*3+J])J=2;var N=(J+1)%3,V=(J+2)%3;$=Math.sqrt(K[J*3+J]-K[N*3+N]-K[V*3+V]+1),Q[J]=0.5*$,$=0.5/$,Q[3]=(K[N*3+V]-K[V*3+N])*$,Q[N]=(K[N*3+J]+K[J*3+N])*$,Q[V]=(K[V*3+J]+K[J*3+V])*$}return Q}function oK(Q,K,Z,$){var J=0.5*Math.PI/180;K*=J,Z*=J,$*=J;var N=Math.sin(K),V=Math.cos(K),B=Math.sin(Z),F=Math.cos(Z),Y=Math.sin($),C=Math.cos($);return Q[0]=N*F*C-V*B*Y,Q[1]=V*B*C+N*F*Y,Q[2]=V*F*Y-N*B*C,Q[3]=V*F*C+N*B*Y,Q}function tK(Q){return"quat("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+")"}var aK=d0,QZ=y0,KZ=i0,ZZ=l0,$Z=x0,JZ=a0,$Q=c0,JQ=e0,NZ=b0,NQ=m0,VZ=NQ,VQ=s0,BZ=VQ,F0=r0,FZ=u0,YZ=o0,CZ=function(){var Q=s(),K=r(1,0,0),Z=r(0,1,0);return function($,J,N){var V=e(J,N);if(V<-0.999999){if(c(Q,K,J),V0(Q)<0.000001)c(Q,Z,J);return N0(Q,Q),t0($,Q,Math.PI),$}else if(V>0.999999)return $[0]=0,$[1]=0,$[2]=0,$[3]=1,$;else return c(Q,J,N),$[0]=Q[0],$[1]=Q[1],$[2]=Q[2],$[3]=1+V,F0($,$)}}(),PZ=function(){var Q=B0(),K=B0();return function(Z,$,J,N,V,B){return b(Q,$,V,B),b(K,J,N,B),b(Z,Q,K,2*B*(1-B)),Z}}(),EZ=function(){var Q=h0();return function(K,Z,$,J){return Q[0]=$[0],Q[3]=$[1],Q[6]=$[2],Q[1]=J[0],Q[4]=J[1],Q[7]=J[2],Q[2]=-Z[0],Q[5]=-Z[1],Q[8]=-Z[2],F0(K,ZQ(K,Q))}}();var WZ=Math.PI/90;class Y0{matrix;constructor(){this.matrix=k.create()}static create(){return new Y0}translate(Q,K,Z){return k.translate(this.matrix,this.matrix,[Q,K,Z]),this}rotateX(Q){return k.rotateX(this.matrix,this.matrix,Q),this}rotateY(Q){return k.rotateY(this.matrix,this.matrix,Q),this}rotateZ(Q){return k.rotateZ(this.matrix,this.matrix,Q),this}scale(Q,K,Z){return k.scale(this.matrix,this.matrix,[Q,K,Z]),this}perspective(Q,K,Z,$){return k.perspective(this.matrix,Q*WZ,K,Z,$),this}ortho(Q,K,Z,$,J,N){return k.ortho(this.matrix,Q,K,Z,$,J,N),this}static aTemp=k.create();static bTemp=k.create();static combineMat4(Q,K,Z,$=0.5){k.multiplyScalar(this.aTemp,K,1-$),k.multiplyScalar(this.bTemp,Z,$),k.add(Q,this.aTemp,this.bTemp)}static tempQuat=m.create();static moveMatrix(Q,K,Z,$,J=null){const N=y.fromValues(-K,Z,$);if(J)k.getRotation(this.tempQuat,J),m.invert(this.tempQuat,this.tempQuat),y.transformQuat(N,N,this.tempQuat);k.translate(Q,Q,N)}getMatrix(){return this.matrix}}var z=Y0;class C0{gl;uniforms;cameraMatrix=z.create().translate(0,0,-1).getMatrix();perspectiveMatrix=z.create().getMatrix();orthoMatrix=z.create().getMatrix();projectionMatrix=z.create().getMatrix();perspectiveLevel=1;constructor(Q,K){this.gl=Q,this.uniforms=K}configPerspectiveMatrix(Q){this.perspectiveMatrix=z.create().perspective(45,Q,0.1,1000).getMatrix(),this.updatePerspective()}configOrthoMatrix(Q){this.orthoMatrix=z.create().ortho(-Q,Q,-1,1,-1000,1000).getMatrix(),this.updatePerspective()}camTiltMatrix=z.create().getMatrix();camTurnMatrix=z.create().getMatrix();camMatrix=k.create();refresh(){k.mul(this.camMatrix,this.camTiltMatrix,this.camTurnMatrix),k.mul(this.camMatrix,this.camMatrix,this.cameraMatrix);const Q=this.uniforms.getUniformLocation(O0);if(Q)this.gl.uniformMatrix4fv(Q,!1,this.camMatrix)}orthoTemp=k.create();perspectiveTemp=k.create();updatePerspective(Q){if(Q!==void 0)this.perspectiveLevel=Q;z.combineMat4(this.projectionMatrix,this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel);const K=this.uniforms.getUniformLocation(R0);if(K)this.gl.uniformMatrix4fv(K,!1,this.projectionMatrix);this.refresh()}moveCam(Q,K,Z){z.moveMatrix(this.cameraMatrix,Q,K,Z,this.camTurnMatrix),this.refresh()}turnCam(Q){k.rotateY(this.camTurnMatrix,this.camTurnMatrix,Q),this.refresh()}tilt(Q){k.rotateX(this.camTiltMatrix,this.camTiltMatrix,Q),this.refresh()}}class n extends v{texImgSrc;activated=!1;width;height;constructor(Q){super();this.texImgSrc=Q,this.width=Q instanceof HTMLImageElement?Q.naturalWidth:Q instanceof VideoFrame?Q.displayWidth:Q.width,this.height=Q instanceof HTMLImageElement?Q.naturalHeight:Q instanceof VideoFrame?Q.displayHeight:Q.width}static async loadImage(Q){return new Promise((K,Z)=>{const $=new Image,J=new n($),N=()=>K(J),V=(B)=>Z(B.error);$.addEventListener("error",V),$.addEventListener("load",N,{once:!0}),J.addOnDestroy(()=>$.removeEventListener("load",N)),$.src=Q})}static async loadVideo(Q,K){return new Promise((Z,$)=>{const J=document.createElement("video"),N=new n(J);if(J.loop=!0,K!==void 0)J.volume=K;const V=()=>J.play(),B=()=>Z(N);J.addEventListener("loadedmetadata",V),J.addEventListener("playing",B,{once:!0}),J.addEventListener("error",(F)=>$(F.error)),J.src=Q,N.addOnDestroy(()=>{J.pause(),J.removeEventListener("playing",B),J.removeEventListener("loadmetadata",V)})})}static async loadWebcam(Q){return new Promise((K,Z)=>{const $=document.createElement("video"),J=new n($);$.loop=!0;const N=()=>$.play(),V=()=>K(J);$.addEventListener("loadedmetadata",N),$.addEventListener("playing",V,{once:!0}),$.addEventListener("error",(F)=>Z(F.error));let B=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:Q}}).then((F)=>{if(!B)$.srcObject=F,J.addOnDestroy(()=>F.getTracks().forEach((Y)=>Y.stop()))}),J.addOnDestroy(()=>{B=!0,$.pause(),$.removeEventListener("playing",V),$.removeEventListener("loadmetadata",N)})})}}class P0 extends v{constructor(){super(...arguments)}images={};hasImageId(Q){return!!this.images[Q]}getMedia(Q){return this.images[Q]}async drawImage(Q,K){const Z=new OffscreenCanvas(1,1);K(Z.getContext("2d"));const $=new n(Z);return this.images[Q]=this.own($),$}async loadCanvas(Q,K){const Z=new n(K);return K.getContext("2d"),this.images[Q]=this.own(Z),Z}async loadImage(Q,K){const Z=await n.loadImage(K);return this.images[Q]=this.own(Z),Z}async loadVideo(Q,K,Z){const $=await n.loadVideo(K,Z);return this.images[Q]=this.own($),$}async loadWebCam(Q,K){const Z=await n.loadWebcam(K);return this.images[Q]=this.own(Z),Z}}var UZ=function(Q){if(!HZ)return Q;return new Proxy(Q,{get(Z,$){const J=Z,N=J[$];if(typeof N==="function")return(...B)=>{const F=N.apply(J,B);return console.log(`gl.${String($)}(`,B,") = ",F),F};else return console.log(`gl.${String($)} = `,N),N}})},XZ={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},HZ=!1;class E0 extends v{gl;programs;attributeBuffers;uniforms;canvas;textureManager;imageManager;camera;constructor(Q,K){super();this.gl=UZ(Q.getContext("webgl2",{...XZ,...K})),this.canvas=Q,this.programs=this.own(new t(this.gl)),this.uniforms=this.own(new K0(this.gl,this.programs)),this.attributeBuffers=this.own(new Q0(this.gl,this.programs)),this.textureManager=new $0(this.gl),this.imageManager=new P0,this.camera=new C0(this.gl,this.uniforms),window.addEventListener("resize",this.checkCanvasSize.bind(this))}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const Q=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configOrthoMatrix(Q),this.camera.configPerspectiveMatrix(Q)}async initialize(){const K={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",J0(T0,K),J0(j0,K)),this.programs.useProgram("main"),this.gl.enable(A.DEPTH_TEST),this.gl.depthFunc(A.LESS),this.gl.enable(A.BLEND),this.gl.blendFunc(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const Z=H0;this.attributeBuffers.createBuffer(Z);const $=this.attributeBuffers.getAttributeBuffer(Z);this.attributeBuffers.bindBuffer(A.ELEMENT_ARRAY_BUFFER,$),this.attributeBuffers.bufferData(A.ELEMENT_ARRAY_BUFFER,Z,Uint16Array.from([0,1,2,2,3,0]),0,A.STATIC_DRAW)}{const Z=Z0;this.attributeBuffers.createBuffer(Z);const $=this.attributeBuffers.getAttributeBuffer(Z);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,$),this.gl.vertexAttribPointer($.location,2,A.FLOAT,!1,0,0),this.gl.enableVertexAttribArray($.location),this.attributeBuffers.bufferData(A.ARRAY_BUFFER,Z,Float32Array.from([-1,-1,1,-1,1,1,-1,1]),0,A.STATIC_DRAW)}{const Z=U0;this.attributeBuffers.createBuffer(Z);const $=this.attributeBuffers.getAttributeBuffer(Z);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,$);for(let J=0;J<4;J++){const N=$.location+J;this.gl.vertexAttribPointer(N,4,A.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,J*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(N),this.gl.vertexAttribDivisor(N,1)}this.attributeBuffers.bufferData(A.ARRAY_BUFFER,Z,Float32Array.from([...z.create().translate(0,0,-1).getMatrix(),...z.create().translate(-1,0,0).rotateY(Math.PI/2).getMatrix(),...z.create().translate(1,0,0).rotateY(-Math.PI/2).getMatrix(),...z.create().translate(0,-1,0).rotateX(-Math.PI/2).getMatrix()]),0,A.DYNAMIC_DRAW)}{const Z=D0;this.attributeBuffers.createBuffer(Z);const $=this.attributeBuffers.getAttributeBuffer(Z);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,$),this.gl.vertexAttribPointer($.location,2,A.FLOAT,!1,0,0),this.gl.enableVertexAttribArray($.location),this.attributeBuffers.bufferData(A.ARRAY_BUFFER,Z,Float32Array.from([0,1,1,1,1,0,0,0]),0,A.STATIC_DRAW)}await this.loadLogoTexture(),this.checkCanvasSize(),this.camera.refresh()}async loadLogoTexture(){{const Z=A0;this.attributeBuffers.createBuffer(Z);const $=this.attributeBuffers.getAttributeBuffer(Z);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,$);const J=$.location;this.gl.vertexAttribPointer(J,2,A.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(J),this.gl.vertexAttribDivisor(J,1),this.attributeBuffers.bufferData(A.ARRAY_BUFFER,Z,Float32Array.from([512,512,512,512,512,512,512,512]),0,A.DYNAMIC_DRAW)}await this.imageManager.drawImage("logo",(Z)=>{const{canvas:$}=Z;$.width=2048,$.height=2048,Z.imageSmoothingEnabled=!0,Z.fillStyle="#ddd",Z.lineWidth=$.width/50,Z.fillRect(0,0,$.width,$.height),Z.strokeStyle="black",Z.fillStyle="gold",Z.beginPath(),Z.arc($.width/2,$.height/2,$.width/2*0.8,0,2*Math.PI),Z.fill(),Z.stroke(),Z.beginPath(),Z.arc($.width/2,$.height/2,$.width/2*0.5,0,Math.PI),Z.stroke(),Z.beginPath(),Z.arc($.width/3,$.height/3,$.width/2*0.1,0,Math.PI,!0),Z.stroke(),Z.beginPath(),Z.arc($.width/3*2,$.height/3,$.width/2*0.1,0,Math.PI*2,!0),Z.stroke()}),this.textureManager.assignImageToTexture(this.imageManager.getMedia("logo"),"TEXTURE0",[0,0,2048,2048],[0,0,512,512]),this.textureManager.generateMipMap("TEXTURE0")}updateTrianglePosition(Q,K){const Z=this.attributeBuffers.getAttributeBuffer(Z0);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,Z),this.attributeBuffers.bufferSubData(A.ARRAY_BUFFER,Float32Array.from(K),Q*4*3*Float32Array.BYTES_PER_ELEMENT)}drawArrays(Q){this.gl.drawArrays(A.TRIANGLES,0,Q)}drawElementsInstanced(Q,K){this.gl.drawElementsInstanced(A.TRIANGLES,Q,A.UNSIGNED_SHORT,0,K)}refresh(){this.gl.clearDepth(1),this.gl.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT);const Q=6,K=4;this.drawElementsInstanced(Q,K)}bindVertexArray(){return this.own(new a(this.gl))}}async function W$(){console.log("Hello World!")}function X$(Q){Q.style.border="2px solid silver",Q.style.cursor="grab",Q.addEventListener("mouseenter",()=>{Q.style.borderColor="black"}),Q.addEventListener("mouseleave",()=>{Q.style.borderColor="silver"});const K=new E0(Q);K.initialize();const Z={};document.addEventListener("keydown",(J)=>{Z[J.code]=!0,console.log(Z)}),document.addEventListener("keyup",(J)=>{Z[J.code]=!1});function $(){K.gl.enable(K.gl.DEPTH_TEST);const J=0.25,N=0.05;if(Z.KeyW)K.camera.moveCam(0,0,J);if(Z.KeyS)K.camera.moveCam(0,0,-J);if(Z.ArrowUp&&!Z.ShiftRight)K.camera.moveCam(0,-J,0);if(Z.ArrowDown&&!Z.ShiftRight)K.camera.moveCam(0,J,0);if(Z.KeyA||Z.ArrowLeft&&!Z.ShiftRight)K.camera.moveCam(-J,0,0);if(Z.KeyD||Z.ArrowRight&&!Z.ShiftRight)K.camera.moveCam(J,0,0);if(Z.KeyQ||Z.ArrowLeft&&Z.ShiftRight)K.camera.turnCam(-N);if(Z.KeyE||Z.ArrowRight&&Z.ShiftRight)K.camera.turnCam(N);if(Z.ArrowUp&&Z.ShiftRight)K.camera.tilt(-N);if(Z.ArrowDown&&Z.ShiftRight)K.camera.tilt(N);K.refresh(),requestAnimationFrame($)}return $(),K}export{X$ as testCanvas,W$ as hello};

//# debugId=CA7D7882AB15454164756e2164756e21
