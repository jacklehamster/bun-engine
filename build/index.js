var LK=Object.defineProperty;var F0=(K,Q)=>{for(var $ in Q)LK(K,$,{get:Q[$],enumerable:!0,configurable:!0,set:(Z)=>Q[$]=()=>Z})};var N=0.000001,q=typeof Float32Array!=="undefined"?Float32Array:Array,l=Math.random,m$=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var K=0,Q=arguments.length;while(Q--)K+=arguments[Q]*arguments[Q];return Math.sqrt(K)};function I0(){var K=new q(9);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0;return K[0]=1,K[4]=1,K[8]=1,K}var k={};F0(k,{transpose:()=>{{return gK}},translate:()=>{{return cK}},targetTo:()=>{{return XQ}},subtract:()=>{{return y0}},sub:()=>{{return AQ}},str:()=>{{return CQ}},set:()=>{{return pK}},scale:()=>{{return xK}},rotateZ:()=>{{return iK}},rotateY:()=>{{return dK}},rotateX:()=>{{return mK}},rotate:()=>{{return lK}},perspectiveZO:()=>{{return VQ}},perspectiveNO:()=>{{return z0}},perspectiveFromFieldOfView:()=>{{return YQ}},perspective:()=>{{return JQ}},orthoZO:()=>{{return PQ}},orthoNO:()=>{{return f0}},ortho:()=>{{return BQ}},multiplyScalarAndAdd:()=>{{return UQ}},multiplyScalar:()=>{{return WQ}},multiply:()=>{{return v0}},mul:()=>{{return jQ}},lookAt:()=>{{return FQ}},invert:()=>{{return zK}},identity:()=>{{return w0}},getTranslation:()=>{{return aK}},getScaling:()=>{{return g0}},getRotation:()=>{{return tK}},frustum:()=>{{return ZQ}},fromZRotation:()=>{{return uK}},fromYRotation:()=>{{return eK}},fromXRotation:()=>{{return bK}},fromValues:()=>{{return vK}},fromTranslation:()=>{{return nK}},fromScaling:()=>{{return sK}},fromRotationTranslationScaleOrigin:()=>{{return QQ}},fromRotationTranslationScale:()=>{{return KQ}},fromRotationTranslation:()=>{{return p0}},fromRotation:()=>{{return rK}},fromQuat2:()=>{{return oK}},fromQuat:()=>{{return $Q}},frob:()=>{{return HQ}},exactEquals:()=>{{return DQ}},equals:()=>{{return EQ}},determinant:()=>{{return yK}},create:()=>{{return hK}},copy:()=>{{return wK}},clone:()=>{{return IK}},adjoint:()=>{{return fK}},add:()=>{{return OQ}}});function hK(){var K=new q(16);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0;return K[0]=1,K[5]=1,K[10]=1,K[15]=1,K}function IK(K){var Q=new q(16);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function wK(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function vK(K,Q,$,Z,J,V,Y,B,P,F,X,C,W,O,D,U){var H=new q(16);return H[0]=K,H[1]=Q,H[2]=$,H[3]=Z,H[4]=J,H[5]=V,H[6]=Y,H[7]=B,H[8]=P,H[9]=F,H[10]=X,H[11]=C,H[12]=W,H[13]=O,H[14]=D,H[15]=U,H}function pK(K,Q,$,Z,J,V,Y,B,P,F,X,C,W,O,D,U,H){return K[0]=Q,K[1]=$,K[2]=Z,K[3]=J,K[4]=V,K[5]=Y,K[6]=B,K[7]=P,K[8]=F,K[9]=X,K[10]=C,K[11]=W,K[12]=O,K[13]=D,K[14]=U,K[15]=H,K}function w0(K){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function gK(K,Q){if(K===Q){var $=Q[1],Z=Q[2],J=Q[3],V=Q[6],Y=Q[7],B=Q[11];K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=$,K[6]=Q[9],K[7]=Q[13],K[8]=Z,K[9]=V,K[11]=Q[14],K[12]=J,K[13]=Y,K[14]=B}else K[0]=Q[0],K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=Q[1],K[5]=Q[5],K[6]=Q[9],K[7]=Q[13],K[8]=Q[2],K[9]=Q[6],K[10]=Q[10],K[11]=Q[14],K[12]=Q[3],K[13]=Q[7],K[14]=Q[11],K[15]=Q[15];return K}function zK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Q[4],B=Q[5],P=Q[6],F=Q[7],X=Q[8],C=Q[9],W=Q[10],O=Q[11],D=Q[12],U=Q[13],H=Q[14],E=Q[15],G=$*B-Z*Y,M=$*P-J*Y,R=$*F-V*Y,A=Z*P-J*B,_=Z*F-V*B,w=J*F-V*P,S=X*U-C*D,h=X*H-W*D,I=X*E-O*D,v=C*H-W*U,p=C*E-O*U,z=W*E-O*H,T=G*z-M*p+R*v+A*I-_*h+w*S;if(!T)return null;return T=1/T,K[0]=(B*z-P*p+F*v)*T,K[1]=(J*p-Z*z-V*v)*T,K[2]=(U*w-H*_+E*A)*T,K[3]=(W*_-C*w-O*A)*T,K[4]=(P*I-Y*z-F*h)*T,K[5]=($*z-J*I+V*h)*T,K[6]=(H*R-D*w-E*M)*T,K[7]=(X*w-W*R+O*M)*T,K[8]=(Y*p-B*I+F*S)*T,K[9]=(Z*I-$*p-V*S)*T,K[10]=(D*_-U*R+E*G)*T,K[11]=(C*R-X*_-O*G)*T,K[12]=(B*h-Y*v-P*S)*T,K[13]=($*v-Z*h+J*S)*T,K[14]=(U*M-D*A-H*G)*T,K[15]=(X*A-C*M+W*G)*T,K}function fK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Q[4],B=Q[5],P=Q[6],F=Q[7],X=Q[8],C=Q[9],W=Q[10],O=Q[11],D=Q[12],U=Q[13],H=Q[14],E=Q[15];return K[0]=B*(W*E-O*H)-C*(P*E-F*H)+U*(P*O-F*W),K[1]=-(Z*(W*E-O*H)-C*(J*E-V*H)+U*(J*O-V*W)),K[2]=Z*(P*E-F*H)-B*(J*E-V*H)+U*(J*F-V*P),K[3]=-(Z*(P*O-F*W)-B*(J*O-V*W)+C*(J*F-V*P)),K[4]=-(Y*(W*E-O*H)-X*(P*E-F*H)+D*(P*O-F*W)),K[5]=$*(W*E-O*H)-X*(J*E-V*H)+D*(J*O-V*W),K[6]=-($*(P*E-F*H)-Y*(J*E-V*H)+D*(J*F-V*P)),K[7]=$*(P*O-F*W)-Y*(J*O-V*W)+X*(J*F-V*P),K[8]=Y*(C*E-O*U)-X*(B*E-F*U)+D*(B*O-F*C),K[9]=-($*(C*E-O*U)-X*(Z*E-V*U)+D*(Z*O-V*C)),K[10]=$*(B*E-F*U)-Y*(Z*E-V*U)+D*(Z*F-V*B),K[11]=-($*(B*O-F*C)-Y*(Z*O-V*C)+X*(Z*F-V*B)),K[12]=-(Y*(C*H-W*U)-X*(B*H-P*U)+D*(B*W-P*C)),K[13]=$*(C*H-W*U)-X*(Z*H-J*U)+D*(Z*W-J*C),K[14]=-($*(B*H-P*U)-Y*(Z*H-J*U)+D*(Z*P-J*B)),K[15]=$*(B*W-P*C)-Y*(Z*W-J*C)+X*(Z*P-J*B),K}function yK(K){var Q=K[0],$=K[1],Z=K[2],J=K[3],V=K[4],Y=K[5],B=K[6],P=K[7],F=K[8],X=K[9],C=K[10],W=K[11],O=K[12],D=K[13],U=K[14],H=K[15],E=Q*Y-$*V,G=Q*B-Z*V,M=Q*P-J*V,R=$*B-Z*Y,A=$*P-J*Y,_=Z*P-J*B,w=F*D-X*O,S=F*U-C*O,h=F*H-W*O,I=X*U-C*D,v=X*H-W*D,p=C*H-W*U;return E*p-G*v+M*I+R*h-A*S+_*w}function v0(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Q[4],P=Q[5],F=Q[6],X=Q[7],C=Q[8],W=Q[9],O=Q[10],D=Q[11],U=Q[12],H=Q[13],E=Q[14],G=Q[15],M=$[0],R=$[1],A=$[2],_=$[3];return K[0]=M*Z+R*B+A*C+_*U,K[1]=M*J+R*P+A*W+_*H,K[2]=M*V+R*F+A*O+_*E,K[3]=M*Y+R*X+A*D+_*G,M=$[4],R=$[5],A=$[6],_=$[7],K[4]=M*Z+R*B+A*C+_*U,K[5]=M*J+R*P+A*W+_*H,K[6]=M*V+R*F+A*O+_*E,K[7]=M*Y+R*X+A*D+_*G,M=$[8],R=$[9],A=$[10],_=$[11],K[8]=M*Z+R*B+A*C+_*U,K[9]=M*J+R*P+A*W+_*H,K[10]=M*V+R*F+A*O+_*E,K[11]=M*Y+R*X+A*D+_*G,M=$[12],R=$[13],A=$[14],_=$[15],K[12]=M*Z+R*B+A*C+_*U,K[13]=M*J+R*P+A*W+_*H,K[14]=M*V+R*F+A*O+_*E,K[15]=M*Y+R*X+A*D+_*G,K}function cK(K,Q,$){var Z=$[0],J=$[1],V=$[2],Y,B,P,F,X,C,W,O,D,U,H,E;if(Q===K)K[12]=Q[0]*Z+Q[4]*J+Q[8]*V+Q[12],K[13]=Q[1]*Z+Q[5]*J+Q[9]*V+Q[13],K[14]=Q[2]*Z+Q[6]*J+Q[10]*V+Q[14],K[15]=Q[3]*Z+Q[7]*J+Q[11]*V+Q[15];else Y=Q[0],B=Q[1],P=Q[2],F=Q[3],X=Q[4],C=Q[5],W=Q[6],O=Q[7],D=Q[8],U=Q[9],H=Q[10],E=Q[11],K[0]=Y,K[1]=B,K[2]=P,K[3]=F,K[4]=X,K[5]=C,K[6]=W,K[7]=O,K[8]=D,K[9]=U,K[10]=H,K[11]=E,K[12]=Y*Z+X*J+D*V+Q[12],K[13]=B*Z+C*J+U*V+Q[13],K[14]=P*Z+W*J+H*V+Q[14],K[15]=F*Z+O*J+E*V+Q[15];return K}function xK(K,Q,$){var Z=$[0],J=$[1],V=$[2];return K[0]=Q[0]*Z,K[1]=Q[1]*Z,K[2]=Q[2]*Z,K[3]=Q[3]*Z,K[4]=Q[4]*J,K[5]=Q[5]*J,K[6]=Q[6]*J,K[7]=Q[7]*J,K[8]=Q[8]*V,K[9]=Q[9]*V,K[10]=Q[10]*V,K[11]=Q[11]*V,K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function lK(K,Q,$,Z){var J=Z[0],V=Z[1],Y=Z[2],B=Math.hypot(J,V,Y),P,F,X,C,W,O,D,U,H,E,G,M,R,A,_,w,S,h,I,v,p,z,T,f;if(B<N)return null;if(B=1/B,J*=B,V*=B,Y*=B,P=Math.sin($),F=Math.cos($),X=1-F,C=Q[0],W=Q[1],O=Q[2],D=Q[3],U=Q[4],H=Q[5],E=Q[6],G=Q[7],M=Q[8],R=Q[9],A=Q[10],_=Q[11],w=J*J*X+F,S=V*J*X+Y*P,h=Y*J*X-V*P,I=J*V*X-Y*P,v=V*V*X+F,p=Y*V*X+J*P,z=J*Y*X+V*P,T=V*Y*X-J*P,f=Y*Y*X+F,K[0]=C*w+U*S+M*h,K[1]=W*w+H*S+R*h,K[2]=O*w+E*S+A*h,K[3]=D*w+G*S+_*h,K[4]=C*I+U*v+M*p,K[5]=W*I+H*v+R*p,K[6]=O*I+E*v+A*p,K[7]=D*I+G*v+_*p,K[8]=C*z+U*T+M*f,K[9]=W*z+H*T+R*f,K[10]=O*z+E*T+A*f,K[11]=D*z+G*T+_*f,Q!==K)K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K}function mK(K,Q,$){var Z=Math.sin($),J=Math.cos($),V=Q[4],Y=Q[5],B=Q[6],P=Q[7],F=Q[8],X=Q[9],C=Q[10],W=Q[11];if(Q!==K)K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[4]=V*J+F*Z,K[5]=Y*J+X*Z,K[6]=B*J+C*Z,K[7]=P*J+W*Z,K[8]=F*J-V*Z,K[9]=X*J-Y*Z,K[10]=C*J-B*Z,K[11]=W*J-P*Z,K}function dK(K,Q,$){var Z=Math.sin($),J=Math.cos($),V=Q[0],Y=Q[1],B=Q[2],P=Q[3],F=Q[8],X=Q[9],C=Q[10],W=Q[11];if(Q!==K)K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=V*J-F*Z,K[1]=Y*J-X*Z,K[2]=B*J-C*Z,K[3]=P*J-W*Z,K[8]=V*Z+F*J,K[9]=Y*Z+X*J,K[10]=B*Z+C*J,K[11]=P*Z+W*J,K}function iK(K,Q,$){var Z=Math.sin($),J=Math.cos($),V=Q[0],Y=Q[1],B=Q[2],P=Q[3],F=Q[4],X=Q[5],C=Q[6],W=Q[7];if(Q!==K)K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=V*J+F*Z,K[1]=Y*J+X*Z,K[2]=B*J+C*Z,K[3]=P*J+W*Z,K[4]=F*J-V*Z,K[5]=X*J-Y*Z,K[6]=C*J-B*Z,K[7]=W*J-P*Z,K}function nK(K,Q){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=Q[0],K[13]=Q[1],K[14]=Q[2],K[15]=1,K}function sK(K,Q){return K[0]=Q[0],K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Q[1],K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=Q[2],K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function rK(K,Q,$){var Z=$[0],J=$[1],V=$[2],Y=Math.hypot(Z,J,V),B,P,F;if(Y<N)return null;return Y=1/Y,Z*=Y,J*=Y,V*=Y,B=Math.sin(Q),P=Math.cos(Q),F=1-P,K[0]=Z*Z*F+P,K[1]=J*Z*F+V*B,K[2]=V*Z*F-J*B,K[3]=0,K[4]=Z*J*F-V*B,K[5]=J*J*F+P,K[6]=V*J*F+Z*B,K[7]=0,K[8]=Z*V*F+J*B,K[9]=J*V*F-Z*B,K[10]=V*V*F+P,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function bK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Z,K[6]=$,K[7]=0,K[8]=0,K[9]=-$,K[10]=Z,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function eK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=Z,K[1]=0,K[2]=-$,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=$,K[9]=0,K[10]=Z,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function uK(K,Q){var $=Math.sin(Q),Z=Math.cos(Q);return K[0]=Z,K[1]=$,K[2]=0,K[3]=0,K[4]=-$,K[5]=Z,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function p0(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Z+Z,P=J+J,F=V+V,X=Z*B,C=Z*P,W=Z*F,O=J*P,D=J*F,U=V*F,H=Y*B,E=Y*P,G=Y*F;return K[0]=1-(O+U),K[1]=C+G,K[2]=W-E,K[3]=0,K[4]=C-G,K[5]=1-(X+U),K[6]=D+H,K[7]=0,K[8]=W+E,K[9]=D-H,K[10]=1-(X+O),K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function oK(K,Q){var $=new q(3),Z=-Q[0],J=-Q[1],V=-Q[2],Y=Q[3],B=Q[4],P=Q[5],F=Q[6],X=Q[7],C=Z*Z+J*J+V*V+Y*Y;if(C>0)$[0]=(B*Y+X*Z+P*V-F*J)*2/C,$[1]=(P*Y+X*J+F*Z-B*V)*2/C,$[2]=(F*Y+X*V+B*J-P*Z)*2/C;else $[0]=(B*Y+X*Z+P*V-F*J)*2,$[1]=(P*Y+X*J+F*Z-B*V)*2,$[2]=(F*Y+X*V+B*J-P*Z)*2;return p0(K,Q,$),K}function aK(K,Q){return K[0]=Q[12],K[1]=Q[13],K[2]=Q[14],K}function g0(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[4],Y=Q[5],B=Q[6],P=Q[8],F=Q[9],X=Q[10];return K[0]=Math.hypot($,Z,J),K[1]=Math.hypot(V,Y,B),K[2]=Math.hypot(P,F,X),K}function tK(K,Q){var $=new q(3);g0($,Q);var Z=1/$[0],J=1/$[1],V=1/$[2],Y=Q[0]*Z,B=Q[1]*J,P=Q[2]*V,F=Q[4]*Z,X=Q[5]*J,C=Q[6]*V,W=Q[8]*Z,O=Q[9]*J,D=Q[10]*V,U=Y+X+D,H=0;if(U>0)H=Math.sqrt(U+1)*2,K[3]=0.25*H,K[0]=(C-O)/H,K[1]=(W-P)/H,K[2]=(B-F)/H;else if(Y>X&&Y>D)H=Math.sqrt(1+Y-X-D)*2,K[3]=(C-O)/H,K[0]=0.25*H,K[1]=(B+F)/H,K[2]=(W+P)/H;else if(X>D)H=Math.sqrt(1+X-Y-D)*2,K[3]=(W-P)/H,K[0]=(B+F)/H,K[1]=0.25*H,K[2]=(C+O)/H;else H=Math.sqrt(1+D-Y-X)*2,K[3]=(B-F)/H,K[0]=(W+P)/H,K[1]=(C+O)/H,K[2]=0.25*H;return K}function KQ(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Q[3],P=J+J,F=V+V,X=Y+Y,C=J*P,W=J*F,O=J*X,D=V*F,U=V*X,H=Y*X,E=B*P,G=B*F,M=B*X,R=Z[0],A=Z[1],_=Z[2];return K[0]=(1-(D+H))*R,K[1]=(W+M)*R,K[2]=(O-G)*R,K[3]=0,K[4]=(W-M)*A,K[5]=(1-(C+H))*A,K[6]=(U+E)*A,K[7]=0,K[8]=(O+G)*_,K[9]=(U-E)*_,K[10]=(1-(C+D))*_,K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function QQ(K,Q,$,Z,J){var V=Q[0],Y=Q[1],B=Q[2],P=Q[3],F=V+V,X=Y+Y,C=B+B,W=V*F,O=V*X,D=V*C,U=Y*X,H=Y*C,E=B*C,G=P*F,M=P*X,R=P*C,A=Z[0],_=Z[1],w=Z[2],S=J[0],h=J[1],I=J[2],v=(1-(U+E))*A,p=(O+R)*A,z=(D-M)*A,T=(O-R)*_,f=(1-(W+E))*_,n=(H+G)*_,s=(D+M)*w,S0=(H-G)*w,h0=(1-(W+U))*w;return K[0]=v,K[1]=p,K[2]=z,K[3]=0,K[4]=T,K[5]=f,K[6]=n,K[7]=0,K[8]=s,K[9]=S0,K[10]=h0,K[11]=0,K[12]=$[0]+S-(v*S+T*h+s*I),K[13]=$[1]+h-(p*S+f*h+S0*I),K[14]=$[2]+I-(z*S+n*h+h0*I),K[15]=1,K}function $Q(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=$+$,B=Z+Z,P=J+J,F=$*Y,X=Z*Y,C=Z*B,W=J*Y,O=J*B,D=J*P,U=V*Y,H=V*B,E=V*P;return K[0]=1-C-D,K[1]=X+E,K[2]=W-H,K[3]=0,K[4]=X-E,K[5]=1-F-D,K[6]=O+U,K[7]=0,K[8]=W+H,K[9]=O-U,K[10]=1-F-C,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function ZQ(K,Q,$,Z,J,V,Y){var B=1/($-Q),P=1/(J-Z),F=1/(V-Y);return K[0]=V*2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=V*2*P,K[6]=0,K[7]=0,K[8]=($+Q)*B,K[9]=(J+Z)*P,K[10]=(Y+V)*F,K[11]=-1,K[12]=0,K[13]=0,K[14]=Y*V*2*F,K[15]=0,K}function z0(K,Q,$,Z,J){var V=1/Math.tan(Q/2),Y;if(K[0]=V/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=V,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,J!=null&&J!==Infinity)Y=1/(Z-J),K[10]=(J+Z)*Y,K[14]=2*J*Z*Y;else K[10]=-1,K[14]=-2*Z;return K}function VQ(K,Q,$,Z,J){var V=1/Math.tan(Q/2),Y;if(K[0]=V/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=V,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,J!=null&&J!==Infinity)Y=1/(Z-J),K[10]=J*Y,K[14]=J*Z*Y;else K[10]=-1,K[14]=-Z;return K}function YQ(K,Q,$,Z){var J=Math.tan(Q.upDegrees*Math.PI/180),V=Math.tan(Q.downDegrees*Math.PI/180),Y=Math.tan(Q.leftDegrees*Math.PI/180),B=Math.tan(Q.rightDegrees*Math.PI/180),P=2/(Y+B),F=2/(J+V);return K[0]=P,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=F,K[6]=0,K[7]=0,K[8]=-((Y-B)*P*0.5),K[9]=(J-V)*F*0.5,K[10]=Z/($-Z),K[11]=-1,K[12]=0,K[13]=0,K[14]=Z*$/($-Z),K[15]=0,K}function f0(K,Q,$,Z,J,V,Y){var B=1/(Q-$),P=1/(Z-J),F=1/(V-Y);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*P,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=2*F,K[11]=0,K[12]=(Q+$)*B,K[13]=(J+Z)*P,K[14]=(Y+V)*F,K[15]=1,K}function PQ(K,Q,$,Z,J,V,Y){var B=1/(Q-$),P=1/(Z-J),F=1/(V-Y);return K[0]=-2*B,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*P,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=F,K[11]=0,K[12]=(Q+$)*B,K[13]=(J+Z)*P,K[14]=V*F,K[15]=1,K}function FQ(K,Q,$,Z){var J,V,Y,B,P,F,X,C,W,O,D=Q[0],U=Q[1],H=Q[2],E=Z[0],G=Z[1],M=Z[2],R=$[0],A=$[1],_=$[2];if(Math.abs(D-R)<N&&Math.abs(U-A)<N&&Math.abs(H-_)<N)return w0(K);if(X=D-R,C=U-A,W=H-_,O=1/Math.hypot(X,C,W),X*=O,C*=O,W*=O,J=G*W-M*C,V=M*X-E*W,Y=E*C-G*X,O=Math.hypot(J,V,Y),!O)J=0,V=0,Y=0;else O=1/O,J*=O,V*=O,Y*=O;if(B=C*Y-W*V,P=W*J-X*Y,F=X*V-C*J,O=Math.hypot(B,P,F),!O)B=0,P=0,F=0;else O=1/O,B*=O,P*=O,F*=O;return K[0]=J,K[1]=B,K[2]=X,K[3]=0,K[4]=V,K[5]=P,K[6]=C,K[7]=0,K[8]=Y,K[9]=F,K[10]=W,K[11]=0,K[12]=-(J*D+V*U+Y*H),K[13]=-(B*D+P*U+F*H),K[14]=-(X*D+C*U+W*H),K[15]=1,K}function XQ(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Z[0],P=Z[1],F=Z[2],X=J-$[0],C=V-$[1],W=Y-$[2],O=X*X+C*C+W*W;if(O>0)O=1/Math.sqrt(O),X*=O,C*=O,W*=O;var D=P*W-F*C,U=F*X-B*W,H=B*C-P*X;if(O=D*D+U*U+H*H,O>0)O=1/Math.sqrt(O),D*=O,U*=O,H*=O;return K[0]=D,K[1]=U,K[2]=H,K[3]=0,K[4]=C*H-W*U,K[5]=W*D-X*H,K[6]=X*U-C*D,K[7]=0,K[8]=X,K[9]=C,K[10]=W,K[11]=0,K[12]=J,K[13]=V,K[14]=Y,K[15]=1,K}function CQ(K){return"mat4("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+", "+K[4]+", "+K[5]+", "+K[6]+", "+K[7]+", "+K[8]+", "+K[9]+", "+K[10]+", "+K[11]+", "+K[12]+", "+K[13]+", "+K[14]+", "+K[15]+")"}function HQ(K){return Math.hypot(K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12],K[13],K[14],K[15])}function OQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K[4]=Q[4]+$[4],K[5]=Q[5]+$[5],K[6]=Q[6]+$[6],K[7]=Q[7]+$[7],K[8]=Q[8]+$[8],K[9]=Q[9]+$[9],K[10]=Q[10]+$[10],K[11]=Q[11]+$[11],K[12]=Q[12]+$[12],K[13]=Q[13]+$[13],K[14]=Q[14]+$[14],K[15]=Q[15]+$[15],K}function y0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K[3]=Q[3]-$[3],K[4]=Q[4]-$[4],K[5]=Q[5]-$[5],K[6]=Q[6]-$[6],K[7]=Q[7]-$[7],K[8]=Q[8]-$[8],K[9]=Q[9]-$[9],K[10]=Q[10]-$[10],K[11]=Q[11]-$[11],K[12]=Q[12]-$[12],K[13]=Q[13]-$[13],K[14]=Q[14]-$[14],K[15]=Q[15]-$[15],K}function WQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K[4]=Q[4]*$,K[5]=Q[5]*$,K[6]=Q[6]*$,K[7]=Q[7]*$,K[8]=Q[8]*$,K[9]=Q[9]*$,K[10]=Q[10]*$,K[11]=Q[11]*$,K[12]=Q[12]*$,K[13]=Q[13]*$,K[14]=Q[14]*$,K[15]=Q[15]*$,K}function UQ(K,Q,$,Z){return K[0]=Q[0]+$[0]*Z,K[1]=Q[1]+$[1]*Z,K[2]=Q[2]+$[2]*Z,K[3]=Q[3]+$[3]*Z,K[4]=Q[4]+$[4]*Z,K[5]=Q[5]+$[5]*Z,K[6]=Q[6]+$[6]*Z,K[7]=Q[7]+$[7]*Z,K[8]=Q[8]+$[8]*Z,K[9]=Q[9]+$[9]*Z,K[10]=Q[10]+$[10]*Z,K[11]=Q[11]+$[11]*Z,K[12]=Q[12]+$[12]*Z,K[13]=Q[13]+$[13]*Z,K[14]=Q[14]+$[14]*Z,K[15]=Q[15]+$[15]*Z,K}function DQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]&&K[4]===Q[4]&&K[5]===Q[5]&&K[6]===Q[6]&&K[7]===Q[7]&&K[8]===Q[8]&&K[9]===Q[9]&&K[10]===Q[10]&&K[11]===Q[11]&&K[12]===Q[12]&&K[13]===Q[13]&&K[14]===Q[14]&&K[15]===Q[15]}function EQ(K,Q){var $=K[0],Z=K[1],J=K[2],V=K[3],Y=K[4],B=K[5],P=K[6],F=K[7],X=K[8],C=K[9],W=K[10],O=K[11],D=K[12],U=K[13],H=K[14],E=K[15],G=Q[0],M=Q[1],R=Q[2],A=Q[3],_=Q[4],w=Q[5],S=Q[6],h=Q[7],I=Q[8],v=Q[9],p=Q[10],z=Q[11],T=Q[12],f=Q[13],n=Q[14],s=Q[15];return Math.abs($-G)<=N*Math.max(1,Math.abs($),Math.abs(G))&&Math.abs(Z-M)<=N*Math.max(1,Math.abs(Z),Math.abs(M))&&Math.abs(J-R)<=N*Math.max(1,Math.abs(J),Math.abs(R))&&Math.abs(V-A)<=N*Math.max(1,Math.abs(V),Math.abs(A))&&Math.abs(Y-_)<=N*Math.max(1,Math.abs(Y),Math.abs(_))&&Math.abs(B-w)<=N*Math.max(1,Math.abs(B),Math.abs(w))&&Math.abs(P-S)<=N*Math.max(1,Math.abs(P),Math.abs(S))&&Math.abs(F-h)<=N*Math.max(1,Math.abs(F),Math.abs(h))&&Math.abs(X-I)<=N*Math.max(1,Math.abs(X),Math.abs(I))&&Math.abs(C-v)<=N*Math.max(1,Math.abs(C),Math.abs(v))&&Math.abs(W-p)<=N*Math.max(1,Math.abs(W),Math.abs(p))&&Math.abs(O-z)<=N*Math.max(1,Math.abs(O),Math.abs(z))&&Math.abs(D-T)<=N*Math.max(1,Math.abs(D),Math.abs(T))&&Math.abs(U-f)<=N*Math.max(1,Math.abs(U),Math.abs(f))&&Math.abs(H-n)<=N*Math.max(1,Math.abs(H),Math.abs(n))&&Math.abs(E-s)<=N*Math.max(1,Math.abs(E),Math.abs(s))}var JQ=z0,BQ=f0,jQ=v0,AQ=y0;var e={};F0(e,{str:()=>{{return U$}},squaredLength:()=>{{return OK}},sqrLen:()=>{{return G$}},sqlerp:()=>{{return L$}},slerp:()=>{{return K0}},setAxisAngle:()=>{{return VK}},setAxes:()=>{{return S$}},set:()=>{{return A$}},scale:()=>{{return XK}},rotationTo:()=>{{return q$}},rotateZ:()=>{{return P$}},rotateY:()=>{{return B$}},rotateX:()=>{{return Y$}},random:()=>{{return C$}},pow:()=>{{return X$}},normalize:()=>{{return O0}},multiply:()=>{{return YK}},mul:()=>{{return R$}},ln:()=>{{return PK}},lerp:()=>{{return M$}},length:()=>{{return HK}},len:()=>{{return N$}},invert:()=>{{return H$}},identity:()=>{{return Z$}},getAxisAngle:()=>{{return J$}},getAngle:()=>{{return V$}},fromValues:()=>{{return E$}},fromMat3:()=>{{return FK}},fromEuler:()=>{{return W$}},exp:()=>{{return BK}},exactEquals:()=>{{return T$}},equals:()=>{{return k$}},dot:()=>{{return CK}},create:()=>{{return H0}},copy:()=>{{return j$}},conjugate:()=>{{return O$}},clone:()=>{{return D$}},calculateW:()=>{{return F$}},add:()=>{{return _$}}});var m={};F0(m,{zero:()=>{{return iQ}},transformQuat:()=>{{return cQ}},transformMat4:()=>{{return fQ}},transformMat3:()=>{{return yQ}},subtract:()=>{{return x0}},sub:()=>{{return bQ}},str:()=>{{return nQ}},squaredLength:()=>{{return n0}},squaredDistance:()=>{{return i0}},sqrLen:()=>{{return tQ}},sqrDist:()=>{{return aQ}},set:()=>{{return MQ}},scaleAndAdd:()=>{{return hQ}},scale:()=>{{return SQ}},round:()=>{{return LQ}},rotateZ:()=>{{return mQ}},rotateY:()=>{{return lQ}},rotateX:()=>{{return xQ}},random:()=>{{return zQ}},normalize:()=>{{return X0}},negate:()=>{{return IQ}},multiply:()=>{{return l0}},mul:()=>{{return eQ}},min:()=>{{return kQ}},max:()=>{{return qQ}},lerp:()=>{{return vQ}},length:()=>{{return c0}},len:()=>{{return C0}},inverse:()=>{{return wQ}},hermite:()=>{{return pQ}},fromValues:()=>{{return a}},forEach:()=>{{return K$}},floor:()=>{{return TQ}},exactEquals:()=>{{return sQ}},equals:()=>{{return rQ}},dot:()=>{{return t}},divide:()=>{{return m0}},div:()=>{{return uQ}},distance:()=>{{return d0}},dist:()=>{{return oQ}},cross:()=>{{return b}},create:()=>{{return o}},copy:()=>{{return RQ}},clone:()=>{{return _Q}},ceil:()=>{{return GQ}},bezier:()=>{{return gQ}},angle:()=>{{return dQ}},add:()=>{{return NQ}}});function o(){var K=new q(3);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K}function _Q(K){var Q=new q(3);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q}function c0(K){var Q=K[0],$=K[1],Z=K[2];return Math.hypot(Q,$,Z)}function a(K,Q,$){var Z=new q(3);return Z[0]=K,Z[1]=Q,Z[2]=$,Z}function RQ(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K}function MQ(K,Q,$,Z){return K[0]=Q,K[1]=$,K[2]=Z,K}function NQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K}function x0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K}function l0(K,Q,$){return K[0]=Q[0]*$[0],K[1]=Q[1]*$[1],K[2]=Q[2]*$[2],K}function m0(K,Q,$){return K[0]=Q[0]/$[0],K[1]=Q[1]/$[1],K[2]=Q[2]/$[2],K}function GQ(K,Q){return K[0]=Math.ceil(Q[0]),K[1]=Math.ceil(Q[1]),K[2]=Math.ceil(Q[2]),K}function TQ(K,Q){return K[0]=Math.floor(Q[0]),K[1]=Math.floor(Q[1]),K[2]=Math.floor(Q[2]),K}function kQ(K,Q,$){return K[0]=Math.min(Q[0],$[0]),K[1]=Math.min(Q[1],$[1]),K[2]=Math.min(Q[2],$[2]),K}function qQ(K,Q,$){return K[0]=Math.max(Q[0],$[0]),K[1]=Math.max(Q[1],$[1]),K[2]=Math.max(Q[2],$[2]),K}function LQ(K,Q){return K[0]=Math.round(Q[0]),K[1]=Math.round(Q[1]),K[2]=Math.round(Q[2]),K}function SQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K}function hQ(K,Q,$,Z){return K[0]=Q[0]+$[0]*Z,K[1]=Q[1]+$[1]*Z,K[2]=Q[2]+$[2]*Z,K}function d0(K,Q){var $=Q[0]-K[0],Z=Q[1]-K[1],J=Q[2]-K[2];return Math.hypot($,Z,J)}function i0(K,Q){var $=Q[0]-K[0],Z=Q[1]-K[1],J=Q[2]-K[2];return $*$+Z*Z+J*J}function n0(K){var Q=K[0],$=K[1],Z=K[2];return Q*Q+$*$+Z*Z}function IQ(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K}function wQ(K,Q){return K[0]=1/Q[0],K[1]=1/Q[1],K[2]=1/Q[2],K}function X0(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=$*$+Z*Z+J*J;if(V>0)V=1/Math.sqrt(V);return K[0]=Q[0]*V,K[1]=Q[1]*V,K[2]=Q[2]*V,K}function t(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]}function b(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=$[0],B=$[1],P=$[2];return K[0]=J*P-V*B,K[1]=V*Y-Z*P,K[2]=Z*B-J*Y,K}function vQ(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2];return K[0]=J+Z*($[0]-J),K[1]=V+Z*($[1]-V),K[2]=Y+Z*($[2]-Y),K}function pQ(K,Q,$,Z,J,V){var Y=V*V,B=Y*(2*V-3)+1,P=Y*(V-2)+V,F=Y*(V-1),X=Y*(3-2*V);return K[0]=Q[0]*B+$[0]*P+Z[0]*F+J[0]*X,K[1]=Q[1]*B+$[1]*P+Z[1]*F+J[1]*X,K[2]=Q[2]*B+$[2]*P+Z[2]*F+J[2]*X,K}function gQ(K,Q,$,Z,J,V){var Y=1-V,B=Y*Y,P=V*V,F=B*Y,X=3*V*B,C=3*P*Y,W=P*V;return K[0]=Q[0]*F+$[0]*X+Z[0]*C+J[0]*W,K[1]=Q[1]*F+$[1]*X+Z[1]*C+J[1]*W,K[2]=Q[2]*F+$[2]*X+Z[2]*C+J[2]*W,K}function zQ(K,Q){Q=Q||1;var $=l()*2*Math.PI,Z=l()*2-1,J=Math.sqrt(1-Z*Z)*Q;return K[0]=Math.cos($)*J,K[1]=Math.sin($)*J,K[2]=Z*Q,K}function fQ(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=$[3]*Z+$[7]*J+$[11]*V+$[15];return Y=Y||1,K[0]=($[0]*Z+$[4]*J+$[8]*V+$[12])/Y,K[1]=($[1]*Z+$[5]*J+$[9]*V+$[13])/Y,K[2]=($[2]*Z+$[6]*J+$[10]*V+$[14])/Y,K}function yQ(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2];return K[0]=Z*$[0]+J*$[3]+V*$[6],K[1]=Z*$[1]+J*$[4]+V*$[7],K[2]=Z*$[2]+J*$[5]+V*$[8],K}function cQ(K,Q,$){var Z=$[0],J=$[1],V=$[2],Y=$[3],B=Q[0],P=Q[1],F=Q[2],X=J*F-V*P,C=V*B-Z*F,W=Z*P-J*B,O=J*W-V*C,D=V*X-Z*W,U=Z*C-J*X,H=Y*2;return X*=H,C*=H,W*=H,O*=2,D*=2,U*=2,K[0]=B+X+O,K[1]=P+C+D,K[2]=F+W+U,K}function xQ(K,Q,$,Z){var J=[],V=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],V[0]=J[0],V[1]=J[1]*Math.cos(Z)-J[2]*Math.sin(Z),V[2]=J[1]*Math.sin(Z)+J[2]*Math.cos(Z),K[0]=V[0]+$[0],K[1]=V[1]+$[1],K[2]=V[2]+$[2],K}function lQ(K,Q,$,Z){var J=[],V=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],V[0]=J[2]*Math.sin(Z)+J[0]*Math.cos(Z),V[1]=J[1],V[2]=J[2]*Math.cos(Z)-J[0]*Math.sin(Z),K[0]=V[0]+$[0],K[1]=V[1]+$[1],K[2]=V[2]+$[2],K}function mQ(K,Q,$,Z){var J=[],V=[];return J[0]=Q[0]-$[0],J[1]=Q[1]-$[1],J[2]=Q[2]-$[2],V[0]=J[0]*Math.cos(Z)-J[1]*Math.sin(Z),V[1]=J[0]*Math.sin(Z)+J[1]*Math.cos(Z),V[2]=J[2],K[0]=V[0]+$[0],K[1]=V[1]+$[1],K[2]=V[2]+$[2],K}function dQ(K,Q){var $=K[0],Z=K[1],J=K[2],V=Q[0],Y=Q[1],B=Q[2],P=Math.sqrt($*$+Z*Z+J*J),F=Math.sqrt(V*V+Y*Y+B*B),X=P*F,C=X&&t(K,Q)/X;return Math.acos(Math.min(Math.max(C,-1),1))}function iQ(K){return K[0]=0,K[1]=0,K[2]=0,K}function nQ(K){return"vec3("+K[0]+", "+K[1]+", "+K[2]+")"}function sQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]}function rQ(K,Q){var $=K[0],Z=K[1],J=K[2],V=Q[0],Y=Q[1],B=Q[2];return Math.abs($-V)<=N*Math.max(1,Math.abs($),Math.abs(V))&&Math.abs(Z-Y)<=N*Math.max(1,Math.abs(Z),Math.abs(Y))&&Math.abs(J-B)<=N*Math.max(1,Math.abs(J),Math.abs(B))}var bQ=x0,eQ=l0,uQ=m0,oQ=d0,aQ=i0,C0=c0,tQ=n0,K$=function(){var K=o();return function(Q,$,Z,J,V,Y){var B,P;if(!$)$=3;if(!Z)Z=0;if(J)P=Math.min(J*$+Z,Q.length);else P=Q.length;for(B=Z;B<P;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],V(K,K,Y),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2];return Q}}();function Q$(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0,K[3]=0;return K}function s0(K){var Q=new q(4);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q}function r0(K,Q,$,Z){var J=new q(4);return J[0]=K,J[1]=Q,J[2]=$,J[3]=Z,J}function b0(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K}function e0(K,Q,$,Z,J){return K[0]=Q,K[1]=$,K[2]=Z,K[3]=J,K}function u0(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K}function o0(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K}function a0(K){var Q=K[0],$=K[1],Z=K[2],J=K[3];return Math.hypot(Q,$,Z,J)}function t0(K){var Q=K[0],$=K[1],Z=K[2],J=K[3];return Q*Q+$*$+Z*Z+J*J}function KK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=$*$+Z*Z+J*J+V*V;if(Y>0)Y=1/Math.sqrt(Y);return K[0]=$*Y,K[1]=Z*Y,K[2]=J*Y,K[3]=V*Y,K}function QK(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]+K[3]*Q[3]}function $K(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Q[3];return K[0]=J+Z*($[0]-J),K[1]=V+Z*($[1]-V),K[2]=Y+Z*($[2]-Y),K[3]=B+Z*($[3]-B),K}function ZK(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]}function JK(K,Q){var $=K[0],Z=K[1],J=K[2],V=K[3],Y=Q[0],B=Q[1],P=Q[2],F=Q[3];return Math.abs($-Y)<=N*Math.max(1,Math.abs($),Math.abs(Y))&&Math.abs(Z-B)<=N*Math.max(1,Math.abs(Z),Math.abs(B))&&Math.abs(J-P)<=N*Math.max(1,Math.abs(J),Math.abs(P))&&Math.abs(V-F)<=N*Math.max(1,Math.abs(V),Math.abs(F))}var d$=function(){var K=Q$();return function(Q,$,Z,J,V,Y){var B,P;if(!$)$=4;if(!Z)Z=0;if(J)P=Math.min(J*$+Z,Q.length);else P=Q.length;for(B=Z;B<P;B+=$)K[0]=Q[B],K[1]=Q[B+1],K[2]=Q[B+2],K[3]=Q[B+3],V(K,K,Y),Q[B]=K[0],Q[B+1]=K[1],Q[B+2]=K[2],Q[B+3]=K[3];return Q}}();function H0(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K[3]=1,K}function Z$(K){return K[0]=0,K[1]=0,K[2]=0,K[3]=1,K}function VK(K,Q,$){$=$*0.5;var Z=Math.sin($);return K[0]=Z*Q[0],K[1]=Z*Q[1],K[2]=Z*Q[2],K[3]=Math.cos($),K}function J$(K,Q){var $=Math.acos(Q[3])*2,Z=Math.sin($/2);if(Z>N)K[0]=Q[0]/Z,K[1]=Q[1]/Z,K[2]=Q[2]/Z;else K[0]=1,K[1]=0,K[2]=0;return $}function V$(K,Q){var $=CK(K,Q);return Math.acos(2*$*$-1)}function YK(K,Q,$){var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=$[0],P=$[1],F=$[2],X=$[3];return K[0]=Z*X+Y*B+J*F-V*P,K[1]=J*X+Y*P+V*B-Z*F,K[2]=V*X+Y*F+Z*P-J*B,K[3]=Y*X-Z*B-J*P-V*F,K}function Y$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Math.sin($),P=Math.cos($);return K[0]=Z*P+Y*B,K[1]=J*P+V*B,K[2]=V*P-J*B,K[3]=Y*P-Z*B,K}function B$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Math.sin($),P=Math.cos($);return K[0]=Z*P-V*B,K[1]=J*P+Y*B,K[2]=V*P+Z*B,K[3]=Y*P-J*B,K}function P$(K,Q,$){$*=0.5;var Z=Q[0],J=Q[1],V=Q[2],Y=Q[3],B=Math.sin($),P=Math.cos($);return K[0]=Z*P+J*B,K[1]=J*P-Z*B,K[2]=V*P+Y*B,K[3]=Y*P-V*B,K}function F$(K,Q){var $=Q[0],Z=Q[1],J=Q[2];return K[0]=$,K[1]=Z,K[2]=J,K[3]=Math.sqrt(Math.abs(1-$*$-Z*Z-J*J)),K}function BK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Math.sqrt($*$+Z*Z+J*J),B=Math.exp(V),P=Y>0?B*Math.sin(Y)/Y:0;return K[0]=$*P,K[1]=Z*P,K[2]=J*P,K[3]=B*Math.cos(Y),K}function PK(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=Math.sqrt($*$+Z*Z+J*J),B=Y>0?Math.atan2(Y,V)/Y:0;return K[0]=$*B,K[1]=Z*B,K[2]=J*B,K[3]=0.5*Math.log($*$+Z*Z+J*J+V*V),K}function X$(K,Q,$){return PK(K,Q),XK(K,K,$),BK(K,K),K}function K0(K,Q,$,Z){var J=Q[0],V=Q[1],Y=Q[2],B=Q[3],P=$[0],F=$[1],X=$[2],C=$[3],W,O,D,U,H;if(O=J*P+V*F+Y*X+B*C,O<0)O=-O,P=-P,F=-F,X=-X,C=-C;if(1-O>N)W=Math.acos(O),D=Math.sin(W),U=Math.sin((1-Z)*W)/D,H=Math.sin(Z*W)/D;else U=1-Z,H=Z;return K[0]=U*J+H*P,K[1]=U*V+H*F,K[2]=U*Y+H*X,K[3]=U*B+H*C,K}function C$(K){var Q=l(),$=l(),Z=l(),J=Math.sqrt(1-Q),V=Math.sqrt(Q);return K[0]=J*Math.sin(2*Math.PI*$),K[1]=J*Math.cos(2*Math.PI*$),K[2]=V*Math.sin(2*Math.PI*Z),K[3]=V*Math.cos(2*Math.PI*Z),K}function H$(K,Q){var $=Q[0],Z=Q[1],J=Q[2],V=Q[3],Y=$*$+Z*Z+J*J+V*V,B=Y?1/Y:0;return K[0]=-$*B,K[1]=-Z*B,K[2]=-J*B,K[3]=V*B,K}function O$(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K[3]=Q[3],K}function FK(K,Q){var $=Q[0]+Q[4]+Q[8],Z;if($>0)Z=Math.sqrt($+1),K[3]=0.5*Z,Z=0.5/Z,K[0]=(Q[5]-Q[7])*Z,K[1]=(Q[6]-Q[2])*Z,K[2]=(Q[1]-Q[3])*Z;else{var J=0;if(Q[4]>Q[0])J=1;if(Q[8]>Q[J*3+J])J=2;var V=(J+1)%3,Y=(J+2)%3;Z=Math.sqrt(Q[J*3+J]-Q[V*3+V]-Q[Y*3+Y]+1),K[J]=0.5*Z,Z=0.5/Z,K[3]=(Q[V*3+Y]-Q[Y*3+V])*Z,K[V]=(Q[V*3+J]+Q[J*3+V])*Z,K[Y]=(Q[Y*3+J]+Q[J*3+Y])*Z}return K}function W$(K,Q,$,Z){var J=0.5*Math.PI/180;Q*=J,$*=J,Z*=J;var V=Math.sin(Q),Y=Math.cos(Q),B=Math.sin($),P=Math.cos($),F=Math.sin(Z),X=Math.cos(Z);return K[0]=V*P*X-Y*B*F,K[1]=Y*B*X+V*P*F,K[2]=Y*P*F-V*B*X,K[3]=Y*P*X+V*B*F,K}function U$(K){return"quat("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+")"}var D$=s0,E$=r0,j$=b0,A$=e0,_$=u0,R$=YK,XK=o0,CK=QK,M$=$K,HK=a0,N$=HK,OK=t0,G$=OK,O0=KK,T$=ZK,k$=JK,q$=function(){var K=o(),Q=a(1,0,0),$=a(0,1,0);return function(Z,J,V){var Y=t(J,V);if(Y<-0.999999){if(b(K,Q,J),C0(K)<0.000001)b(K,$,J);return X0(K,K),VK(Z,K,Math.PI),Z}else if(Y>0.999999)return Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z;else return b(K,J,V),Z[0]=K[0],Z[1]=K[1],Z[2]=K[2],Z[3]=1+Y,O0(Z,Z)}}(),L$=function(){var K=H0(),Q=H0();return function($,Z,J,V,Y,B){return K0(K,Z,Y,B),K0(Q,J,V,B),K0($,K,Q,2*B*(1-B)),$}}(),S$=function(){var K=I0();return function(Q,$,Z,J){return K[0]=Z[0],K[3]=Z[1],K[6]=Z[2],K[1]=J[0],K[4]=J[1],K[7]=J[2],K[2]=-$[0],K[5]=-$[1],K[8]=-$[2],O0(Q,FK(Q,K))}}();var h$=Math.PI/90;class y{m4=Float32Array.from(k.create());constructor(){this.identity()}static create(){return new y}identity(){return k.identity(this.m4),this}invert(K){return k.invert(this.m4,K.getMatrix()),this}multiply(K){return k.multiply(this.m4,this.m4,K.getMatrix()),this}multiply2(K,Q){return k.multiply(this.m4,K.getMatrix(),Q.getMatrix()),this}multiply3(K,Q,$){return this.multiply2(K,Q),this.multiply($),this}translate(K,Q,$){return k.translate(this.m4,this.m4,[K,Q,$]),this}translateToMatrix(K){const Q=K.getMatrix();return this.translate(-Q[12],-Q[13],-Q[14]),this}rotateX(K){return k.rotateX(this.m4,this.m4,K),this}rotateY(K){return k.rotateY(this.m4,this.m4,K),this}rotateZ(K){return k.rotateZ(this.m4,this.m4,K),this}scale(K,Q,$){return k.scale(this.m4,this.m4,[K,Q,$]),this}perspective(K,Q,$,Z){return k.perspective(this.m4,K*h$,Q,$,Z),this}ortho(K,Q,$,Z,J,V){return k.ortho(this.m4,K,Q,$,Z,J,V),this}static aTemp=k.create();static bTemp=k.create();combine(K,Q,$=0.5){return k.multiplyScalar(y.aTemp,K.getMatrix(),1-$),k.multiplyScalar(y.bTemp,Q.getMatrix(),$),k.add(this.m4,y.aTemp,y.bTemp),this}static tempQuat=e.create();moveMatrix(K,Q,$,Z){const J=m.fromValues(-K,Q,$);if(Z)k.getRotation(y.tempQuat,Z.getMatrix()),e.invert(y.tempQuat,y.tempQuat),m.transformQuat(J,J,y.tempQuat);return k.translate(this.m4,this.m4,J),this}getMatrix(){return this.m4}}var L=y;var WK=0,UK=1,DK=2;class W0{getHudSpriteId(){return 0}getNumImages(){return 3}drawImage(K,Q){switch(K){case WK:{const{canvas:Z}=Q;Z.width=512,Z.height=512;const J=Z.width/2,V=Z.height/2,Y=Z.width/2;Q.imageSmoothingEnabled=!0,Q.fillStyle="#ddd",Q.lineWidth=Z.width/50,Q.fillRect(0,0,Z.width,Z.height),Q.strokeStyle="black",Q.fillStyle="gold",Q.beginPath(),Q.arc(J,V,Y*0.8,0,2*Math.PI),Q.fill(),Q.stroke(),Q.beginPath(),Q.arc(J,V,Y*0.5,0,Math.PI),Q.stroke(),Q.beginPath(),Q.arc(Z.width/3,Z.height/3,Y*0.1,0,Math.PI,!0),Q.stroke(),Q.beginPath(),Q.arc(Z.width/3*2,Z.height/3,Y*0.1,0,Math.PI*2,!0),Q.stroke()}break;case UK:{const{canvas:Z}=Q;Z.width=512,Z.height=512,Q.imageSmoothingEnabled=!0,Q.fillStyle="#ddd",Q.lineWidth=Z.width/50,Q.fillRect(0,0,Z.width,Z.height),Q.strokeStyle="black",Q.fillStyle="silver",Q.beginPath(),Q.rect(Z.width*0.2,Z.height*0.2,Z.width*0.6,Z.height*0.6),Q.fill(),Q.stroke()}break;case DK:{const{canvas:Z}=Q;Z.width=512,Z.height=512,Q.imageSmoothingEnabled=!0,Q.fillStyle="#ddd",Q.lineWidth=Z.width/50,Q.strokeStyle="black",Q.fillStyle="silver",Q.beginPath(),Q.rect(30,30,Z.width-60,Z.height-60),Q.stroke()}break}}hudMatrix=L.create();sprites=[{imageId:DK,transforms:[this.hudMatrix.getMatrix()]},...[L.create().translate(0,0,0).getMatrix(),L.create().translate(-1,0,1).rotateY(Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(1,0,1).rotateY(-Math.PI/2).scale(1,1,1).getMatrix()].map((K)=>({imageId:WK,transforms:[K]})),...[L.create().translate(0,-1,1).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(0,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(-2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix(),L.create().translate(2,-1,3).rotateX(-Math.PI/2).scale(1,1,1).getMatrix()].map((K)=>({imageId:UK,transforms:[K]}))];getHudMatrix(){return this.hudMatrix}getSpriteCount(){return this.sprites.length}getSprite(K){return this.sprites[K]}}class g{disposables;own(K){if(!this.disposables)this.disposables=new Set;return this.disposables.add(K),K}addOnDestroy(K){this.disposables?.add({destroy:K})}destroy(){this.disposables?.forEach((K)=>K.destroy())}}var j=globalThis.WebGL2RenderingContext??{},EK="position_and_tex",jK="index",U0="transform",AK="slotSize_and_number",_K="cam",RK="projection",MK="maxTextureSize",NK="uTextures";var I$=function(K,Q,$){function Z(X,C){function W(D){return D===K?.VERTEX_SHADER?"vertex":D===K?.FRAGMENT_SHADER?"fragment":void 0}if(C!==K.VERTEX_SHADER&&C!==K.FRAGMENT_SHADER)throw new Error(`Shader error in ${W(C)}`);const O=K.createShader(C);if(!O)throw new Error(`Unable to generate ${W(C)} shader.`);if(K.shaderSource(O,X),K.compileShader(O),!K.getShaderParameter(O,K.COMPILE_STATUS))console.error(`Shader compile error in ${W(C)}:`+K.getShaderInfoLog(O));return O}const J=K.createProgram();if(!J)throw new Error("Unable to create program.");const V=Z(Q,K.VERTEX_SHADER),Y=Z($,K.FRAGMENT_SHADER),B=K.getShaderInfoLog(V),P=K.getShaderInfoLog(Y);if(B)console.log("VERTEX",B);if(P)console.log("FRAGMENT",P);K.attachShader(J,V),K.attachShader(J,Y),K.linkProgram(J);const F=K.getProgramInfoLog(J);if(F)console.log("PROGRAM",F);if(K.detachShader(J,V),K.detachShader(J,Y),K.deleteShader(V),K.deleteShader(Y),K.validateProgram(J),Object.entries(j).forEach(([X,C])=>{if(C&&K.getError()===C)console.log(`gl.${X}`)}),!K.getProgramParameter(J,K.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+K.getProgramInfoLog(J));return J},w$=function(K,Q){K.deleteProgram(Q)};class D0 extends g{gl;program;constructor(K,Q,$){super();this.gl=K,this.program=I$(K,Q.trim(),$.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),w$(this.gl,this.program)}}class E0 extends g{activeProgramId="";gl;programs={};constructor(K){super();this.gl=K}addProgram(K,Q,$){if(this.programs[K])this.removeProgram(K);this.programs[K]=this.own(new D0(this.gl,Q,$))}useProgram(K){if(this.activeProgramId!==K)this.activeProgramId=K,this.programs[K].use()}removeProgram(K){this.programs[K].destroy(),delete this.programs[K]}getProgram(K){return this.programs[K??this.activeProgramId]?.program}}class j0 extends g{gl;triangleArray;constructor(K){super();this.gl=K,this.triangleArray=K.createVertexArray(),K.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class A0 extends g{bufferRecord={};lastBoundBuffer;gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getAttributeLocation(K,Q){const $=this.programs.getProgram(Q);return $?this.gl.getAttribLocation($,K)??-1:-1}createBuffer(K){this.deleteBuffer(K);const Q=this.gl?.createBuffer();if(!Q)throw new Error(`Unable to create buffer "${K}"`);const $={buffer:Q,location:this.getAttributeLocation(K)};return this.bufferRecord[K]=$,$}deleteBuffer(K){if(this.bufferRecord[K])this.gl.deleteBuffer(this.bufferRecord[K].buffer),delete this.bufferRecord[K]}getAttributeBuffer(K,Q){const $=this.bufferRecord[K];if(!$){if(Q)return this.createBuffer(K);throw new Error(`Attribute "${K}" not created. Make sure "createBuffer" is called.`)}return $}bufferData(K,Q,$,Z,J){const V=this.getAttributeBuffer(Q);if($)this.gl.bufferData(K,$,J);else this.gl.bufferData(K,Z,J);V.bufferSize=Z||$?.length,V.bufferArray=$??new Float32Array(V.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),V.usage=J,V.target=K}bufferSubData(K,Q,$,Z,J){if(Z)this.gl.bufferSubData(K,$,Q,Z,J);else this.gl.bufferSubData(K,$,Q)}bindBuffer(K,Q){if(this.lastBoundBuffer!==Q)this.lastBoundBuffer=Q,this.gl.bindBuffer(K,Q.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((K)=>this.deleteBuffer(K))}}class _0 extends g{gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getUniformLocation(K,Q){const $=this.programs.getProgram(Q);return this.gl.getUniformLocation($,K)}}function GK(K,Q=($)=>$.key){var $=[];return R0(K,"",!0,(Z)=>$.push(Z),Q),$.join("")}var R0=function(K,Q,$,Z,J){if(K){Z(`${Q}${$?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${J(K)}\n`);const V=Q+($?"    ":"\u2502   ");if(K.left)R0(K.left,V,!1,Z,J);if(K.right)R0(K.right,V,!0,Z,J)}};function Q0(K){if(K===null)return!0;var Q=$0(K.left),$=$0(K.right);if(Math.abs(Q-$)<=1&&Q0(K.left)&&Q0(K.right))return!0;return!1}var $0=function(K){return K?1+Math.max($0(K.left),$0(K.right)):0};function Z0(K,Q,$,Z,J){const V=J-Z;if(V>0){const Y=Z+Math.floor(V/2),B=Q[Y],P=$[Y],F={key:B,data:P,parent:K};return F.left=Z0(F,Q,$,Z,Y),F.right=Z0(F,Q,$,Y+1,J),F}return null}function J0(K){if(K===null)return 0;const Q=J0(K.left),$=J0(K.right);return K.balanceFactor=Q-$,Math.max(Q,$)+1}function V0(K,Q,$,Z,J){if($>=Z)return;const V=K[$+Z>>1];let Y=$-1,B=Z+1;while(!0){do Y++;while(J(K[Y],V)<0);do B--;while(J(K[B],V)>0);if(Y>=B)break;let P=K[Y];K[Y]=K[B],K[B]=P,P=Q[Y],Q[Y]=Q[B],Q[B]=P}V0(K,Q,$,B,J),V0(K,Q,B+1,Z,J)}var v$=function(K,Q){return K>Q?1:K<Q?-1:0},Y0=function(K){var Q=K.right;if(K.right=Q.left,Q.left)Q.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.left=K,K.balanceFactor+=1,Q.balanceFactor<0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor+=1,K.balanceFactor>0)Q.balanceFactor+=K.balanceFactor;return Q},B0=function(K){var Q=K.left;if(K.left=Q.right,K.left)K.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.right=K,K.balanceFactor-=1,Q.balanceFactor>0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor-=1,K.balanceFactor<0)Q.balanceFactor+=K.balanceFactor;return Q};class d{constructor(K,Q=!1){this._comparator=K||v$,this._root=null,this._size=0,this._noDuplicates=!!Q}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(K){if(this._root){var Q=this._root,$=this._comparator;while(Q){var Z=$(K,Q.key);if(Z===0)return!0;else if(Z<0)Q=Q.left;else Q=Q.right}}return!1}next(K){var Q=K;if(Q)if(Q.right){Q=Q.right;while(Q.left)Q=Q.left}else{Q=K.parent;while(Q&&Q.right===K)K=Q,Q=Q.parent}return Q}prev(K){var Q=K;if(Q)if(Q.left){Q=Q.left;while(Q.right)Q=Q.right}else{Q=K.parent;while(Q&&Q.left===K)K=Q,Q=Q.parent}return Q}forEach(K){var Q=this._root,$=[],Z=!1,J=0;while(!Z)if(Q)$.push(Q),Q=Q.left;else if($.length>0)Q=$.pop(),K(Q,J++),Q=Q.right;else Z=!0;return this}range(K,Q,$,Z){const J=[],V=this._comparator;let Y=this._root,B;while(J.length!==0||Y)if(Y)J.push(Y),Y=Y.left;else{if(Y=J.pop(),B=V(Y.key,Q),B>0)break;else if(V(Y.key,K)>=0){if($.call(Z,Y))return this}Y=Y.right}return this}keys(){var K=this._root,Q=[],$=[],Z=!1;while(!Z)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.key),K=K.right;else Z=!0;return $}values(){var K=this._root,Q=[],$=[],Z=!1;while(!Z)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.data),K=K.right;else Z=!0;return $}at(K){var Q=this._root,$=[],Z=!1,J=0;while(!Z)if(Q)$.push(Q),Q=Q.left;else if($.length>0){if(Q=$.pop(),J===K)return Q;J++,Q=Q.right}else Z=!0;return null}minNode(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K}maxNode(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K}min(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K.key}max(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K.key}isEmpty(){return!this._root}pop(){var K=this._root,Q=null;if(K){while(K.left)K=K.left;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}popMax(){var K=this._root,Q=null;if(K){while(K.right)K=K.right;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}find(K){var Q=this._root,$=Q,Z,J=this._comparator;while($)if(Z=J(K,$.key),Z===0)return $;else if(Z<0)$=$.left;else $=$.right;return null}insert(K,Q){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:K,data:Q},this._size++,this._root;var $=this._comparator,Z=this._root,J=null,V=0;if(this._noDuplicates)while(Z)if(V=$(K,Z.key),J=Z,V===0)return null;else if(V<0)Z=Z.left;else Z=Z.right;else while(Z)if(V=$(K,Z.key),J=Z,V<=0)Z=Z.left;else Z=Z.right;var Y={left:null,right:null,balanceFactor:0,parent:J,key:K,data:Q},B;if(V<=0)J.left=Y;else J.right=Y;while(J){if(V=$(J.key,K),V<0)J.balanceFactor-=1;else J.balanceFactor+=1;if(J.balanceFactor===0)break;else if(J.balanceFactor<-1){if(J.right.balanceFactor===1)B0(J.right);if(B=Y0(J),J===this._root)this._root=B;break}else if(J.balanceFactor>1){if(J.left.balanceFactor===-1)Y0(J.left);if(B=B0(J),J===this._root)this._root=B;break}J=J.parent}return this._size++,Y}remove(K){if(!this._root)return null;var Q=this._root,$=this._comparator,Z=0;while(Q)if(Z=$(K,Q.key),Z===0)break;else if(Z<0)Q=Q.left;else Q=Q.right;if(!Q)return null;var J=Q.key,V,Y;if(Q.left){V=Q.left;while(V.left||V.right){while(V.right)V=V.right;if(Q.key=V.key,Q.data=V.data,V.left)Q=V,V=V.left}Q.key=V.key,Q.data=V.data,Q=V}if(Q.right){Y=Q.right;while(Y.left||Y.right){while(Y.left)Y=Y.left;if(Q.key=Y.key,Q.data=Y.data,Y.right)Q=Y,Y=Y.right}Q.key=Y.key,Q.data=Y.data,Q=Y}var B=Q.parent,P=Q,F;while(B){if(B.left===P)B.balanceFactor-=1;else B.balanceFactor+=1;if(B.balanceFactor<-1){if(B.right.balanceFactor===1)B0(B.right);if(F=Y0(B),B===this._root)this._root=F;B=F}else if(B.balanceFactor>1){if(B.left.balanceFactor===-1)Y0(B.left);if(F=B0(B),B===this._root)this._root=F;B=F}if(B.balanceFactor===-1||B.balanceFactor===1)break;P=B,B=B.parent}if(Q.parent)if(Q.parent.left===Q)Q.parent.left=null;else Q.parent.right=null;if(Q===this._root)this._root=null;return this._size--,J}load(K=[],Q=[],$){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const Z=K.length;if($)V0(K,Q,0,Z-1,this._comparator);return this._root=Z0(null,K,Q,0,Z),J0(this._root),this._size=Z,this}isBalanced(){return Q0(this._root)}toString(K){return GK(this._root,K)}}d.default=d;class c{size;slotNumber;x;y;textureIndex;parent;sibbling;textureSizeLimits;constructor(K,Q,$,Z){this.textureSizeLimits=$?.textureSizeLimits??Z??{min:M0,max:N0},this.size=K,this.slotNumber=Q,this.parent=$,this.sibbling=void 0;const{x:J,y:V,textureIndex:Y}=this.calculatePosition(K,Q);this.x=J,this.y=V,this.textureIndex=Y}calculateTextureIndex(K,Q){const[$,Z]=K,J=this.textureSizeLimits.max/$*(this.textureSizeLimits.max/Z);return Math.floor(Q/J)}calculatePosition(K,Q){const[$,Z]=K,J=this.textureSizeLimits.max/$,V=this.textureSizeLimits.max/Z,Y=Q%J*$,B=Math.floor(Q/J)%V*Z;return{x:Y,y:B,textureIndex:this.calculateTextureIndex(K,Q)}}getTag(){return c.getTag(this)}static getTag(K){return`${K.size[0]}x${K.size[1]}-#${K.slotNumber}`}static positionToTextureSlot(K,Q,$,Z,J){const[V,Y]=$,B=J.textureSizeLimits.max/V,F=J.textureSizeLimits.max/V*(J.textureSizeLimits.max/Y)*Z+Q/Y*B+K/V;return new c($,F,J)}getPosition(){return{x:this.x,y:this.y,size:this.size,textureIndex:this.textureIndex}}canSplitHorizontally(){const[,K]=this.size;return K>this.textureSizeLimits.min}canSplitVertically(){const[K]=this.size;return K>this.textureSizeLimits.min}splitHorizontally(){const{x:K,y:Q,size:$,textureIndex:Z}=this,[J,V]=$;if(!this.canSplitHorizontally())throw new Error(`Cannot split texture slot of size ${J} horizontally`);const Y=J/2,B=c.positionToTextureSlot(K,Q,[Y,V],Z,this),P=c.positionToTextureSlot(K+Y,Q,[Y,V],Z,this);return B.sibbling=P,P.sibbling=B,[B,P]}splitVertically(){const{x:K,y:Q,size:$,textureIndex:Z}=this,[J,V]=$;if(!this.canSplitVertically())throw new Error(`Cannot split texture slot of size ${V} vertically`);const Y=V/2,B=c.positionToTextureSlot(K,Q,[J,Y],Z,this),P=c.positionToTextureSlot(K,Q+Y,[J,Y],Z,this);return B.sibbling=P,P.sibbling=B,[B,P]}}function P0(K,Q){return Math.max(Q,Math.pow(2,Math.ceil(Math.log(K)/Math.log(2))))}function TK(K,Q,$,Z){if($<1)throw new Error("Invalid count");const J=P0(K,Z.min),V=P0(Q,Z.min),Y=new Map;let B=Z.min;for(let P=1;P<=$;P++){B=P0(J*P,Z.min);const F=P0(V*Math.ceil($/P),Z.min);Y.set(B,F)}for(let P=B;P<=Z.max;P*=2)if(!Y.has(P))Y.set(P,V);return Y}var p$=!1,M0=16,N0=4096,g$=16;class G0{textureSlots=new d((K,Q)=>{const $=K.size[0]*K.size[1]-Q.size[0]*Q.size[1];if($!==0)return $;return K.slotNumber-Q.slotNumber},!1);allocatedTextures={};minTextureSize;maxTextureSize;numTextureSheets;initialSlots=[];constructor({numTextureSheets:K,minTextureSize:Q,maxTextureSize:$}={},Z){if(this.numTextureSheets=K??g$,this.minTextureSize=Q??M0,this.maxTextureSize=$??N0,Z)this.numTextureSheets=Math.min(this.numTextureSheets,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_IMAGE_UNITS)),this.maxTextureSize=Math.min(this.maxTextureSize,Z.getParameter(WebGL2RenderingContext.MAX_TEXTURE_SIZE)),this.minTextureSize=Math.min(this.minTextureSize,this.maxTextureSize);for(let J=0;J<this.numTextureSheets;J++)this.initialSlots.push(new c([this.maxTextureSize,this.maxTextureSize],J,void 0,{min:this.minTextureSize,max:this.maxTextureSize}));this.initialSlots.forEach((J)=>this.textureSlots.insert(J))}allocate(K,Q,$=1){const{size:Z,slotNumber:J,x:V,y:Y,textureIndex:B}=this.allocateHelper(K,Q,$);return{size:Z,slotNumber:J,x:V,y:Y,textureIndex:B}}deallocate(K){if(!this.isSlotUsed(K))throw new Error("Slot is not allocated");const Q=this.allocatedTextures[c.getTag(K)];this.deallocateHelper(Q)}get countUsedTextureSheets(){return this.initialSlots.filter((K)=>this.isSlotUsed(K)).length}allocateHelper(K,Q,$=1){const Z=TK(K,Q,$,{min:this.minTextureSize,max:this.maxTextureSize}),J=this.findSlot(Z);if(!J)throw new Error(`Could not find a slot for texture to fit ${$} sprites of size ${K}x${Q}`);this.textureSlots.remove(J);const[V,Y]=this.bestFit(Z,J);return this.fitSlot(J,V,Y)}findSlot(K){for(let Q=0;Q<this.textureSlots.size;Q++){const Z=this.textureSlots.at(Q).key,[J,V]=Z.size;if(K.get(J)<=V)return Z}return null}calculateRatio(K,Q){return Math.max(K/Q,Q/K)}bestFit(K,Q){const[$,Z]=Q.size;let J=Q.textureSizeLimits.max;return K.forEach((V,Y)=>{if(Y<=$&&V<=Z){const B=Y*V,P=K.get(J)*J;if(B<P)J=Y;else if(B===P){if(this.calculateRatio(Y,V)<this.calculateRatio(J,K.get(J)))J=Y}}}),[J,K.get(J)]}isSlotUsed(K){return!!this.allocatedTextures[c.getTag(K)]}deallocateHelper(K){if(K.parent&&K.sibbling&&!this.isSlotUsed(K.sibbling)){const Q=K.sibbling;if(this.textureSlots.remove(Q),p$&&this.textureSlots.find(K))throw new Error("Slot is not expected to be in the tree");const $=K.parent;this.deallocateHelper($);return}this.textureSlots.insert(K),delete this.allocatedTextures[K.getTag()]}trySplitHorizontally(K,Q,$){if(K.canSplitHorizontally()){const[Z,J]=K.splitHorizontally();if(Z.size[0]>=Q)return this.textureSlots.insert(J),this.fitSlot(Z,Q,$)}return null}trySplitVertically(K,Q,$){if(K.canSplitVertically()){const[Z,J]=K.splitVertically();if(Z.size[1]>=$)return this.textureSlots.insert(J),this.fitSlot(Z,Q,$)}return null}fitSlot(K,Q,$){if(this.allocatedTextures[K.getTag()]=K,K.size[0]>K.size[1]){const Z=this.trySplitHorizontally(K,Q,$)??this.trySplitVertically(K,Q,$);if(Z)return Z}else{const Z=this.trySplitVertically(K,Q,$)??this.trySplitHorizontally(K,Q,$);if(Z)return Z}return K}listSlots(){this.textureSlots.forEach((K)=>{console.log(K.key?.getTag())})}}class T0 extends g{gl;uniforms;textureBuffers={};tempContext=new OffscreenCanvas(1,1).getContext("2d");textureSlotAllocator=new G0;constructor(K,Q){super();this.gl=K,this.uniforms=Q,this.tempContext.imageSmoothingEnabled=!0}initialize(){this.initTextureUniforms(),this.initMaxTexture()}getTexture(K){if(!this.textureBuffers[K]){const Q=this.gl.createTexture();if(!Q)return;this.gl.bindTexture(j.TEXTURE_2D,Q),this.gl.texImage2D(j.TEXTURE_2D,0,j.RGBA,this.textureSlotAllocator.maxTextureSize,this.textureSlotAllocator.maxTextureSize,0,j.RGBA,j.UNSIGNED_BYTE,null),this.textureBuffers[K]=Q,this.addOnDestroy(()=>this.gl.deleteTexture(Q))}return this.textureBuffers[K]}loadTexture(K,Q,$,Z,J){this.gl.activeTexture(j[Q]),this.gl.bindTexture(j.TEXTURE_2D,$),this.applyTexImage2d(K,Z,J),this.gl.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR)}applyTexImage2d(K,[Q,$,Z,J],[V,Y,B,P]){if(Z===B&&J===P&&!Q&&!$)this.gl.texSubImage2D(j.TEXTURE_2D,0,V,Y,B,P,j.RGBA,j.UNSIGNED_BYTE,K.texImgSrc);else{const F=this.tempContext.canvas;if(K.texImgSrc instanceof ImageData){if(F.width=B||K.width,F.height=P||K.height,this.tempContext.putImageData(K.texImgSrc,0,0),Q||$)console.warn("Offset not available when sending imageData")}else{const X=Z||K.width,C=J||K.height;F.width=B||X,F.height=P||C,this.tempContext.drawImage(K.texImgSrc,Q,$,X,C,0,0,F.width,F.height)}this.gl.texSubImage2D(j.TEXTURE_2D,0,V,Y,F.width,F.height,j.RGBA,j.UNSIGNED_BYTE,F)}}allocateSlotForImage(K){const Q=this.textureSlotAllocator.allocate(K.width,K.height),$=`TEXTURE${Q.textureIndex}`,Z=this.getTexture($);if(!Z)throw new Error(`Invalid texture Id ${$}`);const J=this.assignImageToTexture(K,$,Z,[0,0,K.width,K.height],[Q.x,Q.y,...Q.size]);return{slot:Q,refreshCallback:J}}assignImageToTexture(K,Q,$,Z,J){if(K){const V=Z??[0,0,K.width,K.height],Y=J??[0,0,V[2],V[3]];if(K.active){const B=()=>{this.gl.bindTexture(j.TEXTURE_2D,$),this.applyTexImage2d(K,V,Y)};return B(),B}else this.loadTexture(K,Q,$,V,Y),K.active=!0}return null}generateMipMap(K){const Q=this.getTexture(K);if(Q)this.gl.activeTexture(j[K]),this.gl.bindTexture(j.TEXTURE_2D,Q),this.gl.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),this.gl.generateMipmap(j.TEXTURE_2D)}generateMipMaps(){const K=this.textureSlotAllocator.countUsedTextureSheets;for(let Q=0;Q<K;Q++){const $=`TEXTURE${Q}`;this.generateMipMap($)}}initTextureUniforms(){const K=this.gl.getParameter(j.MAX_TEXTURE_IMAGE_UNITS),Q=new Array(K).fill(null).map((Z,J)=>J),$=this.uniforms.getUniformLocation(NK);this.gl.uniform1iv($,Q)}initMaxTexture(){const K=this.uniforms.getUniformLocation(MK);this.gl.uniform1f(K,this.textureSlotAllocator.maxTextureSize)}}class x extends g{texImgSrc;active=!1;width;height;constructor(K){super();if(this.texImgSrc=K,this.width=K instanceof Image?K.naturalWidth:K instanceof VideoFrame?K.displayWidth:K.width,this.height=K instanceof Image?K.naturalHeight:K instanceof VideoFrame?K.displayHeight:K.height,!this.width||!this.height)throw new Error("Invalid image")}static createFromCanvas(K){return new x(K)}static async loadImage(K){return new Promise((Q,$)=>{const Z=new Image,J=new x(Z),V=()=>Q(J),Y=(B)=>$(B.error);Z.addEventListener("error",Y),Z.addEventListener("load",V,{once:!0}),J.addOnDestroy(()=>Z.removeEventListener("load",V)),Z.src=K})}static async loadVideo(K,Q){return new Promise(($,Z)=>{const J=document.createElement("video"),V=new x(J);if(J.loop=!0,Q!==void 0)J.volume=Q;const Y=()=>J.play(),B=()=>$(V);J.addEventListener("loadedmetadata",Y),J.addEventListener("playing",B,{once:!0}),J.addEventListener("error",(P)=>Z(P.error)),J.src=K,V.addOnDestroy(()=>{J.pause(),J.removeEventListener("playing",B),J.removeEventListener("loadmetadata",Y)})})}static async loadWebcam(K){return new Promise((Q,$)=>{const Z=document.createElement("video"),J=new x(Z);Z.loop=!0;const V=()=>Z.play(),Y=()=>Q(J);Z.addEventListener("loadedmetadata",V),Z.addEventListener("playing",Y,{once:!0}),Z.addEventListener("error",(P)=>$(P.error));let B=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:K}}).then((P)=>{if(!B)Z.srcObject=P,J.addOnDestroy(()=>P.getTracks().forEach((F)=>F.stop()))}),J.addOnDestroy(()=>{B=!0,Z.pause(),Z.removeEventListener("playing",Y),Z.removeEventListener("loadmetadata",V)})})}}class k0 extends g{constructor(){super(...arguments)}images=[];hasImageId(K){return!!this.getMedia(K)}getMedia(K){return this.images[K]}setImage(K,Q){this.images[K]=Q}async drawImage(K,Q){const $=new OffscreenCanvas(1,1);Q($.getContext("2d"));const Z=x.createFromCanvas($);return this.images[K]=this.own(Z),Z}async loadCanvas(K,Q){const $=x.createFromCanvas(Q);return Q.getContext("2d"),this.images[K]=this.own($),$}async loadImage(K,Q){const $=await x.loadImage(Q);return this.images[K]=this.own($),$}async loadVideo(K,Q,$){const Z=await x.loadVideo(Q,$);return this.images[K]=this.own(Z),Z}async loadWebCam(K,Q){const $=await x.loadWebcam(Q);return this.images[K]=this.own($),$}}var kK=`#version 300 es
//  ~{AUTHOR}

precision highp float;

//  IN
//  shape
layout(location = 0) in vec4 position_and_tex;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec3 slotSize_and_number;

//  UNIFORM
uniform float maxTextureSize;
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  vec2 position = position_and_tex.xy;
  vec2 tex = position_and_tex.zw;
  vec2 slotSize = slotSize_and_number.xy;
  float slotNumber = slotSize_and_number.z;
  float maxCols = maxTextureSize / slotSize.x;
  float maxRows = maxTextureSize / slotSize.y;
  float slotX = mod(slotNumber, maxCols);
  float slotY = mod(floor(slotNumber / maxCols), maxRows);

  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = (vec2(slotX, slotY) + tex) * slotSize / maxTextureSize;
  textureIndex = floor(slotNumber / (maxCols * maxRows));
}
`;var qK=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function q0(K,Q){return K.replace(/~\{(\w+)\}/g,($,Z)=>{return Q?.[Z]||$})}class L0 extends L{constructor(){super(...arguments)}perspectiveMatrix=L.create();orthoMatrix=L.create();perspectiveLevel=1;configPerspectiveMatrix(K){this.perspectiveMatrix.perspective(45,K,0.01,1000)}configOrthoMatrix(K){this.orthoMatrix.ortho(-K,K,-1,1,-1000,1000)}configure(K){this.configPerspectiveMatrix(K),this.configOrthoMatrix(K)}setPerspective(K){this.perspectiveLevel=K,this.combine(this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel)}}class i{gl;uniforms;camPositionMatrix=L.create().translate(0,0,-1);projectionMatrix=new L0;needsRefresh=!1;constructor(K,Q){this.gl=K,this.uniforms=Q}configProjectionMatrix(K){this.projectionMatrix.configure(K),this.updatePerspective(1)}camTiltMatrix=L.create();camTurnMatrix=L.create();camMatrix=L.create();refresh(){if(!this.needsRefresh)return!1;this.camMatrix.multiply3(this.camTiltMatrix,this.camTurnMatrix,this.camPositionMatrix);const K=this.uniforms.getUniformLocation(_K);return this.gl.uniformMatrix4fv(K,!1,this.camMatrix.getMatrix()),!0}updatePerspective(K){this.projectionMatrix.setPerspective(K);const Q=this.uniforms.getUniformLocation(RK);this.gl.uniformMatrix4fv(Q,!1,this.projectionMatrix.getMatrix()),this.needsRefresh=!0}moveCam(K,Q,$){this.camPositionMatrix.moveMatrix(K,Q,$,this.camTurnMatrix),this.needsRefresh=!0}turnCam(K){this.camTurnMatrix.rotateY(K),this.needsRefresh=!0}tilt(K){this.camTiltMatrix.rotateX(K),this.needsRefresh=!0}static invertedCamTurnMatrix=L.create();static invertedCamTiltMatrix=L.create();static syncHud(K,Q){Q?.identity().translateToMatrix(K.camPositionMatrix).multiply(i.invertedCamTurnMatrix.invert(K.camTurnMatrix)).multiply(i.invertedCamTiltMatrix.invert(K.camTiltMatrix)).translate(0,0,-0.9)}}var x$=function(K){if(!c$)return K;return new Proxy(K,{get($,Z){const J=$,V=J[Z];if(typeof V==="function")return(...B)=>{const P=V.apply(J,B);return console.log(`gl.${String(Z)}(`,B,") = ",P),P};else return console.log(`gl.${String(Z)} = `,V),V}})},y$={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},c$=!1;class u extends g{gl;programs;attributeBuffers;uniforms;canvas;textureManager;imageManager;camera;world;constructor(K,{attributes:Q,world:$}={}){super();this.gl=x$(K.getContext("webgl2",{...y$,...Q})),this.canvas=K,this.programs=this.own(new E0(this.gl)),this.uniforms=this.own(new _0(this.gl,this.programs)),this.attributeBuffers=this.own(new A0(this.gl,this.programs)),this.textureManager=new T0(this.gl,this.uniforms),this.imageManager=new k0,this.camera=new i(this.gl,this.uniforms),this.world=$,window.addEventListener("resize",this.checkCanvasSize.bind(this))}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const K=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configProjectionMatrix(K)}async initialize(){const Q={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",q0(kK,Q),q0(qK,Q)),this.programs.useProgram("main"),this.gl.enable(j.DEPTH_TEST),this.gl.depthFunc(j.LESS),this.gl.clearDepth(1),this.gl.enable(j.BLEND),this.gl.blendFunc(j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const $=jK;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(j.ELEMENT_ARRAY_BUFFER,Z),this.attributeBuffers.bufferData(j.ELEMENT_ARRAY_BUFFER,$,Uint16Array.from([0,1,2,2,3,0]),0,j.STATIC_DRAW)}{const $=EK;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(j.ARRAY_BUFFER,Z),this.gl.vertexAttribPointer(Z.location,4,j.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(Z.location),this.attributeBuffers.bufferData(j.ARRAY_BUFFER,$,Float32Array.from([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),0,j.STATIC_DRAW)}{const $=U0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(j.ARRAY_BUFFER,Z);for(let V=0;V<4;V++){const Y=Z.location+V;this.gl.vertexAttribPointer(Y,4,j.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,V*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(Y),this.gl.vertexAttribDivisor(Y,1)}const J=this.world?.getSpriteCount()??0;this.attributeBuffers.bufferData(j.ARRAY_BUFFER,$,new Float32Array(J*4*4),0,j.DYNAMIC_DRAW);for(let V=0;V<J;V++)this.updateSprite(V);this.textureManager.initialize()}await this.loadTextures(),this.checkCanvasSize()}static spriteMatrix=L.create();updateSprite(K){u.spriteMatrix.identity();const Q=u.spriteMatrix.getMatrix();this.world?.getSprite(K)?.transforms.forEach((Z)=>k.multiply(Q,Q,Z)),this.attributeBuffers.bufferSubData(j.ARRAY_BUFFER,Q,16*Float32Array.BYTES_PER_ELEMENT*K)}async loadTextures(){const K=this.world?.getSpriteCount()??0;for(let $=0;$<K;$++)await this.imageManager.drawImage($,(Z)=>{this.world?.drawImage($,Z)});this.textureManager.generateMipMaps();{const $=AK;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(j.ARRAY_BUFFER,Z);const J=Z.location;this.gl.vertexAttribPointer(J,3,j.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(J),this.gl.vertexAttribDivisor(J,1),this.attributeBuffers.bufferData(j.ARRAY_BUFFER,$,new Float32Array((this.world?.getSpriteCount()??0)*3),0,j.DYNAMIC_DRAW)}const Q=this.world?.getSpriteCount()??0;for(let $=0;$<Q;$++){const Z=this.world?.getSprite($);if(Z?.imageId!==void 0){const J=this.imageManager.getMedia(Z.imageId),{slot:V}=this.textureManager.allocateSlotForImage(J);this.attributeBuffers.bufferSubData(j.ARRAY_BUFFER,Float32Array.from([...V.size,V.slotNumber]),3*Float32Array.BYTES_PER_ELEMENT*$)}}}drawElementsInstanced(K,Q){this.gl.drawElementsInstanced(j.TRIANGLES,K,j.UNSIGNED_SHORT,0,Q)}refresh(){this.gl.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT);const K=6,Q=this.world?.getSpriteCount()??0;if(this.camera.refresh()){const $=this.world?.getHudSpriteId();if($!==void 0){i.syncHud(this.camera,this.world?.getHudMatrix());const Z=this.attributeBuffers.getAttributeBuffer(U0);this.attributeBuffers.bindBuffer(j.ARRAY_BUFFER,Z),this.updateSprite($)}}this.drawElementsInstanced(K,Q)}bindVertexArray(){return this.own(new j0(this.gl))}}async function QJ(){console.log("Hello World!")}function $J(K){K.style.border="2px solid silver",K.style.cursor="grab",K.addEventListener("mouseenter",()=>{K.style.borderColor="black"}),K.addEventListener("mouseleave",()=>{K.style.borderColor="silver"});const Q=new u(K,{world:new W0});Q.initialize();const $={};document.addEventListener("keydown",(J)=>{$[J.code]=!0}),document.addEventListener("keyup",(J)=>{$[J.code]=!1});function Z(){if($.KeyW)Q.camera.moveCam(0,0,0.25);if($.KeyS)Q.camera.moveCam(0,0,-0.25);if($.ArrowUp&&!$.ShiftRight)Q.camera.moveCam(0,-0.25,0);if($.ArrowDown&&!$.ShiftRight)Q.camera.moveCam(0,0.25,0);if($.KeyA||$.ArrowLeft&&!$.ShiftRight)Q.camera.moveCam(-0.25,0,0);if($.KeyD||$.ArrowRight&&!$.ShiftRight)Q.camera.moveCam(0.25,0,0);if($.KeyQ||$.ArrowLeft&&$.ShiftRight)Q.camera.turnCam(-0.05);if($.KeyE||$.ArrowRight&&$.ShiftRight)Q.camera.turnCam(0.05);if($.ArrowUp&&$.ShiftRight)Q.camera.tilt(-0.05);if($.ArrowDown&&$.ShiftRight)Q.camera.tilt(0.05);Q.refresh(),requestAnimationFrame(Z)}return Q.refresh(),Z(),Q}export{$J as testCanvas,QJ as hello};

//# debugId=EDE7137E6B18A17664756e2164756e21
