var CQ=Object.defineProperty;var u=(Q,K)=>{for(var $ in K)CQ(Q,$,{get:K[$],enumerable:!0,configurable:!0,set:(Z)=>K[$]=()=>Z})};class g{disposables;own(Q){if(!this.disposables)this.disposables=new Set;return this.disposables.add(Q),Q}addOnDestroy(Q){this.disposables?.add({destroy:Q})}destroy(){this.disposables?.forEach((Q)=>Q.destroy())}}var JQ=function(Q,K,$){function Z(Y,P){function M(H){return H===Q?.VERTEX_SHADER?"vertex":H===Q?.FRAGMENT_SHADER?"fragment":void 0}if(P!==Q.VERTEX_SHADER&&P!==Q.FRAGMENT_SHADER)throw new Error(`Shader error in ${M(P)}`);const W=Q.createShader(P);if(!W)throw new Error(`Unable to generate ${M(P)} shader.`);if(Q.shaderSource(W,Y),Q.compileShader(W),!Q.getShaderParameter(W,Q.COMPILE_STATUS))console.error(`Shader compile error in ${M(P)}:`+Q.getShaderInfoLog(W));return W}const C=Q.createProgram();if(!C)throw new Error("Unable to create program.");const J=Z(K,Q.VERTEX_SHADER),N=Z($,Q.FRAGMENT_SHADER),V=Q.getShaderInfoLog(J),B=Q.getShaderInfoLog(N);if(V)console.log("VERTEX",V);if(B)console.log("FRAGMENT",B);Q.attachShader(C,J),Q.attachShader(C,N),Q.linkProgram(C);const F=Q.getProgramInfoLog(C);if(F)console.log("PROGRAM",F);if(Q.detachShader(C,J),Q.detachShader(C,N),Q.deleteShader(J),Q.deleteShader(N),Q.validateProgram(C),Object.entries(WebGL2RenderingContext).forEach(([Y,P])=>{if(P&&Q.getError()===P)console.log(`gl.${Y}`)}),!Q.getProgramParameter(C,Q.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+Q.getProgramInfoLog(C));return C},NQ=function(Q,K){Q.deleteProgram(K)};class o extends g{gl;program;constructor(Q,K,$){super();this.gl=Q,this.program=JQ(Q,K.trim(),$.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),NQ(this.gl,this.program)}}class t extends g{activeProgramId="";gl;programs={};constructor(Q){super();this.gl=Q}addProgram(Q,K,$){if(this.programs[Q])this.removeProgram(Q);this.programs[Q]=this.own(new o(this.gl,K,$))}useProgram(Q){if(this.activeProgramId!==Q)this.activeProgramId=Q,this.programs[Q].use()}removeProgram(Q){this.programs[Q].destroy(),delete this.programs[Q]}getProgram(Q){return this.programs[Q??this.activeProgramId]?.program}}class a extends g{gl;triangleArray;constructor(Q){super();this.gl=Q,this.triangleArray=Q.createVertexArray(),Q.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class Q0 extends g{bufferRecord={};lastBoundBuffer;gl;programs;constructor(Q,K){super();this.gl=Q,this.programs=K}getAttributeLocation(Q,K){const $=this.programs.getProgram(K);return $?this.gl.getAttribLocation($,Q)??-1:-1}createBuffer(Q){this.deleteBuffer(Q);const K=this.gl?.createBuffer();if(!K)throw new Error(`Unable to create buffer "${Q}"`);const $={buffer:K,location:this.getAttributeLocation(Q)};return this.bufferRecord[Q]=$,$}deleteBuffer(Q){if(this.bufferRecord[Q])this.gl.deleteBuffer(this.bufferRecord[Q].buffer),delete this.bufferRecord[Q]}getAttributeBuffer(Q,K){const $=this.bufferRecord[Q];if(!$){if(K)return this.createBuffer(Q);throw new Error(`Attribute "${Q}" not created. Make sure "createBuffer" is called.`)}return $}bufferData(Q,K,$,Z,C){const J=this.getAttributeBuffer(K);if($)this.gl.bufferData(Q,$,C);else this.gl.bufferData(Q,Z,C);J.bufferSize=Z||$?.length,J.bufferArray=$??new Float32Array(J.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),J.usage=C,J.target=Q}bufferSubData(Q,K,$,Z,C){if(Z)this.gl.bufferSubData(Q,$,K,Z,C);else this.gl.bufferSubData(Q,$,K)}bindBuffer(Q,K){if(this.lastBoundBuffer!==K)this.lastBoundBuffer=K,this.gl.bindBuffer(Q,K.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((Q)=>this.deleteBuffer(Q))}}class K0 extends g{gl;programs;constructor(Q,K){super();this.gl=Q,this.programs=K}getUniformLocation(Q,K){const $=this.programs.getProgram(K);return $?this.gl.getUniformLocation($,Q)??void 0:void 0}}var O=WebGL2RenderingContext,$0="position",W0="index",M0="transform",X0="tex",H0="slotSize",U0="cam";var h=0.000001,S=typeof Float32Array!=="undefined"?Float32Array:Array,f=Math.random,S$=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var Q=0,K=arguments.length;while(K--)Q+=arguments[K]*arguments[K];return Math.sqrt(Q)};function O0(){var Q=new S(9);if(S!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[5]=0,Q[6]=0,Q[7]=0;return Q[0]=1,Q[4]=1,Q[8]=1,Q}var k={};u(k,{transpose:()=>{{return WQ}},translate:()=>{{return UQ}},targetTo:()=>{{return lQ}},subtract:()=>{{return j0}},sub:()=>{{return oQ}},str:()=>{{return xQ}},set:()=>{{return EQ}},scale:()=>{{return OQ}},rotateZ:()=>{{return TQ}},rotateY:()=>{{return RQ}},rotateX:()=>{{return AQ}},rotate:()=>{{return DQ}},perspectiveZO:()=>{{return zQ}},perspectiveNO:()=>{{return k0}},perspectiveFromFieldOfView:()=>{{return fQ}},perspective:()=>{{return nQ}},orthoZO:()=>{{return iQ}},orthoNO:()=>{{return h0}},ortho:()=>{{return dQ}},multiplyScalarAndAdd:()=>{{return rQ}},multiplyScalar:()=>{{return sQ}},multiply:()=>{{return A0}},mul:()=>{{return uQ}},lookAt:()=>{{return yQ}},invert:()=>{{return MQ}},identity:()=>{{return D0}},getTranslation:()=>{{return qQ}},getScaling:()=>{{return T0}},getRotation:()=>{{return IQ}},frustum:()=>{{return gQ}},fromZRotation:()=>{{return GQ}},fromYRotation:()=>{{return SQ}},fromXRotation:()=>{{return _Q}},fromValues:()=>{{return PQ}},fromTranslation:()=>{{return kQ}},fromScaling:()=>{{return hQ}},fromRotationTranslationScaleOrigin:()=>{{return pQ}},fromRotationTranslationScale:()=>{{return wQ}},fromRotationTranslation:()=>{{return R0}},fromRotation:()=>{{return jQ}},fromQuat2:()=>{{return LQ}},fromQuat:()=>{{return vQ}},frob:()=>{{return cQ}},exactEquals:()=>{{return eQ}},equals:()=>{{return bQ}},determinant:()=>{{return HQ}},create:()=>{{return BQ}},copy:()=>{{return YQ}},clone:()=>{{return FQ}},adjoint:()=>{{return XQ}},add:()=>{{return mQ}}});function BQ(){var Q=new S(16);if(S!=Float32Array)Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0;return Q[0]=1,Q[5]=1,Q[10]=1,Q[15]=1,Q}function FQ(Q){var K=new S(16);return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function YQ(Q,K){return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function PQ(Q,K,$,Z,C,J,N,V,B,F,Y,P,M,W,H,X){var E=new S(16);return E[0]=Q,E[1]=K,E[2]=$,E[3]=Z,E[4]=C,E[5]=J,E[6]=N,E[7]=V,E[8]=B,E[9]=F,E[10]=Y,E[11]=P,E[12]=M,E[13]=W,E[14]=H,E[15]=X,E}function EQ(Q,K,$,Z,C,J,N,V,B,F,Y,P,M,W,H,X,E){return Q[0]=K,Q[1]=$,Q[2]=Z,Q[3]=C,Q[4]=J,Q[5]=N,Q[6]=V,Q[7]=B,Q[8]=F,Q[9]=Y,Q[10]=P,Q[11]=M,Q[12]=W,Q[13]=H,Q[14]=X,Q[15]=E,Q}function D0(Q){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function WQ(Q,K){if(Q===K){var $=K[1],Z=K[2],C=K[3],J=K[6],N=K[7],V=K[11];Q[1]=K[4],Q[2]=K[8],Q[3]=K[12],Q[4]=$,Q[6]=K[9],Q[7]=K[13],Q[8]=Z,Q[9]=J,Q[11]=K[14],Q[12]=C,Q[13]=N,Q[14]=V}else Q[0]=K[0],Q[1]=K[4],Q[2]=K[8],Q[3]=K[12],Q[4]=K[1],Q[5]=K[5],Q[6]=K[9],Q[7]=K[13],Q[8]=K[2],Q[9]=K[6],Q[10]=K[10],Q[11]=K[14],Q[12]=K[3],Q[13]=K[7],Q[14]=K[11],Q[15]=K[15];return Q}function MQ(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[3],N=K[4],V=K[5],B=K[6],F=K[7],Y=K[8],P=K[9],M=K[10],W=K[11],H=K[12],X=K[13],E=K[14],U=K[15],j=$*V-Z*N,T=$*B-C*N,R=$*F-J*N,D=Z*B-C*V,A=Z*F-J*V,I=C*F-J*B,G=Y*X-P*H,L=Y*E-M*H,q=Y*U-W*H,w=P*E-M*X,p=P*U-W*X,v=M*U-W*E,_=j*v-T*p+R*w+D*q-A*L+I*G;if(!_)return null;return _=1/_,Q[0]=(V*v-B*p+F*w)*_,Q[1]=(C*p-Z*v-J*w)*_,Q[2]=(X*I-E*A+U*D)*_,Q[3]=(M*A-P*I-W*D)*_,Q[4]=(B*q-N*v-F*L)*_,Q[5]=($*v-C*q+J*L)*_,Q[6]=(E*R-H*I-U*T)*_,Q[7]=(Y*I-M*R+W*T)*_,Q[8]=(N*p-V*q+F*G)*_,Q[9]=(Z*q-$*p-J*G)*_,Q[10]=(H*A-X*R+U*j)*_,Q[11]=(P*R-Y*A-W*j)*_,Q[12]=(V*L-N*w-B*G)*_,Q[13]=($*w-Z*L+C*G)*_,Q[14]=(X*T-H*D-E*j)*_,Q[15]=(Y*D-P*T+M*j)*_,Q}function XQ(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[3],N=K[4],V=K[5],B=K[6],F=K[7],Y=K[8],P=K[9],M=K[10],W=K[11],H=K[12],X=K[13],E=K[14],U=K[15];return Q[0]=V*(M*U-W*E)-P*(B*U-F*E)+X*(B*W-F*M),Q[1]=-(Z*(M*U-W*E)-P*(C*U-J*E)+X*(C*W-J*M)),Q[2]=Z*(B*U-F*E)-V*(C*U-J*E)+X*(C*F-J*B),Q[3]=-(Z*(B*W-F*M)-V*(C*W-J*M)+P*(C*F-J*B)),Q[4]=-(N*(M*U-W*E)-Y*(B*U-F*E)+H*(B*W-F*M)),Q[5]=$*(M*U-W*E)-Y*(C*U-J*E)+H*(C*W-J*M),Q[6]=-($*(B*U-F*E)-N*(C*U-J*E)+H*(C*F-J*B)),Q[7]=$*(B*W-F*M)-N*(C*W-J*M)+Y*(C*F-J*B),Q[8]=N*(P*U-W*X)-Y*(V*U-F*X)+H*(V*W-F*P),Q[9]=-($*(P*U-W*X)-Y*(Z*U-J*X)+H*(Z*W-J*P)),Q[10]=$*(V*U-F*X)-N*(Z*U-J*X)+H*(Z*F-J*V),Q[11]=-($*(V*W-F*P)-N*(Z*W-J*P)+Y*(Z*F-J*V)),Q[12]=-(N*(P*E-M*X)-Y*(V*E-B*X)+H*(V*M-B*P)),Q[13]=$*(P*E-M*X)-Y*(Z*E-C*X)+H*(Z*M-C*P),Q[14]=-($*(V*E-B*X)-N*(Z*E-C*X)+H*(Z*B-C*V)),Q[15]=$*(V*M-B*P)-N*(Z*M-C*P)+Y*(Z*B-C*V),Q}function HQ(Q){var K=Q[0],$=Q[1],Z=Q[2],C=Q[3],J=Q[4],N=Q[5],V=Q[6],B=Q[7],F=Q[8],Y=Q[9],P=Q[10],M=Q[11],W=Q[12],H=Q[13],X=Q[14],E=Q[15],U=K*N-$*J,j=K*V-Z*J,T=K*B-C*J,R=$*V-Z*N,D=$*B-C*N,A=Z*B-C*V,I=F*H-Y*W,G=F*X-P*W,L=F*E-M*W,q=Y*X-P*H,w=Y*E-M*H,p=P*E-M*X;return U*p-j*w+T*q+R*L-D*G+A*I}function A0(Q,K,$){var Z=K[0],C=K[1],J=K[2],N=K[3],V=K[4],B=K[5],F=K[6],Y=K[7],P=K[8],M=K[9],W=K[10],H=K[11],X=K[12],E=K[13],U=K[14],j=K[15],T=$[0],R=$[1],D=$[2],A=$[3];return Q[0]=T*Z+R*V+D*P+A*X,Q[1]=T*C+R*B+D*M+A*E,Q[2]=T*J+R*F+D*W+A*U,Q[3]=T*N+R*Y+D*H+A*j,T=$[4],R=$[5],D=$[6],A=$[7],Q[4]=T*Z+R*V+D*P+A*X,Q[5]=T*C+R*B+D*M+A*E,Q[6]=T*J+R*F+D*W+A*U,Q[7]=T*N+R*Y+D*H+A*j,T=$[8],R=$[9],D=$[10],A=$[11],Q[8]=T*Z+R*V+D*P+A*X,Q[9]=T*C+R*B+D*M+A*E,Q[10]=T*J+R*F+D*W+A*U,Q[11]=T*N+R*Y+D*H+A*j,T=$[12],R=$[13],D=$[14],A=$[15],Q[12]=T*Z+R*V+D*P+A*X,Q[13]=T*C+R*B+D*M+A*E,Q[14]=T*J+R*F+D*W+A*U,Q[15]=T*N+R*Y+D*H+A*j,Q}function UQ(Q,K,$){var Z=$[0],C=$[1],J=$[2],N,V,B,F,Y,P,M,W,H,X,E,U;if(K===Q)Q[12]=K[0]*Z+K[4]*C+K[8]*J+K[12],Q[13]=K[1]*Z+K[5]*C+K[9]*J+K[13],Q[14]=K[2]*Z+K[6]*C+K[10]*J+K[14],Q[15]=K[3]*Z+K[7]*C+K[11]*J+K[15];else N=K[0],V=K[1],B=K[2],F=K[3],Y=K[4],P=K[5],M=K[6],W=K[7],H=K[8],X=K[9],E=K[10],U=K[11],Q[0]=N,Q[1]=V,Q[2]=B,Q[3]=F,Q[4]=Y,Q[5]=P,Q[6]=M,Q[7]=W,Q[8]=H,Q[9]=X,Q[10]=E,Q[11]=U,Q[12]=N*Z+Y*C+H*J+K[12],Q[13]=V*Z+P*C+X*J+K[13],Q[14]=B*Z+M*C+E*J+K[14],Q[15]=F*Z+W*C+U*J+K[15];return Q}function OQ(Q,K,$){var Z=$[0],C=$[1],J=$[2];return Q[0]=K[0]*Z,Q[1]=K[1]*Z,Q[2]=K[2]*Z,Q[3]=K[3]*Z,Q[4]=K[4]*C,Q[5]=K[5]*C,Q[6]=K[6]*C,Q[7]=K[7]*C,Q[8]=K[8]*J,Q[9]=K[9]*J,Q[10]=K[10]*J,Q[11]=K[11]*J,Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function DQ(Q,K,$,Z){var C=Z[0],J=Z[1],N=Z[2],V=Math.hypot(C,J,N),B,F,Y,P,M,W,H,X,E,U,j,T,R,D,A,I,G,L,q,w,p,v,_,n;if(V<h)return null;if(V=1/V,C*=V,J*=V,N*=V,B=Math.sin($),F=Math.cos($),Y=1-F,P=K[0],M=K[1],W=K[2],H=K[3],X=K[4],E=K[5],U=K[6],j=K[7],T=K[8],R=K[9],D=K[10],A=K[11],I=C*C*Y+F,G=J*C*Y+N*B,L=N*C*Y-J*B,q=C*J*Y-N*B,w=J*J*Y+F,p=N*J*Y+C*B,v=C*N*Y+J*B,_=J*N*Y-C*B,n=N*N*Y+F,Q[0]=P*I+X*G+T*L,Q[1]=M*I+E*G+R*L,Q[2]=W*I+U*G+D*L,Q[3]=H*I+j*G+A*L,Q[4]=P*q+X*w+T*p,Q[5]=M*q+E*w+R*p,Q[6]=W*q+U*w+D*p,Q[7]=H*q+j*w+A*p,Q[8]=P*v+X*_+T*n,Q[9]=M*v+E*_+R*n,Q[10]=W*v+U*_+D*n,Q[11]=H*v+j*_+A*n,K!==Q)Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q}function AQ(Q,K,$){var Z=Math.sin($),C=Math.cos($),J=K[4],N=K[5],V=K[6],B=K[7],F=K[8],Y=K[9],P=K[10],M=K[11];if(K!==Q)Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q[4]=J*C+F*Z,Q[5]=N*C+Y*Z,Q[6]=V*C+P*Z,Q[7]=B*C+M*Z,Q[8]=F*C-J*Z,Q[9]=Y*C-N*Z,Q[10]=P*C-V*Z,Q[11]=M*C-B*Z,Q}function RQ(Q,K,$){var Z=Math.sin($),C=Math.cos($),J=K[0],N=K[1],V=K[2],B=K[3],F=K[8],Y=K[9],P=K[10],M=K[11];if(K!==Q)Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q[0]=J*C-F*Z,Q[1]=N*C-Y*Z,Q[2]=V*C-P*Z,Q[3]=B*C-M*Z,Q[8]=J*Z+F*C,Q[9]=N*Z+Y*C,Q[10]=V*Z+P*C,Q[11]=B*Z+M*C,Q}function TQ(Q,K,$){var Z=Math.sin($),C=Math.cos($),J=K[0],N=K[1],V=K[2],B=K[3],F=K[4],Y=K[5],P=K[6],M=K[7];if(K!==Q)Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15];return Q[0]=J*C+F*Z,Q[1]=N*C+Y*Z,Q[2]=V*C+P*Z,Q[3]=B*C+M*Z,Q[4]=F*C-J*Z,Q[5]=Y*C-N*Z,Q[6]=P*C-V*Z,Q[7]=M*C-B*Z,Q}function kQ(Q,K){return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=K[0],Q[13]=K[1],Q[14]=K[2],Q[15]=1,Q}function hQ(Q,K){return Q[0]=K[0],Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=K[1],Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=K[2],Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function jQ(Q,K,$){var Z=$[0],C=$[1],J=$[2],N=Math.hypot(Z,C,J),V,B,F;if(N<h)return null;return N=1/N,Z*=N,C*=N,J*=N,V=Math.sin(K),B=Math.cos(K),F=1-B,Q[0]=Z*Z*F+B,Q[1]=C*Z*F+J*V,Q[2]=J*Z*F-C*V,Q[3]=0,Q[4]=Z*C*F-J*V,Q[5]=C*C*F+B,Q[6]=J*C*F+Z*V,Q[7]=0,Q[8]=Z*J*F+C*V,Q[9]=C*J*F-Z*V,Q[10]=J*J*F+B,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function _Q(Q,K){var $=Math.sin(K),Z=Math.cos(K);return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z,Q[6]=$,Q[7]=0,Q[8]=0,Q[9]=-$,Q[10]=Z,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function SQ(Q,K){var $=Math.sin(K),Z=Math.cos(K);return Q[0]=Z,Q[1]=0,Q[2]=-$,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=$,Q[9]=0,Q[10]=Z,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function GQ(Q,K){var $=Math.sin(K),Z=Math.cos(K);return Q[0]=Z,Q[1]=$,Q[2]=0,Q[3]=0,Q[4]=-$,Q[5]=Z,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function R0(Q,K,$){var Z=K[0],C=K[1],J=K[2],N=K[3],V=Z+Z,B=C+C,F=J+J,Y=Z*V,P=Z*B,M=Z*F,W=C*B,H=C*F,X=J*F,E=N*V,U=N*B,j=N*F;return Q[0]=1-(W+X),Q[1]=P+j,Q[2]=M-U,Q[3]=0,Q[4]=P-j,Q[5]=1-(Y+X),Q[6]=H+E,Q[7]=0,Q[8]=M+U,Q[9]=H-E,Q[10]=1-(Y+W),Q[11]=0,Q[12]=$[0],Q[13]=$[1],Q[14]=$[2],Q[15]=1,Q}function LQ(Q,K){var $=new S(3),Z=-K[0],C=-K[1],J=-K[2],N=K[3],V=K[4],B=K[5],F=K[6],Y=K[7],P=Z*Z+C*C+J*J+N*N;if(P>0)$[0]=(V*N+Y*Z+B*J-F*C)*2/P,$[1]=(B*N+Y*C+F*Z-V*J)*2/P,$[2]=(F*N+Y*J+V*C-B*Z)*2/P;else $[0]=(V*N+Y*Z+B*J-F*C)*2,$[1]=(B*N+Y*C+F*Z-V*J)*2,$[2]=(F*N+Y*J+V*C-B*Z)*2;return R0(Q,K,$),Q}function qQ(Q,K){return Q[0]=K[12],Q[1]=K[13],Q[2]=K[14],Q}function T0(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[4],N=K[5],V=K[6],B=K[8],F=K[9],Y=K[10];return Q[0]=Math.hypot($,Z,C),Q[1]=Math.hypot(J,N,V),Q[2]=Math.hypot(B,F,Y),Q}function IQ(Q,K){var $=new S(3);T0($,K);var Z=1/$[0],C=1/$[1],J=1/$[2],N=K[0]*Z,V=K[1]*C,B=K[2]*J,F=K[4]*Z,Y=K[5]*C,P=K[6]*J,M=K[8]*Z,W=K[9]*C,H=K[10]*J,X=N+Y+H,E=0;if(X>0)E=Math.sqrt(X+1)*2,Q[3]=0.25*E,Q[0]=(P-W)/E,Q[1]=(M-B)/E,Q[2]=(V-F)/E;else if(N>Y&&N>H)E=Math.sqrt(1+N-Y-H)*2,Q[3]=(P-W)/E,Q[0]=0.25*E,Q[1]=(V+F)/E,Q[2]=(M+B)/E;else if(Y>H)E=Math.sqrt(1+Y-N-H)*2,Q[3]=(M-B)/E,Q[0]=(V+F)/E,Q[1]=0.25*E,Q[2]=(P+W)/E;else E=Math.sqrt(1+H-N-Y)*2,Q[3]=(V-F)/E,Q[0]=(M+B)/E,Q[1]=(P+W)/E,Q[2]=0.25*E;return Q}function wQ(Q,K,$,Z){var C=K[0],J=K[1],N=K[2],V=K[3],B=C+C,F=J+J,Y=N+N,P=C*B,M=C*F,W=C*Y,H=J*F,X=J*Y,E=N*Y,U=V*B,j=V*F,T=V*Y,R=Z[0],D=Z[1],A=Z[2];return Q[0]=(1-(H+E))*R,Q[1]=(M+T)*R,Q[2]=(W-j)*R,Q[3]=0,Q[4]=(M-T)*D,Q[5]=(1-(P+E))*D,Q[6]=(X+U)*D,Q[7]=0,Q[8]=(W+j)*A,Q[9]=(X-U)*A,Q[10]=(1-(P+H))*A,Q[11]=0,Q[12]=$[0],Q[13]=$[1],Q[14]=$[2],Q[15]=1,Q}function pQ(Q,K,$,Z,C){var J=K[0],N=K[1],V=K[2],B=K[3],F=J+J,Y=N+N,P=V+V,M=J*F,W=J*Y,H=J*P,X=N*Y,E=N*P,U=V*P,j=B*F,T=B*Y,R=B*P,D=Z[0],A=Z[1],I=Z[2],G=C[0],L=C[1],q=C[2],w=(1-(X+U))*D,p=(W+R)*D,v=(H-T)*D,_=(W-R)*A,n=(1-(M+U))*A,i=(E+j)*A,y=(H+T)*I,P0=(E-j)*I,E0=(1-(M+X))*I;return Q[0]=w,Q[1]=p,Q[2]=v,Q[3]=0,Q[4]=_,Q[5]=n,Q[6]=i,Q[7]=0,Q[8]=y,Q[9]=P0,Q[10]=E0,Q[11]=0,Q[12]=$[0]+G-(w*G+_*L+y*q),Q[13]=$[1]+L-(p*G+n*L+P0*q),Q[14]=$[2]+q-(v*G+i*L+E0*q),Q[15]=1,Q}function vQ(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[3],N=$+$,V=Z+Z,B=C+C,F=$*N,Y=Z*N,P=Z*V,M=C*N,W=C*V,H=C*B,X=J*N,E=J*V,U=J*B;return Q[0]=1-P-H,Q[1]=Y+U,Q[2]=M-E,Q[3]=0,Q[4]=Y-U,Q[5]=1-F-H,Q[6]=W+X,Q[7]=0,Q[8]=M+E,Q[9]=W-X,Q[10]=1-F-P,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function gQ(Q,K,$,Z,C,J,N){var V=1/($-K),B=1/(C-Z),F=1/(J-N);return Q[0]=J*2*V,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=J*2*B,Q[6]=0,Q[7]=0,Q[8]=($+K)*V,Q[9]=(C+Z)*B,Q[10]=(N+J)*F,Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=N*J*2*F,Q[15]=0,Q}function k0(Q,K,$,Z,C){var J=1/Math.tan(K/2),N;if(Q[0]=J/$,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=J,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,C!=null&&C!==Infinity)N=1/(Z-C),Q[10]=(C+Z)*N,Q[14]=2*C*Z*N;else Q[10]=-1,Q[14]=-2*Z;return Q}function zQ(Q,K,$,Z,C){var J=1/Math.tan(K/2),N;if(Q[0]=J/$,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=J,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[11]=-1,Q[12]=0,Q[13]=0,Q[15]=0,C!=null&&C!==Infinity)N=1/(Z-C),Q[10]=C*N,Q[14]=C*Z*N;else Q[10]=-1,Q[14]=-Z;return Q}function fQ(Q,K,$,Z){var C=Math.tan(K.upDegrees*Math.PI/180),J=Math.tan(K.downDegrees*Math.PI/180),N=Math.tan(K.leftDegrees*Math.PI/180),V=Math.tan(K.rightDegrees*Math.PI/180),B=2/(N+V),F=2/(C+J);return Q[0]=B,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=F,Q[6]=0,Q[7]=0,Q[8]=-((N-V)*B*0.5),Q[9]=(C-J)*F*0.5,Q[10]=Z/($-Z),Q[11]=-1,Q[12]=0,Q[13]=0,Q[14]=Z*$/($-Z),Q[15]=0,Q}function h0(Q,K,$,Z,C,J,N){var V=1/(K-$),B=1/(Z-C),F=1/(J-N);return Q[0]=-2*V,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*B,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=2*F,Q[11]=0,Q[12]=(K+$)*V,Q[13]=(C+Z)*B,Q[14]=(N+J)*F,Q[15]=1,Q}function iQ(Q,K,$,Z,C,J,N){var V=1/(K-$),B=1/(Z-C),F=1/(J-N);return Q[0]=-2*V,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-2*B,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=F,Q[11]=0,Q[12]=(K+$)*V,Q[13]=(C+Z)*B,Q[14]=J*F,Q[15]=1,Q}function yQ(Q,K,$,Z){var C,J,N,V,B,F,Y,P,M,W,H=K[0],X=K[1],E=K[2],U=Z[0],j=Z[1],T=Z[2],R=$[0],D=$[1],A=$[2];if(Math.abs(H-R)<h&&Math.abs(X-D)<h&&Math.abs(E-A)<h)return D0(Q);if(Y=H-R,P=X-D,M=E-A,W=1/Math.hypot(Y,P,M),Y*=W,P*=W,M*=W,C=j*M-T*P,J=T*Y-U*M,N=U*P-j*Y,W=Math.hypot(C,J,N),!W)C=0,J=0,N=0;else W=1/W,C*=W,J*=W,N*=W;if(V=P*N-M*J,B=M*C-Y*N,F=Y*J-P*C,W=Math.hypot(V,B,F),!W)V=0,B=0,F=0;else W=1/W,V*=W,B*=W,F*=W;return Q[0]=C,Q[1]=V,Q[2]=Y,Q[3]=0,Q[4]=J,Q[5]=B,Q[6]=P,Q[7]=0,Q[8]=N,Q[9]=F,Q[10]=M,Q[11]=0,Q[12]=-(C*H+J*X+N*E),Q[13]=-(V*H+B*X+F*E),Q[14]=-(Y*H+P*X+M*E),Q[15]=1,Q}function lQ(Q,K,$,Z){var C=K[0],J=K[1],N=K[2],V=Z[0],B=Z[1],F=Z[2],Y=C-$[0],P=J-$[1],M=N-$[2],W=Y*Y+P*P+M*M;if(W>0)W=1/Math.sqrt(W),Y*=W,P*=W,M*=W;var H=B*M-F*P,X=F*Y-V*M,E=V*P-B*Y;if(W=H*H+X*X+E*E,W>0)W=1/Math.sqrt(W),H*=W,X*=W,E*=W;return Q[0]=H,Q[1]=X,Q[2]=E,Q[3]=0,Q[4]=P*E-M*X,Q[5]=M*H-Y*E,Q[6]=Y*X-P*H,Q[7]=0,Q[8]=Y,Q[9]=P,Q[10]=M,Q[11]=0,Q[12]=C,Q[13]=J,Q[14]=N,Q[15]=1,Q}function xQ(Q){return"mat4("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+", "+Q[4]+", "+Q[5]+", "+Q[6]+", "+Q[7]+", "+Q[8]+", "+Q[9]+", "+Q[10]+", "+Q[11]+", "+Q[12]+", "+Q[13]+", "+Q[14]+", "+Q[15]+")"}function cQ(Q){return Math.hypot(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15])}function mQ(Q,K,$){return Q[0]=K[0]+$[0],Q[1]=K[1]+$[1],Q[2]=K[2]+$[2],Q[3]=K[3]+$[3],Q[4]=K[4]+$[4],Q[5]=K[5]+$[5],Q[6]=K[6]+$[6],Q[7]=K[7]+$[7],Q[8]=K[8]+$[8],Q[9]=K[9]+$[9],Q[10]=K[10]+$[10],Q[11]=K[11]+$[11],Q[12]=K[12]+$[12],Q[13]=K[13]+$[13],Q[14]=K[14]+$[14],Q[15]=K[15]+$[15],Q}function j0(Q,K,$){return Q[0]=K[0]-$[0],Q[1]=K[1]-$[1],Q[2]=K[2]-$[2],Q[3]=K[3]-$[3],Q[4]=K[4]-$[4],Q[5]=K[5]-$[5],Q[6]=K[6]-$[6],Q[7]=K[7]-$[7],Q[8]=K[8]-$[8],Q[9]=K[9]-$[9],Q[10]=K[10]-$[10],Q[11]=K[11]-$[11],Q[12]=K[12]-$[12],Q[13]=K[13]-$[13],Q[14]=K[14]-$[14],Q[15]=K[15]-$[15],Q}function sQ(Q,K,$){return Q[0]=K[0]*$,Q[1]=K[1]*$,Q[2]=K[2]*$,Q[3]=K[3]*$,Q[4]=K[4]*$,Q[5]=K[5]*$,Q[6]=K[6]*$,Q[7]=K[7]*$,Q[8]=K[8]*$,Q[9]=K[9]*$,Q[10]=K[10]*$,Q[11]=K[11]*$,Q[12]=K[12]*$,Q[13]=K[13]*$,Q[14]=K[14]*$,Q[15]=K[15]*$,Q}function rQ(Q,K,$,Z){return Q[0]=K[0]+$[0]*Z,Q[1]=K[1]+$[1]*Z,Q[2]=K[2]+$[2]*Z,Q[3]=K[3]+$[3]*Z,Q[4]=K[4]+$[4]*Z,Q[5]=K[5]+$[5]*Z,Q[6]=K[6]+$[6]*Z,Q[7]=K[7]+$[7]*Z,Q[8]=K[8]+$[8]*Z,Q[9]=K[9]+$[9]*Z,Q[10]=K[10]+$[10]*Z,Q[11]=K[11]+$[11]*Z,Q[12]=K[12]+$[12]*Z,Q[13]=K[13]+$[13]*Z,Q[14]=K[14]+$[14]*Z,Q[15]=K[15]+$[15]*Z,Q}function eQ(Q,K){return Q[0]===K[0]&&Q[1]===K[1]&&Q[2]===K[2]&&Q[3]===K[3]&&Q[4]===K[4]&&Q[5]===K[5]&&Q[6]===K[6]&&Q[7]===K[7]&&Q[8]===K[8]&&Q[9]===K[9]&&Q[10]===K[10]&&Q[11]===K[11]&&Q[12]===K[12]&&Q[13]===K[13]&&Q[14]===K[14]&&Q[15]===K[15]}function bQ(Q,K){var $=Q[0],Z=Q[1],C=Q[2],J=Q[3],N=Q[4],V=Q[5],B=Q[6],F=Q[7],Y=Q[8],P=Q[9],M=Q[10],W=Q[11],H=Q[12],X=Q[13],E=Q[14],U=Q[15],j=K[0],T=K[1],R=K[2],D=K[3],A=K[4],I=K[5],G=K[6],L=K[7],q=K[8],w=K[9],p=K[10],v=K[11],_=K[12],n=K[13],i=K[14],y=K[15];return Math.abs($-j)<=h*Math.max(1,Math.abs($),Math.abs(j))&&Math.abs(Z-T)<=h*Math.max(1,Math.abs(Z),Math.abs(T))&&Math.abs(C-R)<=h*Math.max(1,Math.abs(C),Math.abs(R))&&Math.abs(J-D)<=h*Math.max(1,Math.abs(J),Math.abs(D))&&Math.abs(N-A)<=h*Math.max(1,Math.abs(N),Math.abs(A))&&Math.abs(V-I)<=h*Math.max(1,Math.abs(V),Math.abs(I))&&Math.abs(B-G)<=h*Math.max(1,Math.abs(B),Math.abs(G))&&Math.abs(F-L)<=h*Math.max(1,Math.abs(F),Math.abs(L))&&Math.abs(Y-q)<=h*Math.max(1,Math.abs(Y),Math.abs(q))&&Math.abs(P-w)<=h*Math.max(1,Math.abs(P),Math.abs(w))&&Math.abs(M-p)<=h*Math.max(1,Math.abs(M),Math.abs(p))&&Math.abs(W-v)<=h*Math.max(1,Math.abs(W),Math.abs(v))&&Math.abs(H-_)<=h*Math.max(1,Math.abs(H),Math.abs(_))&&Math.abs(X-n)<=h*Math.max(1,Math.abs(X),Math.abs(n))&&Math.abs(E-i)<=h*Math.max(1,Math.abs(E),Math.abs(i))&&Math.abs(U-y)<=h*Math.max(1,Math.abs(U),Math.abs(y))}var nQ=k0,dQ=h0,uQ=A0,oQ=j0;var c={};u(c,{str:()=>{{return rK}},squaredLength:()=>{{return QQ}},sqrLen:()=>{{return $$}},sqlerp:()=>{{return N$}},slerp:()=>{{return e}},setAxisAngle:()=>{{return s0}},setAxes:()=>{{return V$}},set:()=>{{return oK}},scale:()=>{{return o0}},rotationTo:()=>{{return J$}},rotateZ:()=>{{return iK}},rotateY:()=>{{return dK}},rotateX:()=>{{return fK}},random:()=>{{return xK}},pow:()=>{{return lK}},normalize:()=>{{return N0}},multiply:()=>{{return r0}},mul:()=>{{return aK}},ln:()=>{{return b0}},lerp:()=>{{return Q$}},length:()=>{{return a0}},len:()=>{{return K$}},invert:()=>{{return cK}},identity:()=>{{return gK}},getAxisAngle:()=>{{return nK}},getAngle:()=>{{return zK}},fromValues:()=>{{return bK}},fromMat3:()=>{{return u0}},fromEuler:()=>{{return sK}},exp:()=>{{return e0}},exactEquals:()=>{{return Z$}},equals:()=>{{return C$}},dot:()=>{{return t0}},create:()=>{{return J0}},copy:()=>{{return uK}},conjugate:()=>{{return mK}},clone:()=>{{return eK}},calculateW:()=>{{return yK}},add:()=>{{return tK}}});var d={};u(d,{zero:()=>{{return TK}},transformQuat:()=>{{return UK}},transformMat4:()=>{{return XK}},transformMat3:()=>{{return HK}},subtract:()=>{{return S0}},sub:()=>{{return _K}},str:()=>{{return kK}},squaredLength:()=>{{return w0}},squaredDistance:()=>{{return I0}},sqrLen:()=>{{return IK}},sqrDist:()=>{{return qK}},set:()=>{{return QK}},scaleAndAdd:()=>{{return BK}},scale:()=>{{return VK}},round:()=>{{return NK}},rotateZ:()=>{{return AK}},rotateY:()=>{{return DK}},rotateX:()=>{{return OK}},random:()=>{{return MK}},normalize:()=>{{return Z0}},negate:()=>{{return FK}},multiply:()=>{{return G0}},mul:()=>{{return SK}},min:()=>{{return CK}},max:()=>{{return JK}},lerp:()=>{{return PK}},length:()=>{{return _0}},len:()=>{{return C0}},inverse:()=>{{return YK}},hermite:()=>{{return EK}},fromValues:()=>{{return s}},forEach:()=>{{return wK}},floor:()=>{{return ZK}},exactEquals:()=>{{return hK}},equals:()=>{{return jK}},dot:()=>{{return r}},divide:()=>{{return L0}},div:()=>{{return GK}},distance:()=>{{return q0}},dist:()=>{{return LK}},cross:()=>{{return x}},create:()=>{{return m}},copy:()=>{{return aQ}},clone:()=>{{return tQ}},ceil:()=>{{return $K}},bezier:()=>{{return WK}},angle:()=>{{return RK}},add:()=>{{return KK}}});function m(){var Q=new S(3);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q}function tQ(Q){var K=new S(3);return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K}function _0(Q){var K=Q[0],$=Q[1],Z=Q[2];return Math.hypot(K,$,Z)}function s(Q,K,$){var Z=new S(3);return Z[0]=Q,Z[1]=K,Z[2]=$,Z}function aQ(Q,K){return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q}function QK(Q,K,$,Z){return Q[0]=K,Q[1]=$,Q[2]=Z,Q}function KK(Q,K,$){return Q[0]=K[0]+$[0],Q[1]=K[1]+$[1],Q[2]=K[2]+$[2],Q}function S0(Q,K,$){return Q[0]=K[0]-$[0],Q[1]=K[1]-$[1],Q[2]=K[2]-$[2],Q}function G0(Q,K,$){return Q[0]=K[0]*$[0],Q[1]=K[1]*$[1],Q[2]=K[2]*$[2],Q}function L0(Q,K,$){return Q[0]=K[0]/$[0],Q[1]=K[1]/$[1],Q[2]=K[2]/$[2],Q}function $K(Q,K){return Q[0]=Math.ceil(K[0]),Q[1]=Math.ceil(K[1]),Q[2]=Math.ceil(K[2]),Q}function ZK(Q,K){return Q[0]=Math.floor(K[0]),Q[1]=Math.floor(K[1]),Q[2]=Math.floor(K[2]),Q}function CK(Q,K,$){return Q[0]=Math.min(K[0],$[0]),Q[1]=Math.min(K[1],$[1]),Q[2]=Math.min(K[2],$[2]),Q}function JK(Q,K,$){return Q[0]=Math.max(K[0],$[0]),Q[1]=Math.max(K[1],$[1]),Q[2]=Math.max(K[2],$[2]),Q}function NK(Q,K){return Q[0]=Math.round(K[0]),Q[1]=Math.round(K[1]),Q[2]=Math.round(K[2]),Q}function VK(Q,K,$){return Q[0]=K[0]*$,Q[1]=K[1]*$,Q[2]=K[2]*$,Q}function BK(Q,K,$,Z){return Q[0]=K[0]+$[0]*Z,Q[1]=K[1]+$[1]*Z,Q[2]=K[2]+$[2]*Z,Q}function q0(Q,K){var $=K[0]-Q[0],Z=K[1]-Q[1],C=K[2]-Q[2];return Math.hypot($,Z,C)}function I0(Q,K){var $=K[0]-Q[0],Z=K[1]-Q[1],C=K[2]-Q[2];return $*$+Z*Z+C*C}function w0(Q){var K=Q[0],$=Q[1],Z=Q[2];return K*K+$*$+Z*Z}function FK(Q,K){return Q[0]=-K[0],Q[1]=-K[1],Q[2]=-K[2],Q}function YK(Q,K){return Q[0]=1/K[0],Q[1]=1/K[1],Q[2]=1/K[2],Q}function Z0(Q,K){var $=K[0],Z=K[1],C=K[2],J=$*$+Z*Z+C*C;if(J>0)J=1/Math.sqrt(J);return Q[0]=K[0]*J,Q[1]=K[1]*J,Q[2]=K[2]*J,Q}function r(Q,K){return Q[0]*K[0]+Q[1]*K[1]+Q[2]*K[2]}function x(Q,K,$){var Z=K[0],C=K[1],J=K[2],N=$[0],V=$[1],B=$[2];return Q[0]=C*B-J*V,Q[1]=J*N-Z*B,Q[2]=Z*V-C*N,Q}function PK(Q,K,$,Z){var C=K[0],J=K[1],N=K[2];return Q[0]=C+Z*($[0]-C),Q[1]=J+Z*($[1]-J),Q[2]=N+Z*($[2]-N),Q}function EK(Q,K,$,Z,C,J){var N=J*J,V=N*(2*J-3)+1,B=N*(J-2)+J,F=N*(J-1),Y=N*(3-2*J);return Q[0]=K[0]*V+$[0]*B+Z[0]*F+C[0]*Y,Q[1]=K[1]*V+$[1]*B+Z[1]*F+C[1]*Y,Q[2]=K[2]*V+$[2]*B+Z[2]*F+C[2]*Y,Q}function WK(Q,K,$,Z,C,J){var N=1-J,V=N*N,B=J*J,F=V*N,Y=3*J*V,P=3*B*N,M=B*J;return Q[0]=K[0]*F+$[0]*Y+Z[0]*P+C[0]*M,Q[1]=K[1]*F+$[1]*Y+Z[1]*P+C[1]*M,Q[2]=K[2]*F+$[2]*Y+Z[2]*P+C[2]*M,Q}function MK(Q,K){K=K||1;var $=f()*2*Math.PI,Z=f()*2-1,C=Math.sqrt(1-Z*Z)*K;return Q[0]=Math.cos($)*C,Q[1]=Math.sin($)*C,Q[2]=Z*K,Q}function XK(Q,K,$){var Z=K[0],C=K[1],J=K[2],N=$[3]*Z+$[7]*C+$[11]*J+$[15];return N=N||1,Q[0]=($[0]*Z+$[4]*C+$[8]*J+$[12])/N,Q[1]=($[1]*Z+$[5]*C+$[9]*J+$[13])/N,Q[2]=($[2]*Z+$[6]*C+$[10]*J+$[14])/N,Q}function HK(Q,K,$){var Z=K[0],C=K[1],J=K[2];return Q[0]=Z*$[0]+C*$[3]+J*$[6],Q[1]=Z*$[1]+C*$[4]+J*$[7],Q[2]=Z*$[2]+C*$[5]+J*$[8],Q}function UK(Q,K,$){var Z=$[0],C=$[1],J=$[2],N=$[3],V=K[0],B=K[1],F=K[2],Y=C*F-J*B,P=J*V-Z*F,M=Z*B-C*V,W=C*M-J*P,H=J*Y-Z*M,X=Z*P-C*Y,E=N*2;return Y*=E,P*=E,M*=E,W*=2,H*=2,X*=2,Q[0]=V+Y+W,Q[1]=B+P+H,Q[2]=F+M+X,Q}function OK(Q,K,$,Z){var C=[],J=[];return C[0]=K[0]-$[0],C[1]=K[1]-$[1],C[2]=K[2]-$[2],J[0]=C[0],J[1]=C[1]*Math.cos(Z)-C[2]*Math.sin(Z),J[2]=C[1]*Math.sin(Z)+C[2]*Math.cos(Z),Q[0]=J[0]+$[0],Q[1]=J[1]+$[1],Q[2]=J[2]+$[2],Q}function DK(Q,K,$,Z){var C=[],J=[];return C[0]=K[0]-$[0],C[1]=K[1]-$[1],C[2]=K[2]-$[2],J[0]=C[2]*Math.sin(Z)+C[0]*Math.cos(Z),J[1]=C[1],J[2]=C[2]*Math.cos(Z)-C[0]*Math.sin(Z),Q[0]=J[0]+$[0],Q[1]=J[1]+$[1],Q[2]=J[2]+$[2],Q}function AK(Q,K,$,Z){var C=[],J=[];return C[0]=K[0]-$[0],C[1]=K[1]-$[1],C[2]=K[2]-$[2],J[0]=C[0]*Math.cos(Z)-C[1]*Math.sin(Z),J[1]=C[0]*Math.sin(Z)+C[1]*Math.cos(Z),J[2]=C[2],Q[0]=J[0]+$[0],Q[1]=J[1]+$[1],Q[2]=J[2]+$[2],Q}function RK(Q,K){var $=Q[0],Z=Q[1],C=Q[2],J=K[0],N=K[1],V=K[2],B=Math.sqrt($*$+Z*Z+C*C),F=Math.sqrt(J*J+N*N+V*V),Y=B*F,P=Y&&r(Q,K)/Y;return Math.acos(Math.min(Math.max(P,-1),1))}function TK(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q}function kK(Q){return"vec3("+Q[0]+", "+Q[1]+", "+Q[2]+")"}function hK(Q,K){return Q[0]===K[0]&&Q[1]===K[1]&&Q[2]===K[2]}function jK(Q,K){var $=Q[0],Z=Q[1],C=Q[2],J=K[0],N=K[1],V=K[2];return Math.abs($-J)<=h*Math.max(1,Math.abs($),Math.abs(J))&&Math.abs(Z-N)<=h*Math.max(1,Math.abs(Z),Math.abs(N))&&Math.abs(C-V)<=h*Math.max(1,Math.abs(C),Math.abs(V))}var _K=S0,SK=G0,GK=L0,LK=q0,qK=I0,C0=_0,IK=w0,wK=function(){var Q=m();return function(K,$,Z,C,J,N){var V,B;if(!$)$=3;if(!Z)Z=0;if(C)B=Math.min(C*$+Z,K.length);else B=K.length;for(V=Z;V<B;V+=$)Q[0]=K[V],Q[1]=K[V+1],Q[2]=K[V+2],J(Q,Q,N),K[V]=Q[0],K[V+1]=Q[1],K[V+2]=Q[2];return K}}();function pK(){var Q=new S(4);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0;return Q}function p0(Q){var K=new S(4);return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K}function v0(Q,K,$,Z){var C=new S(4);return C[0]=Q,C[1]=K,C[2]=$,C[3]=Z,C}function g0(Q,K){return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q}function n0(Q,K,$,Z,C){return Q[0]=K,Q[1]=$,Q[2]=Z,Q[3]=C,Q}function z0(Q,K,$){return Q[0]=K[0]+$[0],Q[1]=K[1]+$[1],Q[2]=K[2]+$[2],Q[3]=K[3]+$[3],Q}function f0(Q,K,$){return Q[0]=K[0]*$,Q[1]=K[1]*$,Q[2]=K[2]*$,Q[3]=K[3]*$,Q}function d0(Q){var K=Q[0],$=Q[1],Z=Q[2],C=Q[3];return Math.hypot(K,$,Z,C)}function i0(Q){var K=Q[0],$=Q[1],Z=Q[2],C=Q[3];return K*K+$*$+Z*Z+C*C}function y0(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[3],N=$*$+Z*Z+C*C+J*J;if(N>0)N=1/Math.sqrt(N);return Q[0]=$*N,Q[1]=Z*N,Q[2]=C*N,Q[3]=J*N,Q}function l0(Q,K){return Q[0]*K[0]+Q[1]*K[1]+Q[2]*K[2]+Q[3]*K[3]}function x0(Q,K,$,Z){var C=K[0],J=K[1],N=K[2],V=K[3];return Q[0]=C+Z*($[0]-C),Q[1]=J+Z*($[1]-J),Q[2]=N+Z*($[2]-N),Q[3]=V+Z*($[3]-V),Q}function c0(Q,K){return Q[0]===K[0]&&Q[1]===K[1]&&Q[2]===K[2]&&Q[3]===K[3]}function m0(Q,K){var $=Q[0],Z=Q[1],C=Q[2],J=Q[3],N=K[0],V=K[1],B=K[2],F=K[3];return Math.abs($-N)<=h*Math.max(1,Math.abs($),Math.abs(N))&&Math.abs(Z-V)<=h*Math.max(1,Math.abs(Z),Math.abs(V))&&Math.abs(C-B)<=h*Math.max(1,Math.abs(C),Math.abs(B))&&Math.abs(J-F)<=h*Math.max(1,Math.abs(J),Math.abs(F))}var G$=function(){var Q=pK();return function(K,$,Z,C,J,N){var V,B;if(!$)$=4;if(!Z)Z=0;if(C)B=Math.min(C*$+Z,K.length);else B=K.length;for(V=Z;V<B;V+=$)Q[0]=K[V],Q[1]=K[V+1],Q[2]=K[V+2],Q[3]=K[V+3],J(Q,Q,N),K[V]=Q[0],K[V+1]=Q[1],K[V+2]=Q[2],K[V+3]=Q[3];return K}}();function J0(){var Q=new S(4);if(S!=Float32Array)Q[0]=0,Q[1]=0,Q[2]=0;return Q[3]=1,Q}function gK(Q){return Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q}function s0(Q,K,$){$=$*0.5;var Z=Math.sin($);return Q[0]=Z*K[0],Q[1]=Z*K[1],Q[2]=Z*K[2],Q[3]=Math.cos($),Q}function nK(Q,K){var $=Math.acos(K[3])*2,Z=Math.sin($/2);if(Z>h)Q[0]=K[0]/Z,Q[1]=K[1]/Z,Q[2]=K[2]/Z;else Q[0]=1,Q[1]=0,Q[2]=0;return $}function zK(Q,K){var $=t0(Q,K);return Math.acos(2*$*$-1)}function r0(Q,K,$){var Z=K[0],C=K[1],J=K[2],N=K[3],V=$[0],B=$[1],F=$[2],Y=$[3];return Q[0]=Z*Y+N*V+C*F-J*B,Q[1]=C*Y+N*B+J*V-Z*F,Q[2]=J*Y+N*F+Z*B-C*V,Q[3]=N*Y-Z*V-C*B-J*F,Q}function fK(Q,K,$){$*=0.5;var Z=K[0],C=K[1],J=K[2],N=K[3],V=Math.sin($),B=Math.cos($);return Q[0]=Z*B+N*V,Q[1]=C*B+J*V,Q[2]=J*B-C*V,Q[3]=N*B-Z*V,Q}function dK(Q,K,$){$*=0.5;var Z=K[0],C=K[1],J=K[2],N=K[3],V=Math.sin($),B=Math.cos($);return Q[0]=Z*B-J*V,Q[1]=C*B+N*V,Q[2]=J*B+Z*V,Q[3]=N*B-C*V,Q}function iK(Q,K,$){$*=0.5;var Z=K[0],C=K[1],J=K[2],N=K[3],V=Math.sin($),B=Math.cos($);return Q[0]=Z*B+C*V,Q[1]=C*B-Z*V,Q[2]=J*B+N*V,Q[3]=N*B-J*V,Q}function yK(Q,K){var $=K[0],Z=K[1],C=K[2];return Q[0]=$,Q[1]=Z,Q[2]=C,Q[3]=Math.sqrt(Math.abs(1-$*$-Z*Z-C*C)),Q}function e0(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[3],N=Math.sqrt($*$+Z*Z+C*C),V=Math.exp(J),B=N>0?V*Math.sin(N)/N:0;return Q[0]=$*B,Q[1]=Z*B,Q[2]=C*B,Q[3]=V*Math.cos(N),Q}function b0(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[3],N=Math.sqrt($*$+Z*Z+C*C),V=N>0?Math.atan2(N,J)/N:0;return Q[0]=$*V,Q[1]=Z*V,Q[2]=C*V,Q[3]=0.5*Math.log($*$+Z*Z+C*C+J*J),Q}function lK(Q,K,$){return b0(Q,K),o0(Q,Q,$),e0(Q,Q),Q}function e(Q,K,$,Z){var C=K[0],J=K[1],N=K[2],V=K[3],B=$[0],F=$[1],Y=$[2],P=$[3],M,W,H,X,E;if(W=C*B+J*F+N*Y+V*P,W<0)W=-W,B=-B,F=-F,Y=-Y,P=-P;if(1-W>h)M=Math.acos(W),H=Math.sin(M),X=Math.sin((1-Z)*M)/H,E=Math.sin(Z*M)/H;else X=1-Z,E=Z;return Q[0]=X*C+E*B,Q[1]=X*J+E*F,Q[2]=X*N+E*Y,Q[3]=X*V+E*P,Q}function xK(Q){var K=f(),$=f(),Z=f(),C=Math.sqrt(1-K),J=Math.sqrt(K);return Q[0]=C*Math.sin(2*Math.PI*$),Q[1]=C*Math.cos(2*Math.PI*$),Q[2]=J*Math.sin(2*Math.PI*Z),Q[3]=J*Math.cos(2*Math.PI*Z),Q}function cK(Q,K){var $=K[0],Z=K[1],C=K[2],J=K[3],N=$*$+Z*Z+C*C+J*J,V=N?1/N:0;return Q[0]=-$*V,Q[1]=-Z*V,Q[2]=-C*V,Q[3]=J*V,Q}function mK(Q,K){return Q[0]=-K[0],Q[1]=-K[1],Q[2]=-K[2],Q[3]=K[3],Q}function u0(Q,K){var $=K[0]+K[4]+K[8],Z;if($>0)Z=Math.sqrt($+1),Q[3]=0.5*Z,Z=0.5/Z,Q[0]=(K[5]-K[7])*Z,Q[1]=(K[6]-K[2])*Z,Q[2]=(K[1]-K[3])*Z;else{var C=0;if(K[4]>K[0])C=1;if(K[8]>K[C*3+C])C=2;var J=(C+1)%3,N=(C+2)%3;Z=Math.sqrt(K[C*3+C]-K[J*3+J]-K[N*3+N]+1),Q[C]=0.5*Z,Z=0.5/Z,Q[3]=(K[J*3+N]-K[N*3+J])*Z,Q[J]=(K[J*3+C]+K[C*3+J])*Z,Q[N]=(K[N*3+C]+K[C*3+N])*Z}return Q}function sK(Q,K,$,Z){var C=0.5*Math.PI/180;K*=C,$*=C,Z*=C;var J=Math.sin(K),N=Math.cos(K),V=Math.sin($),B=Math.cos($),F=Math.sin(Z),Y=Math.cos(Z);return Q[0]=J*B*Y-N*V*F,Q[1]=N*V*Y+J*B*F,Q[2]=N*B*F-J*V*Y,Q[3]=N*B*Y+J*V*F,Q}function rK(Q){return"quat("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+")"}var eK=p0,bK=v0,uK=g0,oK=n0,tK=z0,aK=r0,o0=f0,t0=l0,Q$=x0,a0=d0,K$=a0,QQ=i0,$$=QQ,N0=y0,Z$=c0,C$=m0,J$=function(){var Q=m(),K=s(1,0,0),$=s(0,1,0);return function(Z,C,J){var N=r(C,J);if(N<-0.999999){if(x(Q,K,C),C0(Q)<0.000001)x(Q,$,C);return Z0(Q,Q),s0(Z,Q,Math.PI),Z}else if(N>0.999999)return Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z;else return x(Q,C,J),Z[0]=Q[0],Z[1]=Q[1],Z[2]=Q[2],Z[3]=1+N,N0(Z,Z)}}(),N$=function(){var Q=J0(),K=J0();return function($,Z,C,J,N,V){return e(Q,Z,N,V),e(K,C,J,V),e($,Q,K,2*V*(1-V)),$}}(),V$=function(){var Q=O0();return function(K,$,Z,C){return Q[0]=Z[0],Q[3]=Z[1],Q[6]=Z[2],Q[1]=C[0],Q[4]=C[1],Q[7]=C[2],Q[2]=-$[0],Q[5]=-$[1],Q[8]=-$[2],N0(K,u0(K,Q))}}();class z extends g{texImgSrc;activated=!1;width;height;constructor(Q){super();this.texImgSrc=Q,this.width=Q instanceof HTMLImageElement?Q.naturalWidth:Q instanceof VideoFrame?Q.displayWidth:Q.width,this.height=Q instanceof HTMLImageElement?Q.naturalHeight:Q instanceof VideoFrame?Q.displayHeight:Q.width}static async loadImage(Q){return new Promise((K,$)=>{const Z=new Image,C=new z(Z),J=()=>K(C),N=(V)=>$(V.error);Z.addEventListener("error",N),Z.addEventListener("load",J,{once:!0}),C.addOnDestroy(()=>Z.removeEventListener("load",J)),Z.src=Q})}static async loadVideo(Q,K){return new Promise(($,Z)=>{const C=document.createElement("video"),J=new z(C);if(C.loop=!0,K!==void 0)C.volume=K;const N=()=>C.play(),V=()=>$(J);C.addEventListener("loadedmetadata",N),C.addEventListener("playing",V,{once:!0}),C.addEventListener("error",(B)=>Z(B.error)),C.src=Q,J.addOnDestroy(()=>{C.pause(),C.removeEventListener("playing",V),C.removeEventListener("loadmetadata",N)})})}static async loadWebcam(Q){return new Promise((K,$)=>{const Z=document.createElement("video"),C=new z(Z);Z.loop=!0;const J=()=>Z.play(),N=()=>K(C);Z.addEventListener("loadedmetadata",J),Z.addEventListener("playing",N,{once:!0}),Z.addEventListener("error",(B)=>$(B.error));let V=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:Q}}).then((B)=>{if(!V)Z.srcObject=B,C.addOnDestroy(()=>B.getTracks().forEach((F)=>F.stop()))}),C.addOnDestroy(()=>{V=!0,Z.pause(),Z.removeEventListener("playing",N),Z.removeEventListener("loadmetadata",J)})})}}var KQ=4096;class V0 extends g{gl;textureBuffers={};images={};tempCanvas=new OffscreenCanvas(1,1);tempContext=this.tempCanvas.getContext("2d");constructor(Q){super();this.gl=Q,this.tempContext.imageSmoothingEnabled=!0}getTexture(Q){if(!this.textureBuffers[Q]){const K=this.gl.createTexture();if(!K)return;this.gl.bindTexture(O.TEXTURE_2D,K),this.gl.texImage2D(O.TEXTURE_2D,0,O.RGBA,KQ,KQ,0,O.RGBA,O.UNSIGNED_BYTE,null),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),this.textureBuffers[Q]=K,this.addOnDestroy(()=>this.gl.deleteTexture(K))}return this.textureBuffers[Q]}loadTexture(Q,K,$,Z,C){this.gl.activeTexture(O[K]),this.gl.bindTexture(O.TEXTURE_2D,$),this.applyTexImage2d(Q,Z,C),this.gl.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR)}applyTexImage2d(Q,[K,$,Z,C],[J,N,V,B]){if(Z===V&&C===B&&!K&&!$)this.gl.texSubImage2D(O.TEXTURE_2D,0,J,N,Z,C,O.RGBA,O.UNSIGNED_BYTE,Q.texImgSrc);else{console.log("Used canvas");const F=this.tempContext.canvas;if(Q.texImgSrc instanceof ImageData){if(F.width=V||Q.width,F.height=B||Q.height,this.tempContext.putImageData(Q.texImgSrc,0,0),K||$)console.warn("Offset not available when sending imageData")}else{const Y=Z||Q.width,P=C||Q.height;F.width=V||Y,F.height=B||P,this.tempContext.drawImage(Q.texImgSrc,K,$,Y,P,0,0,F.width,F.height)}this.gl.texSubImage2D(O.TEXTURE_2D,0,J,N,F.width,F.height,O.RGBA,O.UNSIGNED_BYTE,F)}}hasImageId(Q){return!!this.images[Q]}async drawImage(Q,K){const $=new OffscreenCanvas(1,1);K($.getContext("2d"));const Z=new z($);return this.images[Q]=this.own(Z),Z}async loadCanvas(Q,K){const $=new z(K);return K.getContext("2d"),this.images[Q]=this.own($),$}async loadImage(Q,K){const $=await z.loadImage(K);return this.images[Q]=this.own($),$}async loadVideo(Q,K,$){const Z=await z.loadVideo(K,$);return this.images[Q]=this.own(Z),Z}async loadWebCam(Q,K){const $=await z.loadWebcam(K);return this.images[Q]=this.own($),$}assignImageToTexture(Q,K,$,Z){if(!this.getTexture(K)){console.warn("Invalid texture Id");return}const C=this.images[Q];if(C){const J=this.getTexture(K);if(J){const N=$??[0,0,C.width,C.height],V=Z??[0,0,N[2],N[3]];if(C.activated)this.gl.bindTexture(O.TEXTURE_2D,J),this.applyTexImage2d(C,N,V);else this.loadTexture(C,K,J,N,V),C.activated=!0}else console.warn(`Texture not found: ${K}`)}}generateMipMap(Q){const K=this.getTexture(Q);if(K)this.gl.activeTexture(O[Q]),this.gl.bindTexture(O.TEXTURE_2D,K),this.gl.generateMipmap(O.TEXTURE_2D),console.log("GENERATED MIPMAP")}}var $Q=`#version 300 es
//  ~{AUTHOR}

precision highp float;

const float TEXTURE_SIZE = 4096.;

//  IN
//  shape
layout(location = 0) in vec4 position;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec2 tex;
layout(location = 6) in vec2 slotSize;

//  UNIFORM
uniform mat4 cam;

//  OUT
out vec2 vTex;
out float textureIndex;
out float opacity;

void main() {
  gl_Position = cam * transform * position;
  vTex = tex * (slotSize / TEXTURE_SIZE);
  textureIndex = 0.;
  opacity = 1.;
}
`;var ZQ=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = vec4(color.rgb, 1.);
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function B0(Q,K){return Q.replace(/~\{(\w+)\}/g,($,Z)=>{return K?.[Z]||$})}class F0{matrix;constructor(){this.matrix=k.create()}static create(){return new F0}translate(Q,K,$){return k.translate(this.matrix,this.matrix,[Q,K,$]),this}rotateX(Q){return k.rotateX(this.matrix,this.matrix,Q),this}rotateY(Q){return k.rotateY(this.matrix,this.matrix,Q),this}rotateZ(Q){return k.rotateZ(this.matrix,this.matrix,Q),this}scale(Q,K,$){return k.scale(this.matrix,this.matrix,[Q,K,$]),this}getMatrix(){return this.matrix}}var b=F0;var E$=function(Q){if(!P$)return Q;return new Proxy(Q,{get($,Z){const C=$,J=C[Z];if(typeof J==="function")return(...V)=>{const B=J.apply(C,V);return console.log(`gl.${String(Z)}(`,V,") = ",B),B};else return console.log(`gl.${String(Z)} = `,J),J}})},Y$={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},P$=!1;class Y0 extends g{gl;perspectiveLevel=1;programs;attributeBuffers;uniforms;cameraMatrix;camTurnMatrix;perspectiveMatrix;orthoMatrix;projectionMatrix;canvas;textureManager;constructor(Q,K){super();this.gl=E$(Q.getContext("webgl2",{...Y$,...K})),this.canvas=Q,this.textureManager=new V0(this.gl),this.programs=this.own(new t(this.gl)),this.attributeBuffers=this.own(new Q0(this.gl,this.programs)),this.uniforms=this.own(new K0(this.gl,this.programs)),this.cameraMatrix=k.translate(k.create(),k.identity(k.create()),d.fromValues(0,0,-1)),this.camTurnMatrix=k.identity(k.create()),this.perspectiveMatrix=k.identity(k.create()),this.orthoMatrix=k.identity(k.create()),this.projectionMatrix=k.identity(k.create()),window.addEventListener("resize",this.checkCanvasSize.bind(this))}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const Q=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.configOrthoMatrix(Q),this.configPerspectiveMatrix(Q)}async initialize(){const K={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",B0($Q,K),B0(ZQ,K)),this.programs.useProgram("main"),this.gl.enable(O.DEPTH_TEST),this.gl.depthFunc(O.LEQUAL),this.gl.enable(O.BLEND),this.gl.blendFunc(O.SRC_ALPHA,O.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const $=W0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(O.ELEMENT_ARRAY_BUFFER,Z),this.attributeBuffers.bufferData(O.ELEMENT_ARRAY_BUFFER,$,Uint16Array.from([0,1,2,2,3,0]),0,O.STATIC_DRAW)}{const $=$0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(O.ARRAY_BUFFER,Z),this.gl.vertexAttribPointer(Z.location,3,O.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(Z.location),this.attributeBuffers.bufferData(O.ARRAY_BUFFER,$,Float32Array.from([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),0,O.STATIC_DRAW)}{const $=M0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(O.ARRAY_BUFFER,Z);for(let C=0;C<4;C++){const J=Z.location+C;this.gl.vertexAttribPointer(J,4,O.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,C*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(J),this.gl.vertexAttribDivisor(J,1)}this.attributeBuffers.bufferData(O.ARRAY_BUFFER,$,Float32Array.from([...b.create().getMatrix(),...b.create().translate(-1,0,1).rotateY(Math.PI/2).getMatrix(),...b.create().translate(1,0,1).rotateY(-Math.PI/2).getMatrix()]),0,O.DYNAMIC_DRAW)}{const $=X0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(O.ARRAY_BUFFER,Z),this.gl.vertexAttribPointer(Z.location,2,O.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(Z.location),this.attributeBuffers.bufferData(O.ARRAY_BUFFER,$,Float32Array.from([0,1,1,1,1,0,0,0]),0,O.STATIC_DRAW)}await this.loadLogoTexture(),this.checkCanvasSize(),this.refreshCamera()}async loadLogoTexture(){{const $=H0;this.attributeBuffers.createBuffer($);const Z=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(O.ARRAY_BUFFER,Z);const C=Z.location;this.gl.vertexAttribPointer(C,2,O.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(C),this.gl.vertexAttribDivisor(C,1),this.attributeBuffers.bufferData(O.ARRAY_BUFFER,$,Float32Array.from([512,512,512,512,512,512]),0,O.DYNAMIC_DRAW)}await this.textureManager.drawImage("logo",($)=>{const{canvas:Z}=$;Z.width=2048,Z.height=2048,$.imageSmoothingEnabled=!0,$.fillStyle="#ddd",$.lineWidth=Z.width/50,$.fillRect(0,0,Z.width,Z.height),$.strokeStyle="black",$.fillStyle="gold",$.beginPath(),$.arc(Z.width/2,Z.height/2,Z.width/2*0.8,0,2*Math.PI),$.fill(),$.stroke(),$.beginPath(),$.arc(Z.width/2,Z.height/2,Z.width/2*0.5,0,Math.PI),$.stroke(),$.beginPath(),$.arc(Z.width/3,Z.height/3,Z.width/2*0.1,0,Math.PI,!0),$.stroke(),$.beginPath(),$.arc(Z.width/3*2,Z.height/3,Z.width/2*0.1,0,Math.PI*2,!0),$.stroke()}),this.textureManager.assignImageToTexture("logo","TEXTURE0",[0,0,2048,2048],[0,0,512,512]),this.textureManager.generateMipMap("TEXTURE0")}configPerspectiveMatrix(Q){const K=Math.PI/90;this.perspectiveMatrix=k.perspective(k.create(),45*K,Q,0,1e4),this.setPerspective()}configOrthoMatrix(Q){this.orthoMatrix=k.ortho(k.create(),-1*Q,1*Q,-1,1,-100,100),this.setPerspective()}refreshCamera(){const Q=k.identity(k.create());k.mul(Q,this.cameraMatrix,Q),k.mul(Q,this.camTurnMatrix,Q),k.mul(Q,this.projectionMatrix,Q);const K=this.uniforms.getUniformLocation(U0);if(K)this.gl.uniformMatrix4fv(K,!1,Q)}updateTrianglePosition(Q,K){const $=this.attributeBuffers.getAttributeBuffer($0);this.attributeBuffers.bindBuffer(O.ARRAY_BUFFER,$),this.attributeBuffers.bufferSubData(O.ARRAY_BUFFER,Float32Array.from(K),Q*4*3*Float32Array.BYTES_PER_ELEMENT)}setPerspective(Q){if(Q!==void 0)this.perspectiveLevel=Q;const K=k.create();k.multiplyScalar(K,this.orthoMatrix,1-this.perspectiveLevel);const $=k.create();k.multiplyScalar($,this.perspectiveMatrix,this.perspectiveLevel),k.copy(this.projectionMatrix,K),k.add(this.projectionMatrix,this.projectionMatrix,$),this.refreshCamera()}moveCam(Q,K){const $=c.create();k.getRotation($,this.camTurnMatrix),c.invert($,$);const Z=d.fromValues(-Q,0,K);d.transformQuat(Z,Z,$),k.translate(this.cameraMatrix,this.cameraMatrix,Z),this.refreshCamera()}turnCam(Q){k.rotateY(this.camTurnMatrix,this.camTurnMatrix,Q),this.refreshCamera()}drawArrays(Q){this.gl.drawArrays(O.TRIANGLES,0,Q)}drawElementsInstanced(Q,K){this.gl.clear(O.COLOR_BUFFER_BIT|O.DEPTH_BUFFER_BIT),this.gl.drawElementsInstanced(O.TRIANGLES,Q,O.UNSIGNED_SHORT,0,K)}bindVertexArray(){return this.own(new a(this.gl))}}async function KZ(){console.log("Hello World!")}function $Z(Q){Q.style.border=".5px solid silver";const K=new Y0(Q);K.initialize();const $={};document.addEventListener("keydown",(C)=>{$[C.code]=!0}),document.addEventListener("keyup",(C)=>{$[C.code]=!1});function Z(){if($.KeyW||$.ArrowUp)K.moveCam(0,0.25);if($.KeyS||$.ArrowDown)K.moveCam(0,-0.25);if($.KeyA)K.moveCam(-0.25,0);if($.KeyD)K.moveCam(0.25,0);if($.KeyQ||$.ArrowLeft)K.turnCam(-0.05);if($.KeyE||$.ArrowRight)K.turnCam(0.05);const N=6,V=3;K.drawElementsInstanced(N,V),requestAnimationFrame(Z)}return Z(),K}export{$Z as testCanvas,KZ as hello};

//# debugId=20C100732FE8E10C64756e2164756e21
