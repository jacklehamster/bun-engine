var L$=Object.defineProperty;var O0=($,K)=>{for(var Q in K)L$($,Q,{get:K[Q],enumerable:!0,configurable:!0,set:(J)=>K[Q]=()=>J})};class p{disposables;own($){if(!this.disposables)this.disposables=new Set;return this.disposables.add($),$}addOnDestroy($){this.disposables?.add({destroy:$})}destroy(){this.disposables?.forEach(($)=>$.destroy())}}var A=typeof globalThis.WebGL2RenderingContext!==void 0?globalThis.WebGL2RenderingContext:{},I0="position_and_tex",w0="index",v0="transform",p0="slotSize_and_number",u="cam",g0="projection",z0=!1;var k$=function($,K,Q){function J(O,H){function W(X){return X===$?.VERTEX_SHADER?"vertex":X===$?.FRAGMENT_SHADER?"fragment":void 0}if(H!==$.VERTEX_SHADER&&H!==$.FRAGMENT_SHADER)throw new Error(`Shader error in ${W(H)}`);const D=$.createShader(H);if(!D)throw new Error(`Unable to generate ${W(H)} shader.`);if($.shaderSource(D,O),$.compileShader(D),!$.getShaderParameter(D,$.COMPILE_STATUS))console.error(`Shader compile error in ${W(H)}:`+$.getShaderInfoLog(D));return D}const Y=$.createProgram();if(!Y)throw new Error("Unable to create program.");const B=J(K,$.VERTEX_SHADER),V=J(Q,$.FRAGMENT_SHADER),F=$.getShaderInfoLog(B),C=$.getShaderInfoLog(V);if(F)console.log("VERTEX",F);if(C)console.log("FRAGMENT",C);$.attachShader(Y,B),$.attachShader(Y,V),$.linkProgram(Y);const Z=$.getProgramInfoLog(Y);if(Z)console.log("PROGRAM",Z);if($.detachShader(Y,B),$.detachShader(Y,V),$.deleteShader(B),$.deleteShader(V),$.validateProgram(Y),Object.entries(A).forEach(([O,H])=>{if(H&&$.getError()===H)console.log(`gl.${O}`)}),!$.getProgramParameter(Y,$.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+$.getProgramInfoLog(Y));return Y},q$=function($,K){$.deleteProgram(K)};class H0 extends p{gl;program;constructor($,K,Q){super();this.gl=$,this.program=k$($,K.trim(),Q.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),q$(this.gl,this.program)}}class P0 extends p{activeProgramId="";gl;programs={};constructor($){super();this.gl=$}addProgram($,K,Q){if(this.programs[$])this.removeProgram($);this.programs[$]=this.own(new H0(this.gl,K,Q))}useProgram($){if(this.activeProgramId!==$)this.activeProgramId=$,this.programs[$].use()}removeProgram($){this.programs[$].destroy(),delete this.programs[$]}getProgram($){return this.programs[$??this.activeProgramId]?.program}}class D0 extends p{gl;triangleArray;constructor($){super();this.gl=$,this.triangleArray=$.createVertexArray(),$.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class W0 extends p{bufferRecord={};lastBoundBuffer;gl;programs;constructor($,K){super();this.gl=$,this.programs=K}getAttributeLocation($,K){const Q=this.programs.getProgram(K);return Q?this.gl.getAttribLocation(Q,$)??-1:-1}createBuffer($){this.deleteBuffer($);const K=this.gl?.createBuffer();if(!K)throw new Error(`Unable to create buffer "${$}"`);const Q={buffer:K,location:this.getAttributeLocation($)};return this.bufferRecord[$]=Q,Q}deleteBuffer($){if(this.bufferRecord[$])this.gl.deleteBuffer(this.bufferRecord[$].buffer),delete this.bufferRecord[$]}getAttributeBuffer($,K){const Q=this.bufferRecord[$];if(!Q){if(K)return this.createBuffer($);throw new Error(`Attribute "${$}" not created. Make sure "createBuffer" is called.`)}return Q}bufferData($,K,Q,J,Y){const B=this.getAttributeBuffer(K);if(Q)this.gl.bufferData($,Q,Y);else this.gl.bufferData($,J,Y);B.bufferSize=J||Q?.length,B.bufferArray=Q??new Float32Array(B.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),B.usage=Y,B.target=$}bufferSubData($,K,Q,J,Y){if(J)this.gl.bufferSubData($,Q,K,J,Y);else this.gl.bufferSubData($,Q,K)}bindBuffer($,K){if(this.lastBoundBuffer!==K)this.lastBoundBuffer=K,this.gl.bindBuffer($,K.buffer)}destroy(){Object.keys(this.bufferRecord).forEach(($)=>this.deleteBuffer($))}}class U0 extends p{gl;programs;constructor($,K){super();this.gl=$,this.programs=K}getUniformLocation($,K){const Q=this.programs.getProgram(K);return Q?this.gl.getUniformLocation(Q,$)??void 0:void 0}}function o({size:$,slotNumber:K}){const[Q,J]=$,Y=f/Q*(f/J);return Math.floor(K/Y)}function X0($){const{size:K,slotNumber:Q}=$,[J,Y]=K,B=f/J,V=f/Y,F=Q%B*J,C=Math.floor(Q/B)%V*Y;return{x:F,y:C,size:K,textureIndex:o($)}}var f=4096,m=16;class x{size;slotNumber;parent;sibbling;constructor($,K,Q){this.size=$,this.slotNumber=K,this.parent=Q,this.sibbling=void 0}getTag(){return x.getTag(this)}static getTag($){return`${$.size[0]}x${$.size[1]}-#${$.slotNumber}`}getTextureIndex(){return o(this)}getTexturePosition(){return X0(this)}static positionToTextureSlot($,K){const{x:Q,y:J,size:Y,textureIndex:B}=$,[V,F]=Y,C=f/V,O=f/V*(f/F)*B+J/F*C+Q/V;return new x(Y,O,K)}canSplitHorizontally($=m){const[,K]=this.size;return K>$}canSplitVertically($=m){const[K]=this.size;return K>$}splitHorizontally(){const{x:$,y:K,size:Q,textureIndex:J}=this.getTexturePosition(),[Y,B]=Q;if(Y<=m)throw new Error(`Cannot split texture slot of size ${Y} horizontally`);const V=Y/2,F=x.positionToTextureSlot({x:$,y:K,size:[V,B],textureIndex:J},this),C=x.positionToTextureSlot({x:$+V,y:K,size:[V,B],textureIndex:J},this);return F.sibbling=C,C.sibbling=F,[F,C]}splitVertically(){const{x:$,y:K,size:Q,textureIndex:J}=this.getTexturePosition(),[Y,B]=Q;if(Y<=m)throw new Error(`Cannot split texture slot of size ${Y} vertically`);const V=B/2,F=x.positionToTextureSlot({x:$,y:K,size:[Y,V],textureIndex:J},this),C=x.positionToTextureSlot({x:$,y:K+V,size:[Y,V],textureIndex:J},this);return F.sibbling=C,C.sibbling=F,[F,C]}}var f0=4096;class j0 extends p{gl;textureBuffers={};tempCanvas=new OffscreenCanvas(1,1);tempContext=this.tempCanvas.getContext("2d");constructor($){super();this.gl=$,this.tempContext.imageSmoothingEnabled=!0}getTexture($){if(!this.textureBuffers[$]){const K=this.gl.createTexture();if(!K)return;this.gl.bindTexture(A.TEXTURE_2D,K),this.gl.texImage2D(A.TEXTURE_2D,0,A.RGBA,f0,f0,0,A.RGBA,A.UNSIGNED_BYTE,null),this.textureBuffers[$]=K,this.addOnDestroy(()=>this.gl.deleteTexture(K))}return this.textureBuffers[$]}loadTexture($,K,Q,J,Y){this.gl.activeTexture(A[K]),this.gl.bindTexture(A.TEXTURE_2D,Q),this.applyTexImage2d($,J,Y),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR)}applyTexImage2d($,[K,Q,J,Y],[B,V,F,C]){if(J===F&&Y===C&&!K&&!Q)this.gl.texSubImage2D(A.TEXTURE_2D,0,B,V,J,Y,A.RGBA,A.UNSIGNED_BYTE,$.texImgSrc);else{console.log("Used canvas");const Z=this.tempContext.canvas;if($.texImgSrc instanceof ImageData){if(Z.width=F||$.width,Z.height=C||$.height,this.tempContext.putImageData($.texImgSrc,0,0),K||Q)console.warn("Offset not available when sending imageData")}else{const O=J||$.width,H=Y||$.height;Z.width=F||O,Z.height=C||H,this.tempContext.drawImage($.texImgSrc,K,Q,O,H,0,0,Z.width,Z.height)}this.gl.texSubImage2D(A.TEXTURE_2D,0,B,V,Z.width,Z.height,A.RGBA,A.UNSIGNED_BYTE,Z)}}applyImageToSlot($,K,Q){const J=X0(K),B=`TEXTURE${o(K)}`,V=this.getTexture(B);if(!V)return console.warn(`Invalid texture Id ${B}`),null;const F=this.assignImageToTexture($,B,V,[0,0,$.width,$.height],[J.x,J.y,...J.size]);if(Q)this.generateMipMap(B);return F}assignImageToTexture($,K,Q,J,Y){if($){const B=J??[0,0,$.width,$.height],V=Y??[0,0,B[2],B[3]];if($.active){const F=()=>{this.gl.bindTexture(A.TEXTURE_2D,Q),this.applyTexImage2d($,B,V)};return F(),F}else this.loadTexture($,K,Q,B,V),$.active=!0}return null}generateMipMap($){const K=this.getTexture($);if(K)this.gl.activeTexture(A[$]),this.gl.bindTexture(A.TEXTURE_2D,K),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),this.gl.generateMipmap(A.TEXTURE_2D),console.log("GENERATED MIPMAP")}}var y0=`#version 300 es
//  ~{AUTHOR}

precision highp float;

const float TEXTURE_SIZE = 4096.;

//  IN
//  shape
layout(location = 0) in vec4 position_and_tex;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec3 slotSize_and_number;

//  UNIFORM
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  vec2 position = position_and_tex.xy;
  vec2 tex = position_and_tex.zw;
  vec2 slotSize = slotSize_and_number.xy;
  float slotNumber = slotSize_and_number.z;

  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = tex * (slotSize / TEXTURE_SIZE);
  textureIndex = 0.;
}
`;var x0=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function A0($,K){return $.replace(/~\{(\w+)\}/g,(Q,J)=>{return K?.[J]||Q})}var E=0.000001,q=typeof Float32Array!=="undefined"?Float32Array:Array,i=Math.random,VJ=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var $=0,K=arguments.length;while(K--)$+=arguments[K]*arguments[K];return Math.sqrt($)};function c0(){var $=new q(9);if(q!=Float32Array)$[1]=0,$[2]=0,$[3]=0,$[5]=0,$[6]=0,$[7]=0;return $[0]=1,$[4]=1,$[8]=1,$}var k={};O0(k,{transpose:()=>{{return z$}},translate:()=>{{return c$}},targetTo:()=>{{return HK}},subtract:()=>{{return r0}},sub:()=>{{return NK}},str:()=>{{return PK}},set:()=>{{return g$}},scale:()=>{{return m$}},rotateZ:()=>{{return n$}},rotateY:()=>{{return d$}},rotateX:()=>{{return l$}},rotate:()=>{{return i$}},perspectiveZO:()=>{{return VK}},perspectiveNO:()=>{{return n0}},perspectiveFromFieldOfView:()=>{{return FK}},perspective:()=>{{return BK}},orthoZO:()=>{{return ZK}},orthoNO:()=>{{return s0}},ortho:()=>{{return CK}},multiplyScalarAndAdd:()=>{{return XK}},multiplyScalar:()=>{{return UK}},multiply:()=>{{return i0}},mul:()=>{{return RK}},lookAt:()=>{{return OK}},invert:()=>{{return f$}},identity:()=>{{return m0}},getTranslation:()=>{{return t$}},getScaling:()=>{{return d0}},getRotation:()=>{{return $K}},frustum:()=>{{return YK}},fromZRotation:()=>{{return o$}},fromYRotation:()=>{{return u$}},fromXRotation:()=>{{return e$}},fromValues:()=>{{return p$}},fromTranslation:()=>{{return s$}},fromScaling:()=>{{return r$}},fromRotationTranslationScaleOrigin:()=>{{return QK}},fromRotationTranslationScale:()=>{{return KK}},fromRotationTranslation:()=>{{return l0}},fromRotation:()=>{{return b$}},fromQuat2:()=>{{return a$}},fromQuat:()=>{{return JK}},frob:()=>{{return DK}},exactEquals:()=>{{return jK}},equals:()=>{{return AK}},determinant:()=>{{return x$}},create:()=>{{return I$}},copy:()=>{{return v$}},clone:()=>{{return w$}},adjoint:()=>{{return y$}},add:()=>{{return WK}}});function I$(){var $=new q(16);if(q!=Float32Array)$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[11]=0,$[12]=0,$[13]=0,$[14]=0;return $[0]=1,$[5]=1,$[10]=1,$[15]=1,$}function w$($){var K=new q(16);return K[0]=$[0],K[1]=$[1],K[2]=$[2],K[3]=$[3],K[4]=$[4],K[5]=$[5],K[6]=$[6],K[7]=$[7],K[8]=$[8],K[9]=$[9],K[10]=$[10],K[11]=$[11],K[12]=$[12],K[13]=$[13],K[14]=$[14],K[15]=$[15],K}function v$($,K){return $[0]=K[0],$[1]=K[1],$[2]=K[2],$[3]=K[3],$[4]=K[4],$[5]=K[5],$[6]=K[6],$[7]=K[7],$[8]=K[8],$[9]=K[9],$[10]=K[10],$[11]=K[11],$[12]=K[12],$[13]=K[13],$[14]=K[14],$[15]=K[15],$}function p$($,K,Q,J,Y,B,V,F,C,Z,O,H,W,D,X,U){var P=new q(16);return P[0]=$,P[1]=K,P[2]=Q,P[3]=J,P[4]=Y,P[5]=B,P[6]=V,P[7]=F,P[8]=C,P[9]=Z,P[10]=O,P[11]=H,P[12]=W,P[13]=D,P[14]=X,P[15]=U,P}function g$($,K,Q,J,Y,B,V,F,C,Z,O,H,W,D,X,U,P){return $[0]=K,$[1]=Q,$[2]=J,$[3]=Y,$[4]=B,$[5]=V,$[6]=F,$[7]=C,$[8]=Z,$[9]=O,$[10]=H,$[11]=W,$[12]=D,$[13]=X,$[14]=U,$[15]=P,$}function m0($){return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=1,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=1,$[11]=0,$[12]=0,$[13]=0,$[14]=0,$[15]=1,$}function z$($,K){if($===K){var Q=K[1],J=K[2],Y=K[3],B=K[6],V=K[7],F=K[11];$[1]=K[4],$[2]=K[8],$[3]=K[12],$[4]=Q,$[6]=K[9],$[7]=K[13],$[8]=J,$[9]=B,$[11]=K[14],$[12]=Y,$[13]=V,$[14]=F}else $[0]=K[0],$[1]=K[4],$[2]=K[8],$[3]=K[12],$[4]=K[1],$[5]=K[5],$[6]=K[9],$[7]=K[13],$[8]=K[2],$[9]=K[6],$[10]=K[10],$[11]=K[14],$[12]=K[3],$[13]=K[7],$[14]=K[11],$[15]=K[15];return $}function f$($,K){var Q=K[0],J=K[1],Y=K[2],B=K[3],V=K[4],F=K[5],C=K[6],Z=K[7],O=K[8],H=K[9],W=K[10],D=K[11],X=K[12],U=K[13],P=K[14],j=K[15],_=Q*F-J*V,G=Q*C-Y*V,M=Q*Z-B*V,R=J*C-Y*F,N=J*Z-B*F,I=Y*Z-B*C,T=O*U-H*X,S=O*P-W*X,h=O*j-D*X,w=H*P-W*U,v=H*j-D*U,g=W*j-D*P,L=_*g-G*v+M*w+R*h-N*S+I*T;if(!L)return null;return L=1/L,$[0]=(F*g-C*v+Z*w)*L,$[1]=(Y*v-J*g-B*w)*L,$[2]=(U*I-P*N+j*R)*L,$[3]=(W*N-H*I-D*R)*L,$[4]=(C*h-V*g-Z*S)*L,$[5]=(Q*g-Y*h+B*S)*L,$[6]=(P*M-X*I-j*G)*L,$[7]=(O*I-W*M+D*G)*L,$[8]=(V*v-F*h+Z*T)*L,$[9]=(J*h-Q*v-B*T)*L,$[10]=(X*N-U*M+j*_)*L,$[11]=(H*M-O*N-D*_)*L,$[12]=(F*S-V*w-C*T)*L,$[13]=(Q*w-J*S+Y*T)*L,$[14]=(U*G-X*R-P*_)*L,$[15]=(O*R-H*G+W*_)*L,$}function y$($,K){var Q=K[0],J=K[1],Y=K[2],B=K[3],V=K[4],F=K[5],C=K[6],Z=K[7],O=K[8],H=K[9],W=K[10],D=K[11],X=K[12],U=K[13],P=K[14],j=K[15];return $[0]=F*(W*j-D*P)-H*(C*j-Z*P)+U*(C*D-Z*W),$[1]=-(J*(W*j-D*P)-H*(Y*j-B*P)+U*(Y*D-B*W)),$[2]=J*(C*j-Z*P)-F*(Y*j-B*P)+U*(Y*Z-B*C),$[3]=-(J*(C*D-Z*W)-F*(Y*D-B*W)+H*(Y*Z-B*C)),$[4]=-(V*(W*j-D*P)-O*(C*j-Z*P)+X*(C*D-Z*W)),$[5]=Q*(W*j-D*P)-O*(Y*j-B*P)+X*(Y*D-B*W),$[6]=-(Q*(C*j-Z*P)-V*(Y*j-B*P)+X*(Y*Z-B*C)),$[7]=Q*(C*D-Z*W)-V*(Y*D-B*W)+O*(Y*Z-B*C),$[8]=V*(H*j-D*U)-O*(F*j-Z*U)+X*(F*D-Z*H),$[9]=-(Q*(H*j-D*U)-O*(J*j-B*U)+X*(J*D-B*H)),$[10]=Q*(F*j-Z*U)-V*(J*j-B*U)+X*(J*Z-B*F),$[11]=-(Q*(F*D-Z*H)-V*(J*D-B*H)+O*(J*Z-B*F)),$[12]=-(V*(H*P-W*U)-O*(F*P-C*U)+X*(F*W-C*H)),$[13]=Q*(H*P-W*U)-O*(J*P-Y*U)+X*(J*W-Y*H),$[14]=-(Q*(F*P-C*U)-V*(J*P-Y*U)+X*(J*C-Y*F)),$[15]=Q*(F*W-C*H)-V*(J*W-Y*H)+O*(J*C-Y*F),$}function x$($){var K=$[0],Q=$[1],J=$[2],Y=$[3],B=$[4],V=$[5],F=$[6],C=$[7],Z=$[8],O=$[9],H=$[10],W=$[11],D=$[12],X=$[13],U=$[14],P=$[15],j=K*V-Q*B,_=K*F-J*B,G=K*C-Y*B,M=Q*F-J*V,R=Q*C-Y*V,N=J*C-Y*F,I=Z*X-O*D,T=Z*U-H*D,S=Z*P-W*D,h=O*U-H*X,w=O*P-W*X,v=H*P-W*U;return j*v-_*w+G*h+M*S-R*T+N*I}function i0($,K,Q){var J=K[0],Y=K[1],B=K[2],V=K[3],F=K[4],C=K[5],Z=K[6],O=K[7],H=K[8],W=K[9],D=K[10],X=K[11],U=K[12],P=K[13],j=K[14],_=K[15],G=Q[0],M=Q[1],R=Q[2],N=Q[3];return $[0]=G*J+M*F+R*H+N*U,$[1]=G*Y+M*C+R*W+N*P,$[2]=G*B+M*Z+R*D+N*j,$[3]=G*V+M*O+R*X+N*_,G=Q[4],M=Q[5],R=Q[6],N=Q[7],$[4]=G*J+M*F+R*H+N*U,$[5]=G*Y+M*C+R*W+N*P,$[6]=G*B+M*Z+R*D+N*j,$[7]=G*V+M*O+R*X+N*_,G=Q[8],M=Q[9],R=Q[10],N=Q[11],$[8]=G*J+M*F+R*H+N*U,$[9]=G*Y+M*C+R*W+N*P,$[10]=G*B+M*Z+R*D+N*j,$[11]=G*V+M*O+R*X+N*_,G=Q[12],M=Q[13],R=Q[14],N=Q[15],$[12]=G*J+M*F+R*H+N*U,$[13]=G*Y+M*C+R*W+N*P,$[14]=G*B+M*Z+R*D+N*j,$[15]=G*V+M*O+R*X+N*_,$}function c$($,K,Q){var J=Q[0],Y=Q[1],B=Q[2],V,F,C,Z,O,H,W,D,X,U,P,j;if(K===$)$[12]=K[0]*J+K[4]*Y+K[8]*B+K[12],$[13]=K[1]*J+K[5]*Y+K[9]*B+K[13],$[14]=K[2]*J+K[6]*Y+K[10]*B+K[14],$[15]=K[3]*J+K[7]*Y+K[11]*B+K[15];else V=K[0],F=K[1],C=K[2],Z=K[3],O=K[4],H=K[5],W=K[6],D=K[7],X=K[8],U=K[9],P=K[10],j=K[11],$[0]=V,$[1]=F,$[2]=C,$[3]=Z,$[4]=O,$[5]=H,$[6]=W,$[7]=D,$[8]=X,$[9]=U,$[10]=P,$[11]=j,$[12]=V*J+O*Y+X*B+K[12],$[13]=F*J+H*Y+U*B+K[13],$[14]=C*J+W*Y+P*B+K[14],$[15]=Z*J+D*Y+j*B+K[15];return $}function m$($,K,Q){var J=Q[0],Y=Q[1],B=Q[2];return $[0]=K[0]*J,$[1]=K[1]*J,$[2]=K[2]*J,$[3]=K[3]*J,$[4]=K[4]*Y,$[5]=K[5]*Y,$[6]=K[6]*Y,$[7]=K[7]*Y,$[8]=K[8]*B,$[9]=K[9]*B,$[10]=K[10]*B,$[11]=K[11]*B,$[12]=K[12],$[13]=K[13],$[14]=K[14],$[15]=K[15],$}function i$($,K,Q,J){var Y=J[0],B=J[1],V=J[2],F=Math.hypot(Y,B,V),C,Z,O,H,W,D,X,U,P,j,_,G,M,R,N,I,T,S,h,w,v,g,L,y;if(F<E)return null;if(F=1/F,Y*=F,B*=F,V*=F,C=Math.sin(Q),Z=Math.cos(Q),O=1-Z,H=K[0],W=K[1],D=K[2],X=K[3],U=K[4],P=K[5],j=K[6],_=K[7],G=K[8],M=K[9],R=K[10],N=K[11],I=Y*Y*O+Z,T=B*Y*O+V*C,S=V*Y*O-B*C,h=Y*B*O-V*C,w=B*B*O+Z,v=V*B*O+Y*C,g=Y*V*O+B*C,L=B*V*O-Y*C,y=V*V*O+Z,$[0]=H*I+U*T+G*S,$[1]=W*I+P*T+M*S,$[2]=D*I+j*T+R*S,$[3]=X*I+_*T+N*S,$[4]=H*h+U*w+G*v,$[5]=W*h+P*w+M*v,$[6]=D*h+j*w+R*v,$[7]=X*h+_*w+N*v,$[8]=H*g+U*L+G*y,$[9]=W*g+P*L+M*y,$[10]=D*g+j*L+R*y,$[11]=X*g+_*L+N*y,K!==$)$[12]=K[12],$[13]=K[13],$[14]=K[14],$[15]=K[15];return $}function l$($,K,Q){var J=Math.sin(Q),Y=Math.cos(Q),B=K[4],V=K[5],F=K[6],C=K[7],Z=K[8],O=K[9],H=K[10],W=K[11];if(K!==$)$[0]=K[0],$[1]=K[1],$[2]=K[2],$[3]=K[3],$[12]=K[12],$[13]=K[13],$[14]=K[14],$[15]=K[15];return $[4]=B*Y+Z*J,$[5]=V*Y+O*J,$[6]=F*Y+H*J,$[7]=C*Y+W*J,$[8]=Z*Y-B*J,$[9]=O*Y-V*J,$[10]=H*Y-F*J,$[11]=W*Y-C*J,$}function d$($,K,Q){var J=Math.sin(Q),Y=Math.cos(Q),B=K[0],V=K[1],F=K[2],C=K[3],Z=K[8],O=K[9],H=K[10],W=K[11];if(K!==$)$[4]=K[4],$[5]=K[5],$[6]=K[6],$[7]=K[7],$[12]=K[12],$[13]=K[13],$[14]=K[14],$[15]=K[15];return $[0]=B*Y-Z*J,$[1]=V*Y-O*J,$[2]=F*Y-H*J,$[3]=C*Y-W*J,$[8]=B*J+Z*Y,$[9]=V*J+O*Y,$[10]=F*J+H*Y,$[11]=C*J+W*Y,$}function n$($,K,Q){var J=Math.sin(Q),Y=Math.cos(Q),B=K[0],V=K[1],F=K[2],C=K[3],Z=K[4],O=K[5],H=K[6],W=K[7];if(K!==$)$[8]=K[8],$[9]=K[9],$[10]=K[10],$[11]=K[11],$[12]=K[12],$[13]=K[13],$[14]=K[14],$[15]=K[15];return $[0]=B*Y+Z*J,$[1]=V*Y+O*J,$[2]=F*Y+H*J,$[3]=C*Y+W*J,$[4]=Z*Y-B*J,$[5]=O*Y-V*J,$[6]=H*Y-F*J,$[7]=W*Y-C*J,$}function s$($,K){return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=1,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=1,$[11]=0,$[12]=K[0],$[13]=K[1],$[14]=K[2],$[15]=1,$}function r$($,K){return $[0]=K[0],$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=K[1],$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=K[2],$[11]=0,$[12]=0,$[13]=0,$[14]=0,$[15]=1,$}function b$($,K,Q){var J=Q[0],Y=Q[1],B=Q[2],V=Math.hypot(J,Y,B),F,C,Z;if(V<E)return null;return V=1/V,J*=V,Y*=V,B*=V,F=Math.sin(K),C=Math.cos(K),Z=1-C,$[0]=J*J*Z+C,$[1]=Y*J*Z+B*F,$[2]=B*J*Z-Y*F,$[3]=0,$[4]=J*Y*Z-B*F,$[5]=Y*Y*Z+C,$[6]=B*Y*Z+J*F,$[7]=0,$[8]=J*B*Z+Y*F,$[9]=Y*B*Z-J*F,$[10]=B*B*Z+C,$[11]=0,$[12]=0,$[13]=0,$[14]=0,$[15]=1,$}function e$($,K){var Q=Math.sin(K),J=Math.cos(K);return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=J,$[6]=Q,$[7]=0,$[8]=0,$[9]=-Q,$[10]=J,$[11]=0,$[12]=0,$[13]=0,$[14]=0,$[15]=1,$}function u$($,K){var Q=Math.sin(K),J=Math.cos(K);return $[0]=J,$[1]=0,$[2]=-Q,$[3]=0,$[4]=0,$[5]=1,$[6]=0,$[7]=0,$[8]=Q,$[9]=0,$[10]=J,$[11]=0,$[12]=0,$[13]=0,$[14]=0,$[15]=1,$}function o$($,K){var Q=Math.sin(K),J=Math.cos(K);return $[0]=J,$[1]=Q,$[2]=0,$[3]=0,$[4]=-Q,$[5]=J,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=1,$[11]=0,$[12]=0,$[13]=0,$[14]=0,$[15]=1,$}function l0($,K,Q){var J=K[0],Y=K[1],B=K[2],V=K[3],F=J+J,C=Y+Y,Z=B+B,O=J*F,H=J*C,W=J*Z,D=Y*C,X=Y*Z,U=B*Z,P=V*F,j=V*C,_=V*Z;return $[0]=1-(D+U),$[1]=H+_,$[2]=W-j,$[3]=0,$[4]=H-_,$[5]=1-(O+U),$[6]=X+P,$[7]=0,$[8]=W+j,$[9]=X-P,$[10]=1-(O+D),$[11]=0,$[12]=Q[0],$[13]=Q[1],$[14]=Q[2],$[15]=1,$}function a$($,K){var Q=new q(3),J=-K[0],Y=-K[1],B=-K[2],V=K[3],F=K[4],C=K[5],Z=K[6],O=K[7],H=J*J+Y*Y+B*B+V*V;if(H>0)Q[0]=(F*V+O*J+C*B-Z*Y)*2/H,Q[1]=(C*V+O*Y+Z*J-F*B)*2/H,Q[2]=(Z*V+O*B+F*Y-C*J)*2/H;else Q[0]=(F*V+O*J+C*B-Z*Y)*2,Q[1]=(C*V+O*Y+Z*J-F*B)*2,Q[2]=(Z*V+O*B+F*Y-C*J)*2;return l0($,K,Q),$}function t$($,K){return $[0]=K[12],$[1]=K[13],$[2]=K[14],$}function d0($,K){var Q=K[0],J=K[1],Y=K[2],B=K[4],V=K[5],F=K[6],C=K[8],Z=K[9],O=K[10];return $[0]=Math.hypot(Q,J,Y),$[1]=Math.hypot(B,V,F),$[2]=Math.hypot(C,Z,O),$}function $K($,K){var Q=new q(3);d0(Q,K);var J=1/Q[0],Y=1/Q[1],B=1/Q[2],V=K[0]*J,F=K[1]*Y,C=K[2]*B,Z=K[4]*J,O=K[5]*Y,H=K[6]*B,W=K[8]*J,D=K[9]*Y,X=K[10]*B,U=V+O+X,P=0;if(U>0)P=Math.sqrt(U+1)*2,$[3]=0.25*P,$[0]=(H-D)/P,$[1]=(W-C)/P,$[2]=(F-Z)/P;else if(V>O&&V>X)P=Math.sqrt(1+V-O-X)*2,$[3]=(H-D)/P,$[0]=0.25*P,$[1]=(F+Z)/P,$[2]=(W+C)/P;else if(O>X)P=Math.sqrt(1+O-V-X)*2,$[3]=(W-C)/P,$[0]=(F+Z)/P,$[1]=0.25*P,$[2]=(H+D)/P;else P=Math.sqrt(1+X-V-O)*2,$[3]=(F-Z)/P,$[0]=(W+C)/P,$[1]=(H+D)/P,$[2]=0.25*P;return $}function KK($,K,Q,J){var Y=K[0],B=K[1],V=K[2],F=K[3],C=Y+Y,Z=B+B,O=V+V,H=Y*C,W=Y*Z,D=Y*O,X=B*Z,U=B*O,P=V*O,j=F*C,_=F*Z,G=F*O,M=J[0],R=J[1],N=J[2];return $[0]=(1-(X+P))*M,$[1]=(W+G)*M,$[2]=(D-_)*M,$[3]=0,$[4]=(W-G)*R,$[5]=(1-(H+P))*R,$[6]=(U+j)*R,$[7]=0,$[8]=(D+_)*N,$[9]=(U-j)*N,$[10]=(1-(H+X))*N,$[11]=0,$[12]=Q[0],$[13]=Q[1],$[14]=Q[2],$[15]=1,$}function QK($,K,Q,J,Y){var B=K[0],V=K[1],F=K[2],C=K[3],Z=B+B,O=V+V,H=F+F,W=B*Z,D=B*O,X=B*H,U=V*O,P=V*H,j=F*H,_=C*Z,G=C*O,M=C*H,R=J[0],N=J[1],I=J[2],T=Y[0],S=Y[1],h=Y[2],w=(1-(U+j))*R,v=(D+M)*R,g=(X-G)*R,L=(D-M)*N,y=(1-(W+j))*N,n=(P+_)*N,s=(X+G)*I,S0=(P-_)*I,h0=(1-(W+U))*I;return $[0]=w,$[1]=v,$[2]=g,$[3]=0,$[4]=L,$[5]=y,$[6]=n,$[7]=0,$[8]=s,$[9]=S0,$[10]=h0,$[11]=0,$[12]=Q[0]+T-(w*T+L*S+s*h),$[13]=Q[1]+S-(v*T+y*S+S0*h),$[14]=Q[2]+h-(g*T+n*S+h0*h),$[15]=1,$}function JK($,K){var Q=K[0],J=K[1],Y=K[2],B=K[3],V=Q+Q,F=J+J,C=Y+Y,Z=Q*V,O=J*V,H=J*F,W=Y*V,D=Y*F,X=Y*C,U=B*V,P=B*F,j=B*C;return $[0]=1-H-X,$[1]=O+j,$[2]=W-P,$[3]=0,$[4]=O-j,$[5]=1-Z-X,$[6]=D+U,$[7]=0,$[8]=W+P,$[9]=D-U,$[10]=1-Z-H,$[11]=0,$[12]=0,$[13]=0,$[14]=0,$[15]=1,$}function YK($,K,Q,J,Y,B,V){var F=1/(Q-K),C=1/(Y-J),Z=1/(B-V);return $[0]=B*2*F,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=B*2*C,$[6]=0,$[7]=0,$[8]=(Q+K)*F,$[9]=(Y+J)*C,$[10]=(V+B)*Z,$[11]=-1,$[12]=0,$[13]=0,$[14]=V*B*2*Z,$[15]=0,$}function n0($,K,Q,J,Y){var B=1/Math.tan(K/2),V;if($[0]=B/Q,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=B,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[11]=-1,$[12]=0,$[13]=0,$[15]=0,Y!=null&&Y!==Infinity)V=1/(J-Y),$[10]=(Y+J)*V,$[14]=2*Y*J*V;else $[10]=-1,$[14]=-2*J;return $}function VK($,K,Q,J,Y){var B=1/Math.tan(K/2),V;if($[0]=B/Q,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=B,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[11]=-1,$[12]=0,$[13]=0,$[15]=0,Y!=null&&Y!==Infinity)V=1/(J-Y),$[10]=Y*V,$[14]=Y*J*V;else $[10]=-1,$[14]=-J;return $}function FK($,K,Q,J){var Y=Math.tan(K.upDegrees*Math.PI/180),B=Math.tan(K.downDegrees*Math.PI/180),V=Math.tan(K.leftDegrees*Math.PI/180),F=Math.tan(K.rightDegrees*Math.PI/180),C=2/(V+F),Z=2/(Y+B);return $[0]=C,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=Z,$[6]=0,$[7]=0,$[8]=-((V-F)*C*0.5),$[9]=(Y-B)*Z*0.5,$[10]=J/(Q-J),$[11]=-1,$[12]=0,$[13]=0,$[14]=J*Q/(Q-J),$[15]=0,$}function s0($,K,Q,J,Y,B,V){var F=1/(K-Q),C=1/(J-Y),Z=1/(B-V);return $[0]=-2*F,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=-2*C,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=2*Z,$[11]=0,$[12]=(K+Q)*F,$[13]=(Y+J)*C,$[14]=(V+B)*Z,$[15]=1,$}function ZK($,K,Q,J,Y,B,V){var F=1/(K-Q),C=1/(J-Y),Z=1/(B-V);return $[0]=-2*F,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=-2*C,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=Z,$[11]=0,$[12]=(K+Q)*F,$[13]=(Y+J)*C,$[14]=B*Z,$[15]=1,$}function OK($,K,Q,J){var Y,B,V,F,C,Z,O,H,W,D,X=K[0],U=K[1],P=K[2],j=J[0],_=J[1],G=J[2],M=Q[0],R=Q[1],N=Q[2];if(Math.abs(X-M)<E&&Math.abs(U-R)<E&&Math.abs(P-N)<E)return m0($);if(O=X-M,H=U-R,W=P-N,D=1/Math.hypot(O,H,W),O*=D,H*=D,W*=D,Y=_*W-G*H,B=G*O-j*W,V=j*H-_*O,D=Math.hypot(Y,B,V),!D)Y=0,B=0,V=0;else D=1/D,Y*=D,B*=D,V*=D;if(F=H*V-W*B,C=W*Y-O*V,Z=O*B-H*Y,D=Math.hypot(F,C,Z),!D)F=0,C=0,Z=0;else D=1/D,F*=D,C*=D,Z*=D;return $[0]=Y,$[1]=F,$[2]=O,$[3]=0,$[4]=B,$[5]=C,$[6]=H,$[7]=0,$[8]=V,$[9]=Z,$[10]=W,$[11]=0,$[12]=-(Y*X+B*U+V*P),$[13]=-(F*X+C*U+Z*P),$[14]=-(O*X+H*U+W*P),$[15]=1,$}function HK($,K,Q,J){var Y=K[0],B=K[1],V=K[2],F=J[0],C=J[1],Z=J[2],O=Y-Q[0],H=B-Q[1],W=V-Q[2],D=O*O+H*H+W*W;if(D>0)D=1/Math.sqrt(D),O*=D,H*=D,W*=D;var X=C*W-Z*H,U=Z*O-F*W,P=F*H-C*O;if(D=X*X+U*U+P*P,D>0)D=1/Math.sqrt(D),X*=D,U*=D,P*=D;return $[0]=X,$[1]=U,$[2]=P,$[3]=0,$[4]=H*P-W*U,$[5]=W*X-O*P,$[6]=O*U-H*X,$[7]=0,$[8]=O,$[9]=H,$[10]=W,$[11]=0,$[12]=Y,$[13]=B,$[14]=V,$[15]=1,$}function PK($){return"mat4("+$[0]+", "+$[1]+", "+$[2]+", "+$[3]+", "+$[4]+", "+$[5]+", "+$[6]+", "+$[7]+", "+$[8]+", "+$[9]+", "+$[10]+", "+$[11]+", "+$[12]+", "+$[13]+", "+$[14]+", "+$[15]+")"}function DK($){return Math.hypot($[0],$[1],$[2],$[3],$[4],$[5],$[6],$[7],$[8],$[9],$[10],$[11],$[12],$[13],$[14],$[15])}function WK($,K,Q){return $[0]=K[0]+Q[0],$[1]=K[1]+Q[1],$[2]=K[2]+Q[2],$[3]=K[3]+Q[3],$[4]=K[4]+Q[4],$[5]=K[5]+Q[5],$[6]=K[6]+Q[6],$[7]=K[7]+Q[7],$[8]=K[8]+Q[8],$[9]=K[9]+Q[9],$[10]=K[10]+Q[10],$[11]=K[11]+Q[11],$[12]=K[12]+Q[12],$[13]=K[13]+Q[13],$[14]=K[14]+Q[14],$[15]=K[15]+Q[15],$}function r0($,K,Q){return $[0]=K[0]-Q[0],$[1]=K[1]-Q[1],$[2]=K[2]-Q[2],$[3]=K[3]-Q[3],$[4]=K[4]-Q[4],$[5]=K[5]-Q[5],$[6]=K[6]-Q[6],$[7]=K[7]-Q[7],$[8]=K[8]-Q[8],$[9]=K[9]-Q[9],$[10]=K[10]-Q[10],$[11]=K[11]-Q[11],$[12]=K[12]-Q[12],$[13]=K[13]-Q[13],$[14]=K[14]-Q[14],$[15]=K[15]-Q[15],$}function UK($,K,Q){return $[0]=K[0]*Q,$[1]=K[1]*Q,$[2]=K[2]*Q,$[3]=K[3]*Q,$[4]=K[4]*Q,$[5]=K[5]*Q,$[6]=K[6]*Q,$[7]=K[7]*Q,$[8]=K[8]*Q,$[9]=K[9]*Q,$[10]=K[10]*Q,$[11]=K[11]*Q,$[12]=K[12]*Q,$[13]=K[13]*Q,$[14]=K[14]*Q,$[15]=K[15]*Q,$}function XK($,K,Q,J){return $[0]=K[0]+Q[0]*J,$[1]=K[1]+Q[1]*J,$[2]=K[2]+Q[2]*J,$[3]=K[3]+Q[3]*J,$[4]=K[4]+Q[4]*J,$[5]=K[5]+Q[5]*J,$[6]=K[6]+Q[6]*J,$[7]=K[7]+Q[7]*J,$[8]=K[8]+Q[8]*J,$[9]=K[9]+Q[9]*J,$[10]=K[10]+Q[10]*J,$[11]=K[11]+Q[11]*J,$[12]=K[12]+Q[12]*J,$[13]=K[13]+Q[13]*J,$[14]=K[14]+Q[14]*J,$[15]=K[15]+Q[15]*J,$}function jK($,K){return $[0]===K[0]&&$[1]===K[1]&&$[2]===K[2]&&$[3]===K[3]&&$[4]===K[4]&&$[5]===K[5]&&$[6]===K[6]&&$[7]===K[7]&&$[8]===K[8]&&$[9]===K[9]&&$[10]===K[10]&&$[11]===K[11]&&$[12]===K[12]&&$[13]===K[13]&&$[14]===K[14]&&$[15]===K[15]}function AK($,K){var Q=$[0],J=$[1],Y=$[2],B=$[3],V=$[4],F=$[5],C=$[6],Z=$[7],O=$[8],H=$[9],W=$[10],D=$[11],X=$[12],U=$[13],P=$[14],j=$[15],_=K[0],G=K[1],M=K[2],R=K[3],N=K[4],I=K[5],T=K[6],S=K[7],h=K[8],w=K[9],v=K[10],g=K[11],L=K[12],y=K[13],n=K[14],s=K[15];return Math.abs(Q-_)<=E*Math.max(1,Math.abs(Q),Math.abs(_))&&Math.abs(J-G)<=E*Math.max(1,Math.abs(J),Math.abs(G))&&Math.abs(Y-M)<=E*Math.max(1,Math.abs(Y),Math.abs(M))&&Math.abs(B-R)<=E*Math.max(1,Math.abs(B),Math.abs(R))&&Math.abs(V-N)<=E*Math.max(1,Math.abs(V),Math.abs(N))&&Math.abs(F-I)<=E*Math.max(1,Math.abs(F),Math.abs(I))&&Math.abs(C-T)<=E*Math.max(1,Math.abs(C),Math.abs(T))&&Math.abs(Z-S)<=E*Math.max(1,Math.abs(Z),Math.abs(S))&&Math.abs(O-h)<=E*Math.max(1,Math.abs(O),Math.abs(h))&&Math.abs(H-w)<=E*Math.max(1,Math.abs(H),Math.abs(w))&&Math.abs(W-v)<=E*Math.max(1,Math.abs(W),Math.abs(v))&&Math.abs(D-g)<=E*Math.max(1,Math.abs(D),Math.abs(g))&&Math.abs(X-L)<=E*Math.max(1,Math.abs(X),Math.abs(L))&&Math.abs(U-y)<=E*Math.max(1,Math.abs(U),Math.abs(y))&&Math.abs(P-n)<=E*Math.max(1,Math.abs(P),Math.abs(n))&&Math.abs(j-s)<=E*Math.max(1,Math.abs(j),Math.abs(s))}var BK=n0,CK=s0,RK=i0,NK=r0;var e={};O0(e,{str:()=>{{return XQ}},squaredLength:()=>{{return G$}},sqrLen:()=>{{return LQ}},sqlerp:()=>{{return SQ}},slerp:()=>{{return K0}},setAxisAngle:()=>{{return W$}},setAxes:()=>{{return hQ}},set:()=>{{return NQ}},scale:()=>{{return R$}},rotationTo:()=>{{return TQ}},rotateZ:()=>{{return ZQ}},rotateY:()=>{{return CQ}},rotateX:()=>{{return FQ}},random:()=>{{return PQ}},pow:()=>{{return HQ}},normalize:()=>{{return G0}},multiply:()=>{{return U$}},mul:()=>{{return GQ}},ln:()=>{{return j$}},lerp:()=>{{return EQ}},length:()=>{{return M$}},len:()=>{{return _Q}},invert:()=>{{return DQ}},identity:()=>{{return YQ}},getAxisAngle:()=>{{return BQ}},getAngle:()=>{{return VQ}},fromValues:()=>{{return AQ}},fromMat3:()=>{{return A$}},fromEuler:()=>{{return UQ}},exp:()=>{{return X$}},exactEquals:()=>{{return kQ}},equals:()=>{{return qQ}},dot:()=>{{return N$}},create:()=>{{return M0}},copy:()=>{{return RQ}},conjugate:()=>{{return WQ}},clone:()=>{{return jQ}},calculateW:()=>{{return OQ}},add:()=>{{return MQ}}});var l={};O0(l,{zero:()=>{{return nK}},transformQuat:()=>{{return cK}},transformMat4:()=>{{return yK}},transformMat3:()=>{{return xK}},subtract:()=>{{return e0}},sub:()=>{{return eK}},str:()=>{{return sK}},squaredLength:()=>{{return $$}},squaredDistance:()=>{{return t0}},sqrLen:()=>{{return $Q}},sqrDist:()=>{{return tK}},set:()=>{{return EK}},scaleAndAdd:()=>{{return IK}},scale:()=>{{return hK}},round:()=>{{return SK}},rotateZ:()=>{{return lK}},rotateY:()=>{{return iK}},rotateX:()=>{{return mK}},random:()=>{{return fK}},normalize:()=>{{return R0}},negate:()=>{{return wK}},multiply:()=>{{return u0}},mul:()=>{{return uK}},min:()=>{{return qK}},max:()=>{{return TK}},lerp:()=>{{return pK}},length:()=>{{return b0}},len:()=>{{return N0}},inverse:()=>{{return vK}},hermite:()=>{{return gK}},fromValues:()=>{{return t}},forEach:()=>{{return KQ}},floor:()=>{{return kK}},exactEquals:()=>{{return rK}},equals:()=>{{return bK}},dot:()=>{{return $0}},divide:()=>{{return o0}},div:()=>{{return oK}},distance:()=>{{return a0}},dist:()=>{{return aK}},cross:()=>{{return b}},create:()=>{{return a}},copy:()=>{{return GK}},clone:()=>{{return MK}},ceil:()=>{{return LK}},bezier:()=>{{return zK}},angle:()=>{{return dK}},add:()=>{{return _K}}});function a(){var $=new q(3);if(q!=Float32Array)$[0]=0,$[1]=0,$[2]=0;return $}function MK($){var K=new q(3);return K[0]=$[0],K[1]=$[1],K[2]=$[2],K}function b0($){var K=$[0],Q=$[1],J=$[2];return Math.hypot(K,Q,J)}function t($,K,Q){var J=new q(3);return J[0]=$,J[1]=K,J[2]=Q,J}function GK($,K){return $[0]=K[0],$[1]=K[1],$[2]=K[2],$}function EK($,K,Q,J){return $[0]=K,$[1]=Q,$[2]=J,$}function _K($,K,Q){return $[0]=K[0]+Q[0],$[1]=K[1]+Q[1],$[2]=K[2]+Q[2],$}function e0($,K,Q){return $[0]=K[0]-Q[0],$[1]=K[1]-Q[1],$[2]=K[2]-Q[2],$}function u0($,K,Q){return $[0]=K[0]*Q[0],$[1]=K[1]*Q[1],$[2]=K[2]*Q[2],$}function o0($,K,Q){return $[0]=K[0]/Q[0],$[1]=K[1]/Q[1],$[2]=K[2]/Q[2],$}function LK($,K){return $[0]=Math.ceil(K[0]),$[1]=Math.ceil(K[1]),$[2]=Math.ceil(K[2]),$}function kK($,K){return $[0]=Math.floor(K[0]),$[1]=Math.floor(K[1]),$[2]=Math.floor(K[2]),$}function qK($,K,Q){return $[0]=Math.min(K[0],Q[0]),$[1]=Math.min(K[1],Q[1]),$[2]=Math.min(K[2],Q[2]),$}function TK($,K,Q){return $[0]=Math.max(K[0],Q[0]),$[1]=Math.max(K[1],Q[1]),$[2]=Math.max(K[2],Q[2]),$}function SK($,K){return $[0]=Math.round(K[0]),$[1]=Math.round(K[1]),$[2]=Math.round(K[2]),$}function hK($,K,Q){return $[0]=K[0]*Q,$[1]=K[1]*Q,$[2]=K[2]*Q,$}function IK($,K,Q,J){return $[0]=K[0]+Q[0]*J,$[1]=K[1]+Q[1]*J,$[2]=K[2]+Q[2]*J,$}function a0($,K){var Q=K[0]-$[0],J=K[1]-$[1],Y=K[2]-$[2];return Math.hypot(Q,J,Y)}function t0($,K){var Q=K[0]-$[0],J=K[1]-$[1],Y=K[2]-$[2];return Q*Q+J*J+Y*Y}function $$($){var K=$[0],Q=$[1],J=$[2];return K*K+Q*Q+J*J}function wK($,K){return $[0]=-K[0],$[1]=-K[1],$[2]=-K[2],$}function vK($,K){return $[0]=1/K[0],$[1]=1/K[1],$[2]=1/K[2],$}function R0($,K){var Q=K[0],J=K[1],Y=K[2],B=Q*Q+J*J+Y*Y;if(B>0)B=1/Math.sqrt(B);return $[0]=K[0]*B,$[1]=K[1]*B,$[2]=K[2]*B,$}function $0($,K){return $[0]*K[0]+$[1]*K[1]+$[2]*K[2]}function b($,K,Q){var J=K[0],Y=K[1],B=K[2],V=Q[0],F=Q[1],C=Q[2];return $[0]=Y*C-B*F,$[1]=B*V-J*C,$[2]=J*F-Y*V,$}function pK($,K,Q,J){var Y=K[0],B=K[1],V=K[2];return $[0]=Y+J*(Q[0]-Y),$[1]=B+J*(Q[1]-B),$[2]=V+J*(Q[2]-V),$}function gK($,K,Q,J,Y,B){var V=B*B,F=V*(2*B-3)+1,C=V*(B-2)+B,Z=V*(B-1),O=V*(3-2*B);return $[0]=K[0]*F+Q[0]*C+J[0]*Z+Y[0]*O,$[1]=K[1]*F+Q[1]*C+J[1]*Z+Y[1]*O,$[2]=K[2]*F+Q[2]*C+J[2]*Z+Y[2]*O,$}function zK($,K,Q,J,Y,B){var V=1-B,F=V*V,C=B*B,Z=F*V,O=3*B*F,H=3*C*V,W=C*B;return $[0]=K[0]*Z+Q[0]*O+J[0]*H+Y[0]*W,$[1]=K[1]*Z+Q[1]*O+J[1]*H+Y[1]*W,$[2]=K[2]*Z+Q[2]*O+J[2]*H+Y[2]*W,$}function fK($,K){K=K||1;var Q=i()*2*Math.PI,J=i()*2-1,Y=Math.sqrt(1-J*J)*K;return $[0]=Math.cos(Q)*Y,$[1]=Math.sin(Q)*Y,$[2]=J*K,$}function yK($,K,Q){var J=K[0],Y=K[1],B=K[2],V=Q[3]*J+Q[7]*Y+Q[11]*B+Q[15];return V=V||1,$[0]=(Q[0]*J+Q[4]*Y+Q[8]*B+Q[12])/V,$[1]=(Q[1]*J+Q[5]*Y+Q[9]*B+Q[13])/V,$[2]=(Q[2]*J+Q[6]*Y+Q[10]*B+Q[14])/V,$}function xK($,K,Q){var J=K[0],Y=K[1],B=K[2];return $[0]=J*Q[0]+Y*Q[3]+B*Q[6],$[1]=J*Q[1]+Y*Q[4]+B*Q[7],$[2]=J*Q[2]+Y*Q[5]+B*Q[8],$}function cK($,K,Q){var J=Q[0],Y=Q[1],B=Q[2],V=Q[3],F=K[0],C=K[1],Z=K[2],O=Y*Z-B*C,H=B*F-J*Z,W=J*C-Y*F,D=Y*W-B*H,X=B*O-J*W,U=J*H-Y*O,P=V*2;return O*=P,H*=P,W*=P,D*=2,X*=2,U*=2,$[0]=F+O+D,$[1]=C+H+X,$[2]=Z+W+U,$}function mK($,K,Q,J){var Y=[],B=[];return Y[0]=K[0]-Q[0],Y[1]=K[1]-Q[1],Y[2]=K[2]-Q[2],B[0]=Y[0],B[1]=Y[1]*Math.cos(J)-Y[2]*Math.sin(J),B[2]=Y[1]*Math.sin(J)+Y[2]*Math.cos(J),$[0]=B[0]+Q[0],$[1]=B[1]+Q[1],$[2]=B[2]+Q[2],$}function iK($,K,Q,J){var Y=[],B=[];return Y[0]=K[0]-Q[0],Y[1]=K[1]-Q[1],Y[2]=K[2]-Q[2],B[0]=Y[2]*Math.sin(J)+Y[0]*Math.cos(J),B[1]=Y[1],B[2]=Y[2]*Math.cos(J)-Y[0]*Math.sin(J),$[0]=B[0]+Q[0],$[1]=B[1]+Q[1],$[2]=B[2]+Q[2],$}function lK($,K,Q,J){var Y=[],B=[];return Y[0]=K[0]-Q[0],Y[1]=K[1]-Q[1],Y[2]=K[2]-Q[2],B[0]=Y[0]*Math.cos(J)-Y[1]*Math.sin(J),B[1]=Y[0]*Math.sin(J)+Y[1]*Math.cos(J),B[2]=Y[2],$[0]=B[0]+Q[0],$[1]=B[1]+Q[1],$[2]=B[2]+Q[2],$}function dK($,K){var Q=$[0],J=$[1],Y=$[2],B=K[0],V=K[1],F=K[2],C=Math.sqrt(Q*Q+J*J+Y*Y),Z=Math.sqrt(B*B+V*V+F*F),O=C*Z,H=O&&$0($,K)/O;return Math.acos(Math.min(Math.max(H,-1),1))}function nK($){return $[0]=0,$[1]=0,$[2]=0,$}function sK($){return"vec3("+$[0]+", "+$[1]+", "+$[2]+")"}function rK($,K){return $[0]===K[0]&&$[1]===K[1]&&$[2]===K[2]}function bK($,K){var Q=$[0],J=$[1],Y=$[2],B=K[0],V=K[1],F=K[2];return Math.abs(Q-B)<=E*Math.max(1,Math.abs(Q),Math.abs(B))&&Math.abs(J-V)<=E*Math.max(1,Math.abs(J),Math.abs(V))&&Math.abs(Y-F)<=E*Math.max(1,Math.abs(Y),Math.abs(F))}var eK=e0,uK=u0,oK=o0,aK=a0,tK=t0,N0=b0,$Q=$$,KQ=function(){var $=a();return function(K,Q,J,Y,B,V){var F,C;if(!Q)Q=3;if(!J)J=0;if(Y)C=Math.min(Y*Q+J,K.length);else C=K.length;for(F=J;F<C;F+=Q)$[0]=K[F],$[1]=K[F+1],$[2]=K[F+2],B($,$,V),K[F]=$[0],K[F+1]=$[1],K[F+2]=$[2];return K}}();function QQ(){var $=new q(4);if(q!=Float32Array)$[0]=0,$[1]=0,$[2]=0,$[3]=0;return $}function K$($){var K=new q(4);return K[0]=$[0],K[1]=$[1],K[2]=$[2],K[3]=$[3],K}function Q$($,K,Q,J){var Y=new q(4);return Y[0]=$,Y[1]=K,Y[2]=Q,Y[3]=J,Y}function J$($,K){return $[0]=K[0],$[1]=K[1],$[2]=K[2],$[3]=K[3],$}function Y$($,K,Q,J,Y){return $[0]=K,$[1]=Q,$[2]=J,$[3]=Y,$}function B$($,K,Q){return $[0]=K[0]+Q[0],$[1]=K[1]+Q[1],$[2]=K[2]+Q[2],$[3]=K[3]+Q[3],$}function V$($,K,Q){return $[0]=K[0]*Q,$[1]=K[1]*Q,$[2]=K[2]*Q,$[3]=K[3]*Q,$}function F$($){var K=$[0],Q=$[1],J=$[2],Y=$[3];return Math.hypot(K,Q,J,Y)}function C$($){var K=$[0],Q=$[1],J=$[2],Y=$[3];return K*K+Q*Q+J*J+Y*Y}function Z$($,K){var Q=K[0],J=K[1],Y=K[2],B=K[3],V=Q*Q+J*J+Y*Y+B*B;if(V>0)V=1/Math.sqrt(V);return $[0]=Q*V,$[1]=J*V,$[2]=Y*V,$[3]=B*V,$}function O$($,K){return $[0]*K[0]+$[1]*K[1]+$[2]*K[2]+$[3]*K[3]}function H$($,K,Q,J){var Y=K[0],B=K[1],V=K[2],F=K[3];return $[0]=Y+J*(Q[0]-Y),$[1]=B+J*(Q[1]-B),$[2]=V+J*(Q[2]-V),$[3]=F+J*(Q[3]-F),$}function P$($,K){return $[0]===K[0]&&$[1]===K[1]&&$[2]===K[2]&&$[3]===K[3]}function D$($,K){var Q=$[0],J=$[1],Y=$[2],B=$[3],V=K[0],F=K[1],C=K[2],Z=K[3];return Math.abs(Q-V)<=E*Math.max(1,Math.abs(Q),Math.abs(V))&&Math.abs(J-F)<=E*Math.max(1,Math.abs(J),Math.abs(F))&&Math.abs(Y-C)<=E*Math.max(1,Math.abs(Y),Math.abs(C))&&Math.abs(B-Z)<=E*Math.max(1,Math.abs(B),Math.abs(Z))}var FJ=function(){var $=QQ();return function(K,Q,J,Y,B,V){var F,C;if(!Q)Q=4;if(!J)J=0;if(Y)C=Math.min(Y*Q+J,K.length);else C=K.length;for(F=J;F<C;F+=Q)$[0]=K[F],$[1]=K[F+1],$[2]=K[F+2],$[3]=K[F+3],B($,$,V),K[F]=$[0],K[F+1]=$[1],K[F+2]=$[2],K[F+3]=$[3];return K}}();function M0(){var $=new q(4);if(q!=Float32Array)$[0]=0,$[1]=0,$[2]=0;return $[3]=1,$}function YQ($){return $[0]=0,$[1]=0,$[2]=0,$[3]=1,$}function W$($,K,Q){Q=Q*0.5;var J=Math.sin(Q);return $[0]=J*K[0],$[1]=J*K[1],$[2]=J*K[2],$[3]=Math.cos(Q),$}function BQ($,K){var Q=Math.acos(K[3])*2,J=Math.sin(Q/2);if(J>E)$[0]=K[0]/J,$[1]=K[1]/J,$[2]=K[2]/J;else $[0]=1,$[1]=0,$[2]=0;return Q}function VQ($,K){var Q=N$($,K);return Math.acos(2*Q*Q-1)}function U$($,K,Q){var J=K[0],Y=K[1],B=K[2],V=K[3],F=Q[0],C=Q[1],Z=Q[2],O=Q[3];return $[0]=J*O+V*F+Y*Z-B*C,$[1]=Y*O+V*C+B*F-J*Z,$[2]=B*O+V*Z+J*C-Y*F,$[3]=V*O-J*F-Y*C-B*Z,$}function FQ($,K,Q){Q*=0.5;var J=K[0],Y=K[1],B=K[2],V=K[3],F=Math.sin(Q),C=Math.cos(Q);return $[0]=J*C+V*F,$[1]=Y*C+B*F,$[2]=B*C-Y*F,$[3]=V*C-J*F,$}function CQ($,K,Q){Q*=0.5;var J=K[0],Y=K[1],B=K[2],V=K[3],F=Math.sin(Q),C=Math.cos(Q);return $[0]=J*C-B*F,$[1]=Y*C+V*F,$[2]=B*C+J*F,$[3]=V*C-Y*F,$}function ZQ($,K,Q){Q*=0.5;var J=K[0],Y=K[1],B=K[2],V=K[3],F=Math.sin(Q),C=Math.cos(Q);return $[0]=J*C+Y*F,$[1]=Y*C-J*F,$[2]=B*C+V*F,$[3]=V*C-B*F,$}function OQ($,K){var Q=K[0],J=K[1],Y=K[2];return $[0]=Q,$[1]=J,$[2]=Y,$[3]=Math.sqrt(Math.abs(1-Q*Q-J*J-Y*Y)),$}function X$($,K){var Q=K[0],J=K[1],Y=K[2],B=K[3],V=Math.sqrt(Q*Q+J*J+Y*Y),F=Math.exp(B),C=V>0?F*Math.sin(V)/V:0;return $[0]=Q*C,$[1]=J*C,$[2]=Y*C,$[3]=F*Math.cos(V),$}function j$($,K){var Q=K[0],J=K[1],Y=K[2],B=K[3],V=Math.sqrt(Q*Q+J*J+Y*Y),F=V>0?Math.atan2(V,B)/V:0;return $[0]=Q*F,$[1]=J*F,$[2]=Y*F,$[3]=0.5*Math.log(Q*Q+J*J+Y*Y+B*B),$}function HQ($,K,Q){return j$($,K),R$($,$,Q),X$($,$),$}function K0($,K,Q,J){var Y=K[0],B=K[1],V=K[2],F=K[3],C=Q[0],Z=Q[1],O=Q[2],H=Q[3],W,D,X,U,P;if(D=Y*C+B*Z+V*O+F*H,D<0)D=-D,C=-C,Z=-Z,O=-O,H=-H;if(1-D>E)W=Math.acos(D),X=Math.sin(W),U=Math.sin((1-J)*W)/X,P=Math.sin(J*W)/X;else U=1-J,P=J;return $[0]=U*Y+P*C,$[1]=U*B+P*Z,$[2]=U*V+P*O,$[3]=U*F+P*H,$}function PQ($){var K=i(),Q=i(),J=i(),Y=Math.sqrt(1-K),B=Math.sqrt(K);return $[0]=Y*Math.sin(2*Math.PI*Q),$[1]=Y*Math.cos(2*Math.PI*Q),$[2]=B*Math.sin(2*Math.PI*J),$[3]=B*Math.cos(2*Math.PI*J),$}function DQ($,K){var Q=K[0],J=K[1],Y=K[2],B=K[3],V=Q*Q+J*J+Y*Y+B*B,F=V?1/V:0;return $[0]=-Q*F,$[1]=-J*F,$[2]=-Y*F,$[3]=B*F,$}function WQ($,K){return $[0]=-K[0],$[1]=-K[1],$[2]=-K[2],$[3]=K[3],$}function A$($,K){var Q=K[0]+K[4]+K[8],J;if(Q>0)J=Math.sqrt(Q+1),$[3]=0.5*J,J=0.5/J,$[0]=(K[5]-K[7])*J,$[1]=(K[6]-K[2])*J,$[2]=(K[1]-K[3])*J;else{var Y=0;if(K[4]>K[0])Y=1;if(K[8]>K[Y*3+Y])Y=2;var B=(Y+1)%3,V=(Y+2)%3;J=Math.sqrt(K[Y*3+Y]-K[B*3+B]-K[V*3+V]+1),$[Y]=0.5*J,J=0.5/J,$[3]=(K[B*3+V]-K[V*3+B])*J,$[B]=(K[B*3+Y]+K[Y*3+B])*J,$[V]=(K[V*3+Y]+K[Y*3+V])*J}return $}function UQ($,K,Q,J){var Y=0.5*Math.PI/180;K*=Y,Q*=Y,J*=Y;var B=Math.sin(K),V=Math.cos(K),F=Math.sin(Q),C=Math.cos(Q),Z=Math.sin(J),O=Math.cos(J);return $[0]=B*C*O-V*F*Z,$[1]=V*F*O+B*C*Z,$[2]=V*C*Z-B*F*O,$[3]=V*C*O+B*F*Z,$}function XQ($){return"quat("+$[0]+", "+$[1]+", "+$[2]+", "+$[3]+")"}var jQ=K$,AQ=Q$,RQ=J$,NQ=Y$,MQ=B$,GQ=U$,R$=V$,N$=O$,EQ=H$,M$=F$,_Q=M$,G$=C$,LQ=G$,G0=Z$,kQ=P$,qQ=D$,TQ=function(){var $=a(),K=t(1,0,0),Q=t(0,1,0);return function(J,Y,B){var V=$0(Y,B);if(V<-0.999999){if(b($,K,Y),N0($)<0.000001)b($,Q,Y);return R0($,$),W$(J,$,Math.PI),J}else if(V>0.999999)return J[0]=0,J[1]=0,J[2]=0,J[3]=1,J;else return b($,Y,B),J[0]=$[0],J[1]=$[1],J[2]=$[2],J[3]=1+V,G0(J,J)}}(),SQ=function(){var $=M0(),K=M0();return function(Q,J,Y,B,V,F){return K0($,J,V,F),K0(K,Y,B,F),K0(Q,$,K,2*F*(1-F)),Q}}(),hQ=function(){var $=c0();return function(K,Q,J,Y){return $[0]=J[0],$[3]=J[1],$[6]=J[2],$[1]=Y[0],$[4]=Y[1],$[7]=Y[2],$[2]=-Q[0],$[5]=-Q[1],$[8]=-Q[2],G0(K,A$(K,$))}}();var IQ=Math.PI/90;class E0{matrix;constructor(){this.matrix=k.create()}static create(){return new E0}translate($,K,Q){return k.translate(this.matrix,this.matrix,[$,K,Q]),this}rotateX($){return k.rotateX(this.matrix,this.matrix,$),this}rotateY($){return k.rotateY(this.matrix,this.matrix,$),this}rotateZ($){return k.rotateZ(this.matrix,this.matrix,$),this}scale($,K,Q){return k.scale(this.matrix,this.matrix,[$,K,Q]),this}perspective($,K,Q,J){return k.perspective(this.matrix,$*IQ,K,Q,J),this}ortho($,K,Q,J,Y,B){return k.ortho(this.matrix,$,K,Q,J,Y,B),this}static aTemp=k.create();static bTemp=k.create();static combineMat4($,K,Q,J=0.5){k.multiplyScalar(this.aTemp,K,1-J),k.multiplyScalar(this.bTemp,Q,J),k.add($,this.aTemp,this.bTemp)}static tempQuat=e.create();static moveMatrix($,K,Q,J,Y=null){const B=l.fromValues(-K,Q,J);if(Y)k.getRotation(this.tempQuat,Y),e.invert(this.tempQuat,this.tempQuat),l.transformQuat(B,B,this.tempQuat);k.translate($,$,B)}getMatrix(){return this.matrix}}var z=E0;class _0{gl;uniforms;cameraMatrix=z.create().translate(0,0,-1).getMatrix();perspectiveMatrix=z.create().getMatrix();orthoMatrix=z.create().getMatrix();projectionMatrix=z.create().getMatrix();perspectiveLevel=1;constructor($,K){this.gl=$,this.uniforms=K}configPerspectiveMatrix($){this.perspectiveMatrix=z.create().perspective(45,$,0.1,1000).getMatrix(),this.updatePerspective()}configOrthoMatrix($){this.orthoMatrix=z.create().ortho(-$,$,-1,1,-1000,1000).getMatrix(),this.updatePerspective()}camTiltMatrix=z.create().getMatrix();camTurnMatrix=z.create().getMatrix();camMatrix=k.create();refresh(){k.mul(this.camMatrix,this.camTiltMatrix,this.camTurnMatrix),k.mul(this.camMatrix,this.camMatrix,this.cameraMatrix);const $=this.uniforms.getUniformLocation(u);if($)this.gl.uniformMatrix4fv($,!1,this.camMatrix)}orthoTemp=k.create();perspectiveTemp=k.create();updatePerspective($){if($!==void 0)this.perspectiveLevel=$;z.combineMat4(this.projectionMatrix,this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel);const K=this.uniforms.getUniformLocation(g0);if(K)this.gl.uniformMatrix4fv(K,!1,this.projectionMatrix);this.refresh()}moveCam($,K,Q){z.moveMatrix(this.cameraMatrix,$,K,Q,this.camTurnMatrix),this.refresh()}turnCam($){k.rotateY(this.camTurnMatrix,this.camTurnMatrix,$),this.refresh()}tilt($){k.rotateX(this.camTiltMatrix,this.camTiltMatrix,$),this.refresh()}}class c extends p{texImgSrc;active=!1;width;height;constructor($){super();if(this.texImgSrc=$,console.log($ instanceof HTMLImageElement?$.naturalWidth:null),this.width=$ instanceof HTMLImageElement?$.naturalWidth:$ instanceof VideoFrame?$.displayWidth:$.width,this.height=$ instanceof HTMLImageElement?$.naturalHeight:$ instanceof VideoFrame?$.displayHeight:$.width,!this.width||!this.height)throw new Error("Invalid image")}static createFromCanvas($){return new c($)}static async loadImage($){return new Promise((K,Q)=>{const J=new Image,Y=new c(J),B=()=>K(Y),V=(F)=>Q(F.error);J.addEventListener("error",V),J.addEventListener("load",B,{once:!0}),Y.addOnDestroy(()=>J.removeEventListener("load",B)),J.src=$})}static async loadVideo($,K){return new Promise((Q,J)=>{const Y=document.createElement("video"),B=new c(Y);if(Y.loop=!0,K!==void 0)Y.volume=K;const V=()=>Y.play(),F=()=>Q(B);Y.addEventListener("loadedmetadata",V),Y.addEventListener("playing",F,{once:!0}),Y.addEventListener("error",(C)=>J(C.error)),Y.src=$,B.addOnDestroy(()=>{Y.pause(),Y.removeEventListener("playing",F),Y.removeEventListener("loadmetadata",V)})})}static async loadWebcam($){return new Promise((K,Q)=>{const J=document.createElement("video"),Y=new c(J);J.loop=!0;const B=()=>J.play(),V=()=>K(Y);J.addEventListener("loadedmetadata",B),J.addEventListener("playing",V,{once:!0}),J.addEventListener("error",(C)=>Q(C.error));let F=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:$}}).then((C)=>{if(!F)J.srcObject=C,Y.addOnDestroy(()=>C.getTracks().forEach((Z)=>Z.stop()))}),Y.addOnDestroy(()=>{F=!0,J.pause(),J.removeEventListener("playing",V),J.removeEventListener("loadmetadata",B)})})}}class L0 extends p{constructor(){super(...arguments)}images={};hasImageId($){return!!this.images[$]}getMedia($){return this.images[$]}async drawImage($,K){const Q=new OffscreenCanvas(1,1);K(Q.getContext("2d"));const J=c.createFromCanvas(Q);return this.images[$]=this.own(J),J}async loadCanvas($,K){const Q=c.createFromCanvas(K);return K.getContext("2d"),this.images[$]=this.own(Q),Q}async loadImage($,K){const Q=await c.loadImage(K);return this.images[$]=this.own(Q),Q}async loadVideo($,K,Q){const J=await c.loadVideo(K,Q);return this.images[$]=this.own(J),J}async loadWebCam($,K){const Q=await c.loadWebcam(K);return this.images[$]=this.own(Q),Q}}function E$($,K=(Q)=>Q.key){var Q=[];return k0($,"",!0,(J)=>Q.push(J),K),Q.join("")}var k0=function($,K,Q,J,Y){if($){J(`${K}${Q?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${Y($)}\n`);const B=K+(Q?"    ":"\u2502   ");if($.left)k0($.left,B,!1,J,Y);if($.right)k0($.right,B,!0,J,Y)}};function Q0($){if($===null)return!0;var K=J0($.left),Q=J0($.right);if(Math.abs(K-Q)<=1&&Q0($.left)&&Q0($.right))return!0;return!1}var J0=function($){return $?1+Math.max(J0($.left),J0($.right)):0};function Y0($,K,Q,J,Y){const B=Y-J;if(B>0){const V=J+Math.floor(B/2),F=K[V],C=Q[V],Z={key:F,data:C,parent:$};return Z.left=Y0(Z,K,Q,J,V),Z.right=Y0(Z,K,Q,V+1,Y),Z}return null}function B0($){if($===null)return 0;const K=B0($.left),Q=B0($.right);return $.balanceFactor=K-Q,Math.max(K,Q)+1}function V0($,K,Q,J,Y){if(Q>=J)return;const B=$[Q+J>>1];let V=Q-1,F=J+1;while(!0){do V++;while(Y($[V],B)<0);do F--;while(Y($[F],B)>0);if(V>=F)break;let C=$[V];$[V]=$[F],$[F]=C,C=K[V],K[V]=K[F],K[F]=C}V0($,K,Q,F,Y),V0($,K,F+1,J,Y)}var wQ=function($,K){return $>K?1:$<K?-1:0},F0=function($){var K=$.right;if($.right=K.left,K.left)K.left.parent=$;if(K.parent=$.parent,K.parent)if(K.parent.left===$)K.parent.left=K;else K.parent.right=K;if($.parent=K,K.left=$,$.balanceFactor+=1,K.balanceFactor<0)$.balanceFactor-=K.balanceFactor;if(K.balanceFactor+=1,$.balanceFactor>0)K.balanceFactor+=$.balanceFactor;return K},C0=function($){var K=$.left;if($.left=K.right,$.left)$.left.parent=$;if(K.parent=$.parent,K.parent)if(K.parent.left===$)K.parent.left=K;else K.parent.right=K;if($.parent=K,K.right=$,$.balanceFactor-=1,K.balanceFactor>0)$.balanceFactor-=K.balanceFactor;if(K.balanceFactor-=1,$.balanceFactor<0)K.balanceFactor+=$.balanceFactor;return K};class d{constructor($,K=!1){this._comparator=$||wQ,this._root=null,this._size=0,this._noDuplicates=!!K}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains($){if(this._root){var K=this._root,Q=this._comparator;while(K){var J=Q($,K.key);if(J===0)return!0;else if(J<0)K=K.left;else K=K.right}}return!1}next($){var K=$;if(K)if(K.right){K=K.right;while(K.left)K=K.left}else{K=$.parent;while(K&&K.right===$)$=K,K=K.parent}return K}prev($){var K=$;if(K)if(K.left){K=K.left;while(K.right)K=K.right}else{K=$.parent;while(K&&K.left===$)$=K,K=K.parent}return K}forEach($){var K=this._root,Q=[],J=!1,Y=0;while(!J)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$(K,Y++),K=K.right;else J=!0;return this}range($,K,Q,J){const Y=[],B=this._comparator;let V=this._root,F;while(Y.length!==0||V)if(V)Y.push(V),V=V.left;else{if(V=Y.pop(),F=B(V.key,K),F>0)break;else if(B(V.key,$)>=0){if(Q.call(J,V))return this}V=V.right}return this}keys(){var $=this._root,K=[],Q=[],J=!1;while(!J)if($)K.push($),$=$.left;else if(K.length>0)$=K.pop(),Q.push($.key),$=$.right;else J=!0;return Q}values(){var $=this._root,K=[],Q=[],J=!1;while(!J)if($)K.push($),$=$.left;else if(K.length>0)$=K.pop(),Q.push($.data),$=$.right;else J=!0;return Q}at($){var K=this._root,Q=[],J=!1,Y=0;while(!J)if(K)Q.push(K),K=K.left;else if(Q.length>0){if(K=Q.pop(),Y===$)return K;Y++,K=K.right}else J=!0;return null}minNode(){var $=this._root;if(!$)return null;while($.left)$=$.left;return $}maxNode(){var $=this._root;if(!$)return null;while($.right)$=$.right;return $}min(){var $=this._root;if(!$)return null;while($.left)$=$.left;return $.key}max(){var $=this._root;if(!$)return null;while($.right)$=$.right;return $.key}isEmpty(){return!this._root}pop(){var $=this._root,K=null;if($){while($.left)$=$.left;K={key:$.key,data:$.data},this.remove($.key)}return K}popMax(){var $=this._root,K=null;if($){while($.right)$=$.right;K={key:$.key,data:$.data},this.remove($.key)}return K}find($){var K=this._root,Q=K,J,Y=this._comparator;while(Q)if(J=Y($,Q.key),J===0)return Q;else if(J<0)Q=Q.left;else Q=Q.right;return null}insert($,K){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:$,data:K},this._size++,this._root;var Q=this._comparator,J=this._root,Y=null,B=0;if(this._noDuplicates)while(J)if(B=Q($,J.key),Y=J,B===0)return null;else if(B<0)J=J.left;else J=J.right;else while(J)if(B=Q($,J.key),Y=J,B<=0)J=J.left;else J=J.right;var V={left:null,right:null,balanceFactor:0,parent:Y,key:$,data:K},F;if(B<=0)Y.left=V;else Y.right=V;while(Y){if(B=Q(Y.key,$),B<0)Y.balanceFactor-=1;else Y.balanceFactor+=1;if(Y.balanceFactor===0)break;else if(Y.balanceFactor<-1){if(Y.right.balanceFactor===1)C0(Y.right);if(F=F0(Y),Y===this._root)this._root=F;break}else if(Y.balanceFactor>1){if(Y.left.balanceFactor===-1)F0(Y.left);if(F=C0(Y),Y===this._root)this._root=F;break}Y=Y.parent}return this._size++,V}remove($){if(!this._root)return null;var K=this._root,Q=this._comparator,J=0;while(K)if(J=Q($,K.key),J===0)break;else if(J<0)K=K.left;else K=K.right;if(!K)return null;var Y=K.key,B,V;if(K.left){B=K.left;while(B.left||B.right){while(B.right)B=B.right;if(K.key=B.key,K.data=B.data,B.left)K=B,B=B.left}K.key=B.key,K.data=B.data,K=B}if(K.right){V=K.right;while(V.left||V.right){while(V.left)V=V.left;if(K.key=V.key,K.data=V.data,V.right)K=V,V=V.right}K.key=V.key,K.data=V.data,K=V}var F=K.parent,C=K,Z;while(F){if(F.left===C)F.balanceFactor-=1;else F.balanceFactor+=1;if(F.balanceFactor<-1){if(F.right.balanceFactor===1)C0(F.right);if(Z=F0(F),F===this._root)this._root=Z;F=Z}else if(F.balanceFactor>1){if(F.left.balanceFactor===-1)F0(F.left);if(Z=C0(F),F===this._root)this._root=Z;F=Z}if(F.balanceFactor===-1||F.balanceFactor===1)break;C=F,F=F.parent}if(K.parent)if(K.parent.left===K)K.parent.left=null;else K.parent.right=null;if(K===this._root)this._root=null;return this._size--,Y}load($=[],K=[],Q){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const J=$.length;if(Q)V0($,K,0,J-1,this._comparator);return this._root=Y0(null,$,K,0,J),B0(this._root),this._size=J,this}isBalanced(){return Q0(this._root)}toString($){return E$(this._root,$)}}d.default=d;function Z0($){return Math.max(m,Math.pow(2,Math.ceil(Math.log($)/Math.log(2))))}function _$($,K,Q){if(Q<1)throw new Error("Invalid count");const J=Z0($),Y=Z0(K),B=new Map;let V=m;for(let F=1;F<=Q;F++){V=Z0(J*F);const C=Z0(Y*Math.ceil(Q/F));B.set(V,C)}for(let F=V;F<=f;F*=2)if(!B.has(F))B.set(F,Y);return B}class q0{textureSlots=new d(($,K)=>{const Q=$.size[0]*$.size[1]-K.size[0]*K.size[1];if(Q!==0)return Q;return $.slotNumber-K.slotNumber},!1);allocatedTextures={};minTextureSize;constructor({numTextureSheets:$=16,minTextureWidth:K=m,minTextureHeight:Q=m}={}){this.minTextureSize=[K,Q];for(let J=0;J<$;J++)this.textureSlots.insert(new x([f,f],J))}findSlot($){for(let K=0;K<this.textureSlots.size;K++){const J=this.textureSlots.at(K).key,[Y,B]=J.size;if($.get(Y)<=B)return J}return null}calculateRatio($,K){return Math.max($/K,K/$)}bestFit($,K){const[Q,J]=K.size;let Y=f;return $.forEach((B,V)=>{if(V<=Q&&B<=J){const F=V*B,C=$.get(Y)*Y;if(F<C)Y=V;else if(F===C){if(this.calculateRatio(V,B)<this.calculateRatio(Y,$.get(Y)))Y=V}}}),[Y,$.get(Y)]}isSlotUsed($){return!!this.allocatedTextures[x.getTag($)]}allocate($,K,Q=1){const{size:J,slotNumber:Y}=this.allocateHelper($,K,Q);return{size:J,slotNumber:Y}}deallocate($){if(!this.isSlotUsed($))throw new Error("Slot is not allocated");const K=this.allocatedTextures[x.getTag($)];this.deallocateHelper(K)}allocateHelper($,K,Q=1){const J=_$($,K,Q),Y=this.findSlot(J);if(!Y)throw new Error(`Could not find a slot for texture to fit ${Q} sprites of size ${$}x${K}`);this.textureSlots.remove(Y);const[B,V]=this.bestFit(J,Y);return this.fitSlot(Y,B,V)}deallocateHelper($){if($.parent&&$.sibbling&&!this.isSlotUsed($.sibbling)){const K=$.sibbling;if(this.textureSlots.remove(K),z0&&this.textureSlots.find($))throw new Error("Slot is not expected to be in the tree");const Q=$.parent;this.deallocateHelper(Q);return}this.textureSlots.insert($),delete this.allocatedTextures[$.getTag()]}trySplitHorizontally($,K,Q){if($.canSplitHorizontally(this.minTextureSize[1])){const[J,Y]=$.splitHorizontally();if(J.size[0]>=K)return this.textureSlots.insert(Y),this.fitSlot(J,K,Q)}return null}trySplitVertically($,K,Q){if($.canSplitVertically(this.minTextureSize[0])){const[J,Y]=$.splitVertically();if(J.size[1]>=Q)return this.textureSlots.insert(Y),this.fitSlot(J,K,Q)}return null}fitSlot($,K,Q){if(this.allocatedTextures[$.getTag()]=$,$.size[0]>$.size[1]){const J=this.trySplitHorizontally($,K,Q)??this.trySplitVertically($,K,Q);if(J)return J}else{const J=this.trySplitVertically($,K,Q)??this.trySplitHorizontally($,K,Q);if(J)return J}return $}}var gQ=function($){if(!pQ)return $;return new Proxy($,{get(Q,J){const Y=Q,B=Y[J];if(typeof B==="function")return(...F)=>{const C=B.apply(Y,F);return console.log(`gl.${String(J)}(`,F,") = ",C),C};else return console.log(`gl.${String(J)} = `,B),B}})},vQ={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},pQ=!1;class T0 extends p{gl;programs;attributeBuffers;uniforms;canvas;textureManager;textureAllocator;imageManager;camera;constructor($,K){super();this.gl=gQ($.getContext("webgl2",{...vQ,...K})),this.canvas=$,this.programs=this.own(new P0(this.gl)),this.uniforms=this.own(new U0(this.gl,this.programs)),this.attributeBuffers=this.own(new W0(this.gl,this.programs)),this.textureManager=new j0(this.gl),this.textureAllocator=new q0,this.imageManager=new L0,this.camera=new _0(this.gl,this.uniforms),window.addEventListener("resize",this.checkCanvasSize.bind(this)),console.log(this.gl.getParameter(A.MAX_VERTEX_ATTRIBS))}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const $=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configOrthoMatrix($),this.camera.configPerspectiveMatrix($)}async initialize(){const K={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",A0(y0,K),A0(x0,K)),this.programs.useProgram("main"),console.log(this.uniforms.getUniformLocation(u)),this.gl.enable(A.DEPTH_TEST),this.gl.depthFunc(A.LESS),this.gl.enable(A.BLEND),this.gl.blendFunc(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const Q=w0;this.attributeBuffers.createBuffer(Q);const J=this.attributeBuffers.getAttributeBuffer(Q);this.attributeBuffers.bindBuffer(A.ELEMENT_ARRAY_BUFFER,J),this.attributeBuffers.bufferData(A.ELEMENT_ARRAY_BUFFER,Q,Uint16Array.from([0,1,2,2,3,0]),0,A.STATIC_DRAW)}{const Q=I0;this.attributeBuffers.createBuffer(Q);const J=this.attributeBuffers.getAttributeBuffer(Q);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,J),this.gl.vertexAttribPointer(J.location,4,A.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(J.location),this.attributeBuffers.bufferData(A.ARRAY_BUFFER,Q,Float32Array.from([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),0,A.STATIC_DRAW)}{const Q=v0;this.attributeBuffers.createBuffer(Q);const J=this.attributeBuffers.getAttributeBuffer(Q);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,J);for(let Y=0;Y<4;Y++){const B=J.location+Y;this.gl.vertexAttribPointer(B,4,A.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,Y*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(B),this.gl.vertexAttribDivisor(B,1)}this.attributeBuffers.bufferData(A.ARRAY_BUFFER,Q,Float32Array.from([...z.create().translate(0,0,0).getMatrix(),...z.create().translate(-1,0,1).rotateY(Math.PI/2).getMatrix(),...z.create().translate(1,0,1).rotateY(-Math.PI/2).getMatrix(),...z.create().translate(0,-1,1).rotateX(-Math.PI/2).getMatrix()]),0,A.DYNAMIC_DRAW)}await this.loadLogoTexture(),this.checkCanvasSize(),this.camera.refresh()}async loadLogoTexture(){await this.imageManager.drawImage("logo",(Y)=>{const{canvas:B}=Y;B.width=2048,B.height=2048,Y.imageSmoothingEnabled=!0,Y.fillStyle="#ddd",Y.lineWidth=B.width/50,Y.fillRect(0,0,B.width,B.height),Y.strokeStyle="black",Y.fillStyle="gold",Y.beginPath(),Y.arc(B.width/2,B.height/2,B.width/2*0.8,0,2*Math.PI),Y.fill(),Y.stroke(),Y.beginPath(),Y.arc(B.width/2,B.height/2,B.width/2*0.5,0,Math.PI),Y.stroke(),Y.beginPath(),Y.arc(B.width/3,B.height/3,B.width/2*0.1,0,Math.PI,!0),Y.stroke(),Y.beginPath(),Y.arc(B.width/3*2,B.height/3,B.width/2*0.1,0,Math.PI*2,!0),Y.stroke()});const Q=this.textureAllocator.allocate(512,512),J=this.imageManager.getMedia("logo");this.textureManager.applyImageToSlot(J,Q,!0);{const Y=p0;this.attributeBuffers.createBuffer(Y);const B=this.attributeBuffers.getAttributeBuffer(Y);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,B);const V=B.location;this.gl.vertexAttribPointer(V,3,A.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(V),this.gl.vertexAttribDivisor(V,1),this.attributeBuffers.bufferData(A.ARRAY_BUFFER,Y,Float32Array.from([...Q.size,Q.slotNumber,...Q.size,Q.slotNumber,...Q.size,Q.slotNumber,...Q.size,Q.slotNumber]),0,A.DYNAMIC_DRAW)}}drawArrays($){this.gl.drawArrays(A.TRIANGLES,0,$)}drawElementsInstanced($,K){this.gl.drawElementsInstanced(A.TRIANGLES,$,A.UNSIGNED_SHORT,0,K)}refresh(){this.gl.clearDepth(1),this.gl.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT);const $=6,K=4;this.drawElementsInstanced($,K)}bindVertexArray(){return this.own(new D0(this.gl))}}async function bJ(){console.log("Hello World!")}function eJ($){$.style.border="2px solid silver",$.style.cursor="grab",$.addEventListener("mouseenter",()=>{$.style.borderColor="black"}),$.addEventListener("mouseleave",()=>{$.style.borderColor="silver"});const K=new T0($);K.initialize();const Q={};document.addEventListener("keydown",(Y)=>{Q[Y.code]=!0,console.log(Q)}),document.addEventListener("keyup",(Y)=>{Q[Y.code]=!1});function J(){K.gl.enable(K.gl.DEPTH_TEST);const Y=0.25,B=0.05;if(Q.KeyW)K.camera.moveCam(0,0,Y);if(Q.KeyS)K.camera.moveCam(0,0,-Y);if(Q.ArrowUp&&!Q.ShiftRight)K.camera.moveCam(0,-Y,0);if(Q.ArrowDown&&!Q.ShiftRight)K.camera.moveCam(0,Y,0);if(Q.KeyA||Q.ArrowLeft&&!Q.ShiftRight)K.camera.moveCam(-Y,0,0);if(Q.KeyD||Q.ArrowRight&&!Q.ShiftRight)K.camera.moveCam(Y,0,0);if(Q.KeyQ||Q.ArrowLeft&&Q.ShiftRight)K.camera.turnCam(-B);if(Q.KeyE||Q.ArrowRight&&Q.ShiftRight)K.camera.turnCam(B);if(Q.ArrowUp&&Q.ShiftRight)K.camera.tilt(-B);if(Q.ArrowDown&&Q.ShiftRight)K.camera.tilt(B);K.refresh(),requestAnimationFrame(J)}return J(),K}export{eJ as testCanvas,bJ as hello};

//# debugId=C8DB6B4E1FEB165F64756e2164756e21
