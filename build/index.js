class J{disposables;own(H){if(!this.disposables)this.disposables=new Set;return this.disposables.add(H),H}destroy(){this.disposables?.forEach((H)=>H.destroy())}}var _=function(H,W,j){function K(F,Q){function R(P){return P===H?.VERTEX_SHADER?"vertex":P===H?.FRAGMENT_SHADER?"fragment":void 0}if(Q!==H.VERTEX_SHADER&&Q!==H.FRAGMENT_SHADER)throw new Error(`Shader error in ${R(Q)}`);const Y=H.createShader(Q);if(!Y)throw new Error(`Unable to generate ${R(Q)} shader.`);if(H.shaderSource(Y,F),H.compileShader(Y),!H.getShaderParameter(Y,H.COMPILE_STATUS))console.error(`Shader compile error in ${R(Q)}:`+H.getShaderInfoLog(Y));return Y}const k=H.createProgram();if(!k)throw new Error("Unable to create program.");const w=K(W,H.VERTEX_SHADER),$=K(j,H.FRAGMENT_SHADER);if(H.attachShader(k,w),H.attachShader(k,$),H.linkProgram(k),H.detachShader(k,w),H.detachShader(k,$),H.deleteShader(w),H.deleteShader($),H.validateProgram(k),!H.getProgramParameter(k,H.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+H.getProgramInfoLog(k));return k},N=function(H,W){H.deleteProgram(W)};class V extends J{gl;program;constructor(H,W,j){super();this.gl=H,this.program=_(H,W.trim(),j.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),N(this.gl,this.program)}}class z extends J{activeProgramId="";gl;programs={};constructor(H){super();this.gl=H}addProgram(H,W,j){if(this.programs[H])this.removeProgram(H);this.programs[H]=this.own(new V(this.gl,W,j))}useProgram(H){if(this.activeProgramId!==H)this.activeProgramId=H,this.programs[H].use()}removeProgram(H){this.programs[H].destroy(),delete this.programs[H]}getProgram(H){return this.programs[H??this.activeProgramId]?.program}}class X extends J{gl;triangleArray;constructor(H){super();this.gl=H,this.triangleArray=H.createVertexArray(),H.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class E extends J{bufferRecord={};lastBoundBuffer;gl;programs;constructor(H,W){super();this.gl=H,this.programs=W}getAttributeLocation(H,W){const j=this.programs.getProgram(W);return j?this.gl.getAttribLocation(j,H)??-1:-1}createBuffer(H){this.deleteBuffer(H);const W=this.gl?.createBuffer();if(!W)throw new Error(`Unable to create buffer "${H}"`);const j={buffer:W,location:this.getAttributeLocation(H)};return this.bufferRecord[H]=j,j}deleteBuffer(H){if(this.bufferRecord[H])this.gl.deleteBuffer(this.bufferRecord[H].buffer),delete this.bufferRecord[H]}getAttributeBuffer(H,W){const j=this.bufferRecord[H];if(!j){if(W)return this.createBuffer(H);throw new Error(`Attribute "${H}" not created. Make sure "createBuffer" is called.`)}return j}bufferData(H,W,j,K,k){const w=this.getAttributeBuffer(W);if(j)this.gl.bufferData(H,j,k);else this.gl.bufferData(H,K,k);w.bufferSize=K||j?.length,w.bufferArray=j??new Float32Array(w.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),w.usage=k,w.target=H}bufferSubData(H,W,j,K,k){if(K)this.gl.bufferSubData(H,j,W,K,k);else this.gl.bufferSubData(H,j,W)}bindBuffer(H,W){if(this.lastBoundBuffer!==W)this.lastBoundBuffer=W,this.gl.bindBuffer(H,W.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((H)=>this.deleteBuffer(H))}}class T extends J{gl;programs;constructor(H,W){super();this.gl=H,this.programs=W}getUniformLocation(H,W){const j=this.programs.getProgram(W);return j?this.gl.getUniformLocation(j,H)??void 0:void 0}}var Z="position",M="index";var D=function(H){return new Proxy(H,{get(j,K){const k=j,w=k[K];if(typeof w==="function")return(...F)=>{const Q=w.apply(k,F);return console.log(`gl.${String(K)}(`,F,") = ",Q),Q};else return console.log(`gl.${String(K)} = `,w),w}})},U={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},q=WebGL2RenderingContext,C=1e4;class B extends J{gl;programs;attributeBuffers;uniforms;constructor(H,W){super();this.gl=D(H.getContext("webgl2",{...U,...W})),this.programs=this.own(new z(this.gl)),this.attributeBuffers=this.own(new E(this.gl,this.programs)),this.uniforms=this.own(new T(this.gl,this.programs))}initialize(){this.gl.enable(q.DEPTH_TEST),this.gl.depthFunc(q.LEQUAL),this.gl.enable(q.BLEND),this.gl.blendFunc(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{this.attributeBuffers.createBuffer(M);const H=this.attributeBuffers.getAttributeBuffer(M);this.attributeBuffers.bindBuffer(q.ELEMENT_ARRAY_BUFFER,H)}{this.attributeBuffers.createBuffer(Z);const H=this.attributeBuffers.getAttributeBuffer(Z);this.attributeBuffers.bindBuffer(q.ARRAY_BUFFER,H),this.gl.vertexAttribPointer(H.location,3,q.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(H.location)}this.attributeBuffers.bufferData(q.ARRAY_BUFFER,Z,Float32Array.from([1,1,0,1,-1,0,-1,-1,0,-1,1,0]),12*C*Float32Array.BYTES_PER_ELEMENT,q.STATIC_DRAW),this.attributeBuffers.bufferData(q.ELEMENT_ARRAY_BUFFER,M,Uint16Array.from([0,1,2,3,0,2]),0,q.STATIC_DRAW)}updateTrianglePosition(H,W){const j=this.attributeBuffers.getAttributeBuffer(Z);this.attributeBuffers.bindBuffer(q.ARRAY_BUFFER,j),this.attributeBuffers.bufferSubData(q.ARRAY_BUFFER,Float32Array.from(W),H*4*3*Float32Array.BYTES_PER_ELEMENT)}drawArrays(H){this.gl.drawArrays(q.TRIANGLES,0,H)}drawElementsInstanced(H,W){this.gl.clear(q.COLOR_BUFFER_BIT),this.gl.drawElementsInstanced(q.TRIANGLES,H,q.UNSIGNED_SHORT,0,W)}bindVertexArray(){this.own(new X(this.gl))}}function g(){console.log("Hello World!")}function t(H){const W=new B(H);return W.programs.addProgram("test",`
            #version 300 es

            precision highp float;
            
            layout (location=0) in vec4 position;
            // layout (location=1) in mat4 transform;

            void main() {
                // gl_Position = transform * position;
                gl_Position = position;
            }
        `,`
            #version 300 es

            precision highp float;
            out vec4 fragColor;
            
            void main() {
                fragColor = vec4(1.0, 0.0, 0.0, 0.5);
            }
        `),W.programs.useProgram("test"),W.initialize(),W.drawElementsInstanced(6,2),W}export{t as testCanvas,g as hello};

//# debugId=FA334C208030DEC064756e2164756e21
