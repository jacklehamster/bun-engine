var LK=Object.defineProperty;var O0=(K,Q)=>{for(var $ in Q)LK(K,$,{get:Q[$],enumerable:!0,configurable:!0,set:(J)=>Q[$]=()=>J})};class p{disposables;own(K){if(!this.disposables)this.disposables=new Set;return this.disposables.add(K),K}addOnDestroy(K){this.disposables?.add({destroy:K})}destroy(){this.disposables?.forEach((K)=>K.destroy())}}var A=typeof globalThis.WebGL2RenderingContext!==void 0?globalThis.WebGL2RenderingContext:{},h0="position_and_tex",I0="index",w0="transform",v0="slotSize_and_number",p0="cam",g0="projection",f0=!1;var kK=function(K,Q,$){function J(Z,H){function W(X){return X===K?.VERTEX_SHADER?"vertex":X===K?.FRAGMENT_SHADER?"fragment":void 0}if(H!==K.VERTEX_SHADER&&H!==K.FRAGMENT_SHADER)throw new Error(`Shader error in ${W(H)}`);const D=K.createShader(H);if(!D)throw new Error(`Unable to generate ${W(H)} shader.`);if(K.shaderSource(D,Z),K.compileShader(D),!K.getShaderParameter(D,K.COMPILE_STATUS))console.error(`Shader compile error in ${W(H)}:`+K.getShaderInfoLog(D));return D}const Y=K.createProgram();if(!Y)throw new Error("Unable to create program.");const B=J(Q,K.VERTEX_SHADER),V=J($,K.FRAGMENT_SHADER),F=K.getShaderInfoLog(B),C=K.getShaderInfoLog(V);if(F)console.log("VERTEX",F);if(C)console.log("FRAGMENT",C);K.attachShader(Y,B),K.attachShader(Y,V),K.linkProgram(Y);const O=K.getProgramInfoLog(Y);if(O)console.log("PROGRAM",O);if(K.detachShader(Y,B),K.detachShader(Y,V),K.deleteShader(B),K.deleteShader(V),K.validateProgram(Y),Object.entries(A).forEach(([Z,H])=>{if(H&&K.getError()===H)console.log(`gl.${Z}`)}),!K.getProgramParameter(Y,K.LINK_STATUS))throw new Error("Unable to initialize the shader program:\n"+K.getProgramInfoLog(Y));return Y},qK=function(K,Q){K.deleteProgram(Q)};class Z0 extends p{gl;program;constructor(K,Q,$){super();this.gl=K,this.program=kK(K,Q.trim(),$.trim())}use(){this.gl.useProgram(this.program)}destroy(){super.destroy(),qK(this.gl,this.program)}}class H0 extends p{activeProgramId="";gl;programs={};constructor(K){super();this.gl=K}addProgram(K,Q,$){if(this.programs[K])this.removeProgram(K);this.programs[K]=this.own(new Z0(this.gl,Q,$))}useProgram(K){if(this.activeProgramId!==K)this.activeProgramId=K,this.programs[K].use()}removeProgram(K){this.programs[K].destroy(),delete this.programs[K]}getProgram(K){return this.programs[K??this.activeProgramId]?.program}}class P0 extends p{gl;triangleArray;constructor(K){super();this.gl=K,this.triangleArray=K.createVertexArray(),K.bindVertexArray(this.triangleArray)}destroy(){this.gl.deleteVertexArray(this.triangleArray)}}class D0 extends p{bufferRecord={};lastBoundBuffer;gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getAttributeLocation(K,Q){const $=this.programs.getProgram(Q);return $?this.gl.getAttribLocation($,K)??-1:-1}createBuffer(K){this.deleteBuffer(K);const Q=this.gl?.createBuffer();if(!Q)throw new Error(`Unable to create buffer "${K}"`);const $={buffer:Q,location:this.getAttributeLocation(K)};return this.bufferRecord[K]=$,$}deleteBuffer(K){if(this.bufferRecord[K])this.gl.deleteBuffer(this.bufferRecord[K].buffer),delete this.bufferRecord[K]}getAttributeBuffer(K,Q){const $=this.bufferRecord[K];if(!$){if(Q)return this.createBuffer(K);throw new Error(`Attribute "${K}" not created. Make sure "createBuffer" is called.`)}return $}bufferData(K,Q,$,J,Y){const B=this.getAttributeBuffer(Q);if($)this.gl.bufferData(K,$,Y);else this.gl.bufferData(K,J,Y);B.bufferSize=J||$?.length,B.bufferArray=$??new Float32Array(B.bufferSize/Float32Array.BYTES_PER_ELEMENT).fill(0),B.usage=Y,B.target=K}bufferSubData(K,Q,$,J,Y){if(J)this.gl.bufferSubData(K,$,Q,J,Y);else this.gl.bufferSubData(K,$,Q)}bindBuffer(K,Q){if(this.lastBoundBuffer!==Q)this.lastBoundBuffer=Q,this.gl.bindBuffer(K,Q.buffer)}destroy(){Object.keys(this.bufferRecord).forEach((K)=>this.deleteBuffer(K))}}class W0 extends p{gl;programs;constructor(K,Q){super();this.gl=K,this.programs=Q}getUniformLocation(K,Q){const $=this.programs.getProgram(Q);return $?this.gl.getUniformLocation($,K)??void 0:void 0}}var z0=4096;class U0 extends p{gl;textureBuffers={};tempCanvas=new OffscreenCanvas(1,1);tempContext=this.tempCanvas.getContext("2d");constructor(K){super();this.gl=K,this.tempContext.imageSmoothingEnabled=!0}getTexture(K){if(!this.textureBuffers[K]){const Q=this.gl.createTexture();if(!Q)return;this.gl.bindTexture(A.TEXTURE_2D,Q),this.gl.texImage2D(A.TEXTURE_2D,0,A.RGBA,z0,z0,0,A.RGBA,A.UNSIGNED_BYTE,null),this.textureBuffers[K]=Q,this.addOnDestroy(()=>this.gl.deleteTexture(Q))}return this.textureBuffers[K]}loadTexture(K,Q,$,J,Y){this.gl.activeTexture(A[Q]),this.gl.bindTexture(A.TEXTURE_2D,$),this.applyTexImage2d(K,J,Y),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR)}applyTexImage2d(K,[Q,$,J,Y],[B,V,F,C]){if(J===F&&Y===C&&!Q&&!$)this.gl.texSubImage2D(A.TEXTURE_2D,0,B,V,J,Y,A.RGBA,A.UNSIGNED_BYTE,K.texImgSrc);else{console.log("Used canvas");const O=this.tempContext.canvas;if(K.texImgSrc instanceof ImageData){if(O.width=F||K.width,O.height=C||K.height,this.tempContext.putImageData(K.texImgSrc,0,0),Q||$)console.warn("Offset not available when sending imageData")}else{const Z=J||K.width,H=Y||K.height;O.width=F||Z,O.height=C||H,this.tempContext.drawImage(K.texImgSrc,Q,$,Z,H,0,0,O.width,O.height)}this.gl.texSubImage2D(A.TEXTURE_2D,0,B,V,O.width,O.height,A.RGBA,A.UNSIGNED_BYTE,O)}}assignImageToTexture(K,Q,$,J){if(!this.getTexture(Q)){console.warn("Invalid texture Id");return}if(K){const Y=this.getTexture(Q);if(Y){const B=$??[0,0,K.width,K.height],V=J??[0,0,B[2],B[3]];if(K.activated)this.gl.bindTexture(A.TEXTURE_2D,Y),this.applyTexImage2d(K,B,V);else this.loadTexture(K,Q,Y,B,V),K.activated=!0}else console.warn(`Texture not found: ${Q}`)}}generateMipMap(K){const Q=this.getTexture(K);if(Q)this.gl.activeTexture(A[K]),this.gl.bindTexture(A.TEXTURE_2D,Q),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),this.gl.generateMipmap(A.TEXTURE_2D),console.log("GENERATED MIPMAP")}}var y0=`#version 300 es
//  ~{AUTHOR}

precision highp float;

const float TEXTURE_SIZE = 4096.;

//  IN
//  shape
layout(location = 0) in vec4 position_and_tex;
layout(location = 1) in mat4 transform;
//  2, 3, 4
//  animation
layout(location = 5) in vec3 slotSize_and_number;

//  UNIFORM
uniform mat4 cam;
uniform mat4 projection;

//  OUT
out vec2 vTex;
out float textureIndex;

void main() {
  vec2 position = position_and_tex.xy;
  vec2 tex = position_and_tex.zw;
  vec2 slotSize = slotSize_and_number.xy;
  float slotNumber = slotSize_and_number.z;

  gl_Position = projection * cam * transform * vec4(position, 0.0, 1.0);
  vTex = tex * (slotSize / TEXTURE_SIZE);
  textureIndex = 0.;
}
`;var x0=`#version 300 es
//  ~{AUTHOR}
precision highp float;

//  CONST
const int NUM_TEXTURES = 16;
const float threshold = 0.00001;

//  IN
//  texture
uniform sampler2D uTextures[NUM_TEXTURES];
in float textureIndex;
in vec2 vTex;
in float opacity;

//  OUT
out vec4 fragColor;

//  FUNCTIONS
vec4 getTextureColor(float textureSlot, vec2 vTexturePoint);

void main() {
  vec4 color = getTextureColor(textureIndex, vTex);
  if (color.a <= .01) {
    discard;
  };
  fragColor = color;
}

vec4 getTextureColor(float textureSlot, vec2 vTexturePoint) {
  if (abs(0.0 - textureSlot) < threshold) {
    return texture(uTextures[0], vTexturePoint);
  }
  if (abs(1.0 - textureSlot) < threshold) {
    return texture(uTextures[1], vTexturePoint);
  }
  if (abs(2.0 - textureSlot) < threshold) {
    return texture(uTextures[2], vTexturePoint);
  }
  if (abs(3.0 - textureSlot) < threshold) {
    return texture(uTextures[3], vTexturePoint);
  }
  if (abs(4.0 - textureSlot) < threshold) {
    return texture(uTextures[4], vTexturePoint);
  }
  if (abs(5.0 - textureSlot) < threshold) {
    return texture(uTextures[5], vTexturePoint);
  }
  if (abs(6.0 - textureSlot) < threshold) {
    return texture(uTextures[6], vTexturePoint);
  }
  if (abs(7.0 - textureSlot) < threshold) {
    return texture(uTextures[7], vTexturePoint);
  }
  if (abs(8.0 - textureSlot) < threshold) {
    return texture(uTextures[8], vTexturePoint);
  }
  if (abs(9.0 - textureSlot) < threshold) {
    return texture(uTextures[9], vTexturePoint);
  }
  if (abs(10.0 - textureSlot) < threshold) {
    return texture(uTextures[10], vTexturePoint);
  }
  if (abs(11.0 - textureSlot) < threshold) {
    return texture(uTextures[11], vTexturePoint);
  }
  if (abs(12.0 - textureSlot) < threshold) {
    return texture(uTextures[12], vTexturePoint);
  }
  if (abs(13.0 - textureSlot) < threshold) {
    return texture(uTextures[13], vTexturePoint);
  }
  if (abs(14.0 - textureSlot) < threshold) {
    return texture(uTextures[14], vTexturePoint);
  }
  if (abs(15.0 - textureSlot) < threshold) {
    return texture(uTextures[15], vTexturePoint);
  }
  return texture(uTextures[0], vTexturePoint);
}
`;function X0(K,Q){return K.replace(/~\{(\w+)\}/g,($,J)=>{return Q?.[J]||$})}var E=0.000001,q=typeof Float32Array!=="undefined"?Float32Array:Array,i=Math.random,JJ=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var K=0,Q=arguments.length;while(Q--)K+=arguments[Q]*arguments[Q];return Math.sqrt(K)};function c0(){var K=new q(9);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0;return K[0]=1,K[4]=1,K[8]=1,K}var k={};O0(k,{transpose:()=>{{return fK}},translate:()=>{{return cK}},targetTo:()=>{{return HQ}},subtract:()=>{{return r0}},sub:()=>{{return RQ}},str:()=>{{return PQ}},set:()=>{{return gK}},scale:()=>{{return mK}},rotateZ:()=>{{return nK}},rotateY:()=>{{return dK}},rotateX:()=>{{return lK}},rotate:()=>{{return iK}},perspectiveZO:()=>{{return VQ}},perspectiveNO:()=>{{return n0}},perspectiveFromFieldOfView:()=>{{return FQ}},perspective:()=>{{return BQ}},orthoZO:()=>{{return OQ}},orthoNO:()=>{{return s0}},ortho:()=>{{return CQ}},multiplyScalarAndAdd:()=>{{return XQ}},multiplyScalar:()=>{{return UQ}},multiply:()=>{{return i0}},mul:()=>{{return MQ}},lookAt:()=>{{return ZQ}},invert:()=>{{return zK}},identity:()=>{{return m0}},getTranslation:()=>{{return tK}},getScaling:()=>{{return d0}},getRotation:()=>{{return KQ}},frustum:()=>{{return YQ}},fromZRotation:()=>{{return oK}},fromYRotation:()=>{{return uK}},fromXRotation:()=>{{return eK}},fromValues:()=>{{return pK}},fromTranslation:()=>{{return sK}},fromScaling:()=>{{return rK}},fromRotationTranslationScaleOrigin:()=>{{return $Q}},fromRotationTranslationScale:()=>{{return QQ}},fromRotationTranslation:()=>{{return l0}},fromRotation:()=>{{return bK}},fromQuat2:()=>{{return aK}},fromQuat:()=>{{return JQ}},frob:()=>{{return DQ}},exactEquals:()=>{{return jQ}},equals:()=>{{return AQ}},determinant:()=>{{return xK}},create:()=>{{return IK}},copy:()=>{{return vK}},clone:()=>{{return wK}},adjoint:()=>{{return yK}},add:()=>{{return WQ}}});function IK(){var K=new q(16);if(q!=Float32Array)K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0;return K[0]=1,K[5]=1,K[10]=1,K[15]=1,K}function wK(K){var Q=new q(16);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q[4]=K[4],Q[5]=K[5],Q[6]=K[6],Q[7]=K[7],Q[8]=K[8],Q[9]=K[9],Q[10]=K[10],Q[11]=K[11],Q[12]=K[12],Q[13]=K[13],Q[14]=K[14],Q[15]=K[15],Q}function vK(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function pK(K,Q,$,J,Y,B,V,F,C,O,Z,H,W,D,X,U){var P=new q(16);return P[0]=K,P[1]=Q,P[2]=$,P[3]=J,P[4]=Y,P[5]=B,P[6]=V,P[7]=F,P[8]=C,P[9]=O,P[10]=Z,P[11]=H,P[12]=W,P[13]=D,P[14]=X,P[15]=U,P}function gK(K,Q,$,J,Y,B,V,F,C,O,Z,H,W,D,X,U,P){return K[0]=Q,K[1]=$,K[2]=J,K[3]=Y,K[4]=B,K[5]=V,K[6]=F,K[7]=C,K[8]=O,K[9]=Z,K[10]=H,K[11]=W,K[12]=D,K[13]=X,K[14]=U,K[15]=P,K}function m0(K){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function fK(K,Q){if(K===Q){var $=Q[1],J=Q[2],Y=Q[3],B=Q[6],V=Q[7],F=Q[11];K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=$,K[6]=Q[9],K[7]=Q[13],K[8]=J,K[9]=B,K[11]=Q[14],K[12]=Y,K[13]=V,K[14]=F}else K[0]=Q[0],K[1]=Q[4],K[2]=Q[8],K[3]=Q[12],K[4]=Q[1],K[5]=Q[5],K[6]=Q[9],K[7]=Q[13],K[8]=Q[2],K[9]=Q[6],K[10]=Q[10],K[11]=Q[14],K[12]=Q[3],K[13]=Q[7],K[14]=Q[11],K[15]=Q[15];return K}function zK(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[3],V=Q[4],F=Q[5],C=Q[6],O=Q[7],Z=Q[8],H=Q[9],W=Q[10],D=Q[11],X=Q[12],U=Q[13],P=Q[14],j=Q[15],_=$*F-J*V,G=$*C-Y*V,N=$*O-B*V,M=J*C-Y*F,R=J*O-B*F,I=Y*O-B*C,T=Z*U-H*X,S=Z*P-W*X,h=Z*j-D*X,w=H*P-W*U,v=H*j-D*U,g=W*j-D*P,L=_*g-G*v+N*w+M*h-R*S+I*T;if(!L)return null;return L=1/L,K[0]=(F*g-C*v+O*w)*L,K[1]=(Y*v-J*g-B*w)*L,K[2]=(U*I-P*R+j*M)*L,K[3]=(W*R-H*I-D*M)*L,K[4]=(C*h-V*g-O*S)*L,K[5]=($*g-Y*h+B*S)*L,K[6]=(P*N-X*I-j*G)*L,K[7]=(Z*I-W*N+D*G)*L,K[8]=(V*v-F*h+O*T)*L,K[9]=(J*h-$*v-B*T)*L,K[10]=(X*R-U*N+j*_)*L,K[11]=(H*N-Z*R-D*_)*L,K[12]=(F*S-V*w-C*T)*L,K[13]=($*w-J*S+Y*T)*L,K[14]=(U*G-X*M-P*_)*L,K[15]=(Z*M-H*G+W*_)*L,K}function yK(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[3],V=Q[4],F=Q[5],C=Q[6],O=Q[7],Z=Q[8],H=Q[9],W=Q[10],D=Q[11],X=Q[12],U=Q[13],P=Q[14],j=Q[15];return K[0]=F*(W*j-D*P)-H*(C*j-O*P)+U*(C*D-O*W),K[1]=-(J*(W*j-D*P)-H*(Y*j-B*P)+U*(Y*D-B*W)),K[2]=J*(C*j-O*P)-F*(Y*j-B*P)+U*(Y*O-B*C),K[3]=-(J*(C*D-O*W)-F*(Y*D-B*W)+H*(Y*O-B*C)),K[4]=-(V*(W*j-D*P)-Z*(C*j-O*P)+X*(C*D-O*W)),K[5]=$*(W*j-D*P)-Z*(Y*j-B*P)+X*(Y*D-B*W),K[6]=-($*(C*j-O*P)-V*(Y*j-B*P)+X*(Y*O-B*C)),K[7]=$*(C*D-O*W)-V*(Y*D-B*W)+Z*(Y*O-B*C),K[8]=V*(H*j-D*U)-Z*(F*j-O*U)+X*(F*D-O*H),K[9]=-($*(H*j-D*U)-Z*(J*j-B*U)+X*(J*D-B*H)),K[10]=$*(F*j-O*U)-V*(J*j-B*U)+X*(J*O-B*F),K[11]=-($*(F*D-O*H)-V*(J*D-B*H)+Z*(J*O-B*F)),K[12]=-(V*(H*P-W*U)-Z*(F*P-C*U)+X*(F*W-C*H)),K[13]=$*(H*P-W*U)-Z*(J*P-Y*U)+X*(J*W-Y*H),K[14]=-($*(F*P-C*U)-V*(J*P-Y*U)+X*(J*C-Y*F)),K[15]=$*(F*W-C*H)-V*(J*W-Y*H)+Z*(J*C-Y*F),K}function xK(K){var Q=K[0],$=K[1],J=K[2],Y=K[3],B=K[4],V=K[5],F=K[6],C=K[7],O=K[8],Z=K[9],H=K[10],W=K[11],D=K[12],X=K[13],U=K[14],P=K[15],j=Q*V-$*B,_=Q*F-J*B,G=Q*C-Y*B,N=$*F-J*V,M=$*C-Y*V,R=J*C-Y*F,I=O*X-Z*D,T=O*U-H*D,S=O*P-W*D,h=Z*U-H*X,w=Z*P-W*X,v=H*P-W*U;return j*v-_*w+G*h+N*S-M*T+R*I}function i0(K,Q,$){var J=Q[0],Y=Q[1],B=Q[2],V=Q[3],F=Q[4],C=Q[5],O=Q[6],Z=Q[7],H=Q[8],W=Q[9],D=Q[10],X=Q[11],U=Q[12],P=Q[13],j=Q[14],_=Q[15],G=$[0],N=$[1],M=$[2],R=$[3];return K[0]=G*J+N*F+M*H+R*U,K[1]=G*Y+N*C+M*W+R*P,K[2]=G*B+N*O+M*D+R*j,K[3]=G*V+N*Z+M*X+R*_,G=$[4],N=$[5],M=$[6],R=$[7],K[4]=G*J+N*F+M*H+R*U,K[5]=G*Y+N*C+M*W+R*P,K[6]=G*B+N*O+M*D+R*j,K[7]=G*V+N*Z+M*X+R*_,G=$[8],N=$[9],M=$[10],R=$[11],K[8]=G*J+N*F+M*H+R*U,K[9]=G*Y+N*C+M*W+R*P,K[10]=G*B+N*O+M*D+R*j,K[11]=G*V+N*Z+M*X+R*_,G=$[12],N=$[13],M=$[14],R=$[15],K[12]=G*J+N*F+M*H+R*U,K[13]=G*Y+N*C+M*W+R*P,K[14]=G*B+N*O+M*D+R*j,K[15]=G*V+N*Z+M*X+R*_,K}function cK(K,Q,$){var J=$[0],Y=$[1],B=$[2],V,F,C,O,Z,H,W,D,X,U,P,j;if(Q===K)K[12]=Q[0]*J+Q[4]*Y+Q[8]*B+Q[12],K[13]=Q[1]*J+Q[5]*Y+Q[9]*B+Q[13],K[14]=Q[2]*J+Q[6]*Y+Q[10]*B+Q[14],K[15]=Q[3]*J+Q[7]*Y+Q[11]*B+Q[15];else V=Q[0],F=Q[1],C=Q[2],O=Q[3],Z=Q[4],H=Q[5],W=Q[6],D=Q[7],X=Q[8],U=Q[9],P=Q[10],j=Q[11],K[0]=V,K[1]=F,K[2]=C,K[3]=O,K[4]=Z,K[5]=H,K[6]=W,K[7]=D,K[8]=X,K[9]=U,K[10]=P,K[11]=j,K[12]=V*J+Z*Y+X*B+Q[12],K[13]=F*J+H*Y+U*B+Q[13],K[14]=C*J+W*Y+P*B+Q[14],K[15]=O*J+D*Y+j*B+Q[15];return K}function mK(K,Q,$){var J=$[0],Y=$[1],B=$[2];return K[0]=Q[0]*J,K[1]=Q[1]*J,K[2]=Q[2]*J,K[3]=Q[3]*J,K[4]=Q[4]*Y,K[5]=Q[5]*Y,K[6]=Q[6]*Y,K[7]=Q[7]*Y,K[8]=Q[8]*B,K[9]=Q[9]*B,K[10]=Q[10]*B,K[11]=Q[11]*B,K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15],K}function iK(K,Q,$,J){var Y=J[0],B=J[1],V=J[2],F=Math.hypot(Y,B,V),C,O,Z,H,W,D,X,U,P,j,_,G,N,M,R,I,T,S,h,w,v,g,L,y;if(F<E)return null;if(F=1/F,Y*=F,B*=F,V*=F,C=Math.sin($),O=Math.cos($),Z=1-O,H=Q[0],W=Q[1],D=Q[2],X=Q[3],U=Q[4],P=Q[5],j=Q[6],_=Q[7],G=Q[8],N=Q[9],M=Q[10],R=Q[11],I=Y*Y*Z+O,T=B*Y*Z+V*C,S=V*Y*Z-B*C,h=Y*B*Z-V*C,w=B*B*Z+O,v=V*B*Z+Y*C,g=Y*V*Z+B*C,L=B*V*Z-Y*C,y=V*V*Z+O,K[0]=H*I+U*T+G*S,K[1]=W*I+P*T+N*S,K[2]=D*I+j*T+M*S,K[3]=X*I+_*T+R*S,K[4]=H*h+U*w+G*v,K[5]=W*h+P*w+N*v,K[6]=D*h+j*w+M*v,K[7]=X*h+_*w+R*v,K[8]=H*g+U*L+G*y,K[9]=W*g+P*L+N*y,K[10]=D*g+j*L+M*y,K[11]=X*g+_*L+R*y,Q!==K)K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K}function lK(K,Q,$){var J=Math.sin($),Y=Math.cos($),B=Q[4],V=Q[5],F=Q[6],C=Q[7],O=Q[8],Z=Q[9],H=Q[10],W=Q[11];if(Q!==K)K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[4]=B*Y+O*J,K[5]=V*Y+Z*J,K[6]=F*Y+H*J,K[7]=C*Y+W*J,K[8]=O*Y-B*J,K[9]=Z*Y-V*J,K[10]=H*Y-F*J,K[11]=W*Y-C*J,K}function dK(K,Q,$){var J=Math.sin($),Y=Math.cos($),B=Q[0],V=Q[1],F=Q[2],C=Q[3],O=Q[8],Z=Q[9],H=Q[10],W=Q[11];if(Q!==K)K[4]=Q[4],K[5]=Q[5],K[6]=Q[6],K[7]=Q[7],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=B*Y-O*J,K[1]=V*Y-Z*J,K[2]=F*Y-H*J,K[3]=C*Y-W*J,K[8]=B*J+O*Y,K[9]=V*J+Z*Y,K[10]=F*J+H*Y,K[11]=C*J+W*Y,K}function nK(K,Q,$){var J=Math.sin($),Y=Math.cos($),B=Q[0],V=Q[1],F=Q[2],C=Q[3],O=Q[4],Z=Q[5],H=Q[6],W=Q[7];if(Q!==K)K[8]=Q[8],K[9]=Q[9],K[10]=Q[10],K[11]=Q[11],K[12]=Q[12],K[13]=Q[13],K[14]=Q[14],K[15]=Q[15];return K[0]=B*Y+O*J,K[1]=V*Y+Z*J,K[2]=F*Y+H*J,K[3]=C*Y+W*J,K[4]=O*Y-B*J,K[5]=Z*Y-V*J,K[6]=H*Y-F*J,K[7]=W*Y-C*J,K}function sK(K,Q){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=Q[0],K[13]=Q[1],K[14]=Q[2],K[15]=1,K}function rK(K,Q){return K[0]=Q[0],K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=Q[1],K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=Q[2],K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function bK(K,Q,$){var J=$[0],Y=$[1],B=$[2],V=Math.hypot(J,Y,B),F,C,O;if(V<E)return null;return V=1/V,J*=V,Y*=V,B*=V,F=Math.sin(Q),C=Math.cos(Q),O=1-C,K[0]=J*J*O+C,K[1]=Y*J*O+B*F,K[2]=B*J*O-Y*F,K[3]=0,K[4]=J*Y*O-B*F,K[5]=Y*Y*O+C,K[6]=B*Y*O+J*F,K[7]=0,K[8]=J*B*O+Y*F,K[9]=Y*B*O-J*F,K[10]=B*B*O+C,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function eK(K,Q){var $=Math.sin(Q),J=Math.cos(Q);return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=J,K[6]=$,K[7]=0,K[8]=0,K[9]=-$,K[10]=J,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function uK(K,Q){var $=Math.sin(Q),J=Math.cos(Q);return K[0]=J,K[1]=0,K[2]=-$,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=$,K[9]=0,K[10]=J,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function oK(K,Q){var $=Math.sin(Q),J=Math.cos(Q);return K[0]=J,K[1]=$,K[2]=0,K[3]=0,K[4]=-$,K[5]=J,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function l0(K,Q,$){var J=Q[0],Y=Q[1],B=Q[2],V=Q[3],F=J+J,C=Y+Y,O=B+B,Z=J*F,H=J*C,W=J*O,D=Y*C,X=Y*O,U=B*O,P=V*F,j=V*C,_=V*O;return K[0]=1-(D+U),K[1]=H+_,K[2]=W-j,K[3]=0,K[4]=H-_,K[5]=1-(Z+U),K[6]=X+P,K[7]=0,K[8]=W+j,K[9]=X-P,K[10]=1-(Z+D),K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function aK(K,Q){var $=new q(3),J=-Q[0],Y=-Q[1],B=-Q[2],V=Q[3],F=Q[4],C=Q[5],O=Q[6],Z=Q[7],H=J*J+Y*Y+B*B+V*V;if(H>0)$[0]=(F*V+Z*J+C*B-O*Y)*2/H,$[1]=(C*V+Z*Y+O*J-F*B)*2/H,$[2]=(O*V+Z*B+F*Y-C*J)*2/H;else $[0]=(F*V+Z*J+C*B-O*Y)*2,$[1]=(C*V+Z*Y+O*J-F*B)*2,$[2]=(O*V+Z*B+F*Y-C*J)*2;return l0(K,Q,$),K}function tK(K,Q){return K[0]=Q[12],K[1]=Q[13],K[2]=Q[14],K}function d0(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[4],V=Q[5],F=Q[6],C=Q[8],O=Q[9],Z=Q[10];return K[0]=Math.hypot($,J,Y),K[1]=Math.hypot(B,V,F),K[2]=Math.hypot(C,O,Z),K}function KQ(K,Q){var $=new q(3);d0($,Q);var J=1/$[0],Y=1/$[1],B=1/$[2],V=Q[0]*J,F=Q[1]*Y,C=Q[2]*B,O=Q[4]*J,Z=Q[5]*Y,H=Q[6]*B,W=Q[8]*J,D=Q[9]*Y,X=Q[10]*B,U=V+Z+X,P=0;if(U>0)P=Math.sqrt(U+1)*2,K[3]=0.25*P,K[0]=(H-D)/P,K[1]=(W-C)/P,K[2]=(F-O)/P;else if(V>Z&&V>X)P=Math.sqrt(1+V-Z-X)*2,K[3]=(H-D)/P,K[0]=0.25*P,K[1]=(F+O)/P,K[2]=(W+C)/P;else if(Z>X)P=Math.sqrt(1+Z-V-X)*2,K[3]=(W-C)/P,K[0]=(F+O)/P,K[1]=0.25*P,K[2]=(H+D)/P;else P=Math.sqrt(1+X-V-Z)*2,K[3]=(F-O)/P,K[0]=(W+C)/P,K[1]=(H+D)/P,K[2]=0.25*P;return K}function QQ(K,Q,$,J){var Y=Q[0],B=Q[1],V=Q[2],F=Q[3],C=Y+Y,O=B+B,Z=V+V,H=Y*C,W=Y*O,D=Y*Z,X=B*O,U=B*Z,P=V*Z,j=F*C,_=F*O,G=F*Z,N=J[0],M=J[1],R=J[2];return K[0]=(1-(X+P))*N,K[1]=(W+G)*N,K[2]=(D-_)*N,K[3]=0,K[4]=(W-G)*M,K[5]=(1-(H+P))*M,K[6]=(U+j)*M,K[7]=0,K[8]=(D+_)*R,K[9]=(U-j)*R,K[10]=(1-(H+X))*R,K[11]=0,K[12]=$[0],K[13]=$[1],K[14]=$[2],K[15]=1,K}function $Q(K,Q,$,J,Y){var B=Q[0],V=Q[1],F=Q[2],C=Q[3],O=B+B,Z=V+V,H=F+F,W=B*O,D=B*Z,X=B*H,U=V*Z,P=V*H,j=F*H,_=C*O,G=C*Z,N=C*H,M=J[0],R=J[1],I=J[2],T=Y[0],S=Y[1],h=Y[2],w=(1-(U+j))*M,v=(D+N)*M,g=(X-G)*M,L=(D-N)*R,y=(1-(W+j))*R,n=(P+_)*R,s=(X+G)*I,T0=(P-_)*I,S0=(1-(W+U))*I;return K[0]=w,K[1]=v,K[2]=g,K[3]=0,K[4]=L,K[5]=y,K[6]=n,K[7]=0,K[8]=s,K[9]=T0,K[10]=S0,K[11]=0,K[12]=$[0]+T-(w*T+L*S+s*h),K[13]=$[1]+S-(v*T+y*S+T0*h),K[14]=$[2]+h-(g*T+n*S+S0*h),K[15]=1,K}function JQ(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[3],V=$+$,F=J+J,C=Y+Y,O=$*V,Z=J*V,H=J*F,W=Y*V,D=Y*F,X=Y*C,U=B*V,P=B*F,j=B*C;return K[0]=1-H-X,K[1]=Z+j,K[2]=W-P,K[3]=0,K[4]=Z-j,K[5]=1-O-X,K[6]=D+U,K[7]=0,K[8]=W+P,K[9]=D-U,K[10]=1-O-H,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K}function YQ(K,Q,$,J,Y,B,V){var F=1/($-Q),C=1/(Y-J),O=1/(B-V);return K[0]=B*2*F,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=B*2*C,K[6]=0,K[7]=0,K[8]=($+Q)*F,K[9]=(Y+J)*C,K[10]=(V+B)*O,K[11]=-1,K[12]=0,K[13]=0,K[14]=V*B*2*O,K[15]=0,K}function n0(K,Q,$,J,Y){var B=1/Math.tan(Q/2),V;if(K[0]=B/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=B,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,Y!=null&&Y!==Infinity)V=1/(J-Y),K[10]=(Y+J)*V,K[14]=2*Y*J*V;else K[10]=-1,K[14]=-2*J;return K}function VQ(K,Q,$,J,Y){var B=1/Math.tan(Q/2),V;if(K[0]=B/$,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=B,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[11]=-1,K[12]=0,K[13]=0,K[15]=0,Y!=null&&Y!==Infinity)V=1/(J-Y),K[10]=Y*V,K[14]=Y*J*V;else K[10]=-1,K[14]=-J;return K}function FQ(K,Q,$,J){var Y=Math.tan(Q.upDegrees*Math.PI/180),B=Math.tan(Q.downDegrees*Math.PI/180),V=Math.tan(Q.leftDegrees*Math.PI/180),F=Math.tan(Q.rightDegrees*Math.PI/180),C=2/(V+F),O=2/(Y+B);return K[0]=C,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=O,K[6]=0,K[7]=0,K[8]=-((V-F)*C*0.5),K[9]=(Y-B)*O*0.5,K[10]=J/($-J),K[11]=-1,K[12]=0,K[13]=0,K[14]=J*$/($-J),K[15]=0,K}function s0(K,Q,$,J,Y,B,V){var F=1/(Q-$),C=1/(J-Y),O=1/(B-V);return K[0]=-2*F,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*C,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=2*O,K[11]=0,K[12]=(Q+$)*F,K[13]=(Y+J)*C,K[14]=(V+B)*O,K[15]=1,K}function OQ(K,Q,$,J,Y,B,V){var F=1/(Q-$),C=1/(J-Y),O=1/(B-V);return K[0]=-2*F,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=-2*C,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=O,K[11]=0,K[12]=(Q+$)*F,K[13]=(Y+J)*C,K[14]=B*O,K[15]=1,K}function ZQ(K,Q,$,J){var Y,B,V,F,C,O,Z,H,W,D,X=Q[0],U=Q[1],P=Q[2],j=J[0],_=J[1],G=J[2],N=$[0],M=$[1],R=$[2];if(Math.abs(X-N)<E&&Math.abs(U-M)<E&&Math.abs(P-R)<E)return m0(K);if(Z=X-N,H=U-M,W=P-R,D=1/Math.hypot(Z,H,W),Z*=D,H*=D,W*=D,Y=_*W-G*H,B=G*Z-j*W,V=j*H-_*Z,D=Math.hypot(Y,B,V),!D)Y=0,B=0,V=0;else D=1/D,Y*=D,B*=D,V*=D;if(F=H*V-W*B,C=W*Y-Z*V,O=Z*B-H*Y,D=Math.hypot(F,C,O),!D)F=0,C=0,O=0;else D=1/D,F*=D,C*=D,O*=D;return K[0]=Y,K[1]=F,K[2]=Z,K[3]=0,K[4]=B,K[5]=C,K[6]=H,K[7]=0,K[8]=V,K[9]=O,K[10]=W,K[11]=0,K[12]=-(Y*X+B*U+V*P),K[13]=-(F*X+C*U+O*P),K[14]=-(Z*X+H*U+W*P),K[15]=1,K}function HQ(K,Q,$,J){var Y=Q[0],B=Q[1],V=Q[2],F=J[0],C=J[1],O=J[2],Z=Y-$[0],H=B-$[1],W=V-$[2],D=Z*Z+H*H+W*W;if(D>0)D=1/Math.sqrt(D),Z*=D,H*=D,W*=D;var X=C*W-O*H,U=O*Z-F*W,P=F*H-C*Z;if(D=X*X+U*U+P*P,D>0)D=1/Math.sqrt(D),X*=D,U*=D,P*=D;return K[0]=X,K[1]=U,K[2]=P,K[3]=0,K[4]=H*P-W*U,K[5]=W*X-Z*P,K[6]=Z*U-H*X,K[7]=0,K[8]=Z,K[9]=H,K[10]=W,K[11]=0,K[12]=Y,K[13]=B,K[14]=V,K[15]=1,K}function PQ(K){return"mat4("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+", "+K[4]+", "+K[5]+", "+K[6]+", "+K[7]+", "+K[8]+", "+K[9]+", "+K[10]+", "+K[11]+", "+K[12]+", "+K[13]+", "+K[14]+", "+K[15]+")"}function DQ(K){return Math.hypot(K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12],K[13],K[14],K[15])}function WQ(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K[4]=Q[4]+$[4],K[5]=Q[5]+$[5],K[6]=Q[6]+$[6],K[7]=Q[7]+$[7],K[8]=Q[8]+$[8],K[9]=Q[9]+$[9],K[10]=Q[10]+$[10],K[11]=Q[11]+$[11],K[12]=Q[12]+$[12],K[13]=Q[13]+$[13],K[14]=Q[14]+$[14],K[15]=Q[15]+$[15],K}function r0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K[3]=Q[3]-$[3],K[4]=Q[4]-$[4],K[5]=Q[5]-$[5],K[6]=Q[6]-$[6],K[7]=Q[7]-$[7],K[8]=Q[8]-$[8],K[9]=Q[9]-$[9],K[10]=Q[10]-$[10],K[11]=Q[11]-$[11],K[12]=Q[12]-$[12],K[13]=Q[13]-$[13],K[14]=Q[14]-$[14],K[15]=Q[15]-$[15],K}function UQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K[4]=Q[4]*$,K[5]=Q[5]*$,K[6]=Q[6]*$,K[7]=Q[7]*$,K[8]=Q[8]*$,K[9]=Q[9]*$,K[10]=Q[10]*$,K[11]=Q[11]*$,K[12]=Q[12]*$,K[13]=Q[13]*$,K[14]=Q[14]*$,K[15]=Q[15]*$,K}function XQ(K,Q,$,J){return K[0]=Q[0]+$[0]*J,K[1]=Q[1]+$[1]*J,K[2]=Q[2]+$[2]*J,K[3]=Q[3]+$[3]*J,K[4]=Q[4]+$[4]*J,K[5]=Q[5]+$[5]*J,K[6]=Q[6]+$[6]*J,K[7]=Q[7]+$[7]*J,K[8]=Q[8]+$[8]*J,K[9]=Q[9]+$[9]*J,K[10]=Q[10]+$[10]*J,K[11]=Q[11]+$[11]*J,K[12]=Q[12]+$[12]*J,K[13]=Q[13]+$[13]*J,K[14]=Q[14]+$[14]*J,K[15]=Q[15]+$[15]*J,K}function jQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]&&K[4]===Q[4]&&K[5]===Q[5]&&K[6]===Q[6]&&K[7]===Q[7]&&K[8]===Q[8]&&K[9]===Q[9]&&K[10]===Q[10]&&K[11]===Q[11]&&K[12]===Q[12]&&K[13]===Q[13]&&K[14]===Q[14]&&K[15]===Q[15]}function AQ(K,Q){var $=K[0],J=K[1],Y=K[2],B=K[3],V=K[4],F=K[5],C=K[6],O=K[7],Z=K[8],H=K[9],W=K[10],D=K[11],X=K[12],U=K[13],P=K[14],j=K[15],_=Q[0],G=Q[1],N=Q[2],M=Q[3],R=Q[4],I=Q[5],T=Q[6],S=Q[7],h=Q[8],w=Q[9],v=Q[10],g=Q[11],L=Q[12],y=Q[13],n=Q[14],s=Q[15];return Math.abs($-_)<=E*Math.max(1,Math.abs($),Math.abs(_))&&Math.abs(J-G)<=E*Math.max(1,Math.abs(J),Math.abs(G))&&Math.abs(Y-N)<=E*Math.max(1,Math.abs(Y),Math.abs(N))&&Math.abs(B-M)<=E*Math.max(1,Math.abs(B),Math.abs(M))&&Math.abs(V-R)<=E*Math.max(1,Math.abs(V),Math.abs(R))&&Math.abs(F-I)<=E*Math.max(1,Math.abs(F),Math.abs(I))&&Math.abs(C-T)<=E*Math.max(1,Math.abs(C),Math.abs(T))&&Math.abs(O-S)<=E*Math.max(1,Math.abs(O),Math.abs(S))&&Math.abs(Z-h)<=E*Math.max(1,Math.abs(Z),Math.abs(h))&&Math.abs(H-w)<=E*Math.max(1,Math.abs(H),Math.abs(w))&&Math.abs(W-v)<=E*Math.max(1,Math.abs(W),Math.abs(v))&&Math.abs(D-g)<=E*Math.max(1,Math.abs(D),Math.abs(g))&&Math.abs(X-L)<=E*Math.max(1,Math.abs(X),Math.abs(L))&&Math.abs(U-y)<=E*Math.max(1,Math.abs(U),Math.abs(y))&&Math.abs(P-n)<=E*Math.max(1,Math.abs(P),Math.abs(n))&&Math.abs(j-s)<=E*Math.max(1,Math.abs(j),Math.abs(s))}var BQ=n0,CQ=s0,MQ=i0,RQ=r0;var e={};O0(e,{str:()=>{{return X$}},squaredLength:()=>{{return GK}},sqrLen:()=>{{return L$}},sqlerp:()=>{{return S$}},slerp:()=>{{return t}},setAxisAngle:()=>{{return WK}},setAxes:()=>{{return h$}},set:()=>{{return R$}},scale:()=>{{return MK}},rotationTo:()=>{{return T$}},rotateZ:()=>{{return O$}},rotateY:()=>{{return C$}},rotateX:()=>{{return F$}},random:()=>{{return P$}},pow:()=>{{return H$}},normalize:()=>{{return R0}},multiply:()=>{{return UK}},mul:()=>{{return G$}},ln:()=>{{return jK}},lerp:()=>{{return E$}},length:()=>{{return NK}},len:()=>{{return _$}},invert:()=>{{return D$}},identity:()=>{{return Y$}},getAxisAngle:()=>{{return B$}},getAngle:()=>{{return V$}},fromValues:()=>{{return A$}},fromMat3:()=>{{return AK}},fromEuler:()=>{{return U$}},exp:()=>{{return XK}},exactEquals:()=>{{return k$}},equals:()=>{{return q$}},dot:()=>{{return RK}},create:()=>{{return M0}},copy:()=>{{return M$}},conjugate:()=>{{return W$}},clone:()=>{{return j$}},calculateW:()=>{{return Z$}},add:()=>{{return N$}}});var l={};O0(l,{zero:()=>{{return nQ}},transformQuat:()=>{{return cQ}},transformMat4:()=>{{return yQ}},transformMat3:()=>{{return xQ}},subtract:()=>{{return e0}},sub:()=>{{return eQ}},str:()=>{{return sQ}},squaredLength:()=>{{return KK}},squaredDistance:()=>{{return t0}},sqrLen:()=>{{return K$}},sqrDist:()=>{{return tQ}},set:()=>{{return EQ}},scaleAndAdd:()=>{{return IQ}},scale:()=>{{return hQ}},round:()=>{{return SQ}},rotateZ:()=>{{return lQ}},rotateY:()=>{{return iQ}},rotateX:()=>{{return mQ}},random:()=>{{return zQ}},normalize:()=>{{return j0}},negate:()=>{{return wQ}},multiply:()=>{{return u0}},mul:()=>{{return uQ}},min:()=>{{return qQ}},max:()=>{{return TQ}},lerp:()=>{{return pQ}},length:()=>{{return b0}},len:()=>{{return A0}},inverse:()=>{{return vQ}},hermite:()=>{{return gQ}},fromValues:()=>{{return o}},forEach:()=>{{return Q$}},floor:()=>{{return kQ}},exactEquals:()=>{{return rQ}},equals:()=>{{return bQ}},dot:()=>{{return a}},divide:()=>{{return o0}},div:()=>{{return oQ}},distance:()=>{{return a0}},dist:()=>{{return aQ}},cross:()=>{{return b}},create:()=>{{return u}},copy:()=>{{return GQ}},clone:()=>{{return NQ}},ceil:()=>{{return LQ}},bezier:()=>{{return fQ}},angle:()=>{{return dQ}},add:()=>{{return _Q}}});function u(){var K=new q(3);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K}function NQ(K){var Q=new q(3);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q}function b0(K){var Q=K[0],$=K[1],J=K[2];return Math.hypot(Q,$,J)}function o(K,Q,$){var J=new q(3);return J[0]=K,J[1]=Q,J[2]=$,J}function GQ(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K}function EQ(K,Q,$,J){return K[0]=Q,K[1]=$,K[2]=J,K}function _Q(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K}function e0(K,Q,$){return K[0]=Q[0]-$[0],K[1]=Q[1]-$[1],K[2]=Q[2]-$[2],K}function u0(K,Q,$){return K[0]=Q[0]*$[0],K[1]=Q[1]*$[1],K[2]=Q[2]*$[2],K}function o0(K,Q,$){return K[0]=Q[0]/$[0],K[1]=Q[1]/$[1],K[2]=Q[2]/$[2],K}function LQ(K,Q){return K[0]=Math.ceil(Q[0]),K[1]=Math.ceil(Q[1]),K[2]=Math.ceil(Q[2]),K}function kQ(K,Q){return K[0]=Math.floor(Q[0]),K[1]=Math.floor(Q[1]),K[2]=Math.floor(Q[2]),K}function qQ(K,Q,$){return K[0]=Math.min(Q[0],$[0]),K[1]=Math.min(Q[1],$[1]),K[2]=Math.min(Q[2],$[2]),K}function TQ(K,Q,$){return K[0]=Math.max(Q[0],$[0]),K[1]=Math.max(Q[1],$[1]),K[2]=Math.max(Q[2],$[2]),K}function SQ(K,Q){return K[0]=Math.round(Q[0]),K[1]=Math.round(Q[1]),K[2]=Math.round(Q[2]),K}function hQ(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K}function IQ(K,Q,$,J){return K[0]=Q[0]+$[0]*J,K[1]=Q[1]+$[1]*J,K[2]=Q[2]+$[2]*J,K}function a0(K,Q){var $=Q[0]-K[0],J=Q[1]-K[1],Y=Q[2]-K[2];return Math.hypot($,J,Y)}function t0(K,Q){var $=Q[0]-K[0],J=Q[1]-K[1],Y=Q[2]-K[2];return $*$+J*J+Y*Y}function KK(K){var Q=K[0],$=K[1],J=K[2];return Q*Q+$*$+J*J}function wQ(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K}function vQ(K,Q){return K[0]=1/Q[0],K[1]=1/Q[1],K[2]=1/Q[2],K}function j0(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=$*$+J*J+Y*Y;if(B>0)B=1/Math.sqrt(B);return K[0]=Q[0]*B,K[1]=Q[1]*B,K[2]=Q[2]*B,K}function a(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]}function b(K,Q,$){var J=Q[0],Y=Q[1],B=Q[2],V=$[0],F=$[1],C=$[2];return K[0]=Y*C-B*F,K[1]=B*V-J*C,K[2]=J*F-Y*V,K}function pQ(K,Q,$,J){var Y=Q[0],B=Q[1],V=Q[2];return K[0]=Y+J*($[0]-Y),K[1]=B+J*($[1]-B),K[2]=V+J*($[2]-V),K}function gQ(K,Q,$,J,Y,B){var V=B*B,F=V*(2*B-3)+1,C=V*(B-2)+B,O=V*(B-1),Z=V*(3-2*B);return K[0]=Q[0]*F+$[0]*C+J[0]*O+Y[0]*Z,K[1]=Q[1]*F+$[1]*C+J[1]*O+Y[1]*Z,K[2]=Q[2]*F+$[2]*C+J[2]*O+Y[2]*Z,K}function fQ(K,Q,$,J,Y,B){var V=1-B,F=V*V,C=B*B,O=F*V,Z=3*B*F,H=3*C*V,W=C*B;return K[0]=Q[0]*O+$[0]*Z+J[0]*H+Y[0]*W,K[1]=Q[1]*O+$[1]*Z+J[1]*H+Y[1]*W,K[2]=Q[2]*O+$[2]*Z+J[2]*H+Y[2]*W,K}function zQ(K,Q){Q=Q||1;var $=i()*2*Math.PI,J=i()*2-1,Y=Math.sqrt(1-J*J)*Q;return K[0]=Math.cos($)*Y,K[1]=Math.sin($)*Y,K[2]=J*Q,K}function yQ(K,Q,$){var J=Q[0],Y=Q[1],B=Q[2],V=$[3]*J+$[7]*Y+$[11]*B+$[15];return V=V||1,K[0]=($[0]*J+$[4]*Y+$[8]*B+$[12])/V,K[1]=($[1]*J+$[5]*Y+$[9]*B+$[13])/V,K[2]=($[2]*J+$[6]*Y+$[10]*B+$[14])/V,K}function xQ(K,Q,$){var J=Q[0],Y=Q[1],B=Q[2];return K[0]=J*$[0]+Y*$[3]+B*$[6],K[1]=J*$[1]+Y*$[4]+B*$[7],K[2]=J*$[2]+Y*$[5]+B*$[8],K}function cQ(K,Q,$){var J=$[0],Y=$[1],B=$[2],V=$[3],F=Q[0],C=Q[1],O=Q[2],Z=Y*O-B*C,H=B*F-J*O,W=J*C-Y*F,D=Y*W-B*H,X=B*Z-J*W,U=J*H-Y*Z,P=V*2;return Z*=P,H*=P,W*=P,D*=2,X*=2,U*=2,K[0]=F+Z+D,K[1]=C+H+X,K[2]=O+W+U,K}function mQ(K,Q,$,J){var Y=[],B=[];return Y[0]=Q[0]-$[0],Y[1]=Q[1]-$[1],Y[2]=Q[2]-$[2],B[0]=Y[0],B[1]=Y[1]*Math.cos(J)-Y[2]*Math.sin(J),B[2]=Y[1]*Math.sin(J)+Y[2]*Math.cos(J),K[0]=B[0]+$[0],K[1]=B[1]+$[1],K[2]=B[2]+$[2],K}function iQ(K,Q,$,J){var Y=[],B=[];return Y[0]=Q[0]-$[0],Y[1]=Q[1]-$[1],Y[2]=Q[2]-$[2],B[0]=Y[2]*Math.sin(J)+Y[0]*Math.cos(J),B[1]=Y[1],B[2]=Y[2]*Math.cos(J)-Y[0]*Math.sin(J),K[0]=B[0]+$[0],K[1]=B[1]+$[1],K[2]=B[2]+$[2],K}function lQ(K,Q,$,J){var Y=[],B=[];return Y[0]=Q[0]-$[0],Y[1]=Q[1]-$[1],Y[2]=Q[2]-$[2],B[0]=Y[0]*Math.cos(J)-Y[1]*Math.sin(J),B[1]=Y[0]*Math.sin(J)+Y[1]*Math.cos(J),B[2]=Y[2],K[0]=B[0]+$[0],K[1]=B[1]+$[1],K[2]=B[2]+$[2],K}function dQ(K,Q){var $=K[0],J=K[1],Y=K[2],B=Q[0],V=Q[1],F=Q[2],C=Math.sqrt($*$+J*J+Y*Y),O=Math.sqrt(B*B+V*V+F*F),Z=C*O,H=Z&&a(K,Q)/Z;return Math.acos(Math.min(Math.max(H,-1),1))}function nQ(K){return K[0]=0,K[1]=0,K[2]=0,K}function sQ(K){return"vec3("+K[0]+", "+K[1]+", "+K[2]+")"}function rQ(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]}function bQ(K,Q){var $=K[0],J=K[1],Y=K[2],B=Q[0],V=Q[1],F=Q[2];return Math.abs($-B)<=E*Math.max(1,Math.abs($),Math.abs(B))&&Math.abs(J-V)<=E*Math.max(1,Math.abs(J),Math.abs(V))&&Math.abs(Y-F)<=E*Math.max(1,Math.abs(Y),Math.abs(F))}var eQ=e0,uQ=u0,oQ=o0,aQ=a0,tQ=t0,A0=b0,K$=KK,Q$=function(){var K=u();return function(Q,$,J,Y,B,V){var F,C;if(!$)$=3;if(!J)J=0;if(Y)C=Math.min(Y*$+J,Q.length);else C=Q.length;for(F=J;F<C;F+=$)K[0]=Q[F],K[1]=Q[F+1],K[2]=Q[F+2],B(K,K,V),Q[F]=K[0],Q[F+1]=K[1],Q[F+2]=K[2];return Q}}();function $$(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0,K[3]=0;return K}function QK(K){var Q=new q(4);return Q[0]=K[0],Q[1]=K[1],Q[2]=K[2],Q[3]=K[3],Q}function $K(K,Q,$,J){var Y=new q(4);return Y[0]=K,Y[1]=Q,Y[2]=$,Y[3]=J,Y}function JK(K,Q){return K[0]=Q[0],K[1]=Q[1],K[2]=Q[2],K[3]=Q[3],K}function YK(K,Q,$,J,Y){return K[0]=Q,K[1]=$,K[2]=J,K[3]=Y,K}function BK(K,Q,$){return K[0]=Q[0]+$[0],K[1]=Q[1]+$[1],K[2]=Q[2]+$[2],K[3]=Q[3]+$[3],K}function VK(K,Q,$){return K[0]=Q[0]*$,K[1]=Q[1]*$,K[2]=Q[2]*$,K[3]=Q[3]*$,K}function FK(K){var Q=K[0],$=K[1],J=K[2],Y=K[3];return Math.hypot(Q,$,J,Y)}function CK(K){var Q=K[0],$=K[1],J=K[2],Y=K[3];return Q*Q+$*$+J*J+Y*Y}function OK(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[3],V=$*$+J*J+Y*Y+B*B;if(V>0)V=1/Math.sqrt(V);return K[0]=$*V,K[1]=J*V,K[2]=Y*V,K[3]=B*V,K}function ZK(K,Q){return K[0]*Q[0]+K[1]*Q[1]+K[2]*Q[2]+K[3]*Q[3]}function HK(K,Q,$,J){var Y=Q[0],B=Q[1],V=Q[2],F=Q[3];return K[0]=Y+J*($[0]-Y),K[1]=B+J*($[1]-B),K[2]=V+J*($[2]-V),K[3]=F+J*($[3]-F),K}function PK(K,Q){return K[0]===Q[0]&&K[1]===Q[1]&&K[2]===Q[2]&&K[3]===Q[3]}function DK(K,Q){var $=K[0],J=K[1],Y=K[2],B=K[3],V=Q[0],F=Q[1],C=Q[2],O=Q[3];return Math.abs($-V)<=E*Math.max(1,Math.abs($),Math.abs(V))&&Math.abs(J-F)<=E*Math.max(1,Math.abs(J),Math.abs(F))&&Math.abs(Y-C)<=E*Math.max(1,Math.abs(Y),Math.abs(C))&&Math.abs(B-O)<=E*Math.max(1,Math.abs(B),Math.abs(O))}var YJ=function(){var K=$$();return function(Q,$,J,Y,B,V){var F,C;if(!$)$=4;if(!J)J=0;if(Y)C=Math.min(Y*$+J,Q.length);else C=Q.length;for(F=J;F<C;F+=$)K[0]=Q[F],K[1]=Q[F+1],K[2]=Q[F+2],K[3]=Q[F+3],B(K,K,V),Q[F]=K[0],Q[F+1]=K[1],Q[F+2]=K[2],Q[F+3]=K[3];return Q}}();function M0(){var K=new q(4);if(q!=Float32Array)K[0]=0,K[1]=0,K[2]=0;return K[3]=1,K}function Y$(K){return K[0]=0,K[1]=0,K[2]=0,K[3]=1,K}function WK(K,Q,$){$=$*0.5;var J=Math.sin($);return K[0]=J*Q[0],K[1]=J*Q[1],K[2]=J*Q[2],K[3]=Math.cos($),K}function B$(K,Q){var $=Math.acos(Q[3])*2,J=Math.sin($/2);if(J>E)K[0]=Q[0]/J,K[1]=Q[1]/J,K[2]=Q[2]/J;else K[0]=1,K[1]=0,K[2]=0;return $}function V$(K,Q){var $=RK(K,Q);return Math.acos(2*$*$-1)}function UK(K,Q,$){var J=Q[0],Y=Q[1],B=Q[2],V=Q[3],F=$[0],C=$[1],O=$[2],Z=$[3];return K[0]=J*Z+V*F+Y*O-B*C,K[1]=Y*Z+V*C+B*F-J*O,K[2]=B*Z+V*O+J*C-Y*F,K[3]=V*Z-J*F-Y*C-B*O,K}function F$(K,Q,$){$*=0.5;var J=Q[0],Y=Q[1],B=Q[2],V=Q[3],F=Math.sin($),C=Math.cos($);return K[0]=J*C+V*F,K[1]=Y*C+B*F,K[2]=B*C-Y*F,K[3]=V*C-J*F,K}function C$(K,Q,$){$*=0.5;var J=Q[0],Y=Q[1],B=Q[2],V=Q[3],F=Math.sin($),C=Math.cos($);return K[0]=J*C-B*F,K[1]=Y*C+V*F,K[2]=B*C+J*F,K[3]=V*C-Y*F,K}function O$(K,Q,$){$*=0.5;var J=Q[0],Y=Q[1],B=Q[2],V=Q[3],F=Math.sin($),C=Math.cos($);return K[0]=J*C+Y*F,K[1]=Y*C-J*F,K[2]=B*C+V*F,K[3]=V*C-B*F,K}function Z$(K,Q){var $=Q[0],J=Q[1],Y=Q[2];return K[0]=$,K[1]=J,K[2]=Y,K[3]=Math.sqrt(Math.abs(1-$*$-J*J-Y*Y)),K}function XK(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[3],V=Math.sqrt($*$+J*J+Y*Y),F=Math.exp(B),C=V>0?F*Math.sin(V)/V:0;return K[0]=$*C,K[1]=J*C,K[2]=Y*C,K[3]=F*Math.cos(V),K}function jK(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[3],V=Math.sqrt($*$+J*J+Y*Y),F=V>0?Math.atan2(V,B)/V:0;return K[0]=$*F,K[1]=J*F,K[2]=Y*F,K[3]=0.5*Math.log($*$+J*J+Y*Y+B*B),K}function H$(K,Q,$){return jK(K,Q),MK(K,K,$),XK(K,K),K}function t(K,Q,$,J){var Y=Q[0],B=Q[1],V=Q[2],F=Q[3],C=$[0],O=$[1],Z=$[2],H=$[3],W,D,X,U,P;if(D=Y*C+B*O+V*Z+F*H,D<0)D=-D,C=-C,O=-O,Z=-Z,H=-H;if(1-D>E)W=Math.acos(D),X=Math.sin(W),U=Math.sin((1-J)*W)/X,P=Math.sin(J*W)/X;else U=1-J,P=J;return K[0]=U*Y+P*C,K[1]=U*B+P*O,K[2]=U*V+P*Z,K[3]=U*F+P*H,K}function P$(K){var Q=i(),$=i(),J=i(),Y=Math.sqrt(1-Q),B=Math.sqrt(Q);return K[0]=Y*Math.sin(2*Math.PI*$),K[1]=Y*Math.cos(2*Math.PI*$),K[2]=B*Math.sin(2*Math.PI*J),K[3]=B*Math.cos(2*Math.PI*J),K}function D$(K,Q){var $=Q[0],J=Q[1],Y=Q[2],B=Q[3],V=$*$+J*J+Y*Y+B*B,F=V?1/V:0;return K[0]=-$*F,K[1]=-J*F,K[2]=-Y*F,K[3]=B*F,K}function W$(K,Q){return K[0]=-Q[0],K[1]=-Q[1],K[2]=-Q[2],K[3]=Q[3],K}function AK(K,Q){var $=Q[0]+Q[4]+Q[8],J;if($>0)J=Math.sqrt($+1),K[3]=0.5*J,J=0.5/J,K[0]=(Q[5]-Q[7])*J,K[1]=(Q[6]-Q[2])*J,K[2]=(Q[1]-Q[3])*J;else{var Y=0;if(Q[4]>Q[0])Y=1;if(Q[8]>Q[Y*3+Y])Y=2;var B=(Y+1)%3,V=(Y+2)%3;J=Math.sqrt(Q[Y*3+Y]-Q[B*3+B]-Q[V*3+V]+1),K[Y]=0.5*J,J=0.5/J,K[3]=(Q[B*3+V]-Q[V*3+B])*J,K[B]=(Q[B*3+Y]+Q[Y*3+B])*J,K[V]=(Q[V*3+Y]+Q[Y*3+V])*J}return K}function U$(K,Q,$,J){var Y=0.5*Math.PI/180;Q*=Y,$*=Y,J*=Y;var B=Math.sin(Q),V=Math.cos(Q),F=Math.sin($),C=Math.cos($),O=Math.sin(J),Z=Math.cos(J);return K[0]=B*C*Z-V*F*O,K[1]=V*F*Z+B*C*O,K[2]=V*C*O-B*F*Z,K[3]=V*C*Z+B*F*O,K}function X$(K){return"quat("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+")"}var j$=QK,A$=$K,M$=JK,R$=YK,N$=BK,G$=UK,MK=VK,RK=ZK,E$=HK,NK=FK,_$=NK,GK=CK,L$=GK,R0=OK,k$=PK,q$=DK,T$=function(){var K=u(),Q=o(1,0,0),$=o(0,1,0);return function(J,Y,B){var V=a(Y,B);if(V<-0.999999){if(b(K,Q,Y),A0(K)<0.000001)b(K,$,Y);return j0(K,K),WK(J,K,Math.PI),J}else if(V>0.999999)return J[0]=0,J[1]=0,J[2]=0,J[3]=1,J;else return b(K,Y,B),J[0]=K[0],J[1]=K[1],J[2]=K[2],J[3]=1+V,R0(J,J)}}(),S$=function(){var K=M0(),Q=M0();return function($,J,Y,B,V,F){return t(K,J,V,F),t(Q,Y,B,F),t($,K,Q,2*F*(1-F)),$}}(),h$=function(){var K=c0();return function(Q,$,J,Y){return K[0]=J[0],K[3]=J[1],K[6]=J[2],K[1]=Y[0],K[4]=Y[1],K[7]=Y[2],K[2]=-$[0],K[5]=-$[1],K[8]=-$[2],R0(Q,AK(Q,K))}}();var I$=Math.PI/90;class N0{matrix;constructor(){this.matrix=k.create()}static create(){return new N0}translate(K,Q,$){return k.translate(this.matrix,this.matrix,[K,Q,$]),this}rotateX(K){return k.rotateX(this.matrix,this.matrix,K),this}rotateY(K){return k.rotateY(this.matrix,this.matrix,K),this}rotateZ(K){return k.rotateZ(this.matrix,this.matrix,K),this}scale(K,Q,$){return k.scale(this.matrix,this.matrix,[K,Q,$]),this}perspective(K,Q,$,J){return k.perspective(this.matrix,K*I$,Q,$,J),this}ortho(K,Q,$,J,Y,B){return k.ortho(this.matrix,K,Q,$,J,Y,B),this}static aTemp=k.create();static bTemp=k.create();static combineMat4(K,Q,$,J=0.5){k.multiplyScalar(this.aTemp,Q,1-J),k.multiplyScalar(this.bTemp,$,J),k.add(K,this.aTemp,this.bTemp)}static tempQuat=e.create();static moveMatrix(K,Q,$,J,Y=null){const B=l.fromValues(-Q,$,J);if(Y)k.getRotation(this.tempQuat,Y),e.invert(this.tempQuat,this.tempQuat),l.transformQuat(B,B,this.tempQuat);k.translate(K,K,B)}getMatrix(){return this.matrix}}var f=N0;class G0{gl;uniforms;cameraMatrix=f.create().translate(0,0,-1).getMatrix();perspectiveMatrix=f.create().getMatrix();orthoMatrix=f.create().getMatrix();projectionMatrix=f.create().getMatrix();perspectiveLevel=1;constructor(K,Q){this.gl=K,this.uniforms=Q}configPerspectiveMatrix(K){this.perspectiveMatrix=f.create().perspective(45,K,0.1,1000).getMatrix(),this.updatePerspective()}configOrthoMatrix(K){this.orthoMatrix=f.create().ortho(-K,K,-1,1,-1000,1000).getMatrix(),this.updatePerspective()}camTiltMatrix=f.create().getMatrix();camTurnMatrix=f.create().getMatrix();camMatrix=k.create();refresh(){k.mul(this.camMatrix,this.camTiltMatrix,this.camTurnMatrix),k.mul(this.camMatrix,this.camMatrix,this.cameraMatrix);const K=this.uniforms.getUniformLocation(p0);if(K)this.gl.uniformMatrix4fv(K,!1,this.camMatrix)}orthoTemp=k.create();perspectiveTemp=k.create();updatePerspective(K){if(K!==void 0)this.perspectiveLevel=K;f.combineMat4(this.projectionMatrix,this.orthoMatrix,this.perspectiveMatrix,this.perspectiveLevel);const Q=this.uniforms.getUniformLocation(g0);if(Q)this.gl.uniformMatrix4fv(Q,!1,this.projectionMatrix);this.refresh()}moveCam(K,Q,$){f.moveMatrix(this.cameraMatrix,K,Q,$,this.camTurnMatrix),this.refresh()}turnCam(K){k.rotateY(this.camTurnMatrix,this.camTurnMatrix,K),this.refresh()}tilt(K){k.rotateX(this.camTiltMatrix,this.camTiltMatrix,K),this.refresh()}}class c extends p{texImgSrc;activated=!1;width;height;constructor(K){super();this.texImgSrc=K,this.width=K instanceof HTMLImageElement?K.naturalWidth:K instanceof VideoFrame?K.displayWidth:K.width,this.height=K instanceof HTMLImageElement?K.naturalHeight:K instanceof VideoFrame?K.displayHeight:K.width}static async loadImage(K){return new Promise((Q,$)=>{const J=new Image,Y=new c(J),B=()=>Q(Y),V=(F)=>$(F.error);J.addEventListener("error",V),J.addEventListener("load",B,{once:!0}),Y.addOnDestroy(()=>J.removeEventListener("load",B)),J.src=K})}static async loadVideo(K,Q){return new Promise(($,J)=>{const Y=document.createElement("video"),B=new c(Y);if(Y.loop=!0,Q!==void 0)Y.volume=Q;const V=()=>Y.play(),F=()=>$(B);Y.addEventListener("loadedmetadata",V),Y.addEventListener("playing",F,{once:!0}),Y.addEventListener("error",(C)=>J(C.error)),Y.src=K,B.addOnDestroy(()=>{Y.pause(),Y.removeEventListener("playing",F),Y.removeEventListener("loadmetadata",V)})})}static async loadWebcam(K){return new Promise((Q,$)=>{const J=document.createElement("video"),Y=new c(J);J.loop=!0;const B=()=>J.play(),V=()=>Q(Y);J.addEventListener("loadedmetadata",B),J.addEventListener("playing",V,{once:!0}),J.addEventListener("error",(C)=>$(C.error));let F=!1;navigator.mediaDevices.getUserMedia({video:{deviceId:K}}).then((C)=>{if(!F)J.srcObject=C,Y.addOnDestroy(()=>C.getTracks().forEach((O)=>O.stop()))}),Y.addOnDestroy(()=>{F=!0,J.pause(),J.removeEventListener("playing",V),J.removeEventListener("loadmetadata",B)})})}}class E0 extends p{constructor(){super(...arguments)}images={};hasImageId(K){return!!this.images[K]}getMedia(K){return this.images[K]}async drawImage(K,Q){const $=new OffscreenCanvas(1,1);Q($.getContext("2d"));const J=new c($);return this.images[K]=this.own(J),J}async loadCanvas(K,Q){const $=new c(Q);return Q.getContext("2d"),this.images[K]=this.own($),$}async loadImage(K,Q){const $=await c.loadImage(Q);return this.images[K]=this.own($),$}async loadVideo(K,Q,$){const J=await c.loadVideo(Q,$);return this.images[K]=this.own(J),J}async loadWebCam(K,Q){const $=await c.loadWebcam(Q);return this.images[K]=this.own($),$}}function EK(K,Q=($)=>$.key){var $=[];return _0(K,"",!0,(J)=>$.push(J),Q),$.join("")}var _0=function(K,Q,$,J,Y){if(K){J(`${Q}${$?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${Y(K)}\n`);const B=Q+($?"    ":"\u2502   ");if(K.left)_0(K.left,B,!1,J,Y);if(K.right)_0(K.right,B,!0,J,Y)}};function K0(K){if(K===null)return!0;var Q=Q0(K.left),$=Q0(K.right);if(Math.abs(Q-$)<=1&&K0(K.left)&&K0(K.right))return!0;return!1}var Q0=function(K){return K?1+Math.max(Q0(K.left),Q0(K.right)):0};function $0(K,Q,$,J,Y){const B=Y-J;if(B>0){const V=J+Math.floor(B/2),F=Q[V],C=$[V],O={key:F,data:C,parent:K};return O.left=$0(O,Q,$,J,V),O.right=$0(O,Q,$,V+1,Y),O}return null}function J0(K){if(K===null)return 0;const Q=J0(K.left),$=J0(K.right);return K.balanceFactor=Q-$,Math.max(Q,$)+1}function Y0(K,Q,$,J,Y){if($>=J)return;const B=K[$+J>>1];let V=$-1,F=J+1;while(!0){do V++;while(Y(K[V],B)<0);do F--;while(Y(K[F],B)>0);if(V>=F)break;let C=K[V];K[V]=K[F],K[F]=C,C=Q[V],Q[V]=Q[F],Q[F]=C}Y0(K,Q,$,F,Y),Y0(K,Q,F+1,J,Y)}var w$=function(K,Q){return K>Q?1:K<Q?-1:0},B0=function(K){var Q=K.right;if(K.right=Q.left,Q.left)Q.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.left=K,K.balanceFactor+=1,Q.balanceFactor<0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor+=1,K.balanceFactor>0)Q.balanceFactor+=K.balanceFactor;return Q},V0=function(K){var Q=K.left;if(K.left=Q.right,K.left)K.left.parent=K;if(Q.parent=K.parent,Q.parent)if(Q.parent.left===K)Q.parent.left=Q;else Q.parent.right=Q;if(K.parent=Q,Q.right=K,K.balanceFactor-=1,Q.balanceFactor>0)K.balanceFactor-=Q.balanceFactor;if(Q.balanceFactor-=1,K.balanceFactor<0)Q.balanceFactor+=K.balanceFactor;return Q};class d{constructor(K,Q=!1){this._comparator=K||w$,this._root=null,this._size=0,this._noDuplicates=!!Q}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(K){if(this._root){var Q=this._root,$=this._comparator;while(Q){var J=$(K,Q.key);if(J===0)return!0;else if(J<0)Q=Q.left;else Q=Q.right}}return!1}next(K){var Q=K;if(Q)if(Q.right){Q=Q.right;while(Q.left)Q=Q.left}else{Q=K.parent;while(Q&&Q.right===K)K=Q,Q=Q.parent}return Q}prev(K){var Q=K;if(Q)if(Q.left){Q=Q.left;while(Q.right)Q=Q.right}else{Q=K.parent;while(Q&&Q.left===K)K=Q,Q=Q.parent}return Q}forEach(K){var Q=this._root,$=[],J=!1,Y=0;while(!J)if(Q)$.push(Q),Q=Q.left;else if($.length>0)Q=$.pop(),K(Q,Y++),Q=Q.right;else J=!0;return this}range(K,Q,$,J){const Y=[],B=this._comparator;let V=this._root,F;while(Y.length!==0||V)if(V)Y.push(V),V=V.left;else{if(V=Y.pop(),F=B(V.key,Q),F>0)break;else if(B(V.key,K)>=0){if($.call(J,V))return this}V=V.right}return this}keys(){var K=this._root,Q=[],$=[],J=!1;while(!J)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.key),K=K.right;else J=!0;return $}values(){var K=this._root,Q=[],$=[],J=!1;while(!J)if(K)Q.push(K),K=K.left;else if(Q.length>0)K=Q.pop(),$.push(K.data),K=K.right;else J=!0;return $}at(K){var Q=this._root,$=[],J=!1,Y=0;while(!J)if(Q)$.push(Q),Q=Q.left;else if($.length>0){if(Q=$.pop(),Y===K)return Q;Y++,Q=Q.right}else J=!0;return null}minNode(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K}maxNode(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K}min(){var K=this._root;if(!K)return null;while(K.left)K=K.left;return K.key}max(){var K=this._root;if(!K)return null;while(K.right)K=K.right;return K.key}isEmpty(){return!this._root}pop(){var K=this._root,Q=null;if(K){while(K.left)K=K.left;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}popMax(){var K=this._root,Q=null;if(K){while(K.right)K=K.right;Q={key:K.key,data:K.data},this.remove(K.key)}return Q}find(K){var Q=this._root,$=Q,J,Y=this._comparator;while($)if(J=Y(K,$.key),J===0)return $;else if(J<0)$=$.left;else $=$.right;return null}insert(K,Q){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:K,data:Q},this._size++,this._root;var $=this._comparator,J=this._root,Y=null,B=0;if(this._noDuplicates)while(J)if(B=$(K,J.key),Y=J,B===0)return null;else if(B<0)J=J.left;else J=J.right;else while(J)if(B=$(K,J.key),Y=J,B<=0)J=J.left;else J=J.right;var V={left:null,right:null,balanceFactor:0,parent:Y,key:K,data:Q},F;if(B<=0)Y.left=V;else Y.right=V;while(Y){if(B=$(Y.key,K),B<0)Y.balanceFactor-=1;else Y.balanceFactor+=1;if(Y.balanceFactor===0)break;else if(Y.balanceFactor<-1){if(Y.right.balanceFactor===1)V0(Y.right);if(F=B0(Y),Y===this._root)this._root=F;break}else if(Y.balanceFactor>1){if(Y.left.balanceFactor===-1)B0(Y.left);if(F=V0(Y),Y===this._root)this._root=F;break}Y=Y.parent}return this._size++,V}remove(K){if(!this._root)return null;var Q=this._root,$=this._comparator,J=0;while(Q)if(J=$(K,Q.key),J===0)break;else if(J<0)Q=Q.left;else Q=Q.right;if(!Q)return null;var Y=Q.key,B,V;if(Q.left){B=Q.left;while(B.left||B.right){while(B.right)B=B.right;if(Q.key=B.key,Q.data=B.data,B.left)Q=B,B=B.left}Q.key=B.key,Q.data=B.data,Q=B}if(Q.right){V=Q.right;while(V.left||V.right){while(V.left)V=V.left;if(Q.key=V.key,Q.data=V.data,V.right)Q=V,V=V.right}Q.key=V.key,Q.data=V.data,Q=V}var F=Q.parent,C=Q,O;while(F){if(F.left===C)F.balanceFactor-=1;else F.balanceFactor+=1;if(F.balanceFactor<-1){if(F.right.balanceFactor===1)V0(F.right);if(O=B0(F),F===this._root)this._root=O;F=O}else if(F.balanceFactor>1){if(F.left.balanceFactor===-1)B0(F.left);if(O=V0(F),F===this._root)this._root=O;F=O}if(F.balanceFactor===-1||F.balanceFactor===1)break;C=F,F=F.parent}if(Q.parent)if(Q.parent.left===Q)Q.parent.left=null;else Q.parent.right=null;if(Q===this._root)this._root=null;return this._size--,Y}load(K=[],Q=[],$){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const J=K.length;if($)Y0(K,Q,0,J-1,this._comparator);return this._root=$0(null,K,Q,0,J),J0(this._root),this._size=J,this}isBalanced(){return K0(this._root)}toString(K){return EK(this._root,K)}}d.default=d;function F0({size:K,slotNumber:Q}){const[$,J]=K,Y=z/$*(z/J);return Math.floor(Q/Y)}function L0(K){const{size:Q,slotNumber:$}=K,[J,Y]=Q,B=z/J,V=z/Y,F=$%B*J,C=Math.floor($/B)%V*Y;return{x:F,y:C,size:Q,textureIndex:F0(K)}}var z=4096,m=16;class x{size;slotNumber;parent;sibbling;constructor(K,Q,$){this.size=K,this.slotNumber=Q,this.parent=$,this.sibbling=void 0}getTag(){return x.getTag(this)}static getTag(K){return`${K.size[0]}x${K.size[1]}-#${K.slotNumber}`}getTextureIndex(){return F0(this)}getTexturePosition(){return L0(this)}static positionToTextureSlot(K,Q){const{x:$,y:J,size:Y,textureIndex:B}=K,[V,F]=Y,C=z/V,Z=z/V*(z/F)*B+J/F*C+$/V;return new x(Y,Z,Q)}canSplitHorizontally(K=m){const[,Q]=this.size;return Q>K}canSplitVertically(K=m){const[Q]=this.size;return Q>K}splitHorizontally(){const{x:K,y:Q,size:$,textureIndex:J}=this.getTexturePosition(),[Y,B]=$;if(Y<=m)throw new Error(`Cannot split texture slot of size ${Y} horizontally`);const V=Y/2,F=x.positionToTextureSlot({x:K,y:Q,size:[V,B],textureIndex:J},this),C=x.positionToTextureSlot({x:K+V,y:Q,size:[V,B],textureIndex:J},this);return F.sibbling=C,C.sibbling=F,[F,C]}splitVertically(){const{x:K,y:Q,size:$,textureIndex:J}=this.getTexturePosition(),[Y,B]=$;if(Y<=m)throw new Error(`Cannot split texture slot of size ${Y} vertically`);const V=B/2,F=x.positionToTextureSlot({x:K,y:Q,size:[Y,V],textureIndex:J},this),C=x.positionToTextureSlot({x:K,y:Q+V,size:[Y,V],textureIndex:J},this);return F.sibbling=C,C.sibbling=F,[F,C]}}function C0(K){return Math.max(m,Math.pow(2,Math.ceil(Math.log(K)/Math.log(2))))}function _K(K,Q,$){if($<1)throw new Error("Invalid count");const J=C0(K),Y=C0(Q),B=new Map;let V=m;for(let F=1;F<=$;F++){V=C0(J*F);const C=C0(Y*Math.ceil($/F));B.set(V,C)}for(let F=V;F<=z;F*=2)if(!B.has(F))B.set(F,Y);return B}class k0{textureSlots=new d((K,Q)=>{const $=K.size[0]*K.size[1]-Q.size[0]*Q.size[1];if($!==0)return $;return K.slotNumber-Q.slotNumber},!1);allocatedTextures={};minTextureSize;constructor({numTextureSheets:K=16,minTextureWidth:Q=m,minTextureHeight:$=m}={}){this.minTextureSize=[Q,$];for(let J=0;J<K;J++)this.textureSlots.insert(new x([z,z],J))}findSlot(K){for(let Q=0;Q<this.textureSlots.size;Q++){const J=this.textureSlots.at(Q).key,[Y,B]=J.size;if(K.get(Y)<=B)return J}return null}calculateRatio(K,Q){return Math.max(K/Q,Q/K)}bestFit(K,Q){const[$,J]=Q.size;let Y=z;return K.forEach((B,V)=>{if(V<=$&&B<=J){const F=V*B,C=K.get(Y)*Y;if(F<C)Y=V;else if(F===C){if(this.calculateRatio(V,B)<this.calculateRatio(Y,K.get(Y)))Y=V}}}),[Y,K.get(Y)]}isSlotUsed(K){return!!this.allocatedTextures[x.getTag(K)]}allocate(K,Q,$=1){const{size:J,slotNumber:Y}=this.allocateHelper(K,Q,$);return{size:J,slotNumber:Y}}deallocate(K){if(!this.isSlotUsed(K))throw new Error("Slot is not allocated");const Q=this.allocatedTextures[x.getTag(K)];this.deallocateHelper(Q)}allocateHelper(K,Q,$=1){const J=_K(K,Q,$),Y=this.findSlot(J);if(!Y)throw new Error(`Could not find a slot for texture to fit ${$} sprites of size ${K}x${Q}`);this.textureSlots.remove(Y);const[B,V]=this.bestFit(J,Y);return this.fitSlot(Y,B,V)}deallocateHelper(K){if(K.parent&&K.sibbling&&!this.isSlotUsed(K.sibbling)){const Q=K.sibbling;if(this.textureSlots.remove(Q),f0&&this.textureSlots.find(K))throw new Error("Slot is not expected to be in the tree");const $=K.parent;this.deallocateHelper($);return}this.textureSlots.insert(K),delete this.allocatedTextures[K.getTag()]}trySplitHorizontally(K,Q,$){if(K.canSplitHorizontally(this.minTextureSize[1])){const[J,Y]=K.splitHorizontally();if(J.size[0]>=Q)return this.textureSlots.insert(Y),this.fitSlot(J,Q,$)}return null}trySplitVertically(K,Q,$){if(K.canSplitVertically(this.minTextureSize[0])){const[J,Y]=K.splitVertically();if(J.size[1]>=$)return this.textureSlots.insert(Y),this.fitSlot(J,Q,$)}return null}fitSlot(K,Q,$){if(this.allocatedTextures[K.getTag()]=K,K.size[0]>K.size[1]){const J=this.trySplitHorizontally(K,Q,$)??this.trySplitVertically(K,Q,$);if(J)return J}else{const J=this.trySplitVertically(K,Q,$)??this.trySplitHorizontally(K,Q,$);if(J)return J}return K}}var g$=function(K){if(!p$)return K;return new Proxy(K,{get($,J){const Y=$,B=Y[J];if(typeof B==="function")return(...F)=>{const C=B.apply(Y,F);return console.log(`gl.${String(J)}(`,F,") = ",C),C};else return console.log(`gl.${String(J)} = `,B),B}})},v$={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},p$=!1;class q0 extends p{gl;programs;attributeBuffers;uniforms;canvas;textureManager;textureAllocator;imageManager;camera;constructor(K,Q){super();this.gl=g$(K.getContext("webgl2",{...v$,...Q})),this.canvas=K,this.programs=this.own(new H0(this.gl)),this.uniforms=this.own(new W0(this.gl,this.programs)),this.attributeBuffers=this.own(new D0(this.gl,this.programs)),this.textureManager=new U0(this.gl),this.textureAllocator=new k0,this.imageManager=new E0,this.camera=new G0(this.gl,this.uniforms),window.addEventListener("resize",this.checkCanvasSize.bind(this)),console.log(this.gl.getParameter(A.MAX_VERTEX_ATTRIBS))}checkCanvasSize(){this.canvas.width=this.canvas.offsetWidth*2,this.canvas.height=this.canvas.offsetHeight*2,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);const K=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;this.camera.configOrthoMatrix(K),this.camera.configPerspectiveMatrix(K)}async initialize(){const Q={AUTHOR:"Jack le hamster"};this.programs.addProgram("main",X0(y0,Q),X0(x0,Q)),this.programs.useProgram("main"),this.gl.enable(A.DEPTH_TEST),this.gl.depthFunc(A.LESS),this.gl.enable(A.BLEND),this.gl.blendFunc(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);{const $=I0;this.attributeBuffers.createBuffer($);const J=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(A.ELEMENT_ARRAY_BUFFER,J),this.attributeBuffers.bufferData(A.ELEMENT_ARRAY_BUFFER,$,Uint16Array.from([0,1,2,2,3,0]),0,A.STATIC_DRAW)}{const $=h0;this.attributeBuffers.createBuffer($);const J=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,J),this.gl.vertexAttribPointer(J.location,4,A.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(J.location),this.attributeBuffers.bufferData(A.ARRAY_BUFFER,$,Float32Array.from([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),0,A.STATIC_DRAW)}{const $=w0;this.attributeBuffers.createBuffer($);const J=this.attributeBuffers.getAttributeBuffer($);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,J);for(let Y=0;Y<4;Y++){const B=J.location+Y;this.gl.vertexAttribPointer(B,4,A.FLOAT,!1,16*Float32Array.BYTES_PER_ELEMENT,Y*4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(B),this.gl.vertexAttribDivisor(B,1)}this.attributeBuffers.bufferData(A.ARRAY_BUFFER,$,Float32Array.from([...f.create().translate(0,0,0).getMatrix(),...f.create().translate(-1,0,1).rotateY(Math.PI/2).getMatrix(),...f.create().translate(1,0,1).rotateY(-Math.PI/2).getMatrix(),...f.create().translate(0,-1,1).rotateX(-Math.PI/2).getMatrix()]),0,A.DYNAMIC_DRAW)}await this.loadLogoTexture(),this.checkCanvasSize(),this.camera.refresh()}async loadLogoTexture(){await this.imageManager.drawImage("logo",(V)=>{const{canvas:F}=V;F.width=2048,F.height=2048,V.imageSmoothingEnabled=!0,V.fillStyle="#ddd",V.lineWidth=F.width/50,V.fillRect(0,0,F.width,F.height),V.strokeStyle="black",V.fillStyle="gold",V.beginPath(),V.arc(F.width/2,F.height/2,F.width/2*0.8,0,2*Math.PI),V.fill(),V.stroke(),V.beginPath(),V.arc(F.width/2,F.height/2,F.width/2*0.5,0,Math.PI),V.stroke(),V.beginPath(),V.arc(F.width/3,F.height/3,F.width/2*0.1,0,Math.PI,!0),V.stroke(),V.beginPath(),V.arc(F.width/3*2,F.height/3,F.width/2*0.1,0,Math.PI*2,!0),V.stroke()});const $=this.textureAllocator.allocate(512,512),J=L0($),B=`TEXTURE${F0($)}`;this.textureManager.assignImageToTexture(this.imageManager.getMedia("logo"),B,[0,0,2048,2048],[J.x,J.y,...J.size]),this.textureManager.generateMipMap(B);{const V=v0;this.attributeBuffers.createBuffer(V);const F=this.attributeBuffers.getAttributeBuffer(V);this.attributeBuffers.bindBuffer(A.ARRAY_BUFFER,F);const C=F.location;this.gl.vertexAttribPointer(C,3,A.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(C),this.gl.vertexAttribDivisor(C,1),this.attributeBuffers.bufferData(A.ARRAY_BUFFER,V,Float32Array.from([...$.size,$.slotNumber,...$.size,$.slotNumber,...$.size,$.slotNumber,...$.size,$.slotNumber]),0,A.DYNAMIC_DRAW)}}drawArrays(K){this.gl.drawArrays(A.TRIANGLES,0,K)}drawElementsInstanced(K,Q){this.gl.drawElementsInstanced(A.TRIANGLES,K,A.UNSIGNED_SHORT,0,Q)}refresh(){this.gl.clearDepth(1),this.gl.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT);const K=6,Q=4;this.drawElementsInstanced(K,Q)}bindVertexArray(){return this.own(new P0(this.gl))}}async function eJ(){console.log("Hello World!")}function uJ(K){K.style.border="2px solid silver",K.style.cursor="grab",K.addEventListener("mouseenter",()=>{K.style.borderColor="black"}),K.addEventListener("mouseleave",()=>{K.style.borderColor="silver"});const Q=new q0(K);Q.initialize();const $={};document.addEventListener("keydown",(Y)=>{$[Y.code]=!0,console.log($)}),document.addEventListener("keyup",(Y)=>{$[Y.code]=!1});function J(){Q.gl.enable(Q.gl.DEPTH_TEST);const Y=0.25,B=0.05;if($.KeyW)Q.camera.moveCam(0,0,Y);if($.KeyS)Q.camera.moveCam(0,0,-Y);if($.ArrowUp&&!$.ShiftRight)Q.camera.moveCam(0,-Y,0);if($.ArrowDown&&!$.ShiftRight)Q.camera.moveCam(0,Y,0);if($.KeyA||$.ArrowLeft&&!$.ShiftRight)Q.camera.moveCam(-Y,0,0);if($.KeyD||$.ArrowRight&&!$.ShiftRight)Q.camera.moveCam(Y,0,0);if($.KeyQ||$.ArrowLeft&&$.ShiftRight)Q.camera.turnCam(-B);if($.KeyE||$.ArrowRight&&$.ShiftRight)Q.camera.turnCam(B);if($.ArrowUp&&$.ShiftRight)Q.camera.tilt(-B);if($.ArrowDown&&$.ShiftRight)Q.camera.tilt(B);Q.refresh(),requestAnimationFrame(J)}return J(),Q}export{uJ as testCanvas,eJ as hello};

//# debugId=8F820E0A122E84D464756e2164756e21
